
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>geotecha.consolidation.smear_zones &#8212; geotecha 0.2.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../_static/logo.png" border="0" alt="py4sci"/></a>
</div>



      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for geotecha.consolidation.smear_zones</h1><div class="highlight"><pre>
<span></span><span class="c1"># geotecha - A software suite for geotechncial engineering</span>
<span class="c1"># Copyright (C) 2018  Rohan T. Walker (rtrwalker@gmail.com)</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program.  If not, see http://www.gnu.org/licenses/gpl.html.</span>

<span class="sd">&quot;&quot;&quot;Smear zones associated with vertical drain installation.</span>

<span class="sd">Smear zone permeability distributions etc.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="c1">#import cmath</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">log</span><span class="p">,</span> <span class="n">sqrt</span>
<span class="kn">import</span> <span class="nn">scipy.special</span> <span class="k">as</span> <span class="nn">special</span>

<div class="viewcode-block" id="mu_ideal"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.mu_ideal">[docs]</a><span class="k">def</span> <span class="nf">mu_ideal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Smear zone permeability/geometry parameter for ideal drain (no smear)</span>

<span class="sd">    mu parameter in equal strain radial consolidation equations e.g.</span>
<span class="sd">    u = u0 * exp(-8*Th/mu)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : float or ndarray of float</span>
<span class="sd">        Ratio of drain influence radius to drain radius (re/rw).</span>
<span class="sd">    args : anything</span>
<span class="sd">        `args` does not contribute to any calculations it is merely so you</span>
<span class="sd">        can have other arguments such as s and kappa which are used in other</span>
<span class="sd">        smear zone formulations.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mu : float</span>
<span class="sd">        Smear zone permeability/geometry parameter.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The :math:`\\mu` parameter is given by:</span>

<span class="sd">    .. math:: \\mu=\\frac{n^2}{\\left({n^2-1}\\right)}</span>
<span class="sd">              \\left({\\ln\\left({n}\\right)-\\frac{3}{4}}\\right)+</span>
<span class="sd">              \\frac{1}{\\left({n^2-1}\\right)}\\left({1-\\frac{1}{4n^2}}</span>
<span class="sd">              \\right)</span>

<span class="sd">    where:</span>

<span class="sd">    .. math:: n = \\frac{r_e}{r_w}</span>

<span class="sd">    :math:`r_w` is the drain radius, :math:`r_e` is the drain influence radius</span>


<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Hansbo, S. 1981. &quot;Consolidation of Fine-Grained Soils by</span>
<span class="sd">           Prefabricated Drains&quot;. In 10th ICSMFE, 3:677-82.</span>
<span class="sd">           Rotterdam-Boston: A.A. Balkema.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n must be greater than 1. You have n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">n</span><span class="p">)])))</span>

    <span class="n">term1</span> <span class="o">=</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.75</span><span class="p">)</span>
    <span class="n">term2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span>
    <span class="k">return</span> <span class="n">mu</span></div>


<div class="viewcode-block" id="mu_constant"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.mu_constant">[docs]</a><span class="k">def</span> <span class="nf">mu_constant</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Smear zone parameter for smear zone with constant permeability</span>


<span class="sd">    mu parameter in equal strain radial consolidation equations e.g.</span>
<span class="sd">    u = u0 * exp(-8*Th/mu)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : float or ndarray of float</span>
<span class="sd">        Ratio of drain influence radius  to drain radius (re/rw).</span>
<span class="sd">    s : float or ndarray of float</span>
<span class="sd">        Ratio of smear zone radius to  drain radius (rs/rw)</span>
<span class="sd">    kap : float or ndarray of float.</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to smear zone</span>
<span class="sd">        horizontal permeanility (kh / ks).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mu : float</span>
<span class="sd">        smear zone permeability/geometry parameter</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The :math:`\\mu` parameter is given by:</span>

<span class="sd">    .. math:: \\mu=\\frac{n^2}{\\left({n^2-1}\\right)}</span>
<span class="sd">          \\left({\\ln\\left({\\frac{n}{s}}\\right)</span>
<span class="sd">          +\\kappa\\ln\\left({s}\\right)</span>
<span class="sd">          -\\frac{3}{4}}\\right)+</span>
<span class="sd">          \\frac{s^2}{\\left({n^2-1}\\right)}\\left({1-\\frac{s^2}{4n^2}}</span>
<span class="sd">          \\right)</span>
<span class="sd">          +\\frac{\\kappa}{\\left({n^2-1}\\right)}\\left({\\frac{s^4-1}{4n^2}}</span>
<span class="sd">          -s^2+1</span>
<span class="sd">          \\right)</span>

<span class="sd">    where:</span>

<span class="sd">    .. math:: n = \\frac{r_e}{r_w}</span>

<span class="sd">    .. math:: s = \\frac{r_s}{r_w}</span>

<span class="sd">    .. math:: \\kappa = \\frac{k_h}{k_s}</span>

<span class="sd">    :math:`r_w` is the drain radius, :math:`r_e` is the drain influence radius,</span>
<span class="sd">    :math:`r_s` is the smear zone radius, :math:`k_h` is the undisturbed</span>
<span class="sd">    horizontal permeability, :math:`k_s` is the smear zone horizontal</span>
<span class="sd">    permeability.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Hansbo, S. 1981. &#39;Consolidation of Fine-Grained Soils by</span>
<span class="sd">           Prefabricated Drains&#39;. In 10th ICSMFE, 3:677-82.</span>
<span class="sd">           Rotterdam-Boston: A.A. Balkema.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n must be greater than 1. You have n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">n</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">s</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be greater than 1. You have s = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">kap</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kap must be greater than 0. You have kap = &#39;</span>
                         <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span>
                                                <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">s</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be less than n. You have s = &#39;</span>
                         <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> and n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                             <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)]),</span>
                             <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">n</span><span class="p">)])))</span>



    <span class="n">term1</span> <span class="o">=</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="n">kap</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.75</span><span class="p">)</span>
    <span class="n">term2</span> <span class="o">=</span> <span class="n">s</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">term3</span> <span class="o">=</span> <span class="n">kap</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">s</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">s</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span> <span class="o">+</span> <span class="n">term3</span>
    <span class="k">return</span> <span class="n">mu</span></div>

<span class="k">def</span> <span class="nf">_sx</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Value of s=r/rw marking the start of overlapping linear smear zones</span>

<span class="sd">    `s` is usually larger than `n` when considering overlapping smear zones</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : float or ndarray of float</span>
<span class="sd">        Ratio of drain influence radius  to drain radius (re/rw).</span>
<span class="sd">    s : float or ndarray of float</span>
<span class="sd">        Ratio of smear zone radius to  drain radius (rs/rw).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sx : float or ndarray of float</span>
<span class="sd">        Value of s=r/rw marking the start of the overlapping zone</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    .. math:: \\kappa_X= 1+\\frac{\\kappa-1}{s-1}\\left({s_X-1}\\right)</span>

<span class="sd">    .. math:: s_X = 2n-s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    mu_overlapping_linear : uses _sx</span>
<span class="sd">    _kapx : used in mu_overlapping_linear</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">sx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">s</span>
    <span class="k">return</span> <span class="n">sx</span>


<span class="k">def</span> <span class="nf">_kapx</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Value of kap=kh/ks for overlap part of intersecting linear smear zones</span>

<span class="sd">    Assumes `s` is greater than `n`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : float or ndarray of float</span>
<span class="sd">        Ratio of drain influence radius  to drain radius (re/rw).</span>
<span class="sd">    s : float or ndarray of float</span>
<span class="sd">        Ratio of smear zone radius to  drain radius (rs/rw)</span>
<span class="sd">    kap : float or ndarray of float.</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to smear zone</span>
<span class="sd">        horizontal permeanility (kh / ks).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    kapx : float</span>
<span class="sd">        Value of kap=kh/ks for overlap part of intersecting linear smear zones</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    .. math:: \\kappa_X= 1+\\frac{\\kappa-1}{s-1}\\left({s_X-1}\\right)</span>

<span class="sd">    .. math:: s_X = 2n-s</span>


<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    mu_overlapping_linear : uses _kapx</span>
<span class="sd">    _sx : used in mu_overlapping_linear</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sx</span> <span class="o">=</span> <span class="n">_sx</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">kapx</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">kap</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">sx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kapx</span>


<div class="viewcode-block" id="mu_overlapping_linear"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.mu_overlapping_linear">[docs]</a><span class="k">def</span> <span class="nf">mu_overlapping_linear</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">    Smear zone parameter for smear zone with overlapping linear permeability</span>


<span class="sd">    mu parameter in equal strain radial consolidation equations e.g.</span>
<span class="sd">    u = u0 * exp(-8*Th/mu)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : float or ndarray of float</span>
<span class="sd">        Ratio of drain influence radius  to drain radius (re/rw).</span>
<span class="sd">    s : float or ndarray of float</span>
<span class="sd">        Ratio of smear zone radius to  drain radius (rs/rw).</span>
<span class="sd">    kap : float or ndarray of float</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to permeability at</span>
<span class="sd">        the drain-soil interface (kh / ks).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mu : float</span>
<span class="sd">        Smear zone permeability/geometry parameter.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The smear zone parameter :math:`\\mu` is given by:</span>

<span class="sd">    .. math::</span>

<span class="sd">          \\mu_X =</span>
<span class="sd">            \\left\\{\\begin{array}{lr}</span>
<span class="sd">                \\mu_L\\left({n,s,\\kappa}\\right) &amp; n\\geq s \\\\</span>
<span class="sd">                \\frac{\\kappa}{\\kappa_X}\\mu_L</span>
<span class="sd">                    \\left({n, s_X,\\kappa_x}\\right)</span>
<span class="sd">                    &amp; \\frac{s+1}{2}&lt;n&lt;s \\\\</span>
<span class="sd">                \\frac{\\kappa}{\\kappa_X}\\mu_I</span>
<span class="sd">                    \\left({n}\\right) &amp; n\\leq \\frac{s+1}{2}</span>
<span class="sd">             \\end{array}\\right.</span>


<span class="sd">    where :math:`\\mu_L` is the :math:`\\mu` parameter for non_overlapping</span>
<span class="sd">    smear zones with linear permeability, :math:`\\mu_I` is the :math:`\\mu`</span>
<span class="sd">    parameter for no smear zone, and:</span>

<span class="sd">    .. math:: \\kappa_X= 1+\\frac{\\kappa-1}{s-1}\\left({s_X-1}\\right)</span>

<span class="sd">    .. math:: s_X = 2n-s</span>

<span class="sd">    and:</span>

<span class="sd">    .. math:: n = \\frac{r_e}{r_w}</span>

<span class="sd">    .. math:: s = \\frac{r_s}{r_w}</span>

<span class="sd">    .. math:: \\kappa = \\frac{k_h}{k_s}</span>

<span class="sd">    :math:`r_w` is the drain radius, :math:`r_e` is the drain influence radius,</span>
<span class="sd">    :math:`r_s` is the smear zone radius, :math:`k_h` is the undisturbed</span>
<span class="sd">    horizontal permeability, :math:`k_s` is the smear zone horizontal</span>
<span class="sd">    permeability</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    mu_linear : :math:`\\mu` for non-overlapping smear zones</span>

<span class="sd">    mu_ideal :  :math:`\\mu` for ideal drain with no smear zone</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Walker, R., and B. Indraratna. 2007. &#39;Vertical Drain Consolidation</span>
<span class="sd">           with Overlapping Smear Zones&#39;. Geotechnique 57 (5): 463-67.</span>
<span class="sd">           doi:10.1680/geot.2007.57.5.463.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">mu_intersecting</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;mu for intersecting smear zones that do not completely overlap&quot;&quot;&quot;</span>
        <span class="n">sx</span> <span class="o">=</span> <span class="n">_sx</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="n">kapx</span> <span class="o">=</span> <span class="n">_kapx</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">)</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_linear</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">kapx</span><span class="p">)</span> <span class="o">*</span> <span class="n">kap</span> <span class="o">/</span> <span class="n">kapx</span>
        <span class="k">return</span> <span class="n">mu</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n must be greater than 1. You have n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">n</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">s</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be greater than 1. You have s = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">kap</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kap must be greater than 0. You have kap = &#39;</span>
                         <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span>
                                                <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)])))</span>

    <span class="n">is_array</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">]])</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>


    <span class="k">if</span> <span class="nb">len</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">kap</span><span class="o">.</span><span class="n">shape</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n, s, and kap must have the same shape.  You have &#39;</span>
                         <span class="s1">&#39;lengths for n, s, kap of </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                             <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">)))</span>


    <span class="n">ideal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kap</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">normal</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="n">s</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">ideal</span><span class="p">)</span>
    <span class="n">all_disturbed</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">s</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">ideal</span><span class="p">)</span>
    <span class="n">intersecting</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">ideal</span> <span class="o">|</span> <span class="n">normal</span> <span class="o">|</span> <span class="n">all_disturbed</span><span class="p">)</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">mu</span><span class="p">[</span><span class="n">ideal</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu_ideal</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">ideal</span><span class="p">])</span>
    <span class="n">mu</span><span class="p">[</span><span class="n">normal</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu_linear</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">normal</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">normal</span><span class="p">],</span> <span class="n">kap</span><span class="p">[</span><span class="n">normal</span><span class="p">])</span>
    <span class="n">mu</span><span class="p">[</span><span class="n">all_disturbed</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap</span><span class="p">[</span><span class="n">all_disturbed</span><span class="p">]</span> <span class="o">*</span> <span class="n">mu_ideal</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">all_disturbed</span><span class="p">])</span>
    <span class="n">mu</span><span class="p">[</span><span class="n">intersecting</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu_intersecting</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">intersecting</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">intersecting</span><span class="p">],</span>
                                       <span class="n">kap</span><span class="p">[</span><span class="n">intersecting</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">is_array</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mu</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="mu_linear"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.mu_linear">[docs]</a><span class="k">def</span> <span class="nf">mu_linear</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Smear zone parameter for smear zone linear variation of permeability</span>

<span class="sd">    mu parameter in equal strain radial consolidation equations e.g.</span>
<span class="sd">    u = u0 * exp(-8*Th/mu)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : float or ndarray of float</span>
<span class="sd">        Ratio of drain influence radius  to drain radius (re/rw).</span>
<span class="sd">    s : float or ndarray of float</span>
<span class="sd">        Ratio of smear zone radius to  drain radius (rs/rw).</span>
<span class="sd">    kap : float or ndarray of float</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to permeability at</span>
<span class="sd">        the drain-soil interface (kh / ks).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mu : float</span>
<span class="sd">        Smear zone permeability/geometry parameter.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    For :math:`s\\neq\\kappa`, :math:`\\mu` is given by:</span>

<span class="sd">    .. math:: \\mu=\\frac{n^2}{\\left({n^2-1}\\right)}</span>
<span class="sd">          \\left[{</span>
<span class="sd">              \\ln\\left({\\frac{n}{s}}\\right)</span>
<span class="sd">              -\\frac{3}{4}</span>
<span class="sd">              +\\frac{s^2}{n^2}\\left({1-\\frac{s^2}{4n^2}}\\right)</span>
<span class="sd">              -\\frac{\\kappa}{B}\\ln\\left({\\frac{\\kappa}{s}}\\right)</span>
<span class="sd">              +\\frac{\\kappa B}{A^2 n^2}\\left({2-\\frac{B^2}{A^2 n^2}}</span>
<span class="sd">                  \\right)\\ln\\left({\\kappa}\\right)</span>
<span class="sd">              -\\frac{\\kappa\\left({s-1}\\right)}{A n^2}</span>
<span class="sd">                  \\left\\{</span>
<span class="sd">                      2</span>
<span class="sd">                      +\\frac{1}{n^2}</span>
<span class="sd">                          \\left[</span>
<span class="sd">                          {\\frac{A-B}{A}\\left({\\frac{1}{A}}-\\frac{s+1}{2}</span>
<span class="sd">                          \\right)}</span>
<span class="sd">                          -\\frac{s+1}{2}</span>
<span class="sd">                          -\\frac{\\left({s-1}\\right)^2}{3}</span>
<span class="sd">                          \\right]</span>
<span class="sd">                  \\right\\}</span>
<span class="sd">          }\\right]</span>

<span class="sd">    and for the special case :math:`s=\\kappa`, :math:`\\mu` is given by:</span>

<span class="sd">    .. math:: \\mu=\\frac{n^2}{\\left({n^2-1}\\right)}</span>
<span class="sd">          \\left[{</span>
<span class="sd">              \\ln\\left({\\frac{n}{s}}\\right)</span>
<span class="sd">              -\\frac{3}{4}</span>
<span class="sd">              +s-1</span>
<span class="sd">              -\\frac{s^2}{n^2}\\left({1-\\frac{s^2}{12n^2}}\\right)</span>
<span class="sd">              -\\frac{s}{n^2}\\left({2-\\frac{1}{3n^2}}\\right)</span>
<span class="sd">          }\\right]</span>

<span class="sd">    where :math:`A` and :math:`B` are:</span>

<span class="sd">    .. math:: A=\\frac{\\kappa-1}{s-1}</span>

<span class="sd">    .. math:: B=\\frac{s-\\kappa}{s-1}</span>

<span class="sd">    and:</span>

<span class="sd">    .. math:: n = \\frac{r_e}{r_w}</span>

<span class="sd">    .. math:: s = \\frac{r_s}{r_w}</span>

<span class="sd">    .. math:: \\kappa = \\frac{k_h}{k_s}</span>

<span class="sd">    :math:`r_w` is the drain radius, :math:`r_e` is the drain influence radius,</span>
<span class="sd">    :math:`r_s` is the smear zone radius, :math:`k_h` is the undisturbed</span>
<span class="sd">    horizontal permeability, :math:`k_s` is the smear zone horizontal</span>
<span class="sd">    permeability</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Walker, R., and B. Indraratna. 2007. &#39;Vertical Drain Consolidation</span>
<span class="sd">           with Overlapping Smear Zones&#39;. Geotechnique 57 (5): 463-67.</span>
<span class="sd">           doi:10.1680/geot.2007.57.5.463.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">mu_s_neq_kap</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;mu for when s != kap&quot;&quot;&quot;</span>

        <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">kap</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="n">kap</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">term1</span> <span class="o">=</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">term2</span> <span class="o">=</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span>
                 <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">term3</span> <span class="o">=</span> <span class="n">kap</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">term4</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">B</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="n">kap</span><span class="p">)</span>
                 <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">kap</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">B</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">kap</span><span class="p">)))</span>
        <span class="n">term5</span> <span class="o">=</span> <span class="n">term2</span> <span class="o">+</span> <span class="n">term3</span> <span class="o">*</span> <span class="n">term4</span>

        <span class="n">term6</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">B</span><span class="p">)</span>
        <span class="n">term7</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="n">kap</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">kap</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">B</span> <span class="o">*</span> <span class="p">(</span><span class="n">kap</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">kap</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))))</span>
        <span class="n">term8</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">term9</span> <span class="o">=</span> <span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">kap</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">B</span> <span class="o">/</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="n">kap</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">kap</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">B</span> <span class="o">*</span> <span class="p">(</span><span class="n">kap</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">kap</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))))</span>


        <span class="n">term10</span> <span class="o">=</span> <span class="n">kap</span> <span class="o">*</span> <span class="p">(</span><span class="n">term6</span> <span class="o">*</span> <span class="n">term7</span> <span class="o">+</span> <span class="n">term8</span> <span class="o">*</span> <span class="n">term9</span><span class="p">)</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">*</span> <span class="p">(</span><span class="n">term5</span> <span class="o">+</span> <span class="n">term10</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mu</span>

    <span class="k">def</span> <span class="nf">mu_s_eq_kap</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;mu for s == kap&quot;&quot;&quot;</span>

        <span class="n">term1</span> <span class="o">=</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">term2</span> <span class="o">=</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">term3</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">s</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">term4</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">s</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">-</span> <span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">*</span> <span class="p">(</span><span class="n">term2</span> <span class="o">+</span> <span class="n">term3</span> <span class="o">+</span> <span class="n">term4</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mu</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">n</span><span class="o">&lt;=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n must be greater than 1. You have n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">n</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">s</span><span class="o">&lt;</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be greater than 1. You have s = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">kap</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kap must be greater than 0. You have kap = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">s</span><span class="o">&gt;=</span><span class="n">n</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be less than n. You have s = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> and n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)]),</span>
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">n</span><span class="p">)])))</span>




    <span class="n">is_array</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">]])</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>


    <span class="k">if</span> <span class="nb">len</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="n">kap</span><span class="o">.</span><span class="n">shape</span><span class="p">])</span><span class="o">!=</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n, s, and kap must have the same shape.  You have &#39;</span>
            <span class="s1">&#39;lengths for n, s, kap of </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">)))</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>


    <span class="n">ideal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kap</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">s_eq_kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">ideal</span>
    <span class="n">s_neq_kap</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">ideal</span>


    <span class="n">mu</span><span class="p">[</span><span class="n">ideal</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu_ideal</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">ideal</span><span class="p">])</span>
    <span class="n">mu</span><span class="p">[</span><span class="n">s_eq_kap</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu_s_eq_kap</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">s_eq_kap</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">s_eq_kap</span><span class="p">])</span>
    <span class="n">mu</span><span class="p">[</span><span class="n">s_neq_kap</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu_s_neq_kap</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">s_neq_kap</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">s_neq_kap</span><span class="p">],</span> <span class="n">kap</span><span class="p">[</span><span class="n">s_neq_kap</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">is_array</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mu</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="mu_parabolic"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.mu_parabolic">[docs]</a><span class="k">def</span> <span class="nf">mu_parabolic</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Smear zone parameter for parabolic variation of permeability</span>

<span class="sd">    mu parameter in equal strain radial consolidation equations e.g.</span>
<span class="sd">    u = u0 * exp(-8*Th/mu)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : float or ndarray of float</span>
<span class="sd">        Ratio of drain influence radius  to drain radius (re/rw).</span>
<span class="sd">    s : float or ndarray of float</span>
<span class="sd">        Ratio of smear zone radius to  drain radius (rs/rw).</span>
<span class="sd">    kap : float or ndarray of float</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to permeability at</span>
<span class="sd">        the drain-soil interface (kh/ks).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mu : float</span>
<span class="sd">        Smear zone permeability/geometry parameter</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The smear zone parameter :math:`\\mu` is given by:</span>


<span class="sd">    .. math:: \\mu = \\frac{n^2}{\\left({n^2-1}\\right)}</span>
<span class="sd">                \\left({</span>
<span class="sd">                    \\frac{A^2}{n^2}\\mu_1+\\mu_2</span>
<span class="sd">                }\\right)</span>

<span class="sd">    where,</span>

<span class="sd">    .. math:: \\mu_1=</span>
<span class="sd">                \\frac{1}{A^2-B^2}</span>
<span class="sd">                    \\left({</span>
<span class="sd">                        s^2\\ln\\left({s}\\right)</span>
<span class="sd">                        -\\frac{1}{2}\\left({s^2-1}\\right)</span>
<span class="sd">                    }\\right)</span>
<span class="sd">                -\\frac{1}{\\left({A^2-B^2}\\right)C^2}</span>
<span class="sd">                    \\left({</span>
<span class="sd">                        \\frac{A^2}{2}\\ln\\left({\\kappa}\\right)</span>
<span class="sd">                        +\\frac{ABE}{2}+\\frac{1}{2}-B</span>
<span class="sd">                        -\\left({A^2-B^2}\\right)\\ln\\left({\\kappa}\\right)</span>
<span class="sd">                    }\\right)</span>
<span class="sd">                +\\frac{1}{n^2C^4}</span>
<span class="sd">                    \\left({</span>
<span class="sd">                        -\\left({\\frac{A^2}{2}+B^2}\\right)</span>
<span class="sd">                            \\ln\\left({\\kappa}\\right)</span>
<span class="sd">                        +\\frac{3ABE}{2}+\\frac{1}{2}-3B</span>
<span class="sd">                    }\\right)</span>

<span class="sd">    .. math:: \\mu_2=</span>
<span class="sd">                \\ln\\left({\\frac{n}{s}}\\right)</span>
<span class="sd">                -\\frac{3}{4}</span>
<span class="sd">                +\\frac{s^2}{n^2}\\left({1-\\frac{s^2}{4n^2}}\\right)</span>
<span class="sd">                +A^2\\left({1-\\frac{s^2}{n^2}}\\right)</span>
<span class="sd">                \\left[{</span>
<span class="sd">                    \\frac{1}{A^2-B^2}</span>
<span class="sd">                    \\left({</span>
<span class="sd">                        \\ln\\left({\\frac{s}{\\sqrt{\\kappa}}}\\right)</span>
<span class="sd">                        -\\frac{BE}{2A}</span>
<span class="sd">                    }\\right)</span>
<span class="sd">                    +\\frac{1}{n^2C^2}</span>
<span class="sd">                    \\left({</span>
<span class="sd">                        \\ln\\left({\\sqrt{\\kappa}}\\right)</span>
<span class="sd">                        -\\frac{BE}{2A}</span>
<span class="sd">                    }\\right)</span>
<span class="sd">                }\\right]</span>



<span class="sd">    where :math:`A`, :math:`B`, :math:`C` and :math:`E` are:</span>

<span class="sd">    .. math:: A=\\sqrt{\\frac{\\kappa}{\\kappa-1}}</span>

<span class="sd">    .. math:: B=\\frac{s}{s-1}</span>

<span class="sd">    .. math:: C=\\frac{1}{s-1}</span>

<span class="sd">    .. math:: E=\\ln\\left({\\frac{A+1}{A-1}}\\right)</span>

<span class="sd">    and:</span>

<span class="sd">    .. math:: n = \\frac{r_e}{r_w}</span>

<span class="sd">    .. math:: s = \\frac{r_s}{r_w}</span>

<span class="sd">    .. math:: \\kappa = \\frac{k_h}{k_s}</span>


<span class="sd">    :math:`r_w` is the drain radius, :math:`r_e` is the drain influence radius,</span>
<span class="sd">    :math:`r_s` is the smear zone radius, :math:`k_h` is the undisturbed</span>
<span class="sd">    horizontal permeability, :math:`k_s` is the smear zone horizontal</span>
<span class="sd">    permeability</span>


<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Walker, Rohan, and Buddhima Indraratna. 2006. &#39;Vertical Drain</span>
<span class="sd">           Consolidation with Parabolic Distribution of Permeability in</span>
<span class="sd">           Smear Zone&#39;. Journal of Geotechnical and Geoenvironmental</span>
<span class="sd">           Engineering 132 (7): 937-41.</span>
<span class="sd">           doi:10.1061/(ASCE)1090-0241(2006)132:7(937).</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">mu_p</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;mu for parabolic smear&quot;&quot;&quot;</span>

        <span class="n">A</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">kap</span> <span class="o">/</span> <span class="p">(</span><span class="n">kap</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">s</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">term1</span> <span class="o">=</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">+</span>
                <span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
        <span class="n">term2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">term3</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">B</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">term4</span> <span class="o">=</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">kap</span><span class="p">)))</span> <span class="o">-</span> <span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">log</span><span class="p">((</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="n">term5</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">C</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">term6</span> <span class="o">=</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">kap</span><span class="p">)))</span> <span class="o">-</span> <span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">log</span><span class="p">((</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>

        <span class="n">mu2</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span> <span class="o">*</span> <span class="p">((</span><span class="n">term3</span> <span class="o">*</span> <span class="n">term4</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">term5</span> <span class="o">*</span> <span class="n">term6</span><span class="p">))</span>


        <span class="n">term7</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">B</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="n">term8</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">C</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">B</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">term9</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">A</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">log</span><span class="p">((</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">B</span> <span class="o">-</span> <span class="p">(</span><span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">B</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">kap</span><span class="p">))</span>

        <span class="n">term12</span> <span class="o">=</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>
        <span class="n">term13</span> <span class="o">=</span> <span class="p">(</span><span class="n">B</span> <span class="o">*</span> <span class="n">A</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">log</span><span class="p">((</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="n">term14</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">B</span>
        <span class="n">term15</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">B</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>


        <span class="n">term10</span> <span class="o">=</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">C</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">term11</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">B</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">kap</span><span class="p">))</span> <span class="o">+</span>
        <span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">B</span> <span class="o">*</span> <span class="n">log</span><span class="p">((</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">B</span><span class="p">)</span>

        <span class="n">mu1</span> <span class="o">=</span> <span class="n">term7</span> <span class="o">+</span> <span class="p">(</span><span class="n">term8</span> <span class="o">*</span> <span class="n">term9</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">term10</span> <span class="o">*</span> <span class="n">term11</span><span class="p">)</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">mu1</span> <span class="o">+</span> <span class="n">mu2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mu</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">n</span><span class="o">&lt;=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n must be greater than 1. You have n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">n</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">s</span><span class="o">&lt;</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be greater than 1. You have s = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">kap</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kap must be greater than 0. You have kap = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">s</span><span class="o">&gt;</span><span class="n">n</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be less than n. You have s = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> and n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)]),</span>
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">n</span><span class="p">)])))</span>




    <span class="n">is_array</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">]])</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>


    <span class="k">if</span> <span class="nb">len</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="n">kap</span><span class="o">.</span><span class="n">shape</span><span class="p">])</span><span class="o">!=</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n, s, and kap must have the same shape.  You have &#39;</span>
            <span class="s1">&#39;lengths for n, s, kap of </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">)))</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">ideal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kap</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>



    <span class="n">mu</span><span class="p">[</span><span class="n">ideal</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu_ideal</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">ideal</span><span class="p">])</span>
    <span class="n">mu</span><span class="p">[</span><span class="o">~</span><span class="n">ideal</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu_p</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="o">~</span><span class="n">ideal</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="o">~</span><span class="n">ideal</span><span class="p">],</span> <span class="n">kap</span><span class="p">[</span><span class="o">~</span><span class="n">ideal</span><span class="p">])</span>


    <span class="k">if</span> <span class="n">is_array</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mu</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="mu_piecewise_constant"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.mu_piecewise_constant">[docs]</a><span class="k">def</span> <span class="nf">mu_piecewise_constant</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kap_m</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Smear zone parameter for piecewise constant permeability distribution</span>


<span class="sd">    mu parameter in equal strain radial consolidation equations e.g.</span>
<span class="sd">    u = u0 * exp(-8*Th/mu)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s : list or 1d ndarray of float</span>
<span class="sd">        Ratio of segment outer radii to drain radius (r_i/r_0). The first value</span>
<span class="sd">        of s should be greater than 1, i.e. the first value should be s_1;</span>
<span class="sd">        s_0=1 at the drain soil interface is implied.</span>
<span class="sd">    kap : list or ndarray of float</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to permeability in each</span>
<span class="sd">        segment kh/khi.</span>
<span class="sd">    n, kap_m : float, optional</span>
<span class="sd">        If `n` and `kap_m` are given then they will each be appended to `s` and</span>
<span class="sd">        `kap`. This allows the specification of a smear zone separate to the</span>
<span class="sd">        specification of the drain influence radius.</span>
<span class="sd">        Default n=kap_m=None, i.e. soilpermeability is completely described</span>
<span class="sd">        by `s` and `kap`. If n is given but kap_m is None then the last</span>
<span class="sd">        kappa value in kap will be used.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mu : float</span>
<span class="sd">        Smear zone permeability/geometry parameter</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    The smear zone parameter :math:`\\mu` is given by:</span>

<span class="sd">    .. math:: \\mu = \\frac{n^2}{\\left({n^2-1}\\right)}</span>
<span class="sd">                \\sum\\limits_{i=1}^{m} \\kappa_i</span>
<span class="sd">                    \\left[{</span>
<span class="sd">                        \\frac{s_i^2}{n^2}\\ln</span>
<span class="sd">                            \\left({</span>
<span class="sd">                                \\frac{s_i}{s_{i-1}}</span>
<span class="sd">                            }\\right)</span>
<span class="sd">                        -\\frac{s_i^2-s_{i-1}^2}{2n^2}</span>
<span class="sd">                        -\\frac{\\left({s_i^2-s_{i-1}^2}\\right)^2}{4n^4}</span>
<span class="sd">                    }\\right]</span>
<span class="sd">                    +\\psi_i\\frac{s_i^2-s_{i-1}^2}{n^2}</span>

<span class="sd">    where,</span>

<span class="sd">    .. math:: \\psi_{i} = \\sum\\limits_{j=1}^{i-1}\\kappa_j</span>
<span class="sd">                \\left[{</span>
<span class="sd">                        \\ln</span>
<span class="sd">                            \\left({</span>
<span class="sd">                                \\frac{s_j}{s_{j-1}}</span>
<span class="sd">                            }\\right)</span>
<span class="sd">                        -\\frac{s_j^2-s_{j-1}^2}{2n^2}</span>
<span class="sd">                    }\\right]</span>

<span class="sd">    and:</span>

<span class="sd">    .. math:: n = \\frac{r_m}{r_0}</span>

<span class="sd">    .. math:: s_i = \\frac{r_i}{r_0}</span>

<span class="sd">    .. math:: \\kappa_i = \\frac{k_h}{k_{hi}}</span>


<span class="sd">    :math:`r_0` is the drain radius, :math:`r_m` is the drain influence radius,</span>
<span class="sd">    :math:`r_i` is the outer radius of the ith segment,</span>
<span class="sd">    :math:`k_h` is the undisturbed</span>
<span class="sd">    horizontal permeability in the ith segment,</span>
<span class="sd">    :math:`k_{hi}` is the horizontal</span>
<span class="sd">    permeability in the ith segment</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Walker, Rohan. 2006. &#39;Analytical Solutions for Modeling Soft Soil</span>
<span class="sd">           Consolidation by Vertical Drains&#39;. PhD Thesis, Wollongong, NSW,</span>
<span class="sd">           Australia: University of Wollongong. http://ro.uow.edu.au/theses/501</span>
<span class="sd">    .. [2] Walker, Rohan T. 2011. &#39;Vertical Drain Consolidation Analysis in</span>
<span class="sd">           One, Two and Three Dimensions&#39;. Computers and</span>
<span class="sd">           Geotechnics 38 (8): 1069-77. doi:10.1016/j.compgeo.2011.07.006.</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">s_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">s_temp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
        <span class="n">s_temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">kap_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">kap_temp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap</span>
        <span class="k">if</span> <span class="n">kap_m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kap_temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kap_temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap_m</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s_temp</span>
        <span class="n">kap</span> <span class="o">=</span> <span class="n">kap_temp</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s and kap must have the same shape.  You have &#39;</span>
            <span class="s1">&#39;lengths for s, kap of </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">s</span><span class="o">&lt;=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must have all s&gt;=1. You have s = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">kap</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;all kap must be greater than 0. You have kap = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must increase left to right you have s = &#39;</span>
        <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)])))</span>


    <span class="n">n</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">s_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">s</span> <span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">s_</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">sumi</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">psi</span> <span class="o">+=</span> <span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">s_</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">s_</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">psi</span> <span class="o">/=</span> <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">sumi</span> <span class="o">+=</span> <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">s_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="o">+</span> <span class="p">(</span><span class="n">psi</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">s_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="o">-</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">s_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">4</span>
            <span class="p">)</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">sumi</span> <span class="o">*</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mu</span></div>


<div class="viewcode-block" id="mu_piecewise_linear"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.mu_piecewise_linear">[docs]</a><span class="k">def</span> <span class="nf">mu_piecewise_linear</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kap_m</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Smear zone parameter for piecewise linear permeability distribution</span>


<span class="sd">    mu parameter in equal strain radial consolidation equations e.g.</span>
<span class="sd">    u = u0 * exp(-8*Th/mu)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s : list or 1d ndarray of float</span>
<span class="sd">        Ratio of radii to drain radius (r_i/r_0). The first value</span>
<span class="sd">        of s should be 1, i.e. at the drain soil interface.</span>
<span class="sd">    kap : list or ndarray of float</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to permeability at each</span>
<span class="sd">        value of s.</span>
<span class="sd">    n, kap_m : float, optional</span>
<span class="sd">        If `n` and `kap_m` are given then they will each be appended to `s` and</span>
<span class="sd">        `kap`. This allows the specification of a smear zone separate to the</span>
<span class="sd">        specification of the drain influence radius.</span>
<span class="sd">        Default n=kap_m=None, i.e. soilpermeability is completely described</span>
<span class="sd">        by `s` and `kap`. If n is given but kap_m is None then the last</span>
<span class="sd">        kappa value in kap will be used.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mu : float</span>
<span class="sd">        Smear zone permeability/geometry parameter.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    With permeability in the ith segment defined by:</span>

<span class="sd">    .. math:: \\frac{k_i}{k_{ref}}= \\frac{1}{\\kappa_{i-1}}</span>
<span class="sd">                    \\left({A_ir/r_w+B_i}\\right)</span>

<span class="sd">    .. math:: A_i = \\frac{\\kappa_{i-1}/\\kappa_i-1}{s_i-s_{i-1}}</span>

<span class="sd">    .. math:: B_i = \\frac{s_i-s_{i-1}\\kappa_{i-1}/\\kappa_i}{s_i-s_{i-1}}</span>

<span class="sd">    the smear zone :math:`\\mu` parameter is given by:</span>

<span class="sd">    .. math:: \\mu = \\frac{n^2}{n^2-1}</span>
<span class="sd">                        \\left[{</span>
<span class="sd">                            \\sum\\limits_{i=1}^{m}\\kappa_{i-1}\\theta_i</span>
<span class="sd">                            + \\Psi_i</span>
<span class="sd">                            \\left({</span>
<span class="sd">                                \\frac{s_i^2-s_{i-1}^2}{n^2}</span>
<span class="sd">                            }\\right)</span>
<span class="sd">                            +\\mu_w</span>
<span class="sd">                        }\\right]</span>

<span class="sd">    where,</span>

<span class="sd">    .. math:: \\theta_i = \\left\\{</span>
<span class="sd">                            \\begin{array}{lr}</span>
<span class="sd">                            \\frac{s_i^2}{n^2}\\ln</span>
<span class="sd">                                \\left[{\\frac{s_i}{s_{i-1}}}\\right]</span>
<span class="sd">                                -\\frac{s_i^2-s_{i-1}^2}{2n^2}</span>
<span class="sd">                                -\\frac{\\left({s_i^2-s_{i-1}^2}\\right)^2}{4n^4}</span>
<span class="sd">                            &amp; \\textrm{for } \\frac{\\kappa_{i-1}}{\\kappa_i}=1 \\\\</span>
<span class="sd">                            \\frac{\\left({s_i^2-s_{i-1}^2}\\right)}{3n^4}</span>
<span class="sd">                                \\left({3n^2-s_{i-1}^2-2s_{i-1}s_i}\\right)</span>
<span class="sd">                            &amp; \\textrm{for }\\frac{\\kappa_{i-1}}{\\kappa_i}=</span>
<span class="sd">                             \\frac{s_i}{s_{i-1}} \\\\</span>
<span class="sd">                             \\begin{multline}</span>
<span class="sd">                            \\frac{s_i}{B_i n^2}\\ln\\left[{</span>
<span class="sd">                                \\frac{\\kappa_i s_i}{\\kappa_{i-1}s_{i-1}}}\\right]</span>
<span class="sd">                            -\\frac{s_i-s_{i-1}}{A_in^2}</span>
<span class="sd">                                \\left({1-\\frac{B_i^2}{A_i^2n^4}}\\right)</span>
<span class="sd">                            \\\\-\\frac{\\left({s_i-s_{i-1}}\\right)^2}{3A_in^2}</span>
<span class="sd">                                \\left({2s_i+s_{i-1}}\\right)</span>
<span class="sd">                            \\\\+\\frac{B_i}{A_i^2 n^4}\\ln\\left[{</span>
<span class="sd">                                \\frac{\\kappa_{i-1}}{\\kappa_i}}\\right]</span>
<span class="sd">                                \\left({1-\\frac{B_i^2}{A_i^2n^2}}\\right)</span>
<span class="sd">                            \\\\+\\frac{B_i}{2A_i^2 n^4}</span>
<span class="sd">                                \\left({</span>
<span class="sd">                                2s_i^2\\ln\\left[{</span>
<span class="sd">                                \\frac{\\kappa_{i-1}}{\\kappa_i}}\\right]</span>
<span class="sd">                                -s_i^2 + s_{i-1}^2</span>
<span class="sd">                                }\\right)</span>
<span class="sd">                            \\end{multline}</span>
<span class="sd">                            &amp; \\textrm{otherwise}</span>
<span class="sd">                            \\end{array}\\right.</span>

<span class="sd">    .. math:: \\Psi_i = \\sum\\limits_{j=1}^{i-1}\\kappa_{j-1}\\psi_j</span>

<span class="sd">    .. math:: \\psi_i = \\left\\{</span>
<span class="sd">                            \\begin{array}{lr}</span>
<span class="sd">                            \\ln\\left[{\\frac{s_j}{s_{j-1}}}\\right]</span>
<span class="sd">                            - \\frac{s_j^2- s_{j-1}^2}{2n^2}</span>
<span class="sd">                            &amp; \\textrm{for } \\frac{\\kappa_{j-1}}{\\kappa_j}=1 \\\\</span>
<span class="sd">                            \\frac{\\left({s_j - s_{j-1}}\\right)</span>
<span class="sd">                                \\left({n^2-s_js_{j-1}}\\right)}{s_jn^2}</span>
<span class="sd">                            &amp; \\textrm{for }\\frac{\\kappa_{j-1}}{\\kappa_j}=</span>
<span class="sd">                             \\frac{s_j}{s_{j-1}} \\\\</span>
<span class="sd">                             \\begin{multline}</span>
<span class="sd">                            \\frac{1}{B_i}\\ln\\left[{\\frac{s_j}{s_{j-1}}}\\right]</span>
<span class="sd">                                +\\ln\\left[{\\frac{\\kappa_{j-1}}{\\kappa_j}}\\right]</span>
<span class="sd">                                \\left({\\frac{B_j}{A_j^2n^2}-\\frac{1}{B_j}}\\right)</span>
<span class="sd">                                \\\\-\\frac{s_j-s_{j-1}}{A_j^2n^2}</span>
<span class="sd">                            \\end{multline}</span>
<span class="sd">                            &amp; \\textrm{otherwise}</span>
<span class="sd">                            \\end{array}\\right.</span>



<span class="sd">    and:</span>

<span class="sd">    .. math:: n = \\frac{r_m}{r_0}</span>

<span class="sd">    .. math:: s_i = \\frac{r_i}{r_0}</span>

<span class="sd">    .. math:: \\kappa_i = \\frac{k_h}{k_{ref}}</span>


<span class="sd">    :math:`r_0` is the drain radius, :math:`r_m` is the drain influence radius,</span>
<span class="sd">    :math:`r_i` is the radius of the ith radial point,</span>
<span class="sd">    :math:`k_{ref}` is a convienient refernce permeability, usually</span>
<span class="sd">    the undisturbed</span>
<span class="sd">    horizontal permeability,</span>
<span class="sd">    :math:`k_{hi}` is the horizontal</span>
<span class="sd">    permeability at the ith radial point</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Derived by Rohan Walker in 2011 and 2014.</span>
<span class="sd">    Derivation steps are the same as for mu_piecewise_constant in appendix of</span>
<span class="sd">    [1]_ but permeability is linear in a segemetn as in [2]_.</span>

<span class="sd">    .. [1] Walker, Rohan. 2006. &#39;Analytical Solutions for Modeling Soft Soil</span>
<span class="sd">           Consolidation by Vertical Drains&#39;. PhD Thesis, Wollongong, NSW,</span>
<span class="sd">           Australia: University of Wollongong. http://ro.uow.edu.au/theses/501</span>
<span class="sd">    .. [2] Walker, R., and B. Indraratna. 2007. &#39;Vertical Drain Consolidation</span>
<span class="sd">           with Overlapping Smear Zones&#39;. Geotechnique 57 (5): 463-67.</span>
<span class="sd">           doi:10.1680/geot.2007.57.5.463.</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">s_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">s_temp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
        <span class="n">s_temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">kap_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">kap_temp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap</span>
        <span class="k">if</span> <span class="n">kap_m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kap_temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kap_temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap_m</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s_temp</span>
        <span class="n">kap</span> <span class="o">=</span> <span class="n">kap_temp</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s and kap must have the same shape.  You have &#39;</span>
            <span class="s1">&#39;lengths for s, kap of </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">s</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must have all s&gt;=1. You have s = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">kap</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;all kap must be greater than 0. You have kap = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;All s must satisfy s[i]&gt;s[i-1]. You have s = &#39;</span>
        <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;First value of s should be 1.  You &#39;</span>
                            <span class="s1">&#39;have s[0]=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>




    <span class="n">n</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">sumi</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
        <span class="n">sumj</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="c1">#            term1 = 0</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                <span class="n">term1</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kap</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                <span class="n">term1</span> <span class="o">=</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="o">-</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
                <span class="n">term1</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span>
                        <span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">term1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">B</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">B</span><span class="p">)</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="o">-</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">A</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">sumj</span> <span class="o">+=</span> <span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">term1</span>

<span class="c1">#        term1 = 0</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
            <span class="n">term1</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kap</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
            <span class="n">term1</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="o">-</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="o">-</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
            <span class="n">term1</span> <span class="o">=</span> <span class="p">((</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span>
                    <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">term1</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">B</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span>
                    <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="o">-</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">A</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span>
                <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">B</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="o">-</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">A</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span>
                <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="o">+</span> <span class="n">B</span> <span class="o">/</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span>
                <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">B</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">B</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span>
                <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

        <span class="n">sumi</span> <span class="o">+=</span> <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">term1</span> <span class="o">+</span> <span class="n">sumj</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">sumi</span> <span class="o">*</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mu</span></div>


<div class="viewcode-block" id="mu_well_resistance"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.mu_well_resistance">[docs]</a><span class="k">def</span> <span class="nf">mu_well_resistance</span><span class="p">(</span><span class="n">kh</span><span class="p">,</span> <span class="n">qw</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Additional smear zone parameter for well resistance</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    kh : float</span>
<span class="sd">        The normalising permeability used in calculating kappa for smear zone</span>
<span class="sd">        calcs.  Usually the undisturbed permeability i.e. the kh in</span>
<span class="sd">        kappa = kh/ks</span>
<span class="sd">    qw : float</span>
<span class="sd">        Drain discharge capacity.  qw = kw * pi * rw**2.  Make sure</span>
<span class="sd">        the kw used has the same units as kh.</span>
<span class="sd">    n : float</span>
<span class="sd">        Ratio of drain influence radius  to drain radius (re/rw).</span>
<span class="sd">    H : float</span>
<span class="sd">        Length of drainage path.</span>
<span class="sd">    z : float, optional</span>
<span class="sd">        Evaluation depth. Default = None, in which case the well resistance</span>
<span class="sd">        factor will be averaged.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mu : float</span>
<span class="sd">        mu parameter for well resistance</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The smear zone parameter :math:`\\mu_w` is given by:</span>


<span class="sd">    .. math:: \\mu_w = \\frac{k_h}{q_w}\\pi z</span>
<span class="sd">                        \\left({2H-z}\\right)</span>
<span class="sd">                        \\left({1-\\frac{1}{n^2}}\\right)</span>

<span class="sd">    when :math:`z` is None then the average :math:`\\mu_w` is given by:</span>

<span class="sd">    .. math:: \\mu_{w\\textrm{average}} = \\frac{2k_h H^2}{3q_w}\\pi</span>
<span class="sd">                        \\left({1-\\frac{1}{n^2}}\\right)</span>

<span class="sd">    where,</span>

<span class="sd">    .. math:: n = \\frac{r_e}{r_w}</span>

<span class="sd">    .. math:: q_w = k_w \\pi r_w^2</span>
<span class="sd">    :math:`r_w` is the drain radius, :math:`r_e` is the drain influence radius,</span>
<span class="sd">    :math:`k_h` is the undisturbed horizontal permeability,</span>
<span class="sd">    :math:`k_w` is the drain permeability</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Hansbo, S. 1981. &#39;Consolidation of Fine-Grained Soils by</span>
<span class="sd">           Prefabricated Drains&#39;. In 10th ICSMFE, 3:677-82.</span>
<span class="sd">           Rotterdam-Boston: A.A. Balkema.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">&lt;=</span><span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n must be greater than 1. You have n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">n</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">kh</span> <span class="o">*</span> <span class="n">H</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">qw</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">kh</span> <span class="o">/</span> <span class="n">qw</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">H</span> <span class="o">-</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mu</span></div>

<div class="viewcode-block" id="k_parabolic"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.k_parabolic">[docs]</a><span class="k">def</span> <span class="nf">k_parabolic</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Permeability distribution for smear zone with parabolic permeability</span>

<span class="sd">    Normalised with respect to undisturbed permeability.  i.e. if you want the</span>
<span class="sd">    actual permeability then multiply by whatever you used to determine kap.</span>


<span class="sd">    Permeability is parabolic with value 1/kap at the drain soil interface</span>
<span class="sd">    i.e. at s=1 k=k0=1/kap.  for si&gt;s, permeability=1.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : float</span>
<span class="sd">        Ratio of drain influence radius  to drain radius (re/rw).</span>
<span class="sd">    s : float</span>
<span class="sd">        Ratio of smear zone radius to  drain radius (rs/rw).</span>
<span class="sd">    kap : float</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to permeability at</span>
<span class="sd">        the drain-soil interface (kh / ks).</span>
<span class="sd">    si : float of ndarray of float</span>
<span class="sd">        Normalised radial coordinate(s) at which to calc the permeability</span>
<span class="sd">        i.e. si=ri/rw</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    permeability : float or ndarray of float</span>
<span class="sd">        Normalised permeability (i.e. ki/kh) at the si values.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Parabolic distribution of permeability in smear zone is given by:</span>

<span class="sd">    .. math:: \\frac{k_h^\\prime\\left({r}\\right)}{k_h}=</span>
<span class="sd">                \\frac{\\kappa-1}{\\kappa}</span>
<span class="sd">                \\left({A-B+C\\frac{r}{r_w}}\\right)</span>
<span class="sd">                \\left({A+B-C\\frac{r}{r_w}}\\right)</span>

<span class="sd">    where :math:`A`, :math:`B`, :math:`C` are:</span>

<span class="sd">    .. math:: A=\\sqrt{\\frac{\\kappa}{\\kappa-1}}</span>

<span class="sd">    .. math:: B=\\frac{s}{s-1}</span>

<span class="sd">    .. math:: C=\\frac{1}{s-1}</span>

<span class="sd">    and:</span>

<span class="sd">    .. math:: n = \\frac{r_e}{r_w}</span>

<span class="sd">    .. math:: s = \\frac{r_s}{r_w}</span>

<span class="sd">    .. math:: \\kappa = \\frac{k_h}{k_s}</span>

<span class="sd">    :math:`r_w` is the drain radius, :math:`r_e` is the drain influence radius,</span>
<span class="sd">    :math:`r_s` is the smear zone radius, :math:`k_h` is the undisturbed</span>
<span class="sd">    horizontal permeability, :math:`k_s` is the smear zone horizontal</span>
<span class="sd">    permeability</span>


<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Walker, Rohan, and Buddhima Indraratna. 2006. &#39;Vertical Drain</span>
<span class="sd">           Consolidation with Parabolic Distribution of Permeability in</span>
<span class="sd">           Smear Zone&#39;. Journal of Geotechnical and Geoenvironmental</span>
<span class="sd">           Engineering 132 (7): 937-41.</span>
<span class="sd">           doi:10.1061/(ASCE)1090-0241(2006)132:7(937).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">&lt;=</span><span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n must be greater than 1. You have n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">n</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">s</span><span class="o">&lt;</span><span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be greater than 1. You have s = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">s</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">kap</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kap must be greater than 0. You have kap = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kap</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">s</span><span class="o">&gt;</span><span class="n">n</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be less than n. You have s = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> and n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>


    <span class="n">si</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">si</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">((</span><span class="n">si</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">si</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;si must satisfy 1 &gt;= si &gt;= n)&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parabolic_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parbolic smear zone part i.e from si=1 to si=s&quot;&quot;&quot;</span>

        <span class="n">A</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">kap</span> <span class="o">/</span> <span class="p">(</span><span class="n">kap</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">s</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">k0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">kap</span>
        <span class="k">return</span> <span class="n">k0</span><span class="o">*</span><span class="p">(</span><span class="n">kap</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="n">si</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">-</span> <span class="n">C</span> <span class="o">*</span> <span class="n">si</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kap</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">si</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">smear</span> <span class="o">=</span> <span class="p">(</span><span class="n">si</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">)</span>

    <span class="n">permeability</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">si</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">permeability</span><span class="p">[</span><span class="n">smear</span><span class="p">]</span> <span class="o">=</span> <span class="n">parabolic_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">[</span><span class="n">smear</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">permeability</span></div>


<div class="viewcode-block" id="k_linear"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.k_linear">[docs]</a><span class="k">def</span> <span class="nf">k_linear</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Permeability distribution for smear zone with linear permeability</span>

<span class="sd">    Normalised with respect to undisturbed permeability.  i.e. if you want the</span>
<span class="sd">    actual permeability then multiply by whatever you used to determine kap.</span>

<span class="sd">    Permeability is linear with value 1/kap at the drain soil interface</span>
<span class="sd">    i.e. at s=1 k=k0=1/kap.  for si&gt;s, permeability=1.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : float</span>
<span class="sd">        Ratio of drain influence radius  to drain radius (re/rw).</span>
<span class="sd">    s : float</span>
<span class="sd">        Ratio of smear zone radius to  drain radius (rs/rw).</span>
<span class="sd">    kap : float</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to permeability at</span>
<span class="sd">        the drain-soil interface (kh / ks).</span>
<span class="sd">    si : float of ndarray of float</span>
<span class="sd">        Normalised radial coordinate(s) at which to calc the permeability</span>
<span class="sd">        i.e. si=ri/rw.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    permeability : float or ndarray of float</span>
<span class="sd">        Normalised permeability (i.e. ki/kh) at the si values.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Linear distribution of permeability in smear zone is given by:</span>

<span class="sd">    .. math::</span>

<span class="sd">       \\frac{k_h^\\prime\\left({r}\\right)}{k_h}=</span>
<span class="sd">        \\left\\{\\begin{array}{lr}</span>
<span class="sd">        \\frac{1}{\\kappa}</span>
<span class="sd">                    \\left({A\\frac{r}{r_w}+B}\\right)</span>
<span class="sd">                    &amp; s\\neq\\kappa \\\\</span>
<span class="sd">                    \\frac{r}{\\kappa r_w}</span>
<span class="sd">                    &amp; s=\\kappa \\end{array}\\right.</span>

<span class="sd">    where :math:`A` and :math:`B` are:</span>

<span class="sd">    .. math:: A=\\frac{\\kappa-1}{s-1}</span>

<span class="sd">    .. math:: B=\\frac{s-\\kappa}{s-1}</span>

<span class="sd">    and:</span>

<span class="sd">    .. math:: n = \\frac{r_e}{r_w}</span>

<span class="sd">    .. math:: s = \\frac{r_s}{r_w}</span>

<span class="sd">    .. math:: \\kappa = \\frac{k_h}{k_s}</span>

<span class="sd">    :math:`r_w` is the drain radius, :math:`r_e` is the drain influence radius,</span>
<span class="sd">    :math:`r_s` is the smear zone radius, :math:`k_h` is the undisturbed</span>
<span class="sd">    horizontal permeability, :math:`k_s` is the smear zone horizontal</span>
<span class="sd">    permeability</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Walker, R., and B. Indraratna. 2007. &#39;Vertical Drain Consolidation</span>
<span class="sd">           with Overlapping Smear Zones&#39;. Geotechnique 57 (5): 463-67.</span>
<span class="sd">           doi:10.1680/geot.2007.57.5.463.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">s_neq_kap_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Linear permeability in smear zome when s!=kap&quot;&quot;&quot;</span>

        <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">kap</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="n">kap</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>


        <span class="n">k0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">kap</span>

        <span class="k">return</span> <span class="n">k0</span><span class="o">*</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">si</span><span class="o">+</span><span class="n">B</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">s_eq_kap_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">si</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Linear permeability in smear zome when s!=kap&quot;&quot;&quot;</span>

        <span class="n">k0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">kap</span>
        <span class="k">return</span> <span class="n">k0</span> <span class="o">*</span> <span class="n">si</span>

    <span class="k">if</span> <span class="n">n</span><span class="o">&lt;=</span><span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n must be greater than 1. You have n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">n</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">s</span><span class="o">&lt;</span><span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be greater than 1. You have s = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">s</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">kap</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kap must be greater than 0. You have kap = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kap</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">s</span><span class="o">&gt;</span><span class="n">n</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be less than n. You have s = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> and n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

    <span class="n">si</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">si</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">((</span><span class="n">si</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">si</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;si must satisfy 1 &gt;= si &gt;= n)&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kap</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">si</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>


    <span class="n">smear</span> <span class="o">=</span> <span class="p">(</span><span class="n">si</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">permeability</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">si</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">):</span>
        <span class="n">permeability</span><span class="p">[</span><span class="n">smear</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_eq_kap_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">si</span><span class="p">[</span><span class="n">smear</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">permeability</span><span class="p">[</span><span class="n">smear</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_neq_kap_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">[</span><span class="n">smear</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">permeability</span></div>


<div class="viewcode-block" id="k_overlapping_linear"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.k_overlapping_linear">[docs]</a><span class="k">def</span> <span class="nf">k_overlapping_linear</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Permeability smear zone with overlapping linear permeability</span>

<span class="sd">    Normalised with respect to undisturbed permeability.  i.e. if you want the</span>
<span class="sd">    actual permeability then multiply by whatever you used to determine kap.</span>

<span class="sd">    mu parameter in equal strain radial consolidation equations e.g.</span>
<span class="sd">    u = u0 * exp(-8*Th/mu)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : float</span>
<span class="sd">        Ratio of drain influence radius  to drain radius (re/rw).</span>
<span class="sd">    s : float</span>
<span class="sd">        Ratio of smear zone radius to  drain radius (rs/rw).</span>
<span class="sd">    kap : float</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to permeability at</span>
<span class="sd">        the drain-soil interface (kh / ks).</span>
<span class="sd">    si : float of ndarray of float</span>
<span class="sd">        Normalised radial coordinate(s) at which to calc the permeability</span>
<span class="sd">        i.e. si=ri/rw</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    permeability : float or ndarray of float</span>
<span class="sd">        Normalised permeability (i.e. ki/kh) at the si values.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    When :math:`n&gt;s` the permeability is no different from the linear case.</span>

<span class="sd">    When :math:`n\\leq (s+1)/2` then all the soil is disturbed</span>
<span class="sd">    and the permeability everywhere is equal to :math:`1/\\kappa`.</span>

<span class="sd">    When :math:`(s+1)/2&lt;n&lt;s` then the smear zones overlap.</span>
<span class="sd">    the permeability for :math:`r/r_w&lt;s_X` is given by:</span>

<span class="sd">    .. math:: \\frac{k_h^\\prime\\left({r}\\right)}{k_h}=</span>
<span class="sd">                \\left\\{\\begin{array}{lr}</span>
<span class="sd">                \\frac{1}{\\kappa}</span>
<span class="sd">                            \\left({A\\frac{r}{r_w}+B}\\right)</span>
<span class="sd">                            &amp; s\\neq\\kappa \\\\</span>
<span class="sd">                            \\frac{r}{\\kappa r_w}</span>
<span class="sd">                            &amp; s=\\kappa \\end{array}\\right.</span>

<span class="sd">    In the overlapping part, :math:`r/r_w&gt;s_X`, the permeability is given by:</span>

<span class="sd">    .. math::  k_h(r)=\\kappa_X/\\kappa</span>

<span class="sd">    where :math:`A` and :math:`B` are:</span>

<span class="sd">    .. math:: A=\\frac{\\kappa-1}{s-1}</span>

<span class="sd">    .. math:: B=\\frac{s-\\kappa}{s-1}</span>

<span class="sd">    .. math:: \\kappa_X= 1+\\frac{\\kappa-1}{s-1}\\left({s_X-1}\\right)</span>

<span class="sd">    .. math:: s_X = 2n-s</span>




<span class="sd">    and:</span>

<span class="sd">    .. math:: n = \\frac{r_e}{r_w}</span>

<span class="sd">    .. math:: s = \\frac{r_s}{r_w}</span>

<span class="sd">    .. math:: \\kappa = \\frac{k_h}{k_s}</span>

<span class="sd">    :math:`r_w` is the drain radius, :math:`r_e` is the drain influence radius,</span>
<span class="sd">    :math:`r_s` is the smear zone radius, :math:`k_h` is the undisturbed</span>
<span class="sd">    horizontal permeability, :math:`k_s` is the smear zone horizontal</span>
<span class="sd">    permeability</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Walker, R., and B. Indraratna. 2007. &#39;Vertical Drain Consolidation</span>
<span class="sd">           with Overlapping Smear Zones&#39;. Geotechnique 57 (5): 463-67.</span>
<span class="sd">           doi:10.1680/geot.2007.57.5.463.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">mu_intersecting</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;mu for intersecting smear zones that do not completely overlap&quot;&quot;&quot;</span>
        <span class="n">sx</span> <span class="o">=</span> <span class="n">_sx</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="n">kapx</span> <span class="o">=</span>  <span class="n">_kapx</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">)</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_linear</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">kapx</span><span class="p">)</span> <span class="o">*</span> <span class="n">kap</span> <span class="o">/</span> <span class="n">kapx</span>
        <span class="k">return</span> <span class="n">mu</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">&lt;=</span><span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n must be greater than 1. You have n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">n</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">s</span><span class="o">&lt;</span><span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be greater than 1. You have s = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">s</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">kap</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kap must be greater than 0. You have kap = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kap</span><span class="p">))</span>



    <span class="n">si</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">si</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">((</span><span class="n">si</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">si</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;si must satisfy 1 &gt;= si &gt;= n)&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kap</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">permeability</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">si</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="n">s</span> <span class="o">&lt;=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">permeability</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">si</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="n">kap</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">n</span><span class="o">&gt;=</span><span class="n">s</span><span class="p">):</span>
        <span class="n">permeability</span> <span class="o">=</span> <span class="n">k_linear</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sx</span> <span class="o">=</span> <span class="n">_sx</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="n">kapx</span> <span class="o">=</span>  <span class="n">_kapx</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">)</span>

        <span class="n">smear</span> <span class="o">=</span> <span class="p">(</span><span class="n">si</span> <span class="o">&lt;</span> <span class="n">sx</span><span class="p">)</span>
        <span class="n">permeability</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">si</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">kap</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="n">kap</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">permeability</span><span class="p">[</span><span class="n">smear</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">kap</span><span class="o">*</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">si</span><span class="p">[</span><span class="n">smear</span><span class="p">]</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span>
        <span class="n">permeability</span><span class="p">[</span><span class="o">~</span><span class="n">smear</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">kap</span><span class="o">*</span><span class="n">kapx</span><span class="c1">#1 / kapx</span>

    <span class="k">return</span> <span class="n">permeability</span></div>




<div class="viewcode-block" id="u_ideal"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.u_ideal">[docs]</a><span class="k">def</span> <span class="nf">u_ideal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">uavg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">uw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">muw</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pore pressure at radius for ideal drain with no smear zone</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : float</span>
<span class="sd">        Ratio of drain influence radius  to drain radius (re/rw).</span>
<span class="sd">    si : float of ndarray of float</span>
<span class="sd">        Normalised radial coordinate(s) at which to calc the pore pressure</span>
<span class="sd">        i.e. si=ri/rw.</span>
<span class="sd">    uavg : float, optional = 1</span>
<span class="sd">        Average pore pressure in soil. default = 1.  when `uw`=0 , then if</span>
<span class="sd">        uavg=1.</span>
<span class="sd">    uw : float, optional</span>
<span class="sd">        Pore pressure in drain, default = 0.</span>
<span class="sd">    muw : float, optional</span>
<span class="sd">        Well resistance mu parameter</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    u : float or ndarray of float</span>
<span class="sd">        Pore pressure at specified si</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The uavg is calculated from the eta method.  It is not the uavg used when</span>
<span class="sd">    considering the vacuum as an equivalent surcharge.  You would have to do</span>
<span class="sd">    other manipulations for that.</span>

<span class="sd">    Noteing that :math:`s_i=r_i/r_w`, the radial pore pressure distribution is given by:</span>

<span class="sd">    .. math:: u(r) = \\frac{u_{avg}-u_w}{\\mu+\\mu_w}</span>
<span class="sd">                            \\left[{</span>
<span class="sd">                                \\ln\\left({\\frac{r}{r_w}}\\right)</span>
<span class="sd">                                -\\frac{(r/r_w)^2-1}{2n^2}</span>
<span class="sd">                                +\\mu_w</span>
<span class="sd">                            }\\right]+u_w</span>


<span class="sd">    where:</span>

<span class="sd">    .. math:: n = \\frac{r_e}{r_w}</span>

<span class="sd">    :math:`r_w` is the drain radius, :math:`r_e` is the drain influence radius.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Hansbo, S. 1981. &#39;Consolidation of Fine-Grained Soils by</span>
<span class="sd">           Prefabricated Drains&#39;. In 10th ICSMFE, 3:677-82.</span>
<span class="sd">           Rotterdam-Boston: A.A. Balkema.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">&lt;=</span><span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n must be greater than 1. You have n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">n</span><span class="p">))</span>

    <span class="n">si</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">si</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">((</span><span class="n">si</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">si</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;si must satisfy 1 &gt;= si &gt;= n)&#39;</span><span class="p">)</span>


    <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_ideal</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">term1</span> <span class="o">=</span> <span class="p">(</span><span class="n">uavg</span> <span class="o">-</span> <span class="n">uw</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mu</span> <span class="o">+</span> <span class="n">muw</span><span class="p">)</span>
    <span class="n">term2</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">si</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">si</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">muw</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">*</span> <span class="n">term2</span> <span class="o">+</span> <span class="n">uw</span>
    <span class="k">return</span> <span class="n">u</span></div>

<div class="viewcode-block" id="u_constant"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.u_constant">[docs]</a><span class="k">def</span> <span class="nf">u_constant</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">uavg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">uw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">muw</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pore pressure at radius for constant permeability smear zone</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : float</span>
<span class="sd">        Ratio of drain influence radius  to drain radius (re/rw).</span>
<span class="sd">    s : float</span>
<span class="sd">        Ratio of smear zone radius to  drain radius (rs/rw).</span>
<span class="sd">    kap : float</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to permeability at</span>
<span class="sd">        the drain-soil interface (kh / ks).</span>
<span class="sd">    si : float of ndarray of float</span>
<span class="sd">        Normalised radial coordinate(s) at which to calc the pore pressure</span>
<span class="sd">        i.e. si=ri/rw.</span>
<span class="sd">    uavg : float, optional = 1</span>
<span class="sd">        Average pore pressure in soil. default = 1.  when `uw`=0 , then if</span>
<span class="sd">        uavg=1.</span>
<span class="sd">    uw : float, optional</span>
<span class="sd">        Pore pressure in drain, default = 0.</span>
<span class="sd">    muw : float, optional</span>
<span class="sd">        Well resistance mu parameter.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    u : float or ndarray of float</span>
<span class="sd">        Pore pressure at specified si</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The uavg is calculated from the eta method.  It is not the uavg used when</span>
<span class="sd">    considering the vacuum as an equivalent surcharge.  You would have to do</span>
<span class="sd">    other manipulations for that.</span>

<span class="sd">    Noteing that :math:`s_i=r_i/r_w`, the radial pore pressure distribution</span>
<span class="sd">    in the smear zone is given by:</span>

<span class="sd">    .. math:: u^\\prime(r) = \\frac{u_{avg}-u_w}{\\mu+\\mu_w}</span>
<span class="sd">                            \\left[{</span>
<span class="sd">                                \\kappa\\left({</span>
<span class="sd">                                \\ln\\left({s_i}\\right)</span>
<span class="sd">                                -\\frac{1}{2n^2}\\left({s_i^2-1}\\right)</span>
<span class="sd">                                }\\right)</span>
<span class="sd">                                +\\mu_w</span>
<span class="sd">                            }\\right]+u_w</span>

<span class="sd">    The pore pressure in the undisturbed zone is:</span>

<span class="sd">    .. math:: u(r) = \\frac{u_{avg}-u_w}{\\mu+\\mu_w}</span>
<span class="sd">                            \\left[{</span>
<span class="sd">                                \\ln\\left({\\frac{s_i}{s}}\\right)</span>
<span class="sd">                                -\\frac{1}{2n^2}\\left({s_i^2-s^2}\\right)</span>
<span class="sd">                                +\\kappa\\left[{</span>
<span class="sd">                                \\ln\\left({s}\\right)</span>
<span class="sd">                                -\\frac{1}{2n^2}\\left({s^2-1}\\right)</span>
<span class="sd">                            }\\right]</span>
<span class="sd">                                +\\mu_w</span>
<span class="sd">                            }\\right]+u_w</span>

<span class="sd">        where:</span>

<span class="sd">    .. math:: n = \\frac{r_e}{r_w}</span>

<span class="sd">    .. math:: s = \\frac{r_s}{r_w}</span>

<span class="sd">    .. math:: \\kappa = \\frac{k_h}{k_s}</span>

<span class="sd">    :math:`r_w` is the drain radius, :math:`r_e` is the drain influence radius,</span>
<span class="sd">    :math:`r_s` is the smear zone radius, :math:`k_h` is the undisturbed</span>
<span class="sd">    horizontal permeability, :math:`k_s` is the smear zone horizontal</span>
<span class="sd">    permeability</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Hansbo, S. 1981. &#39;Consolidation of Fine-Grained Soils by</span>
<span class="sd">           Prefabricated Drains&#39;. In 10th ICSMFE, 3:677-82.</span>
<span class="sd">           Rotterdam-Boston: A.A. Balkema.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">constant_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;u in smear zone with constant permeability i.e from si=1 to si=s&quot;&quot;&quot;</span>

        <span class="n">term2</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">si</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">si</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">kap</span> <span class="o">*</span> <span class="n">term2</span>
        <span class="k">return</span> <span class="n">u</span>

    <span class="k">def</span> <span class="nf">undisturbed_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;u outside of smear zone with constant permeability i.e from si=1 to si=s&quot;&quot;&quot;</span>

        <span class="n">term4</span> <span class="o">=</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">si</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">si</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">s</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="o">+</span> <span class="n">kap</span> <span class="o">*</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">term4</span>
        <span class="k">return</span> <span class="n">u</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">&lt;=</span><span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n must be greater than 1. You have n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">n</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">s</span><span class="o">&lt;</span><span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be greater than 1. You have s = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">s</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">kap</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kap must be greater than 0. You have kap = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kap</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">s</span><span class="o">&gt;</span><span class="n">n</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be less than n. You have s = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> and n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
    <span class="n">si</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">si</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">((</span><span class="n">si</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">si</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;si must satisfy 1 &gt;= si &gt;= n)&#39;</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kap</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">u_ideal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">uavg</span><span class="p">,</span> <span class="n">uw</span><span class="p">,</span> <span class="n">muw</span><span class="p">)</span>




    <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_constant</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">)</span>
    <span class="n">term1</span> <span class="o">=</span> <span class="p">(</span><span class="n">uavg</span> <span class="o">-</span> <span class="n">uw</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mu</span> <span class="o">+</span> <span class="n">muw</span><span class="p">)</span>
    <span class="n">term2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">si</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">smear</span> <span class="o">=</span> <span class="p">(</span><span class="n">si</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">term2</span><span class="p">[</span><span class="n">smear</span><span class="p">]</span> <span class="o">=</span> <span class="n">constant_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">[</span><span class="n">smear</span><span class="p">])</span>
    <span class="n">term2</span><span class="p">[</span><span class="o">~</span><span class="n">smear</span><span class="p">]</span> <span class="o">=</span> <span class="n">undisturbed_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">[</span><span class="o">~</span><span class="n">smear</span><span class="p">])</span>


    <span class="n">u</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">*</span> <span class="p">(</span><span class="n">term2</span> <span class="o">+</span> <span class="n">muw</span><span class="p">)</span> <span class="o">+</span> <span class="n">uw</span>
    <span class="k">return</span> <span class="n">u</span></div>



<div class="viewcode-block" id="u_linear"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.u_linear">[docs]</a><span class="k">def</span> <span class="nf">u_linear</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">uavg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">uw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">muw</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pore pressure at radius for linear smear zone</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : float</span>
<span class="sd">        Ratio of drain influence radius  to drain radius (re/rw).</span>
<span class="sd">    s : float</span>
<span class="sd">        Ratio of smear zone radius to  drain radius (rs/rw).</span>
<span class="sd">    kap : float</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to permeability at</span>
<span class="sd">        the drain-soil interface (kh / ks).</span>
<span class="sd">    si : float of ndarray of float</span>
<span class="sd">        Normalised radial coordinate(s) at which to calc the pore pressure</span>
<span class="sd">        i.e. si=ri/rw.</span>
<span class="sd">    uavg : float, optional = 1</span>
<span class="sd">        Average pore pressure in soil. default = 1.  when `uw`=0 , then if</span>
<span class="sd">        uavg=1.</span>
<span class="sd">    uw : float, optional</span>
<span class="sd">        Pore pressure in drain, default = 0.</span>
<span class="sd">    muw : float, optional</span>
<span class="sd">        Well resistance mu parameter.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    u : float or ndarray of float</span>
<span class="sd">        Pore pressure at specified si.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The uavg is calculated from the eta method.  It is not the uavg used when</span>
<span class="sd">    considering the vacuum as an equivalent surcharge.  You would have to do</span>
<span class="sd">    other manipulations for that.</span>

<span class="sd">    Noteing that :math:`s_i=r_i/r_w`, the radial pore pressure distribution</span>
<span class="sd">    in the smear zone is given by:</span>

<span class="sd">    .. math:: u^\\prime(r) = \\frac{u_{avg}-u_w}{\\mu+\\mu_w}</span>
<span class="sd">                            \\left[{</span>
<span class="sd">                                \\kappa\\left({\\frac{1}{B}\\ln\\left({s_i}\\right)</span>
<span class="sd">                                +\\left({\\frac{B}{A^2n^2}-\\frac{1}{B}}\\right)</span>
<span class="sd">                                \\ln\\left({B+As_i}\\right)</span>
<span class="sd">                                +\\frac{1-s_i}{An^2}</span>
<span class="sd">                                }\\right)</span>
<span class="sd">                                +\\mu_w</span>
<span class="sd">                            }\\right]+u_w</span>

<span class="sd">    The pore pressure in the undisturbed zone is:</span>

<span class="sd">    .. math:: u(r) = \\frac{u_{avg}-u_w}{\\mu+\\mu_w}</span>
<span class="sd">                            \\left[{</span>
<span class="sd">                                \\ln\\left({\\frac{s_i}{s}}\\right)</span>
<span class="sd">                                -\\frac{s_i^2-s^2}{2n^2}</span>
<span class="sd">                                +\\kappa</span>
<span class="sd">                            \\left[{</span>
<span class="sd">                                \\frac{1}{B}\\ln\\left({s}\\right)</span>
<span class="sd">                                +\\left({\\frac{B}{A^2n^2}-\\frac{1}{B}}\\right)</span>
<span class="sd">                                \\ln\\left({\\kappa}\\right)</span>
<span class="sd">                                +\\frac{1-s}{An^2}</span>
<span class="sd">                            }\\right]</span>
<span class="sd">                                +\\mu_w</span>
<span class="sd">                            }\\right]+u_w</span>

<span class="sd">    for the special case where :math:`s=\\kappa` the pore pressure</span>
<span class="sd">    in the undisturbed zone is:</span>

<span class="sd">    .. math:: u^\\prime(r) = \\frac{u_{avg}-u_w}{\\mu+\\mu_w}</span>
<span class="sd">                            \\left[{</span>
<span class="sd">                                s\\frac{\\left({n^2-s_i}\\right)</span>
<span class="sd">                                    \\left({s_i-1}\\right)}{n^2s_i}</span>
<span class="sd">                                +\\mu_w</span>
<span class="sd">                            }\\right]+u_w</span>

<span class="sd">    The pore pressure in the undisturbed zone is:</span>

<span class="sd">        .. math:: u(r) = \\frac{u_{avg}-u_w}{\\mu+\\mu_w}</span>
<span class="sd">                            \\left[{</span>
<span class="sd">                                \\ln\\left({\\frac{s_i}{s}}\\right)</span>
<span class="sd">                                +s-1+\\frac{s}{n^2}</span>
<span class="sd">                                -\\frac{s_i^2-s^2}{2n^2}</span>
<span class="sd">                                +\\mu_w</span>
<span class="sd">                            }\\right]+u_w</span>

<span class="sd">    where:</span>

<span class="sd">    .. math:: n = \\frac{r_e}{r_w}</span>

<span class="sd">    .. math:: s = \\frac{r_s}{r_w}</span>

<span class="sd">    .. math:: \\kappa = \\frac{k_h}{k_s}</span>

<span class="sd">    :math:`r_w` is the drain radius, :math:`r_e` is the drain influence radius,</span>
<span class="sd">    :math:`r_s` is the smear zone radius, :math:`k_h` is the undisturbed</span>
<span class="sd">    horizontal permeability, :math:`k_s` is the smear zone horizontal</span>
<span class="sd">    permeability</span>

<span class="sd">    If :math:`s=1` or :math:`\\kappa=1` then u_ideal will be used.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Walker, R., and B. Indraratna. 2007. &#39;Vertical Drain Consolidation</span>
<span class="sd">           with Overlapping Smear Zones&#39;. Geotechnique 57 (5): 463-67.</span>
<span class="sd">           doi:10.1680/geot.2007.57.5.463.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">linear_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;u in smear zone with linear permeability i.e from si=1 to si=s&quot;&quot;&quot;</span>


        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">):</span>
            <span class="n">term2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">si</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">si</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">kap</span> <span class="o">*</span> <span class="n">term2</span>
            <span class="k">return</span> <span class="n">u</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">kap</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="n">kap</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">term2</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">si</span><span class="p">)</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">si</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span>
            <span class="n">term3</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">si</span> <span class="o">+</span> <span class="n">B</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">B</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">si</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span>

            <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">B</span> <span class="o">*</span> <span class="n">term2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">term3</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">kap</span> <span class="o">*</span> <span class="n">u</span>

        <span class="k">return</span> <span class="n">u</span>

    <span class="k">def</span> <span class="nf">undisturbed_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;u outside of smear zone with linear permeability i.e from si=1 to si=s&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">):</span>

            <span class="n">term2</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">si</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">si</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">s</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">term3</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">s</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">term2</span> <span class="o">+</span> <span class="n">kap</span> <span class="o">*</span> <span class="n">term3</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">u</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">kap</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="n">kap</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">term2</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">si</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">si</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">s</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">term3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">B</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="n">kap</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span>
                        <span class="p">(</span><span class="n">kap</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">B</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">kap</span><span class="p">)))</span>

            <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">term2</span> <span class="o">+</span> <span class="n">kap</span> <span class="o">*</span> <span class="n">term3</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">u</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">&lt;=</span><span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n must be greater than 1. You have n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">n</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">s</span><span class="o">&lt;</span><span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be greater than 1. You have s = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">s</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">kap</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kap must be greater than 0. You have kap = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kap</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">s</span><span class="o">&gt;</span><span class="n">n</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be less than n. You have s = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> and n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
    <span class="n">si</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">si</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">((</span><span class="n">si</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">si</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;si must satisfy 1 &gt;= si &gt;= n)&#39;</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kap</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">u_ideal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">uavg</span><span class="p">,</span> <span class="n">uw</span><span class="p">,</span> <span class="n">muw</span><span class="p">)</span>


    <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_linear</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">)</span>
    <span class="n">term1</span> <span class="o">=</span> <span class="p">(</span><span class="n">uavg</span> <span class="o">-</span> <span class="n">uw</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mu</span> <span class="o">+</span> <span class="n">muw</span><span class="p">)</span>
    <span class="n">term2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">si</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">smear</span> <span class="o">=</span> <span class="p">(</span><span class="n">si</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">term2</span><span class="p">[</span><span class="n">smear</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">[</span><span class="n">smear</span><span class="p">])</span>
    <span class="n">term2</span><span class="p">[</span><span class="o">~</span><span class="n">smear</span><span class="p">]</span> <span class="o">=</span> <span class="n">undisturbed_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">[</span><span class="o">~</span><span class="n">smear</span><span class="p">])</span>


    <span class="n">u</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">*</span> <span class="p">(</span><span class="n">term2</span> <span class="o">+</span> <span class="n">muw</span><span class="p">)</span> <span class="o">+</span> <span class="n">uw</span>
    <span class="k">return</span> <span class="n">u</span></div>


<div class="viewcode-block" id="u_parabolic"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.u_parabolic">[docs]</a><span class="k">def</span> <span class="nf">u_parabolic</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">uavg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">uw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">muw</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pore pressure at radius for parabolic smear zone</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : float</span>
<span class="sd">        Ratio of drain influence radius  to drain radius (re/rw).</span>
<span class="sd">    s : float</span>
<span class="sd">        Ratio of smear zone radius to  drain radius (rs/rw).</span>
<span class="sd">    kap : float</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to permeability at</span>
<span class="sd">        the drain-soil interface (kh / ks).</span>
<span class="sd">    si : float of ndarray of float</span>
<span class="sd">        Normalised radial coordinate(s) at which to calc the pore pressure</span>
<span class="sd">        i.e. si=ri/rw.</span>
<span class="sd">    uavg : float, optional = 1</span>
<span class="sd">        Average pore pressure in soil. default = 1.  when `uw`=0 , then if</span>
<span class="sd">        uavg=1.</span>
<span class="sd">    uw : float, optional</span>
<span class="sd">        Pore pressure in drain, default = 0.</span>
<span class="sd">    muw : float, optional</span>
<span class="sd">        Well resistance mu parameter.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    u : float of ndarray of float</span>
<span class="sd">        Pore pressure at specified si.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The uavg is calculated from the eta method.  It is not the uavg used when</span>
<span class="sd">    considering the vacuum as an equivalent surcharge.  You would have to do</span>
<span class="sd">    other manipulations for that.</span>

<span class="sd">    Noteing that :math:`s_i=r_i/r_w`, the radial pore pressure distribution</span>
<span class="sd">    in the smear zone is given by:</span>

<span class="sd">    .. math:: u^\\prime(r) = \\frac{u_{avg}-u_w}{\\mu+\\mu_w}</span>
<span class="sd">                            \\left[{</span>
<span class="sd">                                \\frac{\\kappa}{\\kappa-1}\\left\\{{</span>
<span class="sd">                                \\frac{1}{A^2-B^2}</span>
<span class="sd">                                    \\left({</span>
<span class="sd">                                    \\ln\\left({s_i}\\right)</span>
<span class="sd">                                    -\\frac{1}{2A}</span>
<span class="sd">                                        \\left[{</span>
<span class="sd">                                        \\left({A-B}\\right)F</span>
<span class="sd">                                        +\\left({A+B}\\right)G</span>
<span class="sd">                                        }\\right]</span>
<span class="sd">                                    }\\right)</span>
<span class="sd">                                    +\\frac{1}{2n^2AC}</span>
<span class="sd">                                        \\left[{</span>
<span class="sd">                                        \\left({A+B}\\right)F</span>
<span class="sd">                                        +\\left({A-B}\\right)G</span>
<span class="sd">                                        }\\right]</span>
<span class="sd">                                }\\right\\}</span>
<span class="sd">                                +\\mu_w</span>
<span class="sd">                            }\\right]+u_w</span>

<span class="sd">    The pore pressure in the undisturbed zone is:</span>

<span class="sd">    .. math:: u(r) = \\frac{u_{avg}-u_w}{\\mu+\\mu_w}</span>
<span class="sd">                            \\left[{</span>
<span class="sd">                                \\ln\\left({\\frac{s_i}{s}}\\right)</span>
<span class="sd">                                -\\frac{s_i^2-s^2}{2n^2}</span>
<span class="sd">                                +A^2</span>
<span class="sd">                            \\left[{</span>
<span class="sd">                                \\frac{1}{A^2-B^2}</span>
<span class="sd">                                    \\left({</span>
<span class="sd">                                        \\ln\\left({s}\\right)</span>
<span class="sd">                                        -\\frac{1}{2}\\left[{</span>
<span class="sd">                                            \\ln\\left({\\kappa}\\right)</span>
<span class="sd">                                            +\\frac{BE}{A}}\\right]</span>
<span class="sd">                                    }\\right)</span>
<span class="sd">                                +\\frac{1}{2n^2C^2}</span>
<span class="sd">                                    \\left({\\ln\\left({\\kappa}\\right)</span>
<span class="sd">                                    -\\frac{BE}{A}}\\right)</span>
<span class="sd">                            }\\right]</span>
<span class="sd">                                +\\mu_w</span>
<span class="sd">                            }\\right]+u_w</span>

<span class="sd">    where :math:`A`, :math:`B`, :math:`C`, :math:`E`, :math:`F`, and</span>
<span class="sd">    :math:`G`  are:</span>

<span class="sd">    .. math:: A=\\sqrt{\\frac{\\kappa}{\\kappa-1}}</span>

<span class="sd">    .. math:: B=\\frac{s}{s-1}</span>

<span class="sd">    .. math:: C=\\frac{1}{s-1}</span>

<span class="sd">    .. math:: E=\\ln\\left({\\frac{A+1}{A-1}}\\right)</span>

<span class="sd">    .. math:: F(r/r_w) = \\ln\\left({\\frac{A+B-Cs_i}{A+1}}\\right)</span>

<span class="sd">    .. math:: G(r/r_w) = \\ln\\left({\\frac{A-B+Cs_i}{A-1}}\\right)</span>


<span class="sd">    and:</span>

<span class="sd">    .. math:: n = \\frac{r_e}{r_w}</span>

<span class="sd">    .. math:: s = \\frac{r_s}{r_w}</span>

<span class="sd">    .. math:: \\kappa = \\frac{k_h}{k_s}</span>


<span class="sd">    :math:`r_w` is the drain radius, :math:`r_e` is the drain influence radius,</span>
<span class="sd">    :math:`r_s` is the smear zone radius, :math:`k_h` is the undisturbed</span>
<span class="sd">    horizontal permeability, :math:`k_s` is the smear zone horizontal</span>
<span class="sd">    permeability</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Walker, Rohan, and Buddhima Indraratna. 2006. &#39;Vertical Drain</span>
<span class="sd">           Consolidation with Parabolic Distribution of Permeability in</span>
<span class="sd">           Smear Zone&#39;. Journal of Geotechnical and Geoenvironmental</span>
<span class="sd">           Engineering 132 (7): 937-41.</span>
<span class="sd">           doi:10.1061/(ASCE)1090-0241(2006)132:7(937).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">parabolic_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;u in smear zone with parabolic permeability i.e from si=1 to si=s&quot;&quot;&quot;</span>


        <span class="n">A</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">kap</span> <span class="o">/</span> <span class="p">(</span><span class="n">kap</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">s</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">log</span><span class="p">((</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">log</span><span class="p">((</span><span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">-</span> <span class="n">C</span> <span class="o">*</span> <span class="n">si</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">log</span><span class="p">((</span><span class="n">A</span> <span class="o">-</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="n">si</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">term1</span> <span class="o">=</span> <span class="n">kap</span> <span class="o">/</span> <span class="p">(</span><span class="n">kap</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">term2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">B</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">term3</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">si</span><span class="p">)</span>
        <span class="n">term4</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">A</span><span class="p">)</span>
        <span class="n">term5</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">B</span><span class="p">)</span> <span class="o">*</span> <span class="n">F</span> <span class="o">+</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span> <span class="o">*</span> <span class="n">G</span>
        <span class="n">term6</span> <span class="o">=</span> <span class="n">term2</span> <span class="o">*</span> <span class="p">(</span><span class="n">term3</span> <span class="o">+</span> <span class="n">term4</span> <span class="o">*</span> <span class="n">term5</span><span class="p">)</span>

        <span class="n">term7</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">C</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">term8</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span> <span class="o">*</span> <span class="n">F</span> <span class="o">+</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">B</span><span class="p">)</span> <span class="o">*</span> <span class="n">G</span>
        <span class="n">term9</span> <span class="o">=</span> <span class="n">term7</span> <span class="o">*</span> <span class="n">term8</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">*</span> <span class="p">(</span><span class="n">term6</span> <span class="o">+</span> <span class="n">term9</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">u</span>

    <span class="k">def</span> <span class="nf">undisturbed_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;u outside of smear zone with parabolic permeability i.e from si=1 to si=s&quot;&quot;&quot;</span>

        <span class="n">A</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">kap</span> <span class="o">/</span> <span class="p">(</span><span class="n">kap</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">s</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">log</span><span class="p">((</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">term1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">term2</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">si</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">si</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">s</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">term3</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">B</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">term4</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span> <span class="o">+</span> <span class="n">B</span> <span class="o">/</span> <span class="n">A</span> <span class="o">*</span> <span class="n">E</span><span class="p">)</span>
        <span class="n">term5</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">C</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">term6</span> <span class="o">=</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span> <span class="o">-</span> <span class="n">B</span> <span class="o">/</span> <span class="n">A</span> <span class="o">*</span> <span class="n">E</span><span class="p">)</span>
        <span class="n">term7</span> <span class="o">=</span> <span class="n">kap</span> <span class="o">/</span> <span class="p">(</span><span class="n">kap</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">term3</span> <span class="o">*</span> <span class="n">term4</span> <span class="o">+</span> <span class="n">term5</span> <span class="o">*</span> <span class="n">term6</span><span class="p">)</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">*</span> <span class="p">(</span><span class="n">term2</span> <span class="o">+</span> <span class="n">term7</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">u</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">&lt;=</span><span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n must be greater than 1. You have n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">n</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">s</span><span class="o">&lt;</span><span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be greater than 1. You have s = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">s</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">kap</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kap must be greater than 0. You have kap = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kap</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">s</span><span class="o">&gt;</span><span class="n">n</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be less than n. You have s = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> and n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
    <span class="n">si</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">si</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">((</span><span class="n">si</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">si</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;si must satisfy 1 &gt;= si &gt;= n)&#39;</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kap</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">u_ideal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">uavg</span><span class="p">,</span> <span class="n">uw</span><span class="p">,</span> <span class="n">muw</span><span class="p">)</span>




    <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_parabolic</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">)</span>
    <span class="n">term1</span> <span class="o">=</span> <span class="p">(</span><span class="n">uavg</span> <span class="o">-</span> <span class="n">uw</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mu</span> <span class="o">+</span> <span class="n">muw</span><span class="p">)</span>
    <span class="n">term2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">si</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">smear</span> <span class="o">=</span> <span class="p">(</span><span class="n">si</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">term2</span><span class="p">[</span><span class="n">smear</span><span class="p">]</span> <span class="o">=</span> <span class="n">parabolic_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">[</span><span class="n">smear</span><span class="p">])</span>
    <span class="n">term2</span><span class="p">[</span><span class="o">~</span><span class="n">smear</span><span class="p">]</span> <span class="o">=</span> <span class="n">undisturbed_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">[</span><span class="o">~</span><span class="n">smear</span><span class="p">])</span>


    <span class="n">u</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">*</span> <span class="p">(</span><span class="n">term2</span> <span class="o">+</span> <span class="n">muw</span><span class="p">)</span> <span class="o">+</span> <span class="n">uw</span>
    <span class="k">return</span> <span class="n">u</span></div>


<div class="viewcode-block" id="u_piecewise_constant"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.u_piecewise_constant">[docs]</a><span class="k">def</span> <span class="nf">u_piecewise_constant</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">uavg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">uw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">muw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kap_m</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pore pressure at radius for piecewise constant permeability distribution</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s : list or 1d ndarray of float</span>
<span class="sd">        Ratio of segment outer radii to drain radius (r_i/r_0). The first value</span>
<span class="sd">        of s should be greater than 1, i.e. the first value should be s_1;</span>
<span class="sd">        s_0=1 at the drain soil interface is implied.</span>
<span class="sd">    kap : list or ndarray of float</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to permeability in each</span>
<span class="sd">        segment kh/khi.</span>
<span class="sd">    si : float of ndarray of float</span>
<span class="sd">        Normalised radial coordinate(s) at which to calc the pore pressure</span>
<span class="sd">        i.e. si=ri/rw.</span>
<span class="sd">    uavg : float, optional = 1</span>
<span class="sd">        Average pore pressure in soil. default = 1.  when `uw`=0 , then if</span>
<span class="sd">        uavg=1.</span>
<span class="sd">    uw : float, optional</span>
<span class="sd">        Pore pressure in drain, default = 0.</span>
<span class="sd">    muw : float, optional</span>
<span class="sd">        Well resistance mu parameter</span>
<span class="sd">    n, kap_m : float, optional</span>
<span class="sd">        If `n` and `kap_m` are given then they will each be appended to `s` and</span>
<span class="sd">        `kap`. This allows the specification of a smear zone separate to the</span>
<span class="sd">        specification of the drain influence radius.</span>
<span class="sd">        Default n=kap_m=None, i.e. soilpermeability is completely described</span>
<span class="sd">        by `s` and `kap`. If n is given but kap_m is None then the last</span>
<span class="sd">        kappa value in kap will be used.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    u : float of ndarray of float</span>
<span class="sd">        Pore pressure at specified si.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The pore pressure in the ith segment is given by:</span>

<span class="sd">    .. math:: u_i(r) = \\frac{u_{avg}-u_w}{\\mu+\\mu_w}</span>
<span class="sd">                            \\left[{</span>
<span class="sd">                                \\kappa_i\\left({\\ln\\left({\\frac{r}{r_{i-1}}}\\right)</span>
<span class="sd">                                -\\frac{r^2/r_0^2-s_{i-1}^2}{2n^2}}\\right)</span>
<span class="sd">                                +\\psi_i+\\mu_w</span>
<span class="sd">                            }\\right]+u_w</span>

<span class="sd">    where,</span>

<span class="sd">    .. math:: \\psi_{i} = \\sum\\limits_{j=1}^{i-1}\\kappa_j</span>
<span class="sd">                \\left[{</span>
<span class="sd">                        \\ln</span>
<span class="sd">                            \\left({</span>
<span class="sd">                                \\frac{s_j}{s_{j-1}}</span>
<span class="sd">                            }\\right)</span>
<span class="sd">                        -\\frac{s_j^2-s_{j-1}^2}{2n^2}</span>
<span class="sd">                    }\\right]</span>

<span class="sd">    and:</span>

<span class="sd">    .. math:: n = \\frac{r_m}{r_0}</span>

<span class="sd">    .. math:: s_i = \\frac{r_i}{r_0}</span>

<span class="sd">    .. math:: \\kappa_i = \\frac{k_h}{k_{hi}}</span>


<span class="sd">    :math:`r_0` is the drain radius, :math:`r_m` is the drain influence radius,</span>
<span class="sd">    :math:`r_i` is the outer radius of the ith segment,</span>
<span class="sd">    :math:`k_h` is the undisturbed</span>
<span class="sd">    horizontal permeability in the ith segment,</span>
<span class="sd">    :math:`k_{hi}` is the horizontal</span>
<span class="sd">    permeability in the ith segment</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Walker, Rohan. 2006. &#39;Analytical Solutions for Modeling Soft Soil</span>
<span class="sd">           Consolidation by Vertical Drains&#39;. PhD Thesis, Wollongong, NSW,</span>
<span class="sd">           Australia: University of Wollongong. http://ro.uow.edu.au/theses/501</span>
<span class="sd">    .. [2] Walker, Rohan T. 2011. &#39;Vertical Drain Consolidation Analysis in</span>
<span class="sd">           One, Two and Three Dimensions&#39;. Computers and</span>
<span class="sd">           Geotechnics 38 (8): 1069-77. doi:10.1016/j.compgeo.2011.07.006.</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">s_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">s_temp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
        <span class="n">s_temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">kap_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">kap_temp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap</span>
        <span class="k">if</span> <span class="n">kap_m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kap_temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kap_temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap_m</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s_temp</span>
        <span class="n">kap</span> <span class="o">=</span> <span class="n">kap_temp</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s and kap must have the same shape.  You have &#39;</span>
            <span class="s1">&#39;lengths for s, kap of </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">s</span><span class="o">&lt;=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must have all s&gt;=1. You have s = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">kap</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;all kap must be greater than 0. You have kap = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must increase left to right you have s = &#39;</span>
        <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)])))</span>





    <span class="n">n</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">si</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">si</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">((</span><span class="n">si</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">si</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;si must satisfy 1 &gt;= si &gt;= s[-1])&#39;</span><span class="p">)</span>

    <span class="n">s_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">s_</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">si</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span> <span class="p">)</span>

    <span class="n">segment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">si</span><span class="p">)</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_piecewise_constant</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">)</span>

    <span class="n">term1</span> <span class="o">=</span> <span class="p">(</span><span class="n">uavg</span> <span class="o">-</span> <span class="n">uw</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mu</span> <span class="o">+</span> <span class="n">muw</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">segment</span><span class="p">):</span>

        <span class="n">sumj</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">sumj</span> <span class="o">+=</span> <span class="p">(</span><span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">s_</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">s_</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
        <span class="n">sumj</span> <span class="o">=</span> <span class="n">sumj</span> <span class="o">/</span> <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">u</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">log</span><span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">/</span> <span class="n">s_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">s_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">sumj</span>
                <span class="p">)</span> <span class="o">+</span> <span class="n">muw</span>

    <span class="n">u</span> <span class="o">*=</span> <span class="n">term1</span>
    <span class="n">u</span> <span class="o">+=</span> <span class="n">uw</span>
    <span class="k">return</span> <span class="n">u</span></div>


<div class="viewcode-block" id="u_piecewise_linear"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.u_piecewise_linear">[docs]</a><span class="k">def</span> <span class="nf">u_piecewise_linear</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">uavg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">uw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">muw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kap_m</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pore pressure at radius for piecewise constant permeability distribution</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s : list or 1d ndarray of float</span>
<span class="sd">        Ratio of radii to drain radius (r_i/r_0). The first value</span>
<span class="sd">        of s should be 1, i.e. at the drain soil interface.</span>
<span class="sd">    kap : list or ndarray of float</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to permeability at each</span>
<span class="sd">        value of s.</span>
<span class="sd">    si : float of ndarray of float</span>
<span class="sd">        Normalised radial coordinate(s) at which to calc the pore pressure</span>
<span class="sd">        i.e. si=ri/rw.</span>
<span class="sd">    uavg : float, optional = 1</span>
<span class="sd">        Average pore pressure in soil. default = 1.  when `uw`=0 , then if</span>
<span class="sd">        uavg=1.</span>
<span class="sd">    uw : float, optional</span>
<span class="sd">        Pore pressure in drain, default = 0.</span>
<span class="sd">    muw : float, optional</span>
<span class="sd">        Well resistance mu parameter.</span>
<span class="sd">    n, kap_m : float, optional</span>
<span class="sd">        If `n` and `kap_m` are given then they will each be appended to `s` and</span>
<span class="sd">        `kap`. This allows the specification of a smear zone separate to the</span>
<span class="sd">        specification of the drain influence radius.</span>
<span class="sd">        Default n=kap_m=None, i.e. soilpermeability is completely described</span>
<span class="sd">        by `s` and `kap`. If n is given but kap_m is None then the last</span>
<span class="sd">        kappa value in kap will be used.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    u : float or ndarray of float</span>
<span class="sd">        Pore pressure at specified si.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    With permeability in the ith segment defined by:</span>

<span class="sd">    .. math:: \\frac{k_i}{k_{ref}}= \\frac{1}{\\kappa_{i-1}}</span>
<span class="sd">                    \\left({A_ir/r_w+B_i}\\right)</span>

<span class="sd">    .. math:: A_i = \\frac{\\kappa_{i-1}/\\kappa_i-1}{s_i-s_{i-1}}</span>

<span class="sd">    .. math:: B_i = \\frac{s_i-s_{i-1}\\kappa_{i-1}/\\kappa_i}{s_i-s_{i-1}}</span>

<span class="sd">    The pore pressure in the ith segment is given by:</span>

<span class="sd">    .. math:: u_i(s) = \\frac{u_{avg}-u_w}{\\mu+\\mu_w}</span>
<span class="sd">                            \\left[{</span>
<span class="sd">                            \\sum\\limits_{i=1}^{m}\\kappa_{i-1}\\phi_i</span>
<span class="sd">                            + \\Psi_i</span>
<span class="sd">                            +\\mu_w</span>
<span class="sd">                        }\\right]+u_w</span>

<span class="sd">    where,</span>

<span class="sd">    .. math:: \\phi_i = \\left\\{</span>
<span class="sd">                            \\begin{array}{lr}</span>
<span class="sd">                            \\ln\\left[{\\frac{s}{s_{i-1}}}\\right]</span>
<span class="sd">                            - \\frac{s^2- s_{i-1}^2}{2n^2}</span>
<span class="sd">                            &amp; \\textrm{for } \\frac{\\kappa_{i-1}}{\\kappa_i}=1 \\\\</span>
<span class="sd">                            \\frac{\\left({s - s_{i-1}}\\right)</span>
<span class="sd">                                \\left({n^2-ss_{i-1}}\\right)}{sn^2}</span>
<span class="sd">                            &amp; \\textrm{for }\\frac{\\kappa_{i-1}}{\\kappa_i}=</span>
<span class="sd">                             \\frac{s_i}{s_{i-1}} \\\\</span>
<span class="sd">                             \\begin{multline}</span>
<span class="sd">                            \\frac{1}{B_i}\\ln\\left[{\\frac{s}{s_{i-1}}}\\right]</span>
<span class="sd">                                +\\ln\\left[{A_is+B_i}\\right]</span>
<span class="sd">                                \\left({\\frac{B_i}{A_i^2n^2}-\\frac{1}{B_i}}\\right)</span>
<span class="sd">                                \\\\-\\frac{s-s_{i-1}}{A_i^2n^2}</span>
<span class="sd">                            \\end{multline}</span>
<span class="sd">                            &amp; \\textrm{otherwise}</span>
<span class="sd">                            \\end{array}\\right.</span>

<span class="sd">    .. math:: \\Psi_i = \\sum\\limits_{j=1}^{i-1}\\kappa_{j-1}\\psi_j</span>

<span class="sd">    .. math:: \\psi_i = \\left\\{</span>
<span class="sd">                            \\begin{array}{lr}</span>
<span class="sd">                            \\ln\\left[{\\frac{s_j}{s_{j-1}}}\\right]</span>
<span class="sd">                            - \\frac{s_j^2- s_{j-1}^2}{2n^2}</span>
<span class="sd">                            &amp; \\textrm{for } \\frac{\\kappa_{j-1}}{\\kappa_j}=1 \\\\</span>
<span class="sd">                            \\frac{\\left({s_j - s_{j-1}}\\right)</span>
<span class="sd">                                \\left({n^2-s_js_{j-1}}\\right)}{s_jn^2}</span>
<span class="sd">                            &amp; \\textrm{for }\\frac{\\kappa_{j-1}}{\\kappa_j}=</span>
<span class="sd">                             \\frac{s_j}{s_{j-1}} \\\\</span>
<span class="sd">                             \\begin{multline}</span>
<span class="sd">                            \\frac{1}{B_i}\\ln\\left[{\\frac{s_j}{s_{j-1}}}\\right]</span>
<span class="sd">                                +\\ln\\left[{\\frac{\\kappa_{j-1}}{\\kappa_j}}\\right]</span>
<span class="sd">                                \\left({\\frac{B_j}{A_j^2n^2}-\\frac{1}{B_j}}\\right)</span>
<span class="sd">                                \\\\-\\frac{s_j-s_{j-1}}{A_j^2n^2}</span>
<span class="sd">                            \\end{multline}</span>
<span class="sd">                            &amp; \\textrm{otherwise}</span>
<span class="sd">                            \\end{array}\\right.</span>



<span class="sd">    and:</span>

<span class="sd">    .. math:: n = \\frac{r_m}{r_0}</span>

<span class="sd">    .. math:: s_i = \\frac{r_i}{r_0}</span>

<span class="sd">    .. math:: \\kappa_i = \\frac{k_h}{k_{ref}}</span>


<span class="sd">    :math:`r_0` is the drain radius, :math:`r_m` is the drain influence radius,</span>
<span class="sd">    :math:`r_i` is the radius of the ith radial point,</span>
<span class="sd">    :math:`k_{ref}` is a convienient refernce permeability, usually</span>
<span class="sd">    the undisturbed</span>
<span class="sd">    horizontal permeability,</span>
<span class="sd">    :math:`k_{hi}` is the horizontal</span>
<span class="sd">    permeability at the ith radial point</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Derived by Rohan Walker in 2011 and 2014.</span>
<span class="sd">    Derivation steps are the same as for mu_piecewise_constant in appendix of</span>
<span class="sd">    [1]_ but permeability is linear in a segemetn as in [2]_.</span>

<span class="sd">    .. [1] Walker, Rohan. 2006. &#39;Analytical Solutions for Modeling Soft Soil</span>
<span class="sd">           Consolidation by Vertical Drains&#39;. PhD Thesis, Wollongong, NSW,</span>
<span class="sd">           Australia: University of Wollongong. http://ro.uow.edu.au/theses/501</span>
<span class="sd">    .. [2] Walker, R., and B. Indraratna. 2007. &#39;Vertical Drain Consolidation</span>
<span class="sd">           with Overlapping Smear Zones&#39;. Geotechnique 57 (5): 463-67.</span>
<span class="sd">           doi:10.1680/geot.2007.57.5.463.</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">s_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">s_temp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
        <span class="n">s_temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">kap_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">kap_temp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap</span>
        <span class="k">if</span> <span class="n">kap_m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kap_temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kap_temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap_m</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s_temp</span>
        <span class="n">kap</span> <span class="o">=</span> <span class="n">kap_temp</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s and kap must have the same shape.  You have &#39;</span>
            <span class="s1">&#39;lengths for s, kap of </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">s</span><span class="o">&lt;</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must have all s&gt;=1. You have s = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">kap</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;all kap must be greater than 0. You have kap = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must increase left to right. you have s = &#39;</span>
        <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)])))</span>


    <span class="n">n</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">si</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">si</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">((</span><span class="n">si</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">si</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;si must satisfy 1 &gt;= si &gt;= s[-1])&#39;</span><span class="p">)</span>

    <span class="n">s_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">s_</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">si</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">segment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">si</span><span class="p">)</span>
    <span class="n">segment</span><span class="p">[</span><span class="n">segment</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># put si=1 in first segment</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_piecewise_linear</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">)</span>

    <span class="n">term1</span> <span class="o">=</span> <span class="p">(</span><span class="n">uavg</span> <span class="o">-</span> <span class="n">uw</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mu</span> <span class="o">+</span> <span class="n">muw</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">segment</span><span class="p">):</span>



        <span class="c1">#phi</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">):</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">/</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">si</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">B</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">/</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">B</span><span class="o">/</span><span class="n">A</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">B</span><span class="p">)</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">si</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span>
                    <span class="o">-</span> <span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">A</span><span class="o">/</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">psi</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">):</span>
                <span class="n">psi</span> <span class="o">+=</span> <span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">psi</span> <span class="o">+=</span> <span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">((</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">/</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">psi</span> <span class="o">+=</span> <span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">B</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="o">+</span> <span class="p">(</span><span class="n">B</span><span class="o">/</span><span class="n">A</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">B</span><span class="p">)</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span>
                        <span class="o">-</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">A</span><span class="o">/</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">u</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">phi</span> <span class="o">+</span> <span class="n">psi</span> <span class="o">+</span> <span class="n">muw</span>

    <span class="n">u</span> <span class="o">*=</span> <span class="n">term1</span>
    <span class="n">u</span> <span class="o">+=</span> <span class="n">uw</span>
    <span class="k">return</span> <span class="n">u</span></div>


<div class="viewcode-block" id="re_from_drain_spacing"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.re_from_drain_spacing">[docs]</a><span class="k">def</span> <span class="nf">re_from_drain_spacing</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">pattern</span> <span class="o">=</span> <span class="s1">&#39;Triangle&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate drain influence radius from drain spacing</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sp : float</span>
<span class="sd">        Distance between drain centers.</span>
<span class="sd">    pattern : [&#39;Triangle&#39;, &#39;Square&#39;], optional</span>
<span class="sd">        Drain installation pattern. default = &#39;Triangle&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    re : float</span>
<span class="sd">        drain influence radius</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    The influence radius, :math:`r_e`, is given by:</span>

<span class="sd">    .. math:: r_e =</span>
<span class="sd">                \\left\\{\\begin{array}{lr}</span>
<span class="sd">                S_p \\frac{1}{\\sqrt{\\pi}}=S_p\\times 0.564189583</span>
<span class="sd">                &amp; \\textrm{square pattern}\\\\</span>
<span class="sd">                S_p \\sqrt{\\frac{\\sqrt{3}}{2\\pi}}=S_p\\times 0.525037567</span>
<span class="sd">                &amp; \\textrm{triangular pattern}</span>
<span class="sd">                \\end{array}\\right.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Eta method is described in [1]_.</span>

<span class="sd">    .. [1] Walker, Rohan T. 2011. &#39;Vertical Drain Consolidation Analysis in</span>
<span class="sd">           One, Two and Three Dimensions&#39;. Computers and</span>
<span class="sd">           Geotechnics 38 (8): 1069-77. doi:10.1016/j.compgeo.2011.07.006.</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;sp must be greater than zero.  &#39;</span>
                            <span class="s1">&#39;You have sp=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">pattern</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;T&#39;</span><span class="p">:</span>
        <span class="n">re</span> <span class="o">=</span> <span class="mf">0.525037567904332</span> <span class="o">*</span> <span class="n">sp</span> <span class="c1"># factor = (3**0.5/2/np.pi)**0.5</span>
    <span class="k">elif</span> <span class="n">pattern</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;S&#39;</span><span class="p">:</span>
        <span class="n">re</span> <span class="o">=</span> <span class="mf">0.5641895835477563</span> <span class="o">*</span> <span class="n">sp</span> <span class="c1">#factor = 1 / np.pi**0.5</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;pattern must begin with &#39;T&#39; for triangular &quot;</span>
                        <span class="s2">&quot; or &#39;S&#39; for square.  You have pattern=&quot;</span>
                        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">re</span></div>

<div class="viewcode-block" id="drain_eta"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.drain_eta">[docs]</a><span class="k">def</span> <span class="nf">drain_eta</span><span class="p">(</span><span class="n">re</span><span class="p">,</span> <span class="n">mu_function</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the vertical drain eta parameter for a specific smear zone</span>

<span class="sd">    eta = 2 / re**2 / (mu+muw)</span>

<span class="sd">    eta is used in radial consolidation equations u= u0 * exp(-eta*kh/gamw*t)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    re : float</span>
<span class="sd">        Drain influence radius.</span>
<span class="sd">    mu_function : obj or string</span>
<span class="sd">        The mu_funtion to use. e.g. mu_ideal, mu_constant, mu_linear,</span>
<span class="sd">        mu_overlapping_linear, mu_parabolic, mu_piecewise_constant,</span>
<span class="sd">        mu_piecewise_linear. This can either be the function object itself</span>
<span class="sd">        or the name of the function e.g. &#39;mu_ideal&#39;.</span>
<span class="sd">    muw : float, optional</span>
<span class="sd">        Well resistance mu term, default=0.</span>
<span class="sd">    *args, **kwargs : various</span>
<span class="sd">        The arguments to pass to the mu_function.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    eta : float</span>
<span class="sd">        Value of eta parameter</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; drain_eta(1.5, mu_ideal, 10)</span>
<span class="sd">    0.563178340433...</span>
<span class="sd">    &gt;&gt;&gt; drain_eta(1.5, &#39;mu_ideal&#39;, 10)</span>
<span class="sd">    0.5631783404334...</span>
<span class="sd">    &gt;&gt;&gt; drain_eta(1.5, mu_constant, 5, 1.5, 1.6, muw=1)</span>
<span class="sd">    0.4115837724144...</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">mu_fn</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">mu_function</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">mu_fn</span> <span class="o">=</span> <span class="n">mu_function</span>

    <span class="n">muw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;muw&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">re</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">mu_fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">+</span><span class="n">muw</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">eta</span></div>


<div class="viewcode-block" id="back_calc_drain_spacing_from_eta"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.back_calc_drain_spacing_from_eta">[docs]</a><span class="k">def</span> <span class="nf">back_calc_drain_spacing_from_eta</span><span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">mu_function</span><span class="p">,</span> <span class="n">rw</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">muw</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Back calculate the required drain spacing to achieve a given eta</span>

<span class="sd">    eta = 2 / re**2 / (mu + muw)</span>

<span class="sd">    eta is used in radial consolidation equations u= u0 * exp(-eta*kh/gamw*t)</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    eta : float</span>
<span class="sd">        eta value.</span>
<span class="sd">    pattern : [&#39;Triangle&#39;, &#39;Square&#39;]</span>
<span class="sd">        Drain installation pattern.</span>
<span class="sd">    mu_function : obj</span>
<span class="sd">        The mu_funtion to use. e.g. mu_ideal, mu_constant, mu_linear,</span>
<span class="sd">        mu_overlapping_linear, mu_parabolic, mu_piecewise_constant,</span>
<span class="sd">        mu_piecewise_linear.</span>
<span class="sd">    rw : float</span>
<span class="sd">        Drain/well radius.</span>
<span class="sd">    s : float or 1d array_like of float</span>
<span class="sd">        Ratio of smear zone radius to drain radius (rs/rw).  s can only be</span>
<span class="sd">        a 1d array is using a mu_piecewise function</span>
<span class="sd">    kap : float or 1d array_like of float</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to permeability at</span>
<span class="sd">        in smear zone (kh / ks) (often at the drain-soil interface).  Be</span>
<span class="sd">        careful when defining s and kap for mu_piecewise_constant, and</span>
<span class="sd">        mu_piecewise_linear because the last value of kap will be used at</span>
<span class="sd">        the influence drain periphery.  In general the last value of kap</span>
<span class="sd">        should be one, representing the start of the undisturbed zone.</span>
<span class="sd">    muw : float, optional</span>
<span class="sd">        Well resistance mu term, default=0.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sp : float</span>
<span class="sd">        Drain spacing to get the required eta value</span>
<span class="sd">    re : float</span>
<span class="sd">        Drain influence radius</span>
<span class="sd">    n : float</span>
<span class="sd">        Ratio of drain influence radius to drain radius, re/rw</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    When using mu_piecewise_linear or mu_piecewise_constant only define s and</span>
<span class="sd">    kap up to the start of the undisturbed zone.  re will be varied.</span>

<span class="sd">    For anyting other than mu_overlapping_linear do not trust any returned</span>
<span class="sd">    spacing that gives an n value less than the extent of the smear zone.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">calc_eta</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">rw</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">mu_function</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">muw</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;eta from a given spacing value</span>

<span class="sd">        used in root finding</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">re</span> <span class="o">=</span> <span class="n">re_from_drain_spacing</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">re</span><span class="o">/</span><span class="n">rw</span>

        <span class="k">if</span> <span class="n">mu_function</span> <span class="o">!=</span> <span class="n">mu_ideal</span><span class="p">:</span>
            <span class="k">if</span>  <span class="n">n</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">mu_function</span> <span class="o">!=</span> <span class="n">mu_overlapping_linear</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;In determining required drain &#39;</span>
                        <span class="s1">&#39;spacing, n has fallen &#39;</span>
                        <span class="s1">&#39;below s. s=</span><span class="si">{}</span><span class="s1">, n=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">n</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">mu_function</span> <span class="ow">in</span> <span class="p">[</span><span class="n">mu_piecewise_constant</span><span class="p">,</span> <span class="n">mu_piecewise_linear</span><span class="p">]:</span>
            <span class="n">eta_</span> <span class="o">=</span> <span class="n">drain_eta</span><span class="p">(</span><span class="n">re</span><span class="p">,</span> <span class="n">mu_function</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span> <span class="n">muw</span> <span class="o">=</span> <span class="n">muw</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">eta_</span> <span class="o">=</span> <span class="n">drain_eta</span><span class="p">(</span><span class="n">re</span><span class="p">,</span> <span class="n">mu_function</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">muw</span><span class="o">=</span><span class="n">muw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">eta_</span> <span class="o">-</span> <span class="n">eta</span>

    <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">fsolve</span>


    <span class="k">if</span> <span class="ow">not</span> <span class="n">mu_function</span> <span class="ow">in</span> <span class="p">[</span><span class="n">mu_piecewise_constant</span><span class="p">,</span> <span class="n">mu_piecewise_linear</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;for mu_function=</span><span class="si">{}</span><span class="s1">, you cannot have multiple &#39;</span>
                <span class="s1">&#39;values for s. s=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mu_function</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;for mu_function=</span><span class="si">{}</span><span class="s1">, you cannot have multiple &#39;</span>
                <span class="s1">&#39;values for kap. kap=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mu_function</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">kap</span><span class="p">))</span>

    <span class="n">x0</span> <span class="o">=</span> <span class="n">rw</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="mi">2</span> <span class="c1"># this ensures guess is beyond smear zone</span>
    <span class="n">calc_eta</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">rw</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">mu_function</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">muw</span> <span class="p">)</span>
    <span class="n">sp</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">calc_eta</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="n">rw</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">mu_function</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">muw</span><span class="p">))</span>

    <span class="n">re</span> <span class="o">=</span> <span class="n">re_from_drain_spacing</span><span class="p">(</span><span class="n">sp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pattern</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">re</span><span class="o">/</span><span class="n">rw</span>

    <span class="k">if</span> <span class="n">mu_function</span> <span class="o">!=</span> <span class="n">mu_ideal</span><span class="p">:</span>
        <span class="k">if</span>  <span class="n">n</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mu_function</span> <span class="o">!=</span> <span class="n">mu_overlapping_linear</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;calculated spacing results in n&lt;s. s=</span><span class="si">{}</span><span class="s1">, n=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">n</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">sp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">re</span><span class="p">,</span> <span class="n">n</span></div>


<span class="k">def</span> <span class="nf">_g</span><span class="p">(</span><span class="n">r_rw</span><span class="p">,</span> <span class="n">re_rw</span><span class="p">,</span> <span class="n">nflow</span><span class="o">=</span><span class="mf">1.0001</span><span class="p">,</span> <span class="n">nterms</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Non-darcian equal strain radial consolidation term</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r_rw : float</span>
<span class="sd">        Ratio of radial coordinate to drain radius (r/rw).</span>
<span class="sd">    re_rw : float</span>
<span class="sd">        Ratio of drain influence radius to drain readius (re/rw).</span>
<span class="sd">        You will often see this ratio expressed as re/re=n. However, this is</span>
<span class="sd">        confusing with the non-darcian flow exponent.</span>
<span class="sd">    nflow : float, optional</span>
<span class="sd">        Non-Darcian flow exponent. Default nflow=1.0001 i.e. darcian flow.</span>
<span class="sd">        Using nflow=1 will result in an error.</span>
<span class="sd">    nterms : int, optional</span>
<span class="sd">        Number of summation terms.  Default nterms=20.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    g : float</span>
<span class="sd">        Non-darcian equal strain radial consolidation term.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The &#39;g&#39; function arises in the derivation of equal strain radial</span>
<span class="sd">    consolidation equations under non-Darcian flow.</span>

<span class="sd">    We only concern ourselves with the exponential part of Hansbo&#39;s</span>
<span class="sd">    Non-darcian flow relationship:</span>

<span class="sd">    .. math::</span>

<span class="sd">       v=k^{\\ast}i^{n}</span>

<span class="sd">    where,</span>

<span class="sd">    :math:`k^{\\ast}` is a peremability, :math:`i` is hydraulic gradient and</span>
<span class="sd">    :math:`n` is the flow exponent.</span>

<span class="sd">    The expression :math:`g\\left({y}\\right)` is given below. :math:`y` is</span>
<span class="sd">    the ratio of radial coordinate :math:`r` to drain radius :math:`r_w`,</span>
<span class="sd">    :math:`y=r/r_w`. :math:`N` is the ratio of influence radius :math:`r_e`</span>
<span class="sd">    to drain radius :math:`r_w`, :math:`N=r_e/r_w`.</span>

<span class="sd">    .. math::</span>

<span class="sd">       g\\left({y}\\right)=</span>
<span class="sd">           ny^{1-1/n}\sum\limits_{j=0}^\\infty</span>
<span class="sd">           \\frac{\\left\\{{-1/n}\\right\\}_j}</span>
<span class="sd">                 {j!\\left({\\left({2j+1}\\right)n-1}\\right)}</span>
<span class="sd">           \\left({\\frac{y}{N}}\\right)^{2j}</span>


<span class="sd">    :math:`\\left\\{x\\right\\}_m` is the Pochhammer symbol or rising</span>
<span class="sd">    factorial given by:</span>

<span class="sd">    .. math::</span>
<span class="sd">       \\left\\{x\\right\\}_m = x</span>
<span class="sd">                                \\left({x+1}\\right)</span>
<span class="sd">                                \\left({x+2}\\right)</span>
<span class="sd">                                \\dots</span>
<span class="sd">                                \\left({x+m-1}\\right)</span>


<span class="sd">    .. math::</span>

<span class="sd">       \\left\\{x\\right\\}_0=1</span>

<span class="sd">    Alterantely a recurrance relatoin can be formed:</span>

<span class="sd">    .. math::</span>

<span class="sd">       g\\left({y}\\right)=</span>
<span class="sd">           \sum\limits_{j=0}^{\\infty} a_j</span>

<span class="sd">    where,</span>

<span class="sd">    .. math::</span>

<span class="sd">       a_0=\\frac{n}{n-1}y^{1-1/n}</span>

<span class="sd">    .. math::</span>

<span class="sd">       a_j = a_{j-1}</span>
<span class="sd">           \\frac{\\left({jn-n-1}\\right)\\left({2jn-n-1}\\right)}</span>
<span class="sd">           {nj\\left({2jn+n-1}\\right)}</span>
<span class="sd">           \\left({\\frac{y}{N}}\\right)^{2}</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; _g(10.0, 50.0, nflow=1.2)</span>
<span class="sd">    8.7841...</span>
<span class="sd">    &gt;&gt;&gt; _g(10.0, 20.0, nflow=1.2)</span>
<span class="sd">    8.664...</span>
<span class="sd">    &gt;&gt;&gt; _g(2, 50.0, nflow=1.01)</span>
<span class="sd">    101.694...</span>
<span class="sd">    &gt;&gt;&gt; _g(5, 5, nflow=1.01)</span>
<span class="sd">    102.120...</span>
<span class="sd">    &gt;&gt;&gt; _g(10.0, np.array([50.0,20]), nflow=1.2)</span>
<span class="sd">    array([8.7841..., 8.664...])</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    _gbar : multiply _g by y and integrate w.r.t y</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">r_rw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r_rw</span><span class="p">)</span>
    <span class="n">re_rw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">re_rw</span><span class="p">)</span>
    <span class="n">nflow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nflow</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">r_rw</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;r_rw must be greater or equal to 1. &#39;</span>
                         <span class="s1">&#39;You have r_rw = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">r_rw</span><span class="p">)])))</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">re_rw</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;re_rw must be greater than 1. &#39;</span>
                         <span class="s1">&#39;You have re_rw = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">re_rw</span><span class="p">)])))</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">nflow</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;nflow must be greater than 1. &#39;</span>
                         <span class="s1">&#39;You have nflow = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">nflow</span><span class="p">)])))</span>




    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span>
                <span class="p">[</span><span class="n">r_rw</span><span class="p">,</span> <span class="n">re_rw</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">]]):</span>
        <span class="c1">#array inputs, use series loop</span>
        <span class="n">g</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">term1</span> <span class="o">=</span> <span class="n">nflow</span> <span class="o">*</span> <span class="n">r_rw</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">nflow</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nterms</span><span class="p">):</span>

            <span class="n">term2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">poch</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="n">term3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="n">term4</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nflow</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">term5</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_rw</span> <span class="o">/</span> <span class="n">re_rw</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span><span class="p">)</span>
            <span class="n">g</span> <span class="o">+=</span> <span class="n">term2</span> <span class="o">/</span> <span class="n">term3</span> <span class="o">/</span> <span class="n">term4</span> <span class="o">*</span> <span class="n">term5</span>

        <span class="n">g</span> <span class="o">*=</span> <span class="n">term1</span>
        <span class="k">return</span> <span class="n">g</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#scalar inputs, use recursion relationship</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nterms</span><span class="p">)</span>

        <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">nflow</span> <span class="o">/</span> <span class="p">(</span><span class="n">nflow</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">r_rw</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">nflow</span><span class="p">)</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span>
        <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_rw</span> <span class="o">/</span> <span class="n">re_rw</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*=</span> <span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">nflow</span> <span class="o">-</span> <span class="n">nflow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">nflow</span> <span class="o">-</span> <span class="n">nflow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">/=</span> <span class="n">nflow</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">nflow</span> <span class="o">+</span> <span class="n">nflow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">np</span><span class="o">.</span><span class="n">cumprod</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
        <span class="n">g</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">g</span>


<span class="k">def</span> <span class="nf">_gbar</span><span class="p">(</span><span class="n">r_rw</span><span class="p">,</span> <span class="n">re_rw</span><span class="p">,</span> <span class="n">nflow</span><span class="o">=</span><span class="mf">1.0001</span><span class="p">,</span> <span class="n">nterms</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Non-darcian equal strain radial consolidation term</span>

<span class="sd">    _g expression multiplied by y and integrated w.r.t. y</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r_rw : float</span>
<span class="sd">        Ratio of radial coordinate to drain radius (r/rw).</span>
<span class="sd">    re_rw : float</span>
<span class="sd">        Ratio of drain influence radius to drain readius (re/rw).</span>
<span class="sd">        You will often see this ratio expressed as re/re=n. However, this is</span>
<span class="sd">        confusing with the non-darcian flow exponent.</span>
<span class="sd">    nflow : int, optional</span>
<span class="sd">        Non-Darcian flow exponent. Default nflow=1.0001 i.e. darcian flow.</span>
<span class="sd">        Using nflow=1 will result in an error.</span>

<span class="sd">    nterms : float, optional</span>
<span class="sd">        Number of summation terms.  Default nterms=20.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    gbar : float</span>
<span class="sd">        Non-darcian equal strain radial consolidation term.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The &#39;gbar&#39; (bar stands for overbar) function arises in the derivation</span>
<span class="sd">    of equal strain radial consolidation equations under non-Darcian flow.</span>

<span class="sd">    We only concern ourselves with the exponential part of Hansbo&#39;s</span>
<span class="sd">    Non-darcian flow relationship:</span>

<span class="sd">    .. math::</span>

<span class="sd">       v=k^{\\ast}i^{n}</span>

<span class="sd">    where,</span>

<span class="sd">    :math:`k^{\\ast}` is a peremability, :math:`i` is hydraulic gradient and</span>
<span class="sd">    :math:`n` is the flow exponent.</span>

<span class="sd">    The expression :math:`g\\left({y}\\right)` is given below. :math:`y` is</span>
<span class="sd">    the ratio of radial coordinate :math:`r` to drain radius :math:`r_w`,</span>
<span class="sd">    :math:`y=r/r_w`. :math:`N` is the ratio of influence radius :math:`r_e`</span>
<span class="sd">    to drain radius :math:`r_w`, :math:`N=r_e/r_w`.</span>

<span class="sd">    .. math::</span>

<span class="sd">       \\overline{g}\\left({y}\\right)=</span>
<span class="sd">           n^2y^{3-1/n}\sum\limits_{j=0}^\\infty</span>
<span class="sd">           \\frac{\\left\\{{-1/n}\\right\\}_j}</span>
<span class="sd">                 {j!\\left({\\left({2j+1}\\right)n-1}\\right)</span>
<span class="sd">                  \\left({\\left({2j+3}\\right)n-1}\\right)}</span>
<span class="sd">           \\left({\\frac{y}{N}}\\right)^{2j}</span>


<span class="sd">    :math:`\\left\\{x\\right\\}_m` is the Pochhammer symbol or rising</span>
<span class="sd">    factorial given by:</span>

<span class="sd">    .. math::</span>
<span class="sd">       \\left\\{x\\right\\}_m = x</span>
<span class="sd">                                \\left({x+1}\\right)</span>
<span class="sd">                                \\left({x+2}\\right)</span>
<span class="sd">                                \\dots</span>
<span class="sd">                                \\left({x+m-1}\\right)</span>


<span class="sd">    .. math::</span>

<span class="sd">       \\left\\{x\\right\\}_0=1</span>

<span class="sd">    Alterantely a recurrance relatoin can be formed:</span>

<span class="sd">    .. math::</span>

<span class="sd">       \\overline{g}\\left({y}\\right)=</span>
<span class="sd">           \sum\limits_{j=0}^{\\infty} a_j</span>

<span class="sd">    where,</span>

<span class="sd">    .. math::</span>

<span class="sd">       a_0=\\frac{n^2}{\\left({n-1}\\right)\\left({3n-1}\\right)}y^{3-1/n}</span>

<span class="sd">    .. math::</span>

<span class="sd">       a_j = a_{j-1}</span>
<span class="sd">           \\frac{\\left({jn-n-1}\\right)\\left({2jn-n-1}\\right)}</span>
<span class="sd">           {nj\\left({2jn+3n-1}\\right)}</span>
<span class="sd">           \\left({\\frac{y}{N}}\\right)^{2}</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; _gbar(10.0, 50.0, nflow=1.2)</span>
<span class="sd">    405.924...</span>
<span class="sd">    &gt;&gt;&gt; _gbar(10.0, 20.0, nflow=1.2)</span>
<span class="sd">    403.0541...</span>
<span class="sd">    &gt;&gt;&gt; _gbar(2, 50.0, nflow=1.01)</span>
<span class="sd">    202.3883...</span>
<span class="sd">    &gt;&gt;&gt; _gbar(5, 5, nflow=1.01)</span>
<span class="sd">    1273.3329...</span>
<span class="sd">    &gt;&gt;&gt; _gbar(10.0, np.array([50.0,20]), nflow=1.2)</span>
<span class="sd">    array([405.924..., 403.0541...])</span>


<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    _g : earlier step in derivation of `_gbar`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">r_rw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r_rw</span><span class="p">)</span>
    <span class="n">re_rw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">re_rw</span><span class="p">)</span>
    <span class="n">nflow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nflow</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">r_rw</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;r_rw must be greater or equal to 1. &#39;</span>
                         <span class="s1">&#39;You have r_rw = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">r_rw</span><span class="p">)])))</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">re_rw</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;re_rw must be greater than 1. &#39;</span>
                         <span class="s1">&#39;You have re_rw = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">re_rw</span><span class="p">)])))</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">nflow</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;nflow must be greater than 1. &#39;</span>
                         <span class="s1">&#39;You have nflow = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">nflow</span><span class="p">)])))</span>




    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span>
                <span class="p">[</span><span class="n">r_rw</span><span class="p">,</span> <span class="n">re_rw</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">]]):</span>
        <span class="c1">#array inputs, use series loop</span>
        <span class="n">gbar</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">term1</span> <span class="o">=</span> <span class="n">nflow</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">r_rw</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">nflow</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nterms</span><span class="p">):</span>

            <span class="n">term2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">poch</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="n">term3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="n">term4</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nflow</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">term4a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">nflow</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">term5</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_rw</span><span class="o">/</span><span class="n">re_rw</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">j</span><span class="p">)</span>
            <span class="n">gbar</span> <span class="o">+=</span> <span class="n">term2</span><span class="o">/</span><span class="n">term3</span><span class="o">/</span><span class="n">term4</span><span class="o">/</span><span class="n">term4a</span><span class="o">*</span><span class="n">term5</span>

        <span class="n">gbar</span> <span class="o">*=</span> <span class="n">term1</span>
        <span class="k">return</span> <span class="n">gbar</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nterms</span><span class="p">)</span>

        <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">nflow</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">nflow</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">nflow</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">r_rw</span><span class="o">**</span><span class="p">(</span><span class="mf">3.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">nflow</span><span class="p">)</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span>
        <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_rw</span> <span class="o">/</span> <span class="n">re_rw</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*=</span> <span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">nflow</span> <span class="o">-</span> <span class="n">nflow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">nflow</span> <span class="o">-</span> <span class="n">nflow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">/=</span> <span class="n">nflow</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">nflow</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">nflow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">np</span><span class="o">.</span><span class="n">cumprod</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
        <span class="n">gbar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">gbar</span>


<div class="viewcode-block" id="non_darcy_beta_ideal"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.non_darcy_beta_ideal">[docs]</a><span class="k">def</span> <span class="nf">non_darcy_beta_ideal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">nflow</span><span class="o">=</span><span class="mf">1.0001</span><span class="p">,</span> <span class="n">nterms</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Non-darcian flow smear zone permeability/geometry parameter for</span>
<span class="sd">    ideal drain (no smear).</span>

<span class="sd">    beta parameter is in equal strain radial consolidation equations  with</span>
<span class="sd">    non-Darcian flow.</span>



<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : float or ndarray of float</span>
<span class="sd">        Ratio of drain influence radius to drain radius (re/rw).</span>
<span class="sd">    nflow : float, optional</span>
<span class="sd">        non_darcian flow exponent</span>
<span class="sd">    nterms : int, optional</span>
<span class="sd">        Number of terms to use in series</span>
<span class="sd">    args : anything</span>
<span class="sd">        `args` does not contribute to any calculations it is merely so you</span>
<span class="sd">        can have other arguments such as s and kappa which are used in other</span>
<span class="sd">        smear zone formulations.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    beta : float</span>
<span class="sd">        Smear zone permeability/geometry parameter.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    .. math::</span>

<span class="sd">       \\beta = \\frac{1}{N^2-1}</span>
<span class="sd">           \\left({</span>
<span class="sd">               2\\overline{g}\\left({N}\\right)</span>
<span class="sd">               -2\\overline{g}\\left({1}\\right)</span>
<span class="sd">               -g\\left({1}\\right) \\left({N^2-1}\\right)</span>
<span class="sd">                  }\\right)</span>

<span class="sd">    :math:`g\\left({y}\\right)` and :math:`\\overline{g}\\left({y}\\right)`</span>
<span class="sd">    are described in the `_g` and `_gbar` functions respectively.</span>

<span class="sd">    .. math:: n = \\frac{r_e}{r_w}</span>

<span class="sd">    :math:`r_w` is the drain radius, :math:`r_e` is the drain influence radius.</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; non_darcy_beta_ideal(20, 1.000001, nterms=20)</span>
<span class="sd">    2.2538...</span>
<span class="sd">    &gt;&gt;&gt; non_darcy_beta_ideal(np.array([20, 10]), 1.000001, nterms=20)</span>
<span class="sd">    array([2.253..., 1.578...])</span>
<span class="sd">    &gt;&gt;&gt; non_darcy_beta_ideal(15, 1.3)</span>
<span class="sd">    2.618...</span>
<span class="sd">    &gt;&gt;&gt; non_darcy_beta_ideal(np.array([20, 15]), np.array([1.000001,1.3]), nterms=20)</span>
<span class="sd">    array([2.253..., 2.618...])</span>


<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    _g : used in this function.</span>
<span class="sd">    _gbar : used in this function.</span>


<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Hansbo, S. 1981. &quot;Consolidation of Fine-Grained Soils by</span>
<span class="sd">           Prefabricated Drains&quot;. In 10th ICSMFE, 3:677-82.</span>
<span class="sd">           Rotterdam-Boston: A.A. Balkema.</span>
<span class="sd">    .. [2] Walker, R., B. Indraratna, and C. Rujikiatkamjorn.</span>
<span class="sd">           &quot;Vertical Drain Consolidation with Non-Darcian Flow and</span>
<span class="sd">           Void-Ratio-Dependent Compressibility and Permeability.&quot;</span>
<span class="sd">           Geotechnique 62, no. 11 (November 1, 2012): 985-97.</span>
<span class="sd">           doi:10.1680/geot.10.P.084.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">nflow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nflow</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n must be greater than 1. &#39;</span>
                         <span class="s1">&#39;You have n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">n</span><span class="p">)])))</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">nflow</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;nflow must be greater than 1. &#39;</span>
                         <span class="s1">&#39;You have nflow = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">nflow</span><span class="p">)])))</span>


<span class="c1">#    if nflow==1:</span>
<span class="c1">#        raise ValueError(&#39;nflow must not be 1.&#39;)</span>
<span class="c1">##    if n &lt;= 1:</span>
<span class="c1">##        raise ValueError(&#39;n must be greater than 1. You have n = {}&#39;.format(</span>
<span class="c1">##            n))</span>
<span class="c1">#    if np.any(n &lt;= 1):</span>
<span class="c1">#        raise ValueError(&#39;n must be greater than 1. You have n = {}&#39;.format(</span>
<span class="c1">#            &#39;, &#39;.join([str(v) for v in np.atleast_1d(n)])))</span>
<span class="c1">#    beta = _g(1, n, nflow, nterms)</span>
<span class="c1">#    beta *= n**2 - 1</span>
<span class="c1">#    beta += 2 * _gbar(n, n, nflow, nterms)</span>
<span class="c1">#    beta -= 2 * _gbar(1, n, nflow, nterms)</span>
<span class="c1">#    beta /= n**2 - 1</span>

<span class="c1">#    g = _g2</span>
<span class="c1">#    gbar = _gbar2</span>

    <span class="n">beta</span> <span class="o">=</span> <span class="o">-</span><span class="n">_g</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">*=</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">beta</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_gbar</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_gbar</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">/=</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">beta</span></div>

<div class="viewcode-block" id="non_darcy_beta_constant"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.non_darcy_beta_constant">[docs]</a><span class="k">def</span> <span class="nf">non_darcy_beta_constant</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">nflow</span><span class="o">=</span><span class="mf">1.0001</span><span class="p">,</span> <span class="n">nterms</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Non-darcian flow smear zone permeability/geometry parameter for</span>
<span class="sd">    smear zone with constant permeability.</span>

<span class="sd">    beta parameter is in equal strain radial consolidation equations  with</span>
<span class="sd">    non-Darcian flow.</span>



<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : float or ndarray of float</span>
<span class="sd">        Ratio of drain influence radius to drain radius (re/rw).</span>
<span class="sd">    s : float or ndarray of float</span>
<span class="sd">        Ratio of smear zone radius to  drain radius (rs/rw)</span>
<span class="sd">    kap : float or ndarray of float.</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to smear zone</span>
<span class="sd">        horizontal permeanility (kh / ks).</span>
<span class="sd">    nflow : float, optional</span>
<span class="sd">        non_darcian flow exponent</span>
<span class="sd">    nterms : int, optional</span>
<span class="sd">        Number of terms to use in series</span>
<span class="sd">    args : anything</span>
<span class="sd">        `args` does not contribute to any calculations it is merely so you</span>
<span class="sd">        can have other arguments such as s and kappa which are used in other</span>
<span class="sd">        smear zone formulations.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    beta : float</span>
<span class="sd">        Smear zone permeability/geometry parameter.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    .. math::</span>

<span class="sd">       \\beta = \\frac{1}{N^2-1}</span>
<span class="sd">           \\left({</span>
<span class="sd">               \\begin{multline}</span>
<span class="sd">               2\\overline{g}\\left({N}\\right)</span>
<span class="sd">               -\\kappa^{1/n}\\left({</span>
<span class="sd">                   2\\overline{g}\\left({1}\\right)</span>
<span class="sd">                   + g\\left({1}\\right) \\left({N^2-1}\\right)</span>
<span class="sd">                                    }\\right) \\\\</span>
<span class="sd">               +\\left({\\kappa^{1/n}-1}\\right)\\left({</span>
<span class="sd">                   2\\overline{g}\\left({s}\\right)</span>
<span class="sd">                   + g\\left({s}\\right) \\left({N^2-s^2}\\right)</span>
<span class="sd">                                                       }\\right)</span>
<span class="sd">                \\end{multline}</span>
<span class="sd">                  }\\right)</span>



<span class="sd">    :math:`g\\left({y}\\right)` and :math:`\\overline{g}\\left({y}\\right)`</span>
<span class="sd">    are described in the `_g` and `_gbar` functions respectively.</span>

<span class="sd">    .. math:: n = \\frac{r_e}{r_w}</span>

<span class="sd">    .. math:: s = \\frac{r_s}{r_w}</span>

<span class="sd">    .. math:: \\kappa = \\frac{k_h}{k_s}</span>

<span class="sd">    :math:`r_w` is the drain radius, :math:`r_e` is the drain influence radius,</span>
<span class="sd">    :math:`r_s` is the smear zone radius, :math:`k_h` is the undisturbed</span>
<span class="sd">    horizontal permeability, :math:`k_s` is the smear zone horizontal</span>
<span class="sd">    permeability.</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; non_darcy_beta_constant(20,1,1, 1.000001, nterms=20)</span>
<span class="sd">    2.2538...</span>
<span class="sd">    &gt;&gt;&gt; non_darcy_beta_constant(20,5,5, 1.000001, nterms=20)</span>
<span class="sd">    8.4710...</span>
<span class="sd">    &gt;&gt;&gt; non_darcy_beta_constant(15, 5, 4, 1.3, nterms=20)</span>
<span class="sd">    6.1150...</span>
<span class="sd">    &gt;&gt;&gt; non_darcy_beta_constant(np.array([20, 15]), 5,</span>
<span class="sd">    ... np.array([5,4]), np.array([1.000001, 1.3]), nterms=20)</span>
<span class="sd">    array([8.471..., 6.1150...])</span>



<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    _g : used in this function.</span>
<span class="sd">    _gbar : used in this function.</span>


<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Hansbo, S. 1981. &quot;Consolidation of Fine-Grained Soils by</span>
<span class="sd">           Prefabricated Drains&quot;. In 10th ICSMFE, 3:677-82.</span>
<span class="sd">           Rotterdam-Boston: A.A. Balkema.</span>
<span class="sd">    .. [2] Walker, R., B. Indraratna, and C. Rujikiatkamjorn.</span>
<span class="sd">           &quot;Vertical Drain Consolidation with Non-Darcian Flow and</span>
<span class="sd">           Void-Ratio-Dependent Compressibility and Permeability.&quot;</span>
<span class="sd">           Geotechnique 62, no. 11 (November 1, 2012): 985-97.</span>
<span class="sd">           doi:10.1680/geot.10.P.084.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>
    <span class="n">nflow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nflow</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n must be greater than 1. &#39;</span>
                         <span class="s1">&#39;You have n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">n</span><span class="p">)])))</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">s</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must be greater or equal to 1. &#39;</span>
                             <span class="s1">&#39;You have n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)])))</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">kap</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kap must be greater or equal to 1. &#39;</span>
                         <span class="s1">&#39;You have kap = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)])))</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">nflow</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;nflow must be greater than 1. &#39;</span>
                         <span class="s1">&#39;You have nflow = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">nflow</span><span class="p">)])))</span>


    <span class="n">beta</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_gbar</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">-=</span> <span class="n">kap</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">nflow</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="n">_gbar</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">_g</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">beta</span> <span class="o">+=</span> <span class="p">(</span><span class="n">kap</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">nflow</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="n">_gbar</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">_g</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">beta</span> <span class="o">/=</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>



    <span class="k">return</span> <span class="n">beta</span></div>


<div class="viewcode-block" id="non_darcy_beta_piecewise_constant"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.non_darcy_beta_piecewise_constant">[docs]</a><span class="k">def</span> <span class="nf">non_darcy_beta_piecewise_constant</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kap_m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                       <span class="n">nflow</span><span class="o">=</span><span class="mf">1.0001</span><span class="p">,</span> <span class="n">nterms</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Non-darcian flow smear zone permeability/geometry parameter for</span>
<span class="sd">    smear zone with piecewise constant permeability.</span>

<span class="sd">    beta parameter is in equal strain radial consolidation equations  with</span>
<span class="sd">    non-Darcian flow.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s : list or 1d ndarray of float</span>
<span class="sd">        Ratio of segment outer radii to drain radius (r_i/r_0). The first value</span>
<span class="sd">        of s should be greater than 1, i.e. the first value should be s_1;</span>
<span class="sd">        s_0=1 at the drain soil interface is implied.</span>
<span class="sd">    kap : list or ndarray of float</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to permeability in each</span>
<span class="sd">        segment kh/khi.</span>
<span class="sd">    n, kap_m : float, optional</span>
<span class="sd">        If `n` and `kap_m` are given then they will each be appended to `s` and</span>
<span class="sd">        `kap`. This allows the specification of a smear zone separate to the</span>
<span class="sd">        specification of the drain influence radius.</span>
<span class="sd">        Default n=kap_m=None, i.e. soil permeability is completely described</span>
<span class="sd">        by `s` and `kap`. If n is given but kap_m is None then the last</span>
<span class="sd">        kappa value in kap will be used.</span>
<span class="sd">    nflow : float, optional</span>
<span class="sd">        non_darcian flow exponent</span>
<span class="sd">    nterms : int, optional</span>
<span class="sd">        Number of terms to use in series</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    beta : float</span>
<span class="sd">        Smear zone permeability/geometry parameter.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    The non-darcian smear zone parameter :math:`\\beta` is given by:</span>

<span class="sd">    .. math:: \\beta = \\frac{1}{\\left({n^2-1}\\right)}</span>
<span class="sd">                \\sum\\limits_{i=1}^{m} \\kappa^{1/n}_i</span>
<span class="sd">                    \\left[{</span>
<span class="sd">                        2\\overline{g}\\left({s_i}\\right)</span>
<span class="sd">                        -2\\overline{g}\\left({s_{i-1}}\\right)</span>
<span class="sd">                    }\\right]</span>
<span class="sd">                    +\\psi_i \\left({s_i^2-s_{i-1}^2}\\right)</span>

<span class="sd">    where,</span>

<span class="sd">    .. math:: \\psi_{i} = \\sum\\limits_{j=1}^{i-1}\\kappa^{1/n}_j</span>
<span class="sd">                \\left[{</span>
<span class="sd">                        g\\left({s_j}\\right)</span>
<span class="sd">                        -g\\left({s_{j-1}}\\right)</span>
<span class="sd">                    }\\right]</span>

<span class="sd">    and:</span>

<span class="sd">    .. math:: n = \\frac{r_m}{r_0}</span>

<span class="sd">    .. math:: s_i = \\frac{r_i}{r_0}</span>

<span class="sd">    .. math:: \\kappa_i = \\frac{k_h}{k_{hi}}</span>


<span class="sd">    :math:`r_0` is the drain radius, :math:`r_m` is the drain influence radius,</span>
<span class="sd">    :math:`r_i` is the outer radius of the ith segment,</span>
<span class="sd">    :math:`k_h` is the undisturbed</span>
<span class="sd">    horizontal permeability in the ith segment,</span>
<span class="sd">    :math:`k_{hi}` is the horizontal</span>
<span class="sd">    permeability in the ith segment</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; mu_piecewise_constant([1.5, 3, 4],[2, 3, 1], n=5)</span>
<span class="sd">    2.2533...</span>
<span class="sd">    &gt;&gt;&gt; non_darcy_beta_piecewise_constant(s=np.array([1.5, 3, 4]),</span>
<span class="sd">    ... kap=np.array([2, 3, 1]), n=5, nflow=1.000001)</span>
<span class="sd">    2.2533...</span>


<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    None because it is new.</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">s_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">s_temp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
        <span class="n">s_temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">kap_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">kap_temp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap</span>
        <span class="k">if</span> <span class="n">kap_m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kap_temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kap_temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap_m</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s_temp</span>
        <span class="n">kap</span> <span class="o">=</span> <span class="n">kap_temp</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s and kap must have the same shape.  You have &#39;</span>
            <span class="s1">&#39;lengths for s, kap of </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">s</span><span class="o">&lt;=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must have all s&gt;=1. You have s = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">kap</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;all kap must be greater than 0. You have kap = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must increase left to right you have s = &#39;</span>
        <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">nflow</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;nflow must be greater than 1. &#39;</span>
                         <span class="s1">&#39;You have nflow = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">nflow</span><span class="p">)])))</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">s_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">s</span> <span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">s_</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">sumi</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">psi</span><span class="o">+=</span> <span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">nflow</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span>
                    <span class="n">_g</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span>
                    <span class="o">-</span> <span class="n">_g</span><span class="p">(</span><span class="n">s_</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span>
                    <span class="p">)</span>
        <span class="n">psi</span> <span class="o">/=</span> <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">nflow</span><span class="p">)</span>


        <span class="n">sumi</span> <span class="o">+=</span> <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">nflow</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="n">_gbar</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span>
            <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_gbar</span><span class="p">(</span><span class="n">s_</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span>
            <span class="o">+</span><span class="p">(</span><span class="n">psi</span> <span class="o">-</span> <span class="n">_g</span><span class="p">(</span><span class="n">s_</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span> <span class="p">)</span><span class="o">*</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="n">beta</span> <span class="o">=</span> <span class="n">sumi</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">beta</span></div>


<div class="viewcode-block" id="non_darcy_u_piecewise_constant"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.non_darcy_u_piecewise_constant">[docs]</a><span class="k">def</span> <span class="nf">non_darcy_u_piecewise_constant</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">uavg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">uw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">muw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                   <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kap_m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">nflow</span><span class="o">=</span><span class="mf">1.0001</span><span class="p">,</span> <span class="n">nterms</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pore pressure at radius for piecewise constant permeability distribution</span>

<span class="sd">    .. warning::</span>
<span class="sd">        `muw` must always be zero. i.e. no well resistance (It exists to have</span>
<span class="sd">        the same inputs as `u_piecewise_constant`.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s : list or 1d ndarray of float</span>
<span class="sd">        Ratio of segment outer radii to drain radius (r_i/r_0). The first value</span>
<span class="sd">        of s should be greater than 1, i.e. the first value should be s_1;</span>
<span class="sd">        s_0=1 at the drain soil interface is implied.</span>
<span class="sd">    kap : list or ndarray of float</span>
<span class="sd">        Ratio of undisturbed horizontal permeability to permeability in each</span>
<span class="sd">        segment kh/khi.</span>
<span class="sd">    si : float of ndarray of float</span>
<span class="sd">        Normalised radial coordinate(s) at which to calc the pore pressure</span>
<span class="sd">        i.e. si=ri/rw.</span>
<span class="sd">    uavg : float, optional = 1</span>
<span class="sd">        Average pore pressure in soil. default = 1.  when `uw`=0 , then if</span>
<span class="sd">        uavg=1.</span>
<span class="sd">    uw : float, optional</span>
<span class="sd">        Pore pressure in drain, default = 0.</span>
<span class="sd">    muw : float, optional</span>
<span class="sd">        Well resistance mu parameter. Default = 0</span>
<span class="sd">    n, kap_m : float, optional</span>
<span class="sd">        If `n` and `kap_m` are given then they will each be appended to `s` and</span>
<span class="sd">        `kap`. This allows the specification of a smear zone separate to the</span>
<span class="sd">        specification of the drain influence radius.</span>
<span class="sd">        Default n=kap_m=None, i.e. soilpermeability is completely described</span>
<span class="sd">        by `s` and `kap`. If n is given but kap_m is None then the last</span>
<span class="sd">        kappa value in kap will be used.</span>
<span class="sd">    nflow : float, optional</span>
<span class="sd">        non_darcian flow exponent</span>
<span class="sd">    nterms : int, optional</span>
<span class="sd">        Number of terms to use in series</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    u : float of ndarray of float</span>
<span class="sd">        Pore pressure at specified si.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    non_darcy_u_piecewise_constant()</span>
<span class="sd">    The pore pressure in the ith segment is given by:</span>

<span class="sd">    .. math:: u_i(y) = \\frac{u_{avg}-u_w}{\\mu+\\mu_w}</span>
<span class="sd">                            \\left[{</span>
<span class="sd">                                \\kappa^{1/n}_i</span>
<span class="sd">                                  \\left({</span>
<span class="sd">                                    g\\left({y}\\right)</span>
<span class="sd">                                    -g\\left({s_{i-1}}\\right)</span>
<span class="sd">                                         }\\right)</span>
<span class="sd">                                +\\psi_i</span>
<span class="sd">                            }\\right]+u_w</span>


<span class="sd">    where,</span>

<span class="sd">    .. math:: \\psi_{i} = \\sum\\limits_{j=1}^{i-1}\\kappa^{1/n}_j</span>
<span class="sd">                \\left[{</span>
<span class="sd">                        g\\left({s_j}\\right)</span>
<span class="sd">                        -g\\left({s_{j-1}}\\right)</span>
<span class="sd">                    }\\right]</span>

<span class="sd">    and:</span>

<span class="sd">    :math:`g\\left({y}\\right)` is described in the `_g` function</span>


<span class="sd">    .. math:: y = \\frac{r}{r_0}</span>

<span class="sd">    .. math:: n = \\frac{r_m}{r_0}</span>

<span class="sd">    .. math:: s_i = \\frac{r_i}{r_0}</span>

<span class="sd">    .. math:: \\kappa_i = \\frac{k_h}{k_{hi}}</span>



<span class="sd">    :math:`r_0` is the drain radius, :math:`r_m` is the drain influence radius,</span>
<span class="sd">    :math:`r_i` is the outer radius of the ith segment,</span>
<span class="sd">    :math:`k_h` is the undisturbed</span>
<span class="sd">    horizontal permeability in the ith segment,</span>
<span class="sd">    :math:`k_{hi}` is the horizontal</span>
<span class="sd">    permeability in the ith segment</span>



<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; u_piecewise_constant([1.5, 3,], [2, 3], 1.6, n=5, kap_m=1)</span>
<span class="sd">    array([0.4153...])</span>
<span class="sd">    &gt;&gt;&gt; non_darcy_u_piecewise_constant([1.5, 3,], [2, 3], 1.6, n=5, kap_m=1,</span>
<span class="sd">    ... nflow=1.0000001)</span>
<span class="sd">    array([0.4153...])</span>
<span class="sd">    &gt;&gt;&gt; non_darcy_u_piecewise_constant([1.5, 3,], [2, 3], 1.6, n=5, kap_m=1,</span>
<span class="sd">    ... nflow=1.3)</span>
<span class="sd">    array([0.3865...])</span>


<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    none because it is new.</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">s_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">s_temp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
        <span class="n">s_temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">kap_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">kap_temp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap</span>
        <span class="k">if</span> <span class="n">kap_m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kap_temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kap_temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap_m</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s_temp</span>
        <span class="n">kap</span> <span class="o">=</span> <span class="n">kap_temp</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s and kap must have the same shape.  You have &#39;</span>
            <span class="s1">&#39;lengths for s, kap of </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">kap</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">s</span><span class="o">&lt;=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must have all s&gt;=1. You have s = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">kap</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;all kap must be greater than 0. You have kap = &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">kap</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;s must increase left to right you have s = &#39;</span>
        <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">s</span><span class="p">)])))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">nflow</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;nflow must be greater than 1. &#39;</span>
                         <span class="s1">&#39;You have nflow = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">nflow</span><span class="p">)])))</span>



    <span class="n">n</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">si</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">si</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">((</span><span class="n">si</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">si</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;si must satisfy 1 &gt;= si &gt;= s[-1])&#39;</span><span class="p">)</span>

    <span class="n">s_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">s_</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">si</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span> <span class="p">)</span>

    <span class="n">segment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">si</span><span class="p">)</span>

    <span class="n">beta</span> <span class="o">=</span> <span class="n">non_darcy_beta_piecewise_constant</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span>
                                             <span class="n">nflow</span><span class="o">=</span><span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="o">=</span><span class="n">nterms</span><span class="p">)</span>

    <span class="n">term1</span> <span class="o">=</span> <span class="p">(</span><span class="n">uavg</span> <span class="o">-</span> <span class="n">uw</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">beta</span> <span class="o">+</span> <span class="n">muw</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">segment</span><span class="p">):</span>

        <span class="n">psi</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>

            <span class="n">psi</span><span class="o">+=</span> <span class="n">kap</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">nflow</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span>
                    <span class="n">_g</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span>
                    <span class="o">-</span> <span class="n">_g</span><span class="p">(</span><span class="n">s_</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span>
                    <span class="p">)</span>
        <span class="n">psi</span> <span class="o">/=</span> <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">nflow</span><span class="p">)</span>

<span class="c1">#            sumj += (kap[j] * (log(s[j] / s_[j])</span>
<span class="c1">#                    - 0.5 * (s[j] ** 2 / n ** 2 - s_[j] ** 2 / n ** 2)))</span>
<span class="c1">#        sumj = sumj / kap[i]</span>

        <span class="n">u</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">kap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">nflow</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">_g</span><span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span>
                <span class="o">-</span><span class="n">_g</span><span class="p">(</span><span class="n">s_</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">nflow</span><span class="p">,</span> <span class="n">nterms</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">psi</span>
                <span class="p">)</span> <span class="o">+</span> <span class="n">muw</span>

<span class="c1">#        u[ii] = kap[i] * (</span>
<span class="c1">#                log(si[ii] / s_[i])</span>
<span class="c1">#                - 0.5 * (si[ii] ** 2 / n ** 2 - s_[i] ** 2 / n ** 2)</span>
<span class="c1">#                + sumj</span>
<span class="c1">#                ) + muw</span>

    <span class="n">u</span> <span class="o">*=</span> <span class="n">term1</span>
    <span class="n">u</span> <span class="o">+=</span> <span class="n">uw</span>
    <span class="k">return</span> <span class="n">u</span></div>


<div class="viewcode-block" id="non_darcy_drain_eta"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.non_darcy_drain_eta">[docs]</a><span class="k">def</span> <span class="nf">non_darcy_drain_eta</span><span class="p">(</span><span class="n">re</span><span class="p">,</span> <span class="n">iL</span><span class="p">,</span> <span class="n">gamw</span><span class="p">,</span> <span class="n">beta_function</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;For non-Darcy flow calculate the vertical drain eta parameter</span>

<span class="sd">    eta = 2 / (re**2 * beta**nflow * (rw * gamw)**(nflow-1) * nflow * iL**(nflow-1))</span>

<span class="sd">    nflow will be obtained from the **kwargs.  rw will be back calculated</span>
<span class="sd">    from the n parameter (n=re/rw) which is usually the first of the *arg parameters</span>
<span class="sd">    or one of the **kwargs</span>

<span class="sd">    Note that eta is used in radial consolidation equations:</span>
<span class="sd">    [strain rate] = (u - uw)**n * k / gamw * eta</span>
<span class="sd">    Compare with the Darcian case of (eta terms are calculated differerntly</span>
<span class="sd">    for Darcy and non-Darcy cases):</span>
<span class="sd">    [strain rate] = (u - uw) * k / gamw * eta</span>

<span class="sd">    Note that `non_darcy_drain_eta` only uses the exponential portion of the</span>
<span class="sd">    Non-Darcian flow relationship.  If hydraulic gradients are greater than</span>
<span class="sd">    iL then the flow rates will be overestimated.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    re : float</span>
<span class="sd">        Drain influence radius.</span>
<span class="sd">    iL : float</span>
<span class="sd">        Limiting hydraulic gradient beyond which flow follows Darcy&#39;s law.</span>
<span class="sd">    gamw : float</span>
<span class="sd">        Unit weight of water. Usually gamw=10 kN/m**3 or gamw=9.807 kN/m**3.</span>
<span class="sd">    beta_function : obj or string</span>
<span class="sd">        The non_darcy_beta function to use. e.g. non_darcy_beta_ideal</span>
<span class="sd">        non_darcy_beat_constant, non_darcy_piecewise_constant.</span>
<span class="sd">        This can either be the function object itself</span>
<span class="sd">        or the name of the function e.g. &#39;non_darcy_beta_ideal&#39;.</span>
<span class="sd">    *args, **kwargs : various</span>
<span class="sd">        The arguments to pass to the beta_function.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    eta : float</span>
<span class="sd">        Value of eta parameter for non-Darcian flow</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; non_darcy_drain_eta(re=1.5, iL=10, gamw=10,</span>
<span class="sd">    ... beta_function=&#39;non_darcy_beta_ideal&#39;, n=15, nflow=1.3, nterms=20)</span>
<span class="sd">    0.09807...</span>
<span class="sd">    &gt;&gt;&gt; non_darcy_drain_eta(1.5, 10, 10,</span>
<span class="sd">    ... &#39;non_darcy_beta_ideal&#39;, 15, nflow=1.3, nterms=20)</span>
<span class="sd">    0.09807...</span>


<span class="sd">    &gt;&gt;&gt; non_darcy_drain_eta(re=1.5, iL=10, gamw=10,</span>
<span class="sd">    ... beta_function=&#39;non_darcy_beta_ideal&#39;, n=np.array([20.0, 15.0]),</span>
<span class="sd">    ... nflow=np.array([1.000001, 1.3]), nterms=20)</span>
<span class="sd">    array([0.3943..., 0.0980...])</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># beta_function is object or string</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">beta_fn</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">beta_function</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">beta_fn</span> <span class="o">=</span> <span class="n">beta_function</span>

    <span class="c1"># extract n=re/rw from the **kwargs dict or 1st element of the *arg list</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rw</span> <span class="o">=</span> <span class="n">re</span> <span class="o">/</span> <span class="n">n</span>

    <span class="n">nflow</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;nflow&#39;</span><span class="p">]</span>

    <span class="n">beta</span> <span class="o">=</span> <span class="n">beta_fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">eta</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">re</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">beta</span><span class="o">**</span><span class="n">nflow</span> <span class="o">*</span> <span class="p">(</span><span class="n">rw</span> <span class="o">*</span> <span class="n">gamw</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">nflow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
               <span class="o">*</span> <span class="n">nflow</span> <span class="o">*</span> <span class="n">iL</span><span class="o">**</span><span class="p">(</span><span class="n">nflow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">eta</span></div>





<span class="c1">########################################################################</span>



<span class="c1">#scratch()</span>
<div class="viewcode-block" id="scratch"><a class="viewcode-back" href="../../../api/geotecha.consolidation.smear_zones.html#geotecha.consolidation.smear_zones.scratch">[docs]</a><span class="k">def</span> <span class="nf">scratch</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;scratch pad for testing latex markup for docstrings</span>

<span class="sd">   &quot;&quot;&quot;</span>
    <span class="c1">#scratch()</span>
    <span class="k">pass</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="c1">#    watch()</span>
    <span class="kn">import</span> <span class="nn">nose</span>
    <span class="n">nose</span><span class="o">.</span><span class="n">runmodule</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nose&#39;</span><span class="p">,</span> <span class="s1">&#39;--verbosity=3&#39;</span><span class="p">,</span> <span class="s1">&#39;--with-doctest&#39;</span><span class="p">,</span> <span class="s1">&#39;--doctest-options=+ELLIPSIS&#39;</span><span class="p">])</span>



    <span class="n">eta</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span>
    <span class="n">mu_function</span> <span class="o">=</span> <span class="n">mu_overlapping_linear</span>
    <span class="n">rw</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">5</span><span class="c1">#[5,6]</span>
    <span class="n">kap</span> <span class="o">=</span> <span class="mi">2</span><span class="c1">#[2,1]</span>
    <span class="n">muw</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">back_calc_drain_spacing_from_eta</span><span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">mu_function</span><span class="p">,</span> <span class="n">rw</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">muw</span><span class="p">))</span>
<span class="c1">#u_constant()</span>
<span class="c1">#k_overlapping_linear(()</span>

    <span class="n">scratch</span><span class="p">()</span>
<span class="c1">#    print(&#39;lin&#39;,u_linear(5,2,3,[1.5,4]))</span>
<span class="c1">#    print(&#39;pwise&#39;, u_piecewise_linear([1,2,5],[3,1,1],[1.5,4]))</span>
<span class="c1">#    x = np.array(</span>
<span class="c1">#        [1.,   1.06779661,  1.13559322,  1.20338983,  1.27118644,</span>
<span class="c1">#        1.33898305,  1.40677966,  1.47457627,  1.54237288,  1.61016949,</span>
<span class="c1">#        1.6779661 ,  1.74576271,  1.81355932,  1.88135593,  1.94915254,</span>
<span class="c1">#        2.01694915,  2.08474576,  2.15254237,  2.22033898,  2.28813559,</span>
<span class="c1">#        2.3559322 ,  2.42372881,  2.49152542,  2.55932203,  2.62711864,</span>
<span class="c1">#        2.69491525,  2.76271186,  2.83050847,  2.89830508,  2.96610169,</span>
<span class="c1">#        3.03389831,  3.10169492,  3.16949153,  3.23728814,  3.30508475,</span>
<span class="c1">#        3.37288136,  3.44067797,  3.50847458,  3.57627119,  3.6440678 ,</span>
<span class="c1">#        3.71186441,  3.77966102,  3.84745763,  3.91525424,  3.98305085,</span>
<span class="c1">#        4.05084746,  4.11864407,  4.18644068,  4.25423729,  4.3220339 ,</span>
<span class="c1">#        4.38983051,  4.45762712,  4.52542373,  4.59322034,  4.66101695,</span>
<span class="c1">#        4.72881356,  4.79661017,  4.86440678,  4.93220339,  5., 30       ])</span>
<span class="c1">#</span>
<span class="c1">#    y = 1.0/np.array(</span>
<span class="c1">#        [0.5       ,  0.50847458,  0.51694915,  0.52542373,  0.53389831,</span>
<span class="c1">#        0.54237288,  0.55084746,  0.55932203,  0.56779661,  0.57627119,</span>
<span class="c1">#        0.58474576,  0.59322034,  0.60169492,  0.61016949,  0.61864407,</span>
<span class="c1">#        0.62711864,  0.63559322,  0.6440678 ,  0.65254237,  0.66101695,</span>
<span class="c1">#        0.66949153,  0.6779661 ,  0.68644068,  0.69491525,  0.70338983,</span>
<span class="c1">#        0.71186441,  0.72033898,  0.72881356,  0.73728814,  0.74576271,</span>
<span class="c1">#        0.75423729,  0.76271186,  0.77118644,  0.77966102,  0.78813559,</span>
<span class="c1">#        0.79661017,  0.80508475,  0.81355932,  0.8220339 ,  0.83050847,</span>
<span class="c1">#        0.83898305,  0.84745763,  0.8559322 ,  0.86440678,  0.87288136,</span>
<span class="c1">#        0.88135593,  0.88983051,  0.89830508,  0.90677966,  0.91525424,</span>
<span class="c1">#        0.92372881,  0.93220339,  0.94067797,  0.94915254,  0.95762712,</span>
<span class="c1">#        0.96610169,  0.97457627,  0.98305085,  0.99152542,  1., 1.        ])</span>
<span class="c1">#</span>
<span class="c1">#    mu_piecewise_linear(x,y)</span>
<span class="c1">#    mu_overlapping_linear(np.array([5,10]),</span>
<span class="c1">#                                    np.array([7, 12]),</span>
<span class="c1">#                                    np.array([1.6, 1.5,]))</span>
<span class="c1">#    mu_piecewise_linear([1, 5],</span>
<span class="c1">#                        [1, 1])</span>
<span class="c1">#</span>
<span class="c1">#    s=80</span>
<span class="c1">#    n=18</span>
<span class="c1">#    kap=8</span>
<span class="c1">#    x = np.linspace(1,n,50)</span>
<span class="c1">#    y = k_overlapping_linear(n,s, kap, x)</span>
<span class="c1">#    plt.plot(x,y)</span>
<span class="c1">#    plt.gca().grid()</span>
<span class="c1">#    plt.show()</span>
<span class="c1">#</span>
<span class="c1">#    xp = np.array(</span>
<span class="c1">#        [1.,    1.06779661,  1.13559322,  1.20338983,  1.27118644,</span>
<span class="c1">#        1.33898305,  1.40677966,  1.47457627,  1.54237288,  1.61016949,</span>
<span class="c1">#        1.6779661 ,  1.74576271,  1.81355932,  1.88135593,  1.94915254,</span>
<span class="c1">#        2.01694915,  2.08474576,  2.15254237,  2.22033898,  2.28813559,</span>
<span class="c1">#        2.3559322 ,  2.42372881,  2.49152542,  2.55932203,  2.62711864,</span>
<span class="c1">#        2.69491525,  2.76271186,  2.83050847,  2.89830508,  2.96610169,</span>
<span class="c1">#        3.03389831,  3.10169492,  3.16949153,  3.23728814,  3.30508475,</span>
<span class="c1">#        3.37288136,  3.44067797,  3.50847458,  3.57627119,  3.6440678 ,</span>
<span class="c1">#        3.71186441,  3.77966102,  3.84745763,  3.91525424,  3.98305085,</span>
<span class="c1">#        4.05084746,  4.11864407,  4.18644068,  4.25423729,  4.3220339 ,</span>
<span class="c1">#        4.38983051,  4.45762712,  4.52542373,  4.59322034,  4.66101695,</span>
<span class="c1">#        4.72881356,  4.79661017,  4.86440678,  4.93220339,  5., 30       ])</span>
<span class="c1">#</span>
<span class="c1">#    yp = 1.0/np.array(</span>
<span class="c1">#        [ 0.5       ,  0.51680552,  0.53332376,  0.54955473,  0.56549842,</span>
<span class="c1">#        0.58115484,  0.59652399,  0.61160586,  0.62640046,  0.64090779,</span>
<span class="c1">#        0.65512784,  0.66906061,  0.68270612,  0.69606435,  0.70913531,</span>
<span class="c1">#        0.72191899,  0.7344154 ,  0.74662453,  0.75854639,  0.77018098,</span>
<span class="c1">#        0.7815283 ,  0.79258834,  0.8033611 ,  0.8138466 ,  0.82404481,</span>
<span class="c1">#        0.83395576,  0.84357943,  0.85291583,  0.86196495,  0.8707268 ,</span>
<span class="c1">#        0.87920138,  0.88738868,  0.89528871,  0.90290147,  0.91022695,</span>
<span class="c1">#        0.91726515,  0.92401609,  0.93047975,  0.93665613,  0.94254525,</span>
<span class="c1">#        0.94814708,  0.95346165,  0.95848894,  0.96322896,  0.9676817 ,</span>
<span class="c1">#        0.97184717,  0.97572537,  0.97931629,  0.98261994,  0.98563631,</span>
<span class="c1">#        0.98836541,  0.99080724,  0.99296179,  0.99482907,  0.99640908,</span>
<span class="c1">#        0.99770181,  0.99870727,  0.99942545,  0.99985636,  1., 1.        ])</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#    n=30</span>
<span class="c1">#    s=5</span>
<span class="c1">#    kap=2</span>
<span class="c1">#    muw=0</span>
<span class="c1">#    uw=-0.2</span>
<span class="c1">#    x = np.linspace(1, s, 60)</span>
<span class="c1">#    y = k_linear(n, s, kap, x)</span>
<span class="c1">#</span>
<span class="c1">#    x = np.linspace(1, n, 400)</span>
<span class="c1">#    y = u_ideal(n,x, uw=uw,muw=muw)</span>
<span class="c1">#    y2 = u_parabolic(n,s,kap,x, uw=uw,muw=muw)</span>
<span class="c1">#    y3 = u_linear(n,s,kap,x, uw=uw,muw=muw)</span>
<span class="c1">#    y4 = u_constant(n,s,kap,x, uw=uw,muw=muw)</span>
<span class="c1">#    y5 = u_piecewise_constant([s,n], [kap,1],x, uw=uw,muw=muw)</span>
<span class="c1">##    y6 = u_piecewise_linear([1,s,s,n], [kap,kap,1,1], x, uw=uw,muw=muw)</span>
<span class="c1">##</span>
<span class="c1">##    y7 = u_piecewise_linear([1,s,n], [kap,1,1], x, uw=uw,muw=muw)</span>
<span class="c1">##    y8 = u_piecewise_linear(xp, yp, x, uw=uw,muw=muw)</span>
<span class="c1">##    print(repr(x))</span>
<span class="c1">##    print(repr(y))</span>
<span class="c1">#    plt.plot(x,y, &#39;-&#39;,label=&#39;ideal&#39;)</span>
<span class="c1">#    plt.plot(x, y2, &#39;--&#39;,label=&#39;para&#39;)</span>
<span class="c1">#    plt.plot(x, y3, dashes=[5,2,2,2],label=&#39;lin&#39;)</span>
<span class="c1">#    plt.plot(x, y4, dashes=[8,2],label=&#39;const&#39;)</span>
<span class="c1">#    plt.plot(x, y5,&#39;+&#39;,ms=2, label=&#39;pwisec&#39;)</span>
<span class="c1">##    plt.plot(x, y6,&#39;o&#39;,ms=3, label=&#39;pwisel&#39;)</span>
<span class="c1">##    plt.plot(x, y7,&#39;^&#39;,ms=3, label=&#39;pwisel_lin&#39;)</span>
<span class="c1">##    plt.plot(x, y8,&#39;^&#39;,ms=3, label=&#39;pwisel_para&#39;)</span>
<span class="c1">#    leg=plt.gca().legend(loc=4)</span>
<span class="c1">#    plt.gca().grid()</span>
<span class="c1">#    plt.show()</span>

    <span class="n">mu_piecewise_constant</span><span class="p">([</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
                                              <span class="p">[</span><span class="mf">1.6</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">scratch</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mu_parabolic</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">k_parabolic</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.13559322</span><span class="p">]))</span>
    <span class="n">k_parabolic</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,[</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">])</span>
<span class="c1">#    mu_linear()</span>
<span class="c1">#    nose.runmodule(argv=[&#39;nose&#39;, &#39;--verbosity=3&#39;])</span>
<span class="c1">#    print(mu_ideal(0.5))</span>
<span class="c1">#    print(mu_linear(np.array([50,100]),</span>
<span class="c1">#                      np.array([10,20]),</span>
<span class="c1">#                      np.array([5,3])))</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2014, Rohan Walker.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>