
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>geotecha.constitutive_models.epus &#8212; geotecha 0.2.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../_static/logo.png" border="0" alt="py4sci"/></a>
</div>



      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for geotecha.constitutive_models.epus</h1><div class="highlight"><pre>
<span></span><span class="c1"># geotecha - A software suite for geotechncial engineering</span>
<span class="c1"># Copyright (C) 2015  Rohan T. Walker (rtrwalker@gmail.com)</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program.  If not, see http://www.gnu.org/licenses/gpl.html.</span>

<span class="sd">&quot;&quot;&quot;Elasto-Plastic for Unsaturated Soils, adapted from VB code in Phd thesis of</span>
<span class="sd">Pham (2005).</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">geotecha.constitutive_models.epus_ext</span> <span class="k">as</span> <span class="nn">epus_ext</span>
    <span class="c1"># remeber that all fortran variables and routines will be lower case</span>
    <span class="c1"># regardless of what case they are in the source code.</span>
    <span class="n">_SUCCESSFUL_FORTRAN_IMPORT</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to import epus_ext; EPUS will use slow scalar version instead.&quot;</span><span class="p">)</span>
    <span class="n">_SUCCESSFUL_FORTRAN_IMPORT</span> <span class="o">=</span> <span class="kc">False</span>

<span class="kn">from</span> <span class="nn">geotecha.constitutive_models</span> <span class="k">import</span> <span class="n">void_ratio_permeability</span>
<span class="kn">from</span> <span class="nn">geotecha.constitutive_models</span> <span class="k">import</span> <span class="n">swcc</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="n">log10</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span>
<span class="c1">#log10 = np.log10</span>
<span class="c1">#log = np.log</span>




<div class="viewcode-block" id="EPUS"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EPUS">[docs]</a><span class="k">class</span> <span class="nc">EPUS</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Elasto-Plastic for Unsaturated Soils</span>


<span class="sd">    This code is adapted from visual basic code in Appendix E of thesis of</span>
<span class="sd">    Pham (2005) [2]_.  Journal article is [1]_.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    SimpleSWCC : CurveFittingSWCC object</span>
<span class="sd">        Soil water characteristic curve.</span>
<span class="sd">    stp : StressPath object</span>
<span class="sd">        object containing info abount the stress path.</span>
<span class="sd">    logDS : float, optional</span>
<span class="sd">        Distance ratio between boundary drying and boundary drying curve.</span>
<span class="sd">        In log cycles. default logDS=0.</span>
<span class="sd">    logRS : float, optional</span>
<span class="sd">        Slope ratio between boundary drying and boundary drying curve.</span>
<span class="sd">        In log cycles. Default logRS=0.</span>
<span class="sd">    Ccs : float, optional</span>
<span class="sd">        semi-log slope of saturated compression curve.  Default=None, i.e.</span>
<span class="sd">        Ccs will be equal to SimpleSWCC.sl.</span>
<span class="sd">    Css : float, optional</span>
<span class="sd">        semi-log slope of saturated recompression curve.  Default Css=None</span>
<span class="sd">        i.e Css=Ccs*0.1</span>
<span class="sd">    Ccd : float, optional</span>
<span class="sd">        semi-log slope of dry compression curve, default Ccd=0.</span>
<span class="sd">    Gs : float, optional</span>
<span class="sd">        Specific gravity of solids default Gs=2.7.</span>
<span class="sd">    Assumption : int, optional</span>
<span class="sd">        Assumption=0 dry pores are incompressible,</span>
<span class="sd">        Assumption=1 dry pores are compressible. Default Assumption=1.</span>
<span class="sd">    beta : float, optionalB</span>
<span class="sd">        air entrapped in a collapsible pore is proportional to the volume</span>
<span class="sd">        of the pore and can be denoted by an entrapped air parameter beta.</span>
<span class="sd">        Default beta=0.</span>
<span class="sd">    pm : float, optional</span>
<span class="sd">        Soil parameter (Sr)^pm for calculating the yield stress of dry pores.</span>
<span class="sd">        Default pm=1.</span>
<span class="sd">    Pore_shape : float, optional</span>
<span class="sd">        For describing the change in AEV/WEV of the soil. Default</span>
<span class="sd">        Pore_shape=1.</span>
<span class="sd">    K0 : float, optional</span>
<span class="sd">        Lateral earth pressure coefficient. Default K0=1 i.e. isotropic.</span>
<span class="sd">    soilname : str, optional</span>
<span class="sd">        Default soilname=&#39;unknown&#39;.</span>
<span class="sd">    username : str, optional</span>
<span class="sd">        Default username=&#39;unknown&#39;</span>
<span class="sd">    Npoint : int, optional</span>
<span class="sd">        Number of data points along the pore size distribution curve.</span>
<span class="sd">        Default Npoint=1000</span>
<span class="sd">    NumSr : int, optional</span>
<span class="sd">        Number points divided along the wetting and drying Sr.</span>
<span class="sd">        Default NumSr=400</span>
<span class="sd">    MaxSuction : int, optional</span>
<span class="sd">        log Scale or 1000000. Default MaxSuction=6</span>
<span class="sd">    MinSuction : int, optional</span>
<span class="sd">        log scale or 0.001. Default MinSuction=-3</span>
<span class="sd">    implementation : [&#39;fortran&#39;, &#39;scalar&#39;, ], optional</span>
<span class="sd">        Functional implementation: &#39;scalar&#39; = python loops (slow),</span>
<span class="sd">        &#39;fortran&#39; = fortran code (fastest).  Currently there is no</span>
<span class="sd">        &#39;vectorized&#39; = numpy(fast) version.</span>
<span class="sd">        Default implementation=&#39;fortran&#39;.  If fortran extention module</span>
<span class="sd">        cannot be imported then &#39;scalar&#39; version will be used.</span>
<span class="sd">        If anything other than &#39;scalar&#39; is used then</span>
<span class="sd">        default fortran version will be used.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    f : PoresizeDistribution object</span>
<span class="sd">        Pore size distribution function at initial condition.</span>
<span class="sd">    Suction : float</span>
<span class="sd">        Current value of suction.</span>
<span class="sd">    Stress : float</span>
<span class="sd">        Current value of net normal stress.</span>
<span class="sd">    RefSr : float</span>
<span class="sd">        Reference value of Saturation.</span>
<span class="sd">    Curveon : int</span>
<span class="sd">         = 1: on drying; = 2: on horizontal scanning; = 3: on wetting</span>
<span class="sd">    errocc : bool</span>
<span class="sd">        Some sort of error code.</span>
<span class="sd">    Srdry : 1d array of float (size is NumSr)</span>
<span class="sd">        Drying degree of saturation SWCC (zero net mean stress)</span>
<span class="sd">    Srwet : 1d array of float (size is NumSr)</span>
<span class="sd">        Wetting degree of saturation SWCC  (zero net mean stress)</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Pham, H. Q., and Fredlund, D. G. (2011).</span>
<span class="sd">           &#39;Volume-mass unsaturated soil constitutive model for drying-wetting</span>
<span class="sd">           under isotropic loading-unloading conditions. Canadian Geotechnical</span>
<span class="sd">           Journal, 48(2), 280-313.</span>
<span class="sd">    .. [2] Pham, H. Q. (2005). &#39;A volume-mass constitutive model for</span>
<span class="sd">           unsaturated soils&#39;. PhD Thesis, University of Saskatchewan,</span>
<span class="sd">           Saskatoon, Saskatchewan, Canada.</span>



<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">SimpleSWCC</span><span class="p">,</span>
                 <span class="n">stp</span><span class="p">,</span>
                 <span class="n">logDS</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">logRS</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">Ccs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">Css</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">Ccd</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">Gs</span><span class="o">=</span><span class="mf">2.7</span><span class="p">,</span>
                 <span class="n">Assumption</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">pm</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">Pore_shape</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">K0</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">soilname</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
                 <span class="n">username</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
                 <span class="n">Npoint</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                 <span class="n">NumSr</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                 <span class="n">MaxSuction</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                 <span class="n">MinSuction</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span>
                 <span class="n">implementation</span><span class="o">=</span><span class="s1">&#39;fortran&#39;</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SimpleSWCC</span> <span class="o">=</span> <span class="n">SimpleSWCC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stp</span> <span class="o">=</span> <span class="n">stp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logDS</span> <span class="o">=</span> <span class="n">logDS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logRS</span> <span class="o">=</span> <span class="n">logRS</span>
        <span class="k">if</span> <span class="n">Ccs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ccs</span> <span class="o">=</span> <span class="n">SimpleSWCC</span><span class="o">.</span><span class="n">sl</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ccs</span> <span class="o">=</span> <span class="n">Ccs</span>
        <span class="k">if</span> <span class="n">Css</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Css</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ccs</span> <span class="o">*</span> <span class="mf">0.1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Css</span> <span class="o">=</span> <span class="n">Css</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ccd</span> <span class="o">=</span> <span class="n">Ccd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span> <span class="o">=</span> <span class="n">Gs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Assumption</span> <span class="o">=</span> <span class="n">Assumption</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pm</span> <span class="o">=</span> <span class="n">pm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Pore_shape</span> <span class="o">=</span> <span class="n">Pore_shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K0</span> <span class="o">=</span> <span class="n">K0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soilname</span> <span class="o">=</span> <span class="n">soilname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Npoint</span> <span class="o">=</span> <span class="n">Npoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NumSr</span> <span class="o">=</span> <span class="n">NumSr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MaxSuction</span> <span class="o">=</span> <span class="n">MaxSuction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MinSuction</span> <span class="o">=</span> <span class="n">MinSuction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">implementation</span> <span class="o">=</span> <span class="n">implementation</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Srdry</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NumSr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Srwet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NumSr</span><span class="p">)</span>


<div class="viewcode-block" id="EPUS.CVStress"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EPUS.CVStress">[docs]</a>    <span class="k">def</span> <span class="nf">CVStress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;K0 to isotropic stress conversion factor</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : float</span>
<span class="sd">            (2 * K0 + 1) / 3</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">K0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span></div>


<div class="viewcode-block" id="EPUS.Wc"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EPUS.Wc">[docs]</a>    <span class="k">def</span> <span class="nf">Wc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Collapsible water content function</span>

<span class="sd">        Calls CurveFittingSWCC.Wc with self.Gs</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        s : float</span>
<span class="sd">            Suction.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : float</span>
<span class="sd">            water content Wc</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        CurveFittingSWCC.Wc : actual function called.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SimpleSWCC</span><span class="o">.</span><span class="n">Wc</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Gs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">)</span></div>


<div class="viewcode-block" id="EPUS.DWc"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EPUS.DWc">[docs]</a>    <span class="k">def</span> <span class="nf">DWc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Derivative of collapsible water content function</span>

<span class="sd">        Calls CurveFittingSWCC.DWc with self.Gs</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        s : float</span>
<span class="sd">            Suction.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : float</span>
<span class="sd">            Derivative of water content Wc w.r.t. suction</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        CurveFittingSWCC.DWc : actual function called.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SimpleSWCC</span><span class="o">.</span><span class="n">DWc</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Gs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">)</span></div>


<div class="viewcode-block" id="EPUS.DryPoreSize"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EPUS.DryPoreSize">[docs]</a>    <span class="k">def</span> <span class="nf">DryPoreSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set PoresizeDistribution self.f to slurry state</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; SWCC = CurveFittingSWCC(wsat=0.262,</span>
<span class="sd">        ...                         a = 3.1e6,</span>
<span class="sd">        ...                         b = 3.377,</span>
<span class="sd">        ...                         wr = 0.128,</span>
<span class="sd">        ...                         sl = 0.115)</span>
<span class="sd">        &gt;&gt;&gt; stp = StressPath([dict(ist=True, vl=20, name=&quot;1. Load to 20kPa&quot;)])</span>
<span class="sd">        &gt;&gt;&gt; pdict=dict(</span>
<span class="sd">        ...      SimpleSWCC=SWCC,</span>
<span class="sd">        ...      stp=stp,</span>
<span class="sd">        ...      logDS=0.6,</span>
<span class="sd">        ...      logRS=2,</span>
<span class="sd">        ...      Css=0.019,</span>
<span class="sd">        ...      beta=0.1,</span>
<span class="sd">        ...      soilname=&#39;Artificial silt&#39;,</span>
<span class="sd">        ...      username=&#39;Hung Pham&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a=EPUS(**pdict)</span>
<span class="sd">        &gt;&gt;&gt; a.DryPoreSize()</span>
<span class="sd">        &gt;&gt;&gt; a.f.AEV[24]</span>
<span class="sd">        -2.78...</span>
<span class="sd">        &gt;&gt;&gt; a.f.WEV[24]</span>
<span class="sd">        -8.09...</span>
<span class="sd">        &gt;&gt;&gt; a.f.RVC[24]</span>
<span class="sd">        4.24...e-08</span>
<span class="sd">        &gt;&gt;&gt; a.f.RV[24]</span>
<span class="sd">        4.24...e-08</span>
<span class="sd">        &gt;&gt;&gt; a.f.Ccp[24]</span>
<span class="sd">        1.04...e-18</span>
<span class="sd">        &gt;&gt;&gt; a.f.Csp[24]</span>
<span class="sd">        1.71...e-19</span>
<span class="sd">        &gt;&gt;&gt; a.f.Ccd[24]</span>
<span class="sd">        0.0</span>


<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">b1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SimpleSWCC</span><span class="o">.</span><span class="n">b</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SimpleSWCC</span><span class="o">.</span><span class="n">a</span>
        <span class="n">Gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span>
        <span class="n">DWc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DWc</span>
        <span class="n">Ccs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ccs</span>
        <span class="n">Css</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Css</span>
        <span class="n">Ccd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ccd</span>
        <span class="n">logRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logRS</span>
        <span class="n">logDS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logDS</span>

        <span class="n">MaxSuction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MaxSuction</span>
        <span class="n">MinSuction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MinSuction</span>


        <span class="n">f</span> <span class="o">=</span> <span class="n">PoresizeDistribution</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Npoint</span><span class="p">)</span>

        <span class="c1"># Total volume at completely dry</span>
        <span class="c1"># I don&#39;t think this Vtotal bit is used (so I have commented it out RTRW 18/6/2015)</span>
<span class="c1">#        Vtotal = 0</span>
<span class="c1">#        for i in range(f.Npoint):</span>
<span class="c1">#            Interval = (MaxSuction - MinSuction) / f.Npoint</span>
<span class="c1">#            s = 10 ** (f.AEV[i])</span>
<span class="c1">#            temp = (a1 - a1 * s ** b1 / (10 ** (6 * b1))) / (s ** b1 + a1)</span>
<span class="c1">#            Vtotal = Vtotal + (-Gs * DWc(s) * s * log(10) - temp * Ccs) * Interval</span>


        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Npoint</span><span class="p">):</span>
            <span class="n">Interval</span> <span class="o">=</span> <span class="p">(</span><span class="n">MaxSuction</span> <span class="o">-</span> <span class="n">MinSuction</span><span class="p">)</span> <span class="o">/</span> <span class="n">f</span><span class="o">.</span><span class="n">Npoint</span>
            <span class="c1"># Air Entry Value</span>
            <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">Interval</span> <span class="o">+</span> <span class="n">MinSuction</span>

            <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="c1"># Pore volume</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">s</span> <span class="o">**</span> <span class="n">b1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">b1</span><span class="p">)))</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">**</span> <span class="n">b1</span> <span class="o">+</span> <span class="n">a1</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">RV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">Gs</span> <span class="o">*</span> <span class="n">DWc</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">Ccs</span><span class="p">)</span> <span class="o">*</span> <span class="n">Interval</span>


            <span class="c1"># Saturated compression indexes</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="o">-</span><span class="n">a1</span> <span class="o">*</span> <span class="n">b1</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">**</span> <span class="n">b1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">a1</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span> <span class="o">*</span> <span class="n">b1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">**</span> <span class="n">b1</span> <span class="o">+</span> <span class="n">a1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1">#A-83</span>

            <span class="n">f</span><span class="o">.</span><span class="n">Ccp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">temp</span> <span class="o">*</span> <span class="n">Ccs</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Interval</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">Csp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">temp</span> <span class="o">*</span> <span class="n">Css</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Interval</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="c1"># Dried compression index</span>
            <span class="n">f</span><span class="o">.</span><span class="n">Ccd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">Ccp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">Ccd</span> <span class="o">/</span> <span class="n">Ccs</span><span class="p">)</span>  <span class="c1">#(f.RV[i] / Vtotal) * Ccd</span>

            <span class="c1"># Calculate wetting curve parameters</span>
            <span class="n">bwt</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">logDS</span><span class="p">)</span> <span class="o">**</span> <span class="n">b1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">logRS</span><span class="p">)</span>
            <span class="n">dwt</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">/</span> <span class="n">logRS</span>

            <span class="c1"># Calculate wetting soil suctions (assuming tails of the SWCC are linear)</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">log10</span><span class="p">((</span><span class="mf">2.7</span> <span class="o">*</span> <span class="n">a1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">b1</span><span class="p">)):</span><span class="c1"># Then</span>
              <span class="n">f</span><span class="o">.</span><span class="n">WEV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="p">((</span><span class="n">log10</span><span class="p">((</span><span class="mf">2.7</span> <span class="o">*</span> <span class="n">a1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">b1</span><span class="p">))</span> <span class="o">-</span> <span class="n">log10</span><span class="p">((</span><span class="mf">2.7</span> <span class="o">*</span> <span class="n">bwt</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">dwt</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">6</span> <span class="o">-</span> <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">6</span> <span class="o">-</span> <span class="n">log10</span><span class="p">((</span><span class="mf">2.7</span> <span class="o">*</span> <span class="n">a1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">b1</span><span class="p">))))</span>
            <span class="k">else</span><span class="p">:</span>
              <span class="n">f</span><span class="o">.</span><span class="n">WEV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">dwt</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="n">bwt</span><span class="p">)</span> <span class="o">+</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">log10</span><span class="p">(</span><span class="n">a1</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">RV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span></div>

<div class="viewcode-block" id="EPUS.SlurryPoreSize"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EPUS.SlurryPoreSize">[docs]</a>    <span class="k">def</span> <span class="nf">SlurryPoreSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set PoresizeDistribution self.f to slurry state</span>

<span class="sd">        Zero soil suction - Mean kPa net mean stress.</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; SWCC = CurveFittingSWCC(wsat=0.262,</span>
<span class="sd">        ...                         a = 3.1e6,</span>
<span class="sd">        ...                         b = 3.377,</span>
<span class="sd">        ...                         wr = 0.128,</span>
<span class="sd">        ...                         sl = 0.115)</span>
<span class="sd">        &gt;&gt;&gt; stp = StressPath([dict(ist=True, vl=20, name=&quot;1. Load to 20kPa&quot;)])</span>
<span class="sd">        &gt;&gt;&gt; pdict=dict(</span>
<span class="sd">        ...      SimpleSWCC=SWCC,</span>
<span class="sd">        ...      stp=stp,</span>
<span class="sd">        ...      logDS=0.6,</span>
<span class="sd">        ...      logRS=2,</span>
<span class="sd">        ...      Css=0.019,</span>
<span class="sd">        ...      beta=0.1,</span>
<span class="sd">        ...      soilname=&#39;Artificial silt&#39;,</span>
<span class="sd">        ...      username=&#39;Hung Pham&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a=EPUS(**pdict)</span>
<span class="sd">        &gt;&gt;&gt; a.SlurryPoreSize()</span>
<span class="sd">        &gt;&gt;&gt; a.f.RV[24]</span>
<span class="sd">        4.24...e-08</span>
<span class="sd">        &gt;&gt;&gt; a.f.RVC[24]</span>
<span class="sd">        4.24...e-08</span>
<span class="sd">        &gt;&gt;&gt; a.f.AEVC[24]</span>
<span class="sd">        -2.78...</span>
<span class="sd">        &gt;&gt;&gt; a.f.WEVC[24]</span>
<span class="sd">        -8.09...</span>
<span class="sd">        &gt;&gt;&gt; a.f.YieldSt[24]</span>
<span class="sd">        0.0001</span>
<span class="sd">        &gt;&gt;&gt; a.f.Airentrapped[24]</span>
<span class="sd">        False</span>



<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">MinSuction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MinSuction</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">DryPoreSize</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Npoint</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">RV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">RV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">MinSuction</span><span class="p">)</span> <span class="o">*</span> <span class="n">f</span><span class="o">.</span><span class="n">Ccp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">RV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">AEVC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">WEVC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">WEV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0001</span>
            <span class="n">f</span><span class="o">.</span><span class="n">Filled</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">f</span><span class="o">.</span><span class="n">Airentrapped</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Npoint</span><span class="p">):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">RV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Set current suction and stress to the slurry condition.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Suction</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">MinSuction</span>           <span class="c1"># Max suction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stress</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">MinSuction</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>   <span class="c1"># Min suction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Curveon</span> <span class="o">=</span> <span class="mi">1</span>                         <span class="c1"># Starts from drying curve</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RefSr</span> <span class="o">=</span> <span class="mi">1</span>                           <span class="c1"># Initial degree of saturation = 1</span></div>


<div class="viewcode-block" id="EPUS.ChangeSuction"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EPUS.ChangeSuction">[docs]</a>    <span class="k">def</span> <span class="nf">ChangeSuction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MaxSumStress</span><span class="p">,</span> <span class="n">Initialsuction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &#39; = suction(0)/suction(p)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        MaxSumStress : float</span>
<span class="sd">            Not sure.</span>
<span class="sd">        Initialsuction : float</span>
<span class="sd">            Not sure.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : float</span>
<span class="sd">            not sure</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">SimpleSWCC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SimpleSWCC</span>


        <span class="n">Gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span>

        <span class="n">Ccs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ccs</span>
        <span class="n">Css</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Css</span>
        <span class="n">Stress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Stress</span>
        <span class="n">Pore_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pore_shape</span>

        <span class="c1"># Set history parameter equal to 1 for all cases</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Initialsuction</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">MaxSumStress</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">1</span>


        <span class="c1">#Check this condition... if it is collapsible pore group</span>
        <span class="k">if</span> <span class="n">Initialsuction</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">SimpleSWCC</span><span class="o">.</span><span class="n">a</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">SimpleSWCC</span><span class="o">.</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">1</span>

        <span class="n">temp2</span> <span class="o">=</span> <span class="p">(</span><span class="n">SimpleSWCC</span><span class="o">.</span><span class="n">wsat</span> <span class="o">*</span> <span class="n">Gs</span> <span class="o">-</span> <span class="n">Ccs</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="n">Initialsuction</span><span class="p">)</span> <span class="o">-</span> <span class="n">SimpleSWCC</span><span class="o">.</span><span class="n">wr</span> <span class="o">*</span> <span class="n">Gs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp2</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>

        <span class="n">temp1</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ccs</span> <span class="o">-</span> <span class="n">Css</span><span class="p">)</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="n">MaxSumStress</span><span class="p">)</span> <span class="o">+</span> <span class="n">Css</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="n">Initialsuction</span> <span class="o">+</span> <span class="n">Stress</span><span class="p">)</span> <span class="o">-</span> <span class="n">Ccs</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="n">Initialsuction</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Pore_shape</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">temp2</span><span class="p">)))</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
<span class="c1"># A-84</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">errocc</span> <span class="o">=</span> <span class="kc">True</span>
          <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Pore_shape</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">temp2</span><span class="p">)))</span></div>


<div class="viewcode-block" id="EPUS.ChangeWetSuction"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EPUS.ChangeWetSuction">[docs]</a>    <span class="k">def</span> <span class="nf">ChangeWetSuction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MaxSumStress</span><span class="p">,</span> <span class="n">Airentryvalue</span><span class="p">,</span> <span class="n">Waterentryvalue</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &#39; = suction(0)/suction(p)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        MaxSumStress : float</span>
<span class="sd">            Not sure.</span>
<span class="sd">        Airentryvalue : float</span>
<span class="sd">            Not sure.</span>
<span class="sd">        Waterentryvalue : float</span>
<span class="sd">            Not sure.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : float</span>
<span class="sd">            not sure</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">SimpleSWCC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SimpleSWCC</span>


        <span class="n">Gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span>
        <span class="n">Ccs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ccs</span>
        <span class="n">Css</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Css</span>
        <span class="n">Stress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Stress</span>
        <span class="n">Pore_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pore_shape</span>


        <span class="c1"># Set history parameter equal to 1 for all cases</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Airentryvalue</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">MaxSumStress</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">1</span>

        <span class="c1">#Check this condition...  if it is collapsible pore group</span>
        <span class="k">if</span> <span class="n">Airentryvalue</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">SimpleSWCC</span><span class="o">.</span><span class="n">a</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">SimpleSWCC</span><span class="o">.</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="p">(</span><span class="n">SimpleSWCC</span><span class="o">.</span><span class="n">wsat</span> <span class="o">*</span> <span class="n">Gs</span> <span class="o">-</span> <span class="n">Ccs</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="n">Airentryvalue</span><span class="p">)</span> <span class="o">-</span> <span class="n">SimpleSWCC</span><span class="o">.</span><span class="n">wr</span> <span class="o">*</span> <span class="n">Gs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>

        <span class="n">temp1</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ccs</span> <span class="o">-</span> <span class="n">Css</span><span class="p">)</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="n">MaxSumStress</span><span class="p">)</span> <span class="o">+</span> <span class="n">Css</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="n">Waterentryvalue</span> <span class="o">+</span> <span class="n">Stress</span><span class="p">)</span> <span class="o">-</span> <span class="n">Ccs</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="n">Airentryvalue</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Pore_shape</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">temp2</span><span class="p">)))</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errocc</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Pore_shape</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">temp2</span><span class="p">)))</span></div>


<div class="viewcode-block" id="EPUS.Changevolume"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EPUS.Changevolume">[docs]</a>    <span class="k">def</span> <span class="nf">Changevolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">InitialVolume</span><span class="p">,</span> <span class="n">Yieldstress</span><span class="p">,</span> <span class="n">CurrentStress</span><span class="p">,</span> <span class="n">CompIndex</span><span class="p">,</span> <span class="n">UnloadIndex</span><span class="p">):</span>

        <span class="n">MaxSuction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MaxSuction</span>
        <span class="n">MinSuction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MinSuction</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="n">InitialVolume</span> <span class="o">-</span> <span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="n">Yieldstress</span><span class="p">)</span> <span class="o">-</span> <span class="n">MinSuction</span><span class="p">)</span> <span class="o">*</span> <span class="n">CompIndex</span> <span class="o">+</span> <span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="n">Yieldstress</span><span class="p">)</span> <span class="o">-</span> <span class="n">log10</span><span class="p">(</span><span class="n">CurrentStress</span><span class="p">))</span> <span class="o">*</span> <span class="n">UnloadIndex</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">temp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="EPUS.Drying"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EPUS.Drying">[docs]</a>    <span class="k">def</span> <span class="nf">Drying</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ss_new</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &#39;Increase soil suction at a certain net mean/vertical stress</span>
<span class="sd">        &#39;If increase soil suction at a certain net mean stress. All pores that has air</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">RfSr_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RfSr_value</span>
        <span class="n">ChangeSuction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChangeSuction</span>
        <span class="n">Changevolume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Changevolume</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
        <span class="n">Stress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Stress</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Curveon</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Curveon</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RefSr</span> <span class="o">=</span> <span class="n">RfSr_value</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ss_new</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Curveon</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">RefSr</span> <span class="o">&lt;=</span> <span class="n">RfSr_value</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ss_new</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Curveon</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Curveon</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RefSr</span> <span class="o">=</span> <span class="n">RfSr_value</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ss_new</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Curveon</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">RefSr</span> <span class="o">&lt;=</span> <span class="n">RfSr_value</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ss_new</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Curveon</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Curveon</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RefSr</span> <span class="o">=</span> <span class="n">RfSr_value</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ss_new</span><span class="p">)</span>


<span class="c1">#A-85</span>


        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Npoint</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">Stress</span> <span class="o">+</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">ys</span> <span class="o">=</span> <span class="n">Stress</span> <span class="o">+</span> <span class="n">s</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ys</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">Filled</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">ChangeSuction</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">pass</span>
                    <span class="c1">#sgBox &quot;ssdsdd&quot;</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ssdsdd&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="n">ChangeSuction</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">ss_new</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">Stress</span> <span class="o">+</span> <span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="n">ChangeSuction</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">s</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="n">ChangeSuction</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span> <span class="o">+</span> <span class="n">Stress</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Changevolume</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">RV</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="n">ChangeSuction</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span> <span class="o">+</span> <span class="n">Stress</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">Ccp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">Csp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">Filled</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">Airentrapped</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#For pores that have AEV&gt;ss_new - filled with water and subject to the same stress</span>
                    <span class="k">if</span> <span class="n">Stress</span> <span class="o">+</span> <span class="n">ss_new</span> <span class="o">&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Stress</span> <span class="o">+</span> <span class="n">ss_new</span>

                <span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Changevolume</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">RV</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Stress</span> <span class="o">+</span> <span class="n">ss_new</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">Ccp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">Csp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Do not care about the pore that is already dried</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Suction</span> <span class="o">=</span> <span class="n">ss_new</span>     <span class="c1"># Change current suction to the new soil suction.</span></div>


<div class="viewcode-block" id="EPUS.Wetting"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EPUS.Wetting">[docs]</a>    <span class="k">def</span> <span class="nf">Wetting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ss_new</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Decrease soil suction at a certain net mean/vertical Stress</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">RfSr_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RfSr_value</span>
        <span class="n">ChangeSuction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChangeSuction</span>
        <span class="n">Changevolume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Changevolume</span>
        <span class="n">ChangeWetSuction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChangeWetSuction</span>
        <span class="n">CVStress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CVStress</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
        <span class="n">Stress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Stress</span>
        <span class="n">Assumption</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Assumption</span>
        <span class="n">RefSr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RefSr</span>
        <span class="n">pm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pm</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Curveon</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">RefSr</span> <span class="o">&gt;=</span> <span class="n">RfSr_value</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">ss_new</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Curveon</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Curveon</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RefSr</span> <span class="o">=</span> <span class="n">RfSr_value</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">ss_new</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Curveon</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">RefSr</span> <span class="o">&gt;=</span> <span class="n">RfSr_value</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">ss_new</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Curveon</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Curveon</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RefSr</span> <span class="o">=</span> <span class="n">RfSr_value</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">ss_new</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Curveon</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Curveon</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RefSr</span> <span class="o">=</span> <span class="n">RfSr_value</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">ss_new</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Npoint</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">f</span><span class="o">.</span><span class="n">WEV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">Filled</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>     <span class="c1"># Check if the pore group is filled with water</span>
                <span class="k">if</span> <span class="n">Stress</span> <span class="o">+</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">ys</span> <span class="o">=</span> <span class="n">Stress</span> <span class="o">+</span> <span class="n">s</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ys</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="n">ChangeWetSuction</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">f</span><span class="o">.</span><span class="n">WEV</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">&gt;=</span> <span class="n">ss_new</span><span class="p">:</span>      <span class="c1"># Check if the pore group is possible to be filled with water after suction decreased to ss_new</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="n">ChangeWetSuction</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">f</span><span class="o">.</span><span class="n">WEV</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="n">Stress</span> <span class="o">&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="c1">#MsgBox &quot;never happend:&quot; + Str(f.YieldSt[i]) + &quot;     &lt;  &quot; + Str((s / ChangeWetSuction(ys, 10 ** f.AEV[i], 10 ** f.WEV[i])) + Stress)</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="n">ChangeWetSuction</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">f</span><span class="o">.</span><span class="n">WEV</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="n">Stress</span>
<span class="c1">#A-86</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Changevolume</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">RV</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Stress</span> <span class="o">+</span> <span class="n">ss_new</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">Ccp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">Csp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">Filled</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Pores are continually empty (WEV &lt; ss_new) ...those pores are dry and still dry after the wetting process</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">Filled</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">Assumption</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Ccp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">Stress</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                            <span class="n">tmp</span> <span class="o">=</span> <span class="n">CVStress</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(((</span><span class="n">log10</span><span class="p">(</span><span class="n">Stress</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="p">((</span><span class="n">RefSr</span> <span class="o">**</span> <span class="n">pm</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Ccp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">f</span><span class="o">.</span><span class="n">Ccd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">Ccd</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">/</span> <span class="n">f</span><span class="o">.</span><span class="n">Ccp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                        <span class="k">if</span> <span class="n">tmp</span> <span class="o">&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Changevolume</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">RV</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">Ccp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">Csp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># For all pores that has WEV&gt; current suction (..suction..) - AEV, WEV value are the same...pore increase in volume due to decrease in (suction+stress)</span>
                <span class="c1"># Yield stresses are the same</span>
                <span class="k">if</span> <span class="n">Stress</span> <span class="o">+</span> <span class="n">ss_new</span> <span class="o">&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Stress</span> <span class="o">+</span> <span class="n">ss_new</span>
                <span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Changevolume</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">RV</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Stress</span> <span class="o">+</span> <span class="n">ss_new</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">Ccp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">Csp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Suction</span> <span class="o">=</span> <span class="n">ss_new</span>     <span class="c1"># Change current suction to the new soil suction.</span></div>


<div class="viewcode-block" id="EPUS.Loading"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EPUS.Loading">[docs]</a>    <span class="k">def</span> <span class="nf">Loading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">st_new</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Increase net mean stress at a certain soil suction&quot;&quot;&quot;</span>

        <span class="n">RfSr_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RfSr_value</span>
        <span class="n">ChangeSuction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChangeSuction</span>
        <span class="n">Changevolume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Changevolume</span>
        <span class="n">ChangeWetSuction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChangeWetSuction</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
        <span class="n">Stress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Stress</span>
        <span class="n">Suction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Suction</span>
        <span class="n">Assumption</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Assumption</span>
        <span class="n">RefSr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RefSr</span>
        <span class="n">pm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pm</span>
        <span class="n">CVStress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CVStress</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Npoint</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">f</span><span class="o">.</span><span class="n">WEV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>        <span class="c1"># set variable s = water entry value of the pore on reference WPD</span>

            <span class="k">if</span> <span class="n">st_new</span> <span class="o">+</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">ys</span> <span class="o">=</span> <span class="n">st_new</span> <span class="o">+</span> <span class="n">s</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ys</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">Filled</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>   <span class="c1"># For pores that are currently filled with water</span>
                <span class="k">if</span> <span class="n">st_new</span> <span class="o">+</span> <span class="n">Suction</span> <span class="o">&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">st_new</span> <span class="o">+</span> <span class="n">Suction</span>
                <span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Changevolume</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">RV</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Suction</span> <span class="o">+</span> <span class="n">st_new</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">Ccp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">Csp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>  <span class="c1"># If pores are not filled with water...</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="n">ChangeWetSuction</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">Suction</span><span class="p">:</span> <span class="c1"># We have to check if WEV of the pore &lt; current suction...then will be filled with water</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ys</span>                                            <span class="c1"># Group of pores must be wetted before apply a load</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Changevolume</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">RV</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Suction</span> <span class="o">+</span> <span class="n">st_new</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">Ccp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">Csp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                    <span class="n">f</span><span class="o">.</span><span class="n">Filled</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># For all pores that has WEV&gt; current suction (..suction..) - AEV, WEV value are the same...pore increase in volume due to decrease in (suction+stress)</span>
                    <span class="c1"># Yield stresses are the same</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">Assumption</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Ccp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">Stress</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                            <span class="n">tmp</span> <span class="o">=</span> <span class="n">CVStress</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(((</span><span class="n">log10</span><span class="p">(</span><span class="n">st_new</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="p">((</span><span class="n">RefSr</span> <span class="o">**</span> <span class="n">pm</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Ccp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">f</span><span class="o">.</span><span class="n">Ccd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">Ccd</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">/</span> <span class="n">f</span><span class="o">.</span><span class="n">Ccp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">AEV</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="c1">#&#39;If Stress &lt; tmp Then</span>
                            <span class="c1">#&#39;  MsgBox &quot;Stress = &quot; + Str(Stress) + &quot;    Yield stress = &quot; + Str(tmp)</span>
                            <span class="c1">#&#39;End If</span>
                        <span class="k">if</span> <span class="n">tmp</span> <span class="o">&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Changevolume</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">RV</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">Ccp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">Csp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="c1"># A-87</span>

                    <span class="c1">#f.Filled[i] = False</span>
                    <span class="c1">#f.AEVC[i] = log10(10 ** f.AEV[i] / ChangeSuction(f.YieldSt[i], 10 ** f.AEV[i]))</span>
                    <span class="c1">#f.WEVC[i] = log10(10 ** f.WEV[i] / ChangeSuction(f.YieldSt[i], 10 ** f.AEV[i]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stress</span> <span class="o">=</span> <span class="n">st_new</span> <span class="c1"># Change current suction to the new stress.</span></div>

<div class="viewcode-block" id="EPUS.Unloading"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EPUS.Unloading">[docs]</a>    <span class="k">def</span> <span class="nf">Unloading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">st_new</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Decrease net mean stress at a certain soil suction&quot;&quot;&quot;</span>


        <span class="n">Changevolume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Changevolume</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
        <span class="n">Suction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Suction</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Npoint</span><span class="p">):</span>

            <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">f</span><span class="o">.</span><span class="n">WEV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">Filled</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="c1">#For the pore that is filled with water</span>
                <span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Changevolume</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">RV</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">YieldSt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Suction</span> <span class="o">+</span> <span class="n">st_new</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">Ccp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">Csp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="c1">#            End If</span>
<span class="c1">#            Next i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stress</span> <span class="o">=</span> <span class="n">st_new</span>     <span class="c1"># Change current suction to the new stress.</span></div>

<div class="viewcode-block" id="EPUS.DegreeofsaturationSWCC"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EPUS.DegreeofsaturationSWCC">[docs]</a>    <span class="k">def</span> <span class="nf">DegreeofsaturationSWCC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This procedure is used to calculate Srdry and Srwet&quot;&quot;&quot;</span>

        <span class="n">NumSr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NumSr</span>
        <span class="n">MaxSuction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MaxSuction</span>
        <span class="n">MinSuction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MinSuction</span>
        <span class="n">Gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">SlurryPoreSize</span><span class="p">()</span>       <span class="c1"># Reset the soil to initial slurry condition</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
<span class="c1">#        frmFlash.Show (vbModeless)</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Stress</span>          <span class="c1"># cs = current stress</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Suction</span>         <span class="c1"># ct = current suction</span>
        <span class="n">intv</span> <span class="o">=</span> <span class="p">(</span><span class="n">MaxSuction</span> <span class="o">-</span> <span class="n">MinSuction</span><span class="p">)</span> <span class="o">/</span> <span class="n">NumSr</span>  <span class="c1"># Take equal interval in log scale</span>
<span class="c1">#        frmFlash.lbprogress.Caption = &quot;Please wait, calculating Ref Drying S% SWCC...&quot;</span>
<span class="c1">#        &#39;&#39;&#39;frmFlash.Refresh</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NumSr</span><span class="p">):</span> <span class="c1">#&#39; along the drying process</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">intv</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">MinSuction</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Drying</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
            <span class="n">tmp1</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">tmp2</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Npoint</span><span class="p">):</span>
                <span class="n">tmp1</span> <span class="o">=</span> <span class="n">tmp1</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">Filled</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">tmp2</span> <span class="o">=</span> <span class="n">tmp2</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Srdry</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp2</span> <span class="o">/</span> <span class="n">tmp1</span>


<span class="c1">#  frmFlash.lbprogress.Caption = &quot;Please wait, calculating Ref Wetting S% SWCC...&quot;</span>
<span class="c1">#  &#39;&#39;&#39;frmFlash.Refresh</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NumSr</span><span class="p">):</span> <span class="c1"># along the wetting process</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">MaxSuction</span> <span class="o">-</span> <span class="n">intv</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Wetting</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
            <span class="n">tmp1</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">tmp2</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Npoint</span><span class="p">):</span>
                <span class="n">tmp1</span> <span class="o">=</span> <span class="n">tmp1</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">Filled</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">tmp2</span> <span class="o">=</span> <span class="n">tmp2</span> <span class="o">+</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">Gs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Srwet</span><span class="p">[</span><span class="n">NumSr</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp2</span> <span class="o">*</span> <span class="n">Gs</span> <span class="o">/</span> <span class="n">tmp1</span></div>
<span class="c1">#    &#39;&#39;&#39;frmFlash.Refresh</span>
<span class="c1">#      End Sub</span>

<div class="viewcode-block" id="EPUS.RfSr_value"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EPUS.RfSr_value">[docs]</a>    <span class="k">def</span> <span class="nf">RfSr_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curvetype</span><span class="p">,</span> <span class="n">ssvalue</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Curvetype : int</span>
<span class="sd">            curvetype=1: drying; = 2: scanning; =3: wetting</span>
<span class="sd">        ssvalue : double</span>
<span class="sd">            Don&#39;t know</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : float</span>
<span class="sd">            Reference saturation value</span>

<span class="sd">        &quot;&quot;&quot;</span>



        <span class="n">NumSr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NumSr</span>
        <span class="n">MaxSuction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MaxSuction</span>
        <span class="n">MinSuction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MinSuction</span>

        <span class="k">if</span> <span class="n">curvetype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Srdry</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="n">log10</span><span class="p">(</span><span class="n">ssvalue</span><span class="p">)</span> <span class="o">-</span> <span class="n">MinSuction</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">MaxSuction</span> <span class="o">-</span> <span class="n">MinSuction</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">NumSr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))]</span>
        <span class="k">if</span> <span class="n">curvetype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Srwet</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="n">log10</span><span class="p">(</span><span class="n">ssvalue</span><span class="p">)</span> <span class="o">-</span> <span class="n">MinSuction</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">MaxSuction</span> <span class="o">-</span> <span class="n">MinSuction</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">NumSr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))]</span></div>
<span class="c1">#&#39;A-88</span>

    <span class="k">def</span> <span class="nf">_Calresults_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">stp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stp</span>
        <span class="n">Drying</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Drying</span>
        <span class="n">Wetting</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wetting</span>
        <span class="n">Loading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Loading</span>
        <span class="n">Unloading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Unloading</span>
        <span class="n">CVStress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CVStress</span><span class="p">()</span>

        <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span>
        <span class="n">Gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">errocc</span> <span class="o">=</span> <span class="kc">False</span>
<span class="c1">#        Initiate</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Assumption</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DegreeofsaturationSWCC</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#frmFlash.Show</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SlurryPoreSize</span><span class="p">()</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Stress</span>          <span class="c1">#&#39; = current stress</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Suction</span>         <span class="c1">#&#39; = current suction</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
        <span class="n">stp</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stp</span><span class="o">.</span><span class="n">nsteps</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">stp</span><span class="o">.</span><span class="n">ist</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">stp</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">stp</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">intv</span> <span class="o">=</span> <span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="n">stp</span><span class="o">.</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="n">log10</span><span class="p">(</span><span class="n">cs</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">stp</span><span class="o">.</span><span class="n">npp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">#&#39; Take equal interval in log scale</span>
                <span class="c1">#stp.startpoint(stp.n) = datapoint.n + 1</span>
                <span class="n">datapoint</span> <span class="o">=</span> <span class="n">stp</span><span class="o">.</span><span class="n">datapoints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">datapoint</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stp</span><span class="o">.</span><span class="n">npp</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                    <span class="n">datapoint</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">datapoint</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="c1">#frmFlash.lbprogress.Caption = &quot;Calculating data point #&quot; + Str[datapoint.n]</span>
                    <span class="c1">#&#39;&#39;&#39;frmFlash.Refresh</span>
                    <span class="n">datapoint</span><span class="o">.</span><span class="n">ss</span><span class="p">[</span><span class="n">datapoint</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">((</span><span class="n">j</span> <span class="o">-</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">intv</span> <span class="o">+</span> <span class="n">log10</span><span class="p">(</span><span class="n">cs</span><span class="p">))</span>

                    <span class="n">datapoint</span><span class="o">.</span><span class="n">st</span><span class="p">[</span><span class="n">datapoint</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">ct</span>
                    <span class="k">if</span> <span class="n">intv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">Drying</span><span class="p">(</span><span class="n">datapoint</span><span class="o">.</span><span class="n">ss</span><span class="p">[</span><span class="n">datapoint</span><span class="o">.</span><span class="n">n</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">Wetting</span><span class="p">(</span><span class="n">datapoint</span><span class="o">.</span><span class="n">ss</span><span class="p">[</span><span class="n">datapoint</span><span class="o">.</span><span class="n">n</span><span class="p">])</span>
                    <span class="n">tmp1</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">tmp2</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Npoint</span><span class="p">):</span>
                        <span class="n">tmp1</span> <span class="o">=</span> <span class="n">tmp1</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">Filled</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">Airentrapped</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                                <span class="n">tmp2</span> <span class="o">=</span> <span class="n">tmp2</span> <span class="o">+</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">Gs</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">tmp2</span> <span class="o">=</span> <span class="n">tmp2</span> <span class="o">+</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">Gs</span><span class="p">)</span>

                    <span class="n">datapoint</span><span class="o">.</span><span class="n">e</span><span class="p">[</span><span class="n">datapoint</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp1</span>
                    <span class="n">datapoint</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">datapoint</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp2</span>

                <span class="n">cs</span> <span class="o">=</span> <span class="n">stp</span><span class="o">.</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">stp</span><span class="o">.</span><span class="n">ist</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">stp</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">stp</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">intv</span> <span class="o">=</span> <span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="n">stp</span><span class="o">.</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="n">log10</span><span class="p">(</span><span class="n">ct</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">stp</span><span class="o">.</span><span class="n">npp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1">#&#39; Take equal interval in log scale</span>
                <span class="c1">#stp.startpoint(stp.n) = datapoint.n + 1</span>
                <span class="n">datapoint</span> <span class="o">=</span> <span class="n">stp</span><span class="o">.</span><span class="n">datapoints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">datapoint</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stp</span><span class="o">.</span><span class="n">npp</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                    <span class="n">datapoint</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">datapoint</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="c1">#frmFlash.lbprogress.Caption = &quot;         Calculating data point #&quot; + Str[datapoint.n]</span>
                    <span class="c1">#&#39;&#39;&#39;frmFlash.Refresh</span>
                    <span class="n">datapoint</span><span class="o">.</span><span class="n">ss</span><span class="p">[</span><span class="n">datapoint</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">cs</span>
                    <span class="n">datapoint</span><span class="o">.</span><span class="n">st</span><span class="p">[</span><span class="n">datapoint</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="p">((</span><span class="n">j</span> <span class="o">-</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">intv</span> <span class="o">+</span> <span class="n">log10</span><span class="p">(</span><span class="n">ct</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">intv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">Loading</span><span class="p">(</span><span class="n">datapoint</span><span class="o">.</span><span class="n">st</span><span class="p">[</span><span class="n">datapoint</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="n">CVStress</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">Unloading</span><span class="p">(</span><span class="n">datapoint</span><span class="o">.</span><span class="n">st</span><span class="p">[</span><span class="n">datapoint</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="n">CVStress</span><span class="p">)</span>

                    <span class="n">tmp1</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">tmp2</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Npoint</span><span class="p">):</span>
                        <span class="n">tmp1</span> <span class="o">=</span> <span class="n">tmp1</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

<span class="c1">#&#39;A-89</span>
                        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">Filled</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">Airentrapped</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                                <span class="n">tmp2</span> <span class="o">=</span> <span class="n">tmp2</span> <span class="o">+</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">Gs</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">tmp2</span> <span class="o">=</span> <span class="n">tmp2</span> <span class="o">+</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">RVC</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">Gs</span><span class="p">)</span>

                    <span class="n">datapoint</span><span class="o">.</span><span class="n">e</span><span class="p">[</span><span class="n">datapoint</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp1</span>
                    <span class="n">datapoint</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">datapoint</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp2</span>
                <span class="n">ct</span> <span class="o">=</span> <span class="n">stp</span><span class="o">.</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="c1">#stp.endpoint(stp.n) = datapoint.n</span>


        <span class="k">for</span> <span class="n">datapoint</span> <span class="ow">in</span> <span class="n">stp</span><span class="o">.</span><span class="n">datapoints</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">datapoint</span><span class="o">.</span><span class="n">npts</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">datapoint</span><span class="o">.</span><span class="n">ss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">999999</span><span class="p">:</span> <span class="n">datapoint</span><span class="o">.</span><span class="n">ss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">999998</span>
                <span class="k">if</span> <span class="n">datapoint</span><span class="o">.</span><span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">999999</span><span class="p">:</span> <span class="n">datapoint</span><span class="o">.</span><span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">999998</span>
                <span class="n">datapoint</span><span class="o">.</span><span class="n">Sr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">datapoint</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">Gs</span> <span class="o">/</span> <span class="n">datapoint</span><span class="o">.</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">datapoint</span><span class="o">.</span><span class="n">vw</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">datapoint</span><span class="o">.</span><span class="n">Sr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">datapoint</span><span class="o">.</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">datapoint</span><span class="o">.</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">#            Unload frmFlash</span>
<span class="c1">#  Call output_datapoint(Application.ActiveSheet)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">errocc</span><span class="p">:</span>
            <span class="c1">#MsgBox &quot; Input data is not valid, please check the PORE-SHAPE PARAMETER&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Input data is not valid, please check the PORE-SHAPE PARAMETER&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_Calresults_fortran</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">dealloc</span><span class="p">()</span>

        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">nsteps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">nsteps</span>
<span class="c1">#        ALLOCATE(ist(1:nsteps))</span>
<span class="c1">#        ALLOCATE(vl(1:nsteps))</span>
<span class="c1">#        ALLOCATE(npp(1:nsteps))</span>
<span class="c1">#        ist(1:5) = (/.true., .true., .false., .false., .false./)</span>
<span class="c1">#        npp(1:5) = 100</span>
<span class="c1">#        vl(1:5) = (/ 20._DP, 1._DP, 1.E6_DP, 30._DP, 1500._DP/)</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">ist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">ist</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">vl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">vl</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">npp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">npp</span>

        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">wsat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SimpleSWCC</span><span class="o">.</span><span class="n">wsat</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SimpleSWCC</span><span class="o">.</span><span class="n">a</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SimpleSWCC</span><span class="o">.</span><span class="n">b</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">wr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SimpleSWCC</span><span class="o">.</span><span class="n">wr</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SimpleSWCC</span><span class="o">.</span><span class="n">sl</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">logds</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logDS</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">logrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logRS</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">ccs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ccs</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">css</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Css</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">ccd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ccd</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">assumption</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Assumption</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">pm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pm</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">pore_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pore_shape</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">k0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K0</span>
<span class="c1">#        epus_ext.epus.soilname = self.soilname #fortran code *len messes everything up</span>
<span class="c1">#        epus_ext.epus.username = self.username #fortran code *len messes everything up</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">numsr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NumSr</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">npoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Npoint</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">maxsuction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MaxSuction</span>
        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">minsuction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MinSuction</span>

        <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">calresults</span><span class="p">()</span>

        <span class="c1"># put Fortran results (long 1d array) back into stp (multiple 1d arrays for each load step)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">nsteps</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">startpoint</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1"># Fortran indexing starts at 1</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">endpoint</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">datapoints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ss</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">ss</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">datapoints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">st</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">st</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">datapoints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">e</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">ee</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">datapoints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">w</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">datapoints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Sr</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">sr</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">datapoints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">vw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">epus_ext</span><span class="o">.</span><span class="n">epus</span><span class="o">.</span><span class="n">vw</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>


<div class="viewcode-block" id="EPUS.Calresults"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EPUS.Calresults">[docs]</a>    <span class="k">def</span> <span class="nf">Calresults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the results ie calculate the response to the stress path</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">implementation</span> <span class="o">==</span> <span class="s1">&#39;scalar&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Calresults_scalar</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_SUCCESSFUL_FORTRAN_IMPORT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_Calresults_fortran</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_Calresults_scalar</span><span class="p">()</span></div></div>




<div class="viewcode-block" id="PoresizeDistribution"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.PoresizeDistribution">[docs]</a><span class="k">class</span> <span class="nc">PoresizeDistribution</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pore size distribution curve</span>

<span class="sd">    Basically a container for data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Npoint : int, optional</span>
<span class="sd">        Number of data points along the pore size distribution curve.</span>
<span class="sd">        Default Npoint=1000</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    Npoint : int</span>
<span class="sd">        Number of data points along the pore size distrubution curve.</span>
<span class="sd">    AEV : 1d array of float</span>
<span class="sd">        Value of Air Entry Value that the function F represents.</span>
<span class="sd">    WEV : 1d array of float</span>
<span class="sd">        Value of Water Entry Value that the function F represents.</span>
<span class="sd">    Ccp : 1d array of float</span>
<span class="sd">        Virgin compression index of the group of pore at saturated.</span>
<span class="sd">    Csp : 1d array of float</span>
<span class="sd">        Unloading-Reloading index of the group of pore at saturated.</span>
<span class="sd">    Ccd : 1d array of float</span>
<span class="sd">        Virgin compression index of the group of pore at completely dry</span>
<span class="sd">        condition (10^6 kPa).</span>
<span class="sd">    RV : 1d array of float</span>
<span class="sd">        Ratio of Volume of the group of pore/ volume of solid phase.</span>
<span class="sd">    YieldSt : 1d array of float</span>
<span class="sd">        Equivalent maximum stress acted on the pores at water-filled state.</span>
<span class="sd">    Filled : 1d array of bool</span>
<span class="sd">        State of the pore - either filled or empty.</span>
<span class="sd">    RVC : 1d array of float</span>
<span class="sd">        Actual ratio of volume of the group of pore/ volume of solid phase.</span>
<span class="sd">    AEVC : 1d array of float</span>
<span class="sd">        Actual Air Entry Value of the group of pores [i] which has AEV at</span>
<span class="sd">        dried slurry = AEV[i].</span>
<span class="sd">    WEVC : 1d array of float</span>
<span class="sd">        Actual water entry value.</span>
<span class="sd">    Airentrapped : 1d array of bool</span>
<span class="sd">        If experienced dried state = True, if did not = False.</span>


<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Npoint</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Npoint</span> <span class="o">=</span> <span class="n">Npoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AEV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Npoint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">WEV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Npoint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ccp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Npoint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Csp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Npoint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ccd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Npoint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Npoint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">YieldSt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Npoint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Filled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Npoint</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RVC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Npoint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AEVC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Npoint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">WEVC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Npoint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Airentrapped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Npoint</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span></div>




<div class="viewcode-block" id="CurveFittingSWCC"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.CurveFittingSWCC">[docs]</a><span class="k">class</span> <span class="nc">CurveFittingSWCC</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Curve fitting soil water characteristic curve for collapsible pores.</span>
<span class="sd">    </span>
<span class="sd">    i.e. wc(suction)</span>

<span class="sd">    Note that that when suction is less than 1, results are not meaningful.</span>
<span class="sd">    At low suction values we expect wc approx equal to wsat-wr, but the </span>
<span class="sd">    sl * log10(suction) /Gs term gives large negative numbers for suctions </span>
<span class="sd">    less than 1, whereas at suction =1 it dissapears as expected.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wsat : float</span>
<span class="sd">        Gravimetric water condent at 100% saturation.</span>
<span class="sd">    a : float</span>
<span class="sd">        Curve fitting parameter.</span>
<span class="sd">    b : float</span>
<span class="sd">        Curve fitting parameter.</span>
<span class="sd">    wr : float</span>
<span class="sd">        Residual gravimetric water content.</span>
<span class="sd">    sl : float</span>
<span class="sd">        Initial slope of SWCC*Gs. This is actually the saturated virgin </span>
<span class="sd">        compressibility index Cc.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    wsat : float</span>
<span class="sd">        Gravimetric water condent at 100% saturation.</span>
<span class="sd">    a : float</span>
<span class="sd">        Curve fitting parameter.</span>
<span class="sd">    b : float</span>
<span class="sd">        Curve fitting parameter.</span>
<span class="sd">    wr : float</span>
<span class="sd">        Residual gravimetric water content.</span>
<span class="sd">    sl : float</span>
<span class="sd">        Initial slope of SWCC.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wsat</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">wr</span><span class="p">,</span> <span class="n">sl</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wsat</span> <span class="o">=</span> <span class="n">wsat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wr</span> <span class="o">=</span> <span class="n">wr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span> <span class="o">=</span> <span class="n">sl</span>


<div class="viewcode-block" id="CurveFittingSWCC.Wc"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.CurveFittingSWCC.Wc">[docs]</a>    <span class="k">def</span> <span class="nf">Wc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">Gs</span><span class="o">=</span><span class="mf">2.7</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Collapsible water content function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        s : float</span>
<span class="sd">            Suction.</span>
<span class="sd">        Gs : float, optional</span>
<span class="sd">            Specific gravity of solids. Default Gs=2.7</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : float</span>
<span class="sd">            water content Wc</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; SWCC = CurveFittingSWCC(wsat=0.262,</span>
<span class="sd">        ...                        a = 3.1 * 10 ** 6,</span>
<span class="sd">        ...                        b = 3.377,</span>
<span class="sd">        ...                        wr = 0.128,</span>
<span class="sd">        ...                        sl = 0.115)</span>
<span class="sd">        &gt;&gt;&gt; SWCC.Wc(500, Gs=2.7)</span>
<span class="sd">        4.525...e-05</span>


<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">wsat1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsat</span>
        <span class="n">wr1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wr</span>
        <span class="n">b1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="n">sl1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span>
        <span class="n">Wc_</span> <span class="o">=</span> <span class="p">((</span><span class="n">wsat1</span> <span class="o">-</span> <span class="n">sl1</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">/</span> <span class="n">Gs</span> <span class="o">-</span> <span class="n">wr1</span><span class="p">)</span> <span class="o">*</span> <span class="n">a1</span> <span class="o">*</span>
               <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span> <span class="o">**</span> <span class="n">b1</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">b1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">**</span> <span class="n">b1</span> <span class="o">+</span> <span class="n">a1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Wc_</span></div>


<div class="viewcode-block" id="CurveFittingSWCC.DWc"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.CurveFittingSWCC.DWc">[docs]</a>    <span class="k">def</span> <span class="nf">DWc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">Gs</span><span class="o">=</span><span class="mf">2.7</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Derivative of collapsible water content function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        s : float</span>
<span class="sd">            Suction.</span>
<span class="sd">        Gs : float, optional</span>
<span class="sd">            Specific gravity of solids. Default Gs=2.7</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : float</span>
<span class="sd">            derivative of water content Wc w.r.t. suction</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; SWCC = CurveFittingSWCC(wsat=0.262,</span>
<span class="sd">        ...                        a = 3.1 * 10 ** 6,</span>
<span class="sd">        ...                        b = 3.377,</span>
<span class="sd">        ...                        wr = 0.128,</span>
<span class="sd">        ...                        sl = 0.115)</span>
<span class="sd">        &gt;&gt;&gt; SWCC.DWc(500, Gs=2.7)</span>
<span class="sd">        -2.367...e-05</span>


<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">wsat1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsat</span>
        <span class="n">wr1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wr</span>
        <span class="n">b1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="n">sl1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span>
        <span class="n">temp1</span> <span class="o">=</span> <span class="n">wsat1</span> <span class="o">-</span> <span class="n">sl1</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">Gs</span><span class="p">)</span> <span class="o">-</span> <span class="n">wr1</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="o">-</span><span class="n">a1</span> <span class="o">*</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">s</span> <span class="o">**</span> <span class="n">b1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span> <span class="o">*</span> <span class="n">b1</span><span class="p">)</span> <span class="o">*</span> <span class="n">a1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">**</span> <span class="n">b1</span> <span class="o">+</span> <span class="n">a1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">temp3</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">s</span> <span class="o">**</span> <span class="n">b1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">b1</span><span class="p">)))</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">**</span> <span class="n">b1</span> <span class="o">+</span> <span class="n">a1</span><span class="p">)</span>
        <span class="n">temp4</span> <span class="o">=</span> <span class="n">sl1</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">Gs</span><span class="p">)</span>
        <span class="n">temp5</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">s</span> <span class="o">/</span> <span class="n">a1</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">b1</span><span class="p">))</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">6</span> <span class="o">/</span> <span class="n">a1</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">b1</span><span class="p">)))</span>
        <span class="n">temp6</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">b1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">s</span> <span class="o">/</span> <span class="n">a1</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">b1</span><span class="p">))</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">6</span> <span class="o">/</span> <span class="n">a1</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">b1</span><span class="p">))</span>
        <span class="n">DWc_</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp1</span> <span class="o">*</span> <span class="n">temp2</span> <span class="o">-</span> <span class="n">temp3</span> <span class="o">*</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">*</span> <span class="n">temp5</span> <span class="o">-</span> <span class="p">(</span><span class="n">temp3</span> <span class="o">*</span> <span class="n">temp1</span> <span class="o">+</span> <span class="n">wr1</span><span class="p">)</span> <span class="o">/</span> <span class="n">temp6</span>

        <span class="k">return</span> <span class="n">DWc_</span></div></div>



<div class="viewcode-block" id="StressPath"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.StressPath">[docs]</a><span class="k">class</span> <span class="nc">StressPath</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Stress paths to follow</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path_dicts : list of dict</span>
<span class="sd">        Each dict describes a step in the stress path. Each dict in the list</span>
<span class="sd">        has the following.</span>

<span class="sd">        ==================  ============================================</span>
<span class="sd">        key                 description</span>
<span class="sd">        ==================  ============================================</span>
<span class="sd">        vl                  Value of net normal stress or suction</span>
<span class="sd">                            at end of stress path step.</span>
<span class="sd">        ist                 bool. Optional. If change in</span>
<span class="sd">                            stress...ist=True else ist=False. Default</span>
<span class="sd">                            ist=True.</span>
<span class="sd">        npp                 int. Optional. Number of points to subdivide</span>
<span class="sd">                            stress path step into. default npp=100.</span>
<span class="sd">        name                str. Optional. Description of step. Default</span>
<span class="sd">                            name=&#39;Step 0&#39; etc.</span>
<span class="sd">        ==================  ============================================</span>


<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    ist : 1d array of bool</span>
<span class="sd">        Loading type for each step in stress path. True indicates a net</span>
<span class="sd">        normal stress change. False indicates a suction change.</span>
<span class="sd">    vl : 1d array of float</span>
<span class="sd">        Value of stress or suction at end of step.</span>
<span class="sd">    npp : 1d array of int</span>
<span class="sd">        Number of points to subdivide each stress path step into.</span>
<span class="sd">    name : list of str</span>
<span class="sd">        Name of each stress path step</span>
<span class="sd">    n : int</span>
<span class="sd">        Counter indicating current subdivision.</span>
<span class="sd">    nsteps : int</span>
<span class="sd">        Number of stress path steps. i.e. len(path_dicts)</span>
<span class="sd">    datapoints : list of DataResults objects</span>
<span class="sd">        Results data for each stress path step. (ss, st, e, w, sr, vw)</span>
<span class="sd">    datapoints_combined : DataResults object</span>
<span class="sd">        datapoints joined end to end. e.g. access ss from all steps using</span>
<span class="sd">        datapoints_combined.ss  (only exists after running combine_datapoints).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_dicts</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nsteps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">path_dicts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nsteps</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nsteps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nsteps</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">path_dicts</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ist&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;vl&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">npp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;npp&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

            <span class="n">name</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ist</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Step #</span><span class="si">{:s}</span><span class="s2">, stress change to &quot;</span>
                            <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2"> kPa.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Step #</span><span class="si">{:s}</span><span class="s2">, suction change to &quot;</span>
                            <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2"> kPa.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">datapoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">DataResults</span><span class="p">(</span><span class="n">npp</span><span class="p">)</span> <span class="k">for</span> <span class="n">npp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">npp</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">_print_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nsteps</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">npp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<div class="viewcode-block" id="StressPath.combine_datapoints"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.StressPath.combine_datapoints">[docs]</a>    <span class="k">def</span> <span class="nf">combine_datapoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make datapoints_combined i.e. join all the datapoints&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">datapoints_combined</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datapoints</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="DataResults"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.DataResults">[docs]</a><span class="k">class</span> <span class="nc">DataResults</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Container for stress, suction, void ratio, water content, saturation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    npts : int</span>
<span class="sd">        Number of data points.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    npts : int</span>
<span class="sd">        Numer of data points.</span>
<span class="sd">    n : int</span>
<span class="sd">        Counter</span>
<span class="sd">    st : 1d array of float</span>
<span class="sd">        Net normal stress. len is npts</span>
<span class="sd">    ss : 1d array of float</span>
<span class="sd">        Suction.</span>
<span class="sd">    e : 1d array of float</span>
<span class="sd">        Void Ratio</span>
<span class="sd">    w : 1d array of float</span>
<span class="sd">        gravimetric water content</span>
<span class="sd">    Sr : 1d array of float</span>
<span class="sd">        Degree of saturation</span>
<span class="sd">    vw : 1d array of float</span>
<span class="sd">        Volumetric water content.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">npts</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">npts</span> <span class="o">=</span> <span class="n">npts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Sr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ss&#39;</span><span class="p">,</span> <span class="s1">&#39;st&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;Sr&#39;</span><span class="p">,</span> <span class="s1">&#39;vw&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Join two DataResults objects into one</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : DataResults object</span>
<span class="sd">            DataResults object to add onto existing object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : DataResults object</span>
<span class="sd">            out.npts = self.npts + other.npts</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">DataResults</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;other is not a DataResults object.&#39;</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">DataResults</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npts</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">npts</span><span class="p">)</span>



        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">:</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">v</span><span class="p">)[:</span><span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">v</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">:]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">other</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>




<div class="viewcode-block" id="EpusProfile"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EpusProfile">[docs]</a><span class="k">class</span> <span class="nc">EpusProfile</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;1D initial conditons (stress etc.) distribution for EPUS unsaturated</span>
<span class="sd">    soil model.</span>


<span class="sd">    Proceedure:</span>

<span class="sd">     - Determine pore water pressure, uw, at depth based on depth of</span>
<span class="sd">       water table, zw,  i.e. uw is negative above water table. This</span>
<span class="sd">       gives suction (psi) profile above water table.</span>
<span class="sd">     - Guess an initial stress (sig) distribution, including an initial</span>
<span class="sd">       surcharge of q0.</span>
<span class="sd">     - Assume a stress path starting from slurry to stress increase to</span>
<span class="sd">       sig and then suction to psi.  Use EPUS to calculate void ratio (e)</span>
<span class="sd">       and saturation (Sr).</span>
<span class="sd">     - Use Gs, e, Sr to calc unit weight (gamma) profile.</span>
<span class="sd">       Numerically integrate unit weight profile to with sig at z=0 equals q0</span>
<span class="sd">       to give new stress profile.</span>
<span class="sd">     - Check convergence of new stress vs old stress profile.  If not equal</span>
<span class="sd">       then iterate.</span>
<span class="sd">     - Once solutin converged, record stress, void ratio, saturation profiles.</span>



<span class="sd">    Note initial EPUS loading steps begin from 0 net normal stress (sig-ua).</span>
<span class="sd">    Below the water table there is a bouyant force so the sig-ua stress input</span>
<span class="sd">    is actually an effective stress.</span>



<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    epus_object : instance of EPUS object</span>
<span class="sd">        An EPUS object from which all relevant parameters can be taken.</span>
<span class="sd">        Use a dummy stress path for this; it will be ignored.  Also Npoint</span>
<span class="sd">        will be ignored.  Basically just using and EPUS object as a</span>
<span class="sd">        convienient container.</span>
<span class="sd">    H : float</span>
<span class="sd">        Height of soil profile.</span>
<span class="sd">    zw : float, optional</span>
<span class="sd">        Depth of water table.  Default zw=None, i.e. will be set to H.</span>
<span class="sd">    q0 : float, optional</span>
<span class="sd">        Existing surcharge.  Default q0=1.</span>
<span class="sd">    gamw : float, optional</span>
<span class="sd">        Unit weight of water.  Default gamw=10.</span>
<span class="sd">    nz : int, optional</span>
<span class="sd">        Final number of depth values in profile. default nz=10.</span>
<span class="sd">    Npoint : int, optional</span>
<span class="sd">        Number of data points along the pore size distribution curve.</span>
<span class="sd">        Default Npoint=1000</span>
<span class="sd">    npp : float, optional</span>
<span class="sd">        Number of points per stress path step.  Default npp=100</span>
<span class="sd">    nz_refine : list of float, optional</span>
<span class="sd">        Allows progressive refinement of the number of points in the profile.</span>
<span class="sd">        Initially stress profile will be calcuated at int(nz*nz_refine[0])</span>
<span class="sd">        evenly spaced depth values. Once convergence is reached</span>
<span class="sd">        a new stress profile will be interpolated at int(nz*nz_refine[1])</span>
<span class="sd">        and the convergence process is run again.  The refinement is repeated</span>
<span class="sd">        untill the  final value of nz_refine (which should be 1) is used.</span>
<span class="sd">        Default nz_refine=[1] i.e. no successvie refinement.</span>
<span class="sd">    Npoint_refine : list of float, optional</span>
<span class="sd">        Similar to nz_refine.  Last value whould be 1. Sould be same length as</span>
<span class="sd">        nz_refine. Default Npoint_refine=[1]</span>
<span class="sd">    npp_refine : list of float</span>
<span class="sd">        Similar to nz_refine. Last value should be 1.  Should be same length as</span>
<span class="sd">        nz_refine.  Default npp_refine = [1]</span>
<span class="sd">    rtol, atol : float, optional</span>
<span class="sd">        Relative and absolute tolerance for checking convergence of stress.</span>
<span class="sd">        See numpy.allclose . Default atol=0.01, rtol=1e-6</span>
<span class="sd">    max_iter : int, optional</span>
<span class="sd">        Maxmum number of convergence iterations at each refinement step.</span>
<span class="sd">        Default max_iter=100 .</span>
<span class="sd">    initial_stress : tuple of two 1d arrays</span>
<span class="sd">        Initial stress to use to start of iteration.</span>
<span class="sd">        1st element of tuple is list/array of z values, 2nd element is</span>
<span class="sd">        list/array. Default intial_stress=None i.e. make up an initial guess</span>
<span class="sd">        using unit weight = 15.  Values will be interpolated.</span>




<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    _nz, _Npoint, _npp : int</span>
<span class="sd">        Current &#39;refined&#39; value of nz, Npoint, and _npp.</span>
<span class="sd">    profile : DataResults object</span>
<span class="sd">        Contains information about each data point in the profile.</span>
<span class="sd">        In addition to normal DataResults attributes ( ss, st, e, w, Sr, vw)</span>
<span class="sd">        it has unit weight (gam), depth (z), pore water pressure (uw)</span>
<span class="sd">    _epus_dict : dictionary</span>
<span class="sd">        dict containing common keywords from the epus_object to initialize</span>
<span class="sd">        other epus objects at each depth.  Basically just need to add</span>
<span class="sd">        Npoints, and stp stress path objects at each depth and refinement.</span>
<span class="sd">    niter : list of int</span>
<span class="sd">        number of iterations to converge at each refinement level.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    &quot;stress&quot; below water table is effective stress.  &quot;stress&quot; avbove water</span>
<span class="sd">    table is net normal stress.</span>

<span class="sd">    &quot;&quot;&quot;</span>



    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">epus_object</span><span class="p">,</span>
                 <span class="n">H</span><span class="p">,</span>
                 <span class="n">zw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">q0</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">gamw</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                 <span class="n">nz</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                 <span class="n">Npoint</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                 <span class="n">npp</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                 <span class="n">nz_refine</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">Npoint_refine</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">npp_refine</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">atol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                 <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>
                 <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                 <span class="n">initial_stress</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">epus_object</span> <span class="o">=</span> <span class="n">epus_object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="n">H</span>
        <span class="k">if</span> <span class="n">zw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zw</span> <span class="o">=</span> <span class="n">zw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q0</span> <span class="o">=</span> <span class="n">q0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamw</span> <span class="o">=</span> <span class="n">gamw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nz</span> <span class="o">=</span> <span class="n">nz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Npoint</span> <span class="o">=</span> <span class="n">Npoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npp</span> <span class="o">=</span> <span class="n">npp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nz_refine</span> <span class="o">=</span> <span class="n">nz_refine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Npoint_refine</span> <span class="o">=</span> <span class="n">Npoint_refine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npp_refine</span> <span class="o">=</span> <span class="n">npp_refine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atol</span> <span class="o">=</span> <span class="n">atol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rtol</span> <span class="o">=</span> <span class="n">rtol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span> <span class="o">=</span> <span class="n">max_iter</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">niter</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_stress</span> <span class="o">=</span> <span class="n">initial_stress</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimpleSWCC&#39;</span><span class="p">,</span>
                 <span class="c1">#&#39;stp&#39;,</span>
                 <span class="s1">&#39;logDS&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;logRS&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Ccs&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Css&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Ccd&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Gs&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Assumption&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;beta&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;pm&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Pore_shape&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;K0&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;soilname&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;username&#39;</span><span class="p">,</span>
                 <span class="c1">#&#39;Npoint&#39;,</span>
                 <span class="s1">&#39;NumSr&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;MaxSuction&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;MinSuction&#39;</span><span class="p">,]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_epus_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_epus_dict</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epus_object</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>


        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_initialize_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Guess initial stress distribution to begin iterations from&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_stress</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gam</span> <span class="o">=</span> <span class="mf">15.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">st</span><span class="p">[:]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">gam</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">q0</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">uw</span><span class="o">&gt;</span><span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">st</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">uw</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zi</span><span class="p">,</span> <span class="n">si</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_stress</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">st</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
                                      <span class="n">zi</span><span class="p">,</span>
                                      <span class="n">si</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">_refine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Refine numerical parameters&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_stress_from_overburden</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;update stress profile based on q0 and overbuden (integrate density)&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">st</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q0</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="n">gamavg</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">gam</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">gam</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">dsig</span> <span class="o">=</span> <span class="n">dz</span><span class="o">*</span><span class="n">gamavg</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">st</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">dsig</span><span class="p">)</span>

        <span class="c1">#adjust for bouyant force</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">uw</span><span class="o">&gt;</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">st</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">-=</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">uw</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>



    <span class="k">def</span> <span class="nf">_update_density</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;update density based on Gs, e and Sr&quot;&quot;&quot;</span>




        <span class="n">Gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epus_object</span><span class="o">.</span><span class="n">Gs</span>
        <span class="n">gamw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamw</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">e</span>
        <span class="n">Sr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">Sr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">gam</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Gs</span><span class="o">+</span><span class="n">Sr</span><span class="o">*</span><span class="n">e</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="n">gamw</span>


    <span class="k">def</span> <span class="nf">_e_and_Sr_from_EPUS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use EPUS and sig and psi distribution to calc e and Sr&quot;&quot;&quot;</span>



        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">npts</span><span class="p">):</span>

            <span class="n">ss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">ss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">st</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">epus_object</span><span class="o">.</span><span class="n">MinSuction</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ss</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">epus_object</span><span class="o">.</span><span class="n">MinSuction</span><span class="p">:</span>
                <span class="c1">#only need stress increase stresspath</span>
                <span class="n">stp</span> <span class="o">=</span> <span class="n">StressPath</span><span class="p">(</span>
                     <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">ist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">npp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_npp</span><span class="p">,</span> <span class="n">vl</span><span class="o">=</span><span class="n">st</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;1. Stress increase&quot;</span><span class="p">),])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#need stress increase and suction increase stress path</span>
                <span class="n">stp</span> <span class="o">=</span> <span class="n">StressPath</span><span class="p">(</span>
                     <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">ist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">npp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_npp</span><span class="p">,</span> <span class="n">vl</span><span class="o">=</span><span class="n">st</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;1. Stress increase&quot;</span><span class="p">),</span>
                      <span class="nb">dict</span><span class="p">(</span><span class="n">ist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">npp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_npp</span><span class="p">,</span> <span class="n">vl</span><span class="o">=</span><span class="n">ss</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;2. Suction increase&quot;</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_epus_dict</span><span class="p">[</span><span class="s2">&quot;Npoint&quot;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Npoint</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_epus_dict</span><span class="p">[</span><span class="s2">&quot;stp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stp</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">EPUS</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_epus_dict</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Calresults</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">datapoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_attr</span><span class="p">:</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">v</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">datapoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1">#adjust Sr</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">Sr</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">Sr</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_blank_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Modify a DataResults object to contain info about the profile</span>

<span class="sd">        Add z, gam, uw</span>
<span class="sd">        Calc uw from water table</span>
<span class="sd">        calc suction ss from negative values of uw (set suctino to zero</span>
<span class="sd">        elsewhere).</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#put in a point just below and just above the water level</span>
        <span class="n">ztemp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">,</span> <span class="n">nz</span><span class="p">)</span>
        
        <span class="n">dz</span> <span class="o">=</span> <span class="p">(</span><span class="n">ztemp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ztemp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">5.0</span>        
        <span class="n">zp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zw</span> <span class="o">+</span> <span class="n">dz</span>
        <span class="n">zm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zw</span> <span class="o">-</span> <span class="n">dz</span>
        
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">zm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zw</span><span class="p">,</span> <span class="n">zp</span><span class="p">]:</span>            
            <span class="k">if</span> <span class="p">(</span><span class="n">z</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">z</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">):</span>            
                <span class="n">ztemp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ztemp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">z</span><span class="p">])))</span>
                
        <span class="n">ztemp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">ztemp</span><span class="p">))</span>

        <span class="n">profile</span> <span class="o">=</span> <span class="n">DataResults</span><span class="p">(</span><span class="n">npts</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ztemp</span><span class="p">))</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">ztemp</span><span class="c1">#np.linspace(0, self.H, nz)</span>
        
        
        
        
        
                
            
        <span class="n">profile</span><span class="o">.</span><span class="n">gam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">uw</span> <span class="o">=</span> <span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">zw</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamw</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">ss</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">uw</span><span class="o">&lt;</span><span class="mi">0</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">ss</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">profile</span><span class="o">.</span><span class="n">uw</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>

        <span class="n">profile</span><span class="o">.</span><span class="n">_attr</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;gam&#39;</span><span class="p">,</span> <span class="s1">&#39;uw&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">profile</span>



<div class="viewcode-block" id="EpusProfile.calc"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EpusProfile.calc">[docs]</a>    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;do all the calculations&quot;&quot;&quot;</span>

        <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">fnz</span><span class="p">,</span> <span class="n">fNpoint</span><span class="p">,</span> <span class="n">fnpp</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nz_refine</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">Npoint_refine</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">npp_refine</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_nz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fnz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Npoint</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fnz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Npoint</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_npp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fnz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">npp</span><span class="p">)</span>


            <span class="n">new_profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blank_profile</span><span class="p">(</span><span class="n">nz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nz</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">new_profile</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_stress</span><span class="p">()</span>
                <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="c1">#self.profile already exists</span>
                <span class="c1">#interpolate stres from old profile</span>
                <span class="n">new_profile</span><span class="o">.</span><span class="n">st</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">new_profile</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">st</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">new_profile</span>


            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span><span class="p">):</span>
                <span class="n">old_stress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">st</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>


                <span class="bp">self</span><span class="o">.</span><span class="n">_e_and_Sr_from_EPUS</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_density</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stress_from_overburden</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">old_stress</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">st</span><span class="p">,</span>
                               <span class="n">atol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atol</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rtol</span><span class="p">):</span>
                    <span class="k">break</span>


            <span class="k">if</span> <span class="n">j</span><span class="o">&gt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Maximum iterations reached while nz=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nz</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">niter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="EpusProfile.plot_profile"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EpusProfile.plot_profile">[docs]</a>    <span class="k">def</span> <span class="nf">plot_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

        <span class="n">namemap</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">vw</span><span class="o">=</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">theta$&quot;</span><span class="p">,</span>
                     <span class="n">Sr</span><span class="o">=</span><span class="s2">&quot;$S_r$&quot;</span><span class="p">,</span>
                     <span class="n">ss</span><span class="o">=</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">psi$&quot;</span><span class="p">,</span>
                     <span class="n">st</span><span class="o">=</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">,</span>
                     <span class="n">gam</span><span class="o">=</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">gamma$&quot;</span><span class="p">,</span>
                     <span class="n">uw</span><span class="o">=</span><span class="s2">&quot;$u_w$&quot;</span><span class="p">,</span>
                     <span class="n">m1s</span><span class="o">=</span><span class="s2">&quot;$m_</span><span class="si">{1}</span><span class="s2">^s$&quot;</span><span class="p">,</span>
                     <span class="n">m2s</span><span class="o">=</span><span class="s2">&quot;$m_</span><span class="si">{2}</span><span class="s2">^s$&quot;</span><span class="p">,</span>
                     <span class="n">m1w</span><span class="o">=</span><span class="s2">&quot;$m_</span><span class="si">{1}</span><span class="s2">^w$&quot;</span><span class="p">,</span>
                     <span class="n">m2w</span><span class="o">=</span><span class="s2">&quot;$m_</span><span class="si">{2}</span><span class="s2">^w$&quot;</span><span class="p">,</span>
                     <span class="n">m1a</span><span class="o">=</span><span class="s2">&quot;$m_</span><span class="si">{1}</span><span class="s2">^a$&quot;</span><span class="p">,</span>
                     <span class="n">m2a</span><span class="o">=</span><span class="s2">&quot;$m_</span><span class="si">{2}</span><span class="s2">^a$&quot;</span><span class="p">,</span>
                     <span class="n">kw</span><span class="o">=</span><span class="s2">&quot;$k_w$&quot;</span><span class="p">,</span>
                     <span class="n">ka</span><span class="o">=</span><span class="s2">&quot;$k_a$&quot;</span><span class="p">)</span>


        <span class="n">axlims</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Sr</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                      <span class="p">)</span>

        <span class="n">not_plot</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m1s&#39;</span><span class="p">,</span> <span class="s1">&#39;m2s&#39;</span><span class="p">,</span> <span class="s1">&#39;m1w&#39;</span><span class="p">,</span> <span class="s1">&#39;m2w&#39;</span><span class="p">,</span> <span class="s1">&#39;m1a&#39;</span><span class="p">,</span> <span class="s1">&#39;m2a&#39;</span><span class="p">,</span> <span class="s1">&#39;kw&#39;</span><span class="p">,</span> <span class="s1">&#39;ka&#39;</span><span class="p">]</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">_attr</span><span class="p">[:]</span>
        <span class="n">excl</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">excl</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attr</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

        <span class="n">first</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">attr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;m1s&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">_attr</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">not_plot</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dsig_profile</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
                        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dpsi_profile</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
                        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">)</span>


            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">namemap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
                <span class="n">first</span><span class="o">=</span><span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">**</span><span class="n">axlims</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">()))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span></div>



<div class="viewcode-block" id="EpusProfile.save_profile_to_file"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EpusProfile.save_profile_to_file">[docs]</a>    <span class="k">def</span> <span class="nf">save_profile_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save profile data to a csv file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fpath : str</span>
<span class="sd">            path of file to save to</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#make X, i.e. put dataresults in one big array</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">npts</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">_attr</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">_attr</span><span class="p">):</span>
            <span class="n">x</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">v</span><span class="p">)[:]</span>


        <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">_attr</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fpath</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%g</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span>
                   <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="EpusProfile.compression_indexes"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EpusProfile.compression_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">compression_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dsig</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dpsi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the compression indexes</span>

<span class="sd">        m1s, m2s, m1w, m2w, m1a, m2a</span>

<span class="sd">        Calculation is volume change indexes after a) net normal stress</span>
<span class="sd">        change of dsig, and b) or suction change of dpsi.</span>

<span class="sd">        m1a + m1w = m1s</span>
<span class="sd">        m2a + m2w = m2s</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dsig : float, optional</span>
<span class="sd">            Change in net normal stress (sig-ua),  Default dsig=1.0</span>
<span class="sd">        dpsi : float, optional</span>
<span class="sd">            Change in suction (ua-uw)</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#</span>

        <span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">dsig</span> <span class="o">=</span> <span class="n">dsig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dpsi</span> <span class="o">=</span> <span class="n">dpsi</span>

        <span class="n">profile_backup</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">)</span>


        <span class="c1">#dsig</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">npts</span><span class="p">):</span>
            <span class="n">stp</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">ss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">ss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">st</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">epus_object</span><span class="o">.</span><span class="n">MinSuction</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ss</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">epus_object</span><span class="o">.</span><span class="n">MinSuction</span><span class="p">:</span>
                <span class="c1">#only need stress increase stresspath</span>
                <span class="n">stp</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                     <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">ist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">npp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_npp</span><span class="p">,</span> <span class="n">vl</span><span class="o">=</span><span class="n">st</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;1. Stress increase&quot;</span><span class="p">),])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#need stress increase and suction increase stress path</span>
                <span class="n">stp</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                     <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">ist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">npp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_npp</span><span class="p">,</span> <span class="n">vl</span><span class="o">=</span><span class="n">st</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;1. Stress increase&quot;</span><span class="p">),</span>
                      <span class="nb">dict</span><span class="p">(</span><span class="n">ist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">npp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_npp</span><span class="p">,</span> <span class="n">vl</span><span class="o">=</span><span class="n">ss</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;2. Suction increase&quot;</span><span class="p">)])</span>

            <span class="c1">#increase stress by dsig</span>
            <span class="n">st</span> <span class="o">+=</span> <span class="n">dsig</span>
            <span class="n">stp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">ist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">npp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_npp</span><span class="p">,</span> <span class="n">vl</span><span class="o">=</span><span class="n">st</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;3. Stress increase&quot;</span><span class="p">))</span>

            <span class="n">stp</span> <span class="o">=</span> <span class="n">StressPath</span><span class="p">(</span><span class="n">stp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_epus_dict</span><span class="p">[</span><span class="s2">&quot;Npoint&quot;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Npoint</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_epus_dict</span><span class="p">[</span><span class="s2">&quot;stp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stp</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">EPUS</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_epus_dict</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Calresults</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">datapoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_attr</span><span class="p">:</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">v</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">datapoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1">#adjust Sr</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">Sr</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">Sr</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dsig_profile</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">)</span>



        <span class="c1">#dpsi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">profile_backup</span><span class="p">)</span> <span class="c1"># reset to intitial stress profile</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">npts</span><span class="p">):</span>
            <span class="n">stp</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">ss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">ss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">st</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">epus_object</span><span class="o">.</span><span class="n">MinSuction</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ss</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">epus_object</span><span class="o">.</span><span class="n">MinSuction</span><span class="p">:</span>
                <span class="c1">#only need stress increase stresspath</span>
                <span class="n">stp</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                     <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">ist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">npp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_npp</span><span class="p">,</span> <span class="n">vl</span><span class="o">=</span><span class="n">st</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;1. Stress increase&quot;</span><span class="p">),])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#need stress increase and suction increase stress path</span>
                <span class="n">stp</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                     <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">ist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">npp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_npp</span><span class="p">,</span> <span class="n">vl</span><span class="o">=</span><span class="n">st</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;1. Stress increase&quot;</span><span class="p">),</span>
                      <span class="nb">dict</span><span class="p">(</span><span class="n">ist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">npp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_npp</span><span class="p">,</span> <span class="n">vl</span><span class="o">=</span><span class="n">ss</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;2. Suction increase&quot;</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_epus_dict</span><span class="p">[</span><span class="s2">&quot;Npoint&quot;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Npoint</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_epus_dict</span><span class="p">[</span><span class="s2">&quot;stp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stp</span>

            <span class="c1">#increase suction by dpsi</span>
            <span class="n">uw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">uw</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">uw</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1">#uw starts unsaturated and ends in unsaturated; apply full suction</span>
                <span class="n">stp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">ist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">npp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_npp</span><span class="p">,</span> <span class="n">vl</span><span class="o">=</span><span class="n">ss</span><span class="o">+</span><span class="n">dpsi</span><span class="p">,</span>
                                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;3. uw decrease--&gt; suction increase&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">uw</span> <span class="o">-</span> <span class="n">dpsi</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">epus_object</span><span class="o">.</span><span class="n">MinSuction</span><span class="p">):</span>
                    <span class="c1">#uw starts saturated and ends in saturated</span>
                    <span class="c1">#increase stress by dpsi</span>
                    <span class="n">stp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">ist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">npp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_npp</span><span class="p">,</span> <span class="n">vl</span><span class="o">=</span><span class="n">st</span><span class="o">+</span><span class="n">dpsi</span><span class="p">,</span>
                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;3. uw decrease--&gt; stress increase&quot;</span><span class="p">))</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#uw starts saturated and ends unsaturated</span>
                    <span class="c1">#apply uw-0 to effective stress increase then</span>
                    <span class="c1">#apply dpsi-uw to suction</span>
                    <span class="n">stp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">ist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">npp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_npp</span><span class="p">,</span> <span class="n">vl</span><span class="o">=</span><span class="n">st</span><span class="o">+</span><span class="n">uw</span><span class="p">,</span>
                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;3. uw decrease--&gt; partial stress increase&quot;</span><span class="p">))</span>
                    <span class="n">stp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">ist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">npp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_npp</span><span class="p">,</span> <span class="n">vl</span><span class="o">=</span><span class="n">dpsi</span><span class="o">-</span><span class="n">uw</span><span class="p">,</span>
                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;3. uw decrease--&gt; partial suction increase&quot;</span><span class="p">))</span>




            <span class="n">stp</span> <span class="o">=</span> <span class="n">StressPath</span><span class="p">(</span><span class="n">stp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_epus_dict</span><span class="p">[</span><span class="s2">&quot;Npoint&quot;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Npoint</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_epus_dict</span><span class="p">[</span><span class="s2">&quot;stp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stp</span>


            <span class="n">a</span> <span class="o">=</span> <span class="n">EPUS</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_epus_dict</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Calresults</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">datapoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_attr</span><span class="p">:</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">v</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">datapoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1">#adjust Sr</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">Sr</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">Sr</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dpsi_profile</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">)</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">profile_backup</span><span class="p">)</span>
        <span class="c1">#calc compression indexes</span>

        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;m1s&#39;</span><span class="p">,</span> <span class="s1">&#39;m2s&#39;</span><span class="p">,</span> <span class="s1">&#39;m1w&#39;</span><span class="p">,</span> <span class="s1">&#39;m2w&#39;</span><span class="p">,</span> <span class="s1">&#39;m1a&#39;</span><span class="p">,</span> <span class="s1">&#39;m2a&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">_attr</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">_attr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">npts</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">m1s</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dsig_profile</span><span class="o">.</span><span class="n">e</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">e</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="n">dsig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">m2s</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dpsi_profile</span><span class="o">.</span><span class="n">e</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">e</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="n">dpsi</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">m1w</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dsig_profile</span><span class="o">.</span><span class="n">Sr</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_dsig_profile</span><span class="o">.</span><span class="n">e</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">Sr</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">e</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="n">dsig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">m2w</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dpsi_profile</span><span class="o">.</span><span class="n">Sr</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_dpsi_profile</span><span class="o">.</span><span class="n">e</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">Sr</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">e</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="n">dpsi</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">m1a</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">m1s</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">m1w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">m2a</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">m2s</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">m2w</span></div>


<div class="viewcode-block" id="EpusProfile.water_permeability"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EpusProfile.water_permeability">[docs]</a>    <span class="k">def</span> <span class="nf">water_permeability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e_ksat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">npp_swcc</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the water permeability</span>
<span class="sd">        </span>
<span class="sd">        First saturated permeability at depth is determined based on e_ksat.</span>
<span class="sd">        Then unsaturated water permeability is determined by a) working </span>
<span class="sd">        out a volumetric water content vs suction curve (i.e. epus stress</span>
<span class="sd">        path of load to stress and then dry to get a SWCC) and b) use _[1] to </span>
<span class="sd">        numerically integrate and determine relative permeability at the </span>
<span class="sd">        relevatnt profile suction value.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        e_ksat : PermeabilityVoidRatioRelationship object</span>
<span class="sd">            PermeabilityVoidRatioRelationship object defining dependence of</span>
<span class="sd">            saturated permebility on void ratio.  </span>
<span class="sd">            Default e_ksat=ConstantPermeabilityModel(ka=1) i.e. constant </span>
<span class="sd">            saturated permeability with value one.</span>
<span class="sd">        npp_swcc : int, optional</span>
<span class="sd">            number of sterss path intervals to use when determining the </span>
<span class="sd">            volumetric water content vs suction curve that will be used to </span>
<span class="sd">            calculate the relative permeability. Defulat npp_swcc=500</span>
<span class="sd">        </span>
<span class="sd">                    </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        geotecha.constitutive_models.void_ratio_permeability : void ratio</span>
<span class="sd">            saturated permeability relationship.</span>
<span class="sd">        </span>
<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        .. [1] Fredlund, D.G., Anqing Xing, and Shangyan Huang. </span>
<span class="sd">               &quot;Predicting the Permeability Function for Unsaturated </span>
<span class="sd">               Soils Using the Soil-Water Characteristic Curve. </span>
<span class="sd">               Canadian Geotechnical Journal 31, no. 4 (1994): 533-46. </span>
<span class="sd">               doi:10.1139/t94-062.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">e_ksat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">e_ksat</span> <span class="o">=</span> <span class="n">void_ratio_permeability</span><span class="o">.</span><span class="n">ConstantPermeabilityModel</span><span class="p">(</span><span class="n">ka</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
                
        <span class="c1"># saturated water permeability</span>
        <span class="n">ksat</span> <span class="o">=</span> <span class="n">e_ksat</span><span class="o">.</span><span class="n">k_from_e</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>

        <span class="c1"># water permeability relative to saturated</span>
        <span class="n">kr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ksat</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">npts</span><span class="p">):</span>
            <span class="n">stp</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">ss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">ss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">st</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">epus_object</span><span class="o">.</span><span class="n">MinSuction</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ss</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">epus_object</span><span class="o">.</span><span class="n">MinSuction</span><span class="p">:</span>
                <span class="c1">#soil is saturated</span>
                <span class="n">kr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>                
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#need stress increase and then drying stress path</span>
                <span class="n">stp</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                     <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">ist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">npp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_npp</span><span class="p">,</span> <span class="n">vl</span><span class="o">=</span><span class="n">st</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;1. Stress increase&quot;</span><span class="p">),</span>
                      <span class="nb">dict</span><span class="p">(</span><span class="n">ist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">npp</span><span class="o">=</span><span class="n">npp_swcc</span><span class="p">,</span> <span class="n">vl</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;2. Suction increase&quot;</span><span class="p">)])</span>

                <span class="n">stp</span> <span class="o">=</span> <span class="n">StressPath</span><span class="p">(</span><span class="n">stp</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_epus_dict</span><span class="p">[</span><span class="s2">&quot;Npoint&quot;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Npoint</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_epus_dict</span><span class="p">[</span><span class="s2">&quot;stp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stp</span>
        
                <span class="n">a</span> <span class="o">=</span> <span class="n">EPUS</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_epus_dict</span><span class="p">)</span>
                <span class="n">a</span><span class="o">.</span><span class="n">Calresults</span><span class="p">()</span>
                        
                <span class="c1">#have the vw vs psi cureve (SWCC), now calc krel                        </span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">datapoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ss</span> 
                <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">stp</span><span class="o">.</span><span class="n">datapoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vw</span> 
                
                <span class="n">kr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">swcc</span><span class="o">.</span><span class="n">kwrel_from_discrete_swcc</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>                    
        
        <span class="c1">#add &quot;kw&quot; to the profile                               </span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;kw&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">_attr</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">_attr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">npts</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>                                                
            
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">kw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">ksat</span> <span class="o">*</span> <span class="n">kr</span></div>
                                                            
<div class="viewcode-block" id="EpusProfile.air_permeability"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.epus.html#geotecha.constitutive_models.epus.EpusProfile.air_permeability">[docs]</a>    <span class="k">def</span> <span class="nf">air_permeability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e_ksat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qfit</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the Air permeability based on saturation</span>
<span class="sd">        </span>
<span class="sd">        ka = kd * (1-Sr)**0.5*(1-Sr**(1/qfit))**(2*qfit)</span>
<span class="sd">        </span>
<span class="sd">        kd = fn(e)</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        e_ksat : PermeabilityVoidRatioRelationship object</span>
<span class="sd">            PermeabilityVoidRatioRelationship object defining dependence of</span>
<span class="sd">            dry air permeability on void ratio.  </span>
<span class="sd">            Default e_ksat=ConstantPermeabilityModel(ka=1) i.e. constant </span>
<span class="sd">            saturated permeability with value one.</span>
<span class="sd">        qfit : float, optional</span>
<span class="sd">            fitting parameter.  Generally between between 0 and 1. </span>
<span class="sd">            Default qfit=1</span>
<span class="sd">        </span>
<span class="sd">                    </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        geotecha.constitutive_models.void_ratio_permeability : void ratio</span>
<span class="sd">            saturated permeability relationship.</span>
<span class="sd">        </span>
<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        .. [1] Ba-Te, B., Limin Zhang, and Delwyn G. Fredlund. &quot;A General </span>
<span class="sd">               Air-Phase Permeability Function for Airflow through Unsaturated </span>
<span class="sd">               Soils.&quot; In Proceedings of Geofrontiers 2005 Cngress, </span>
<span class="sd">               2961-85. Austin, Tx: ASCE, 2005. doi:10.1061/40787(166)29.</span>
<span class="sd">               </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">e_ksat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">e_ksat</span> <span class="o">=</span> <span class="n">void_ratio_permeability</span><span class="o">.</span><span class="n">ConstantPermeabilityModel</span><span class="p">(</span><span class="n">ka</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
                
        <span class="c1"># saturated water permeability</span>
        <span class="n">kd</span> <span class="o">=</span> <span class="n">e_ksat</span><span class="o">.</span><span class="n">k_from_e</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>

        <span class="c1"># air permeability relative to saturated</span>
        <span class="n">kr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">kd</span><span class="p">)</span>
        <span class="n">Sr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">Sr</span>
<span class="c1">#        kr = (1 - Sr)**0.5*(1 - Sr**(1 / qfit))**(2 * qfit)</span>
        <span class="n">kr</span> <span class="o">=</span> <span class="n">swcc</span><span class="o">.</span><span class="n">karel_air_from_saturation</span><span class="p">(</span><span class="n">Sr</span><span class="p">,</span> <span class="n">qfit</span><span class="o">=</span><span class="n">qfit</span><span class="p">)</span>

         <span class="c1">#add &quot;ka&quot; to the profile                               </span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ka&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">_attr</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">_attr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">npts</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>                                                
            
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">ka</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">kd</span> <span class="o">*</span> <span class="n">kr</span>                                                            </div></div>
                                                
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">nose</span>
<span class="c1">#    nose.runmodule(argv=[&#39;nose&#39;, &#39;--verbosity=3&#39;, &#39;--with-doctest&#39;, &#39;--doctest-options=+ELLIPSIS&#39;])</span>
    <span class="kn">from</span> <span class="nn">geotecha.plotting.one_d</span> <span class="k">import</span> <span class="n">save_figure</span>
    <span class="k">if</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># this takes upwards of </span>
        <span class="kn">import</span> <span class="nn">time</span>
        <span class="kn">from</span> <span class="nn">datetime</span>  <span class="k">import</span> <span class="n">timedelta</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">SWCC</span> <span class="o">=</span> <span class="n">CurveFittingSWCC</span><span class="p">(</span><span class="n">wsat</span><span class="o">=</span><span class="mf">0.262</span><span class="p">,</span>
                                <span class="n">a</span> <span class="o">=</span> <span class="mf">3.1</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">6</span><span class="p">,</span>
                                <span class="n">b</span> <span class="o">=</span> <span class="mf">3.377</span><span class="p">,</span>
                                <span class="n">wr</span> <span class="o">=</span> <span class="mf">0.128</span><span class="p">,</span>
                                <span class="n">sl</span> <span class="o">=</span> <span class="mf">0.115</span><span class="p">,</span> <span class="c1"># note that sl is Cc * Gs see Equation 3.74 in Pham(2005 PhD)</span>
                                <span class="p">)</span>


        <span class="n">stp</span> <span class="o">=</span> <span class="n">StressPath</span><span class="p">([</span><span class="nb">dict</span><span class="p">(</span><span class="n">ist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">npp</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">vl</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;1. Load to 20kPa&quot;</span><span class="p">),])</span>

        <span class="n">pdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
             <span class="n">SimpleSWCC</span><span class="o">=</span><span class="n">SWCC</span><span class="p">,</span>
             <span class="n">stp</span><span class="o">=</span><span class="n">stp</span><span class="p">,</span>
             <span class="n">logDS</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
             <span class="n">logRS</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
             <span class="n">Css</span><span class="o">=</span><span class="mf">0.019</span><span class="p">,</span>
             <span class="n">beta</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
             <span class="n">soilname</span><span class="o">=</span><span class="s1">&#39;Artificial silt&#39;</span><span class="p">,</span>
             <span class="n">username</span><span class="o">=</span><span class="s1">&#39;Hung Pham&#39;</span><span class="p">,</span>
             <span class="n">Npoint</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
             <span class="n">NumSr</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

        <span class="n">epus_object</span> <span class="o">=</span> <span class="n">EPUS</span><span class="p">(</span><span class="o">**</span><span class="n">pdict</span><span class="p">)</span>

        <span class="n">initial_stress</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>  <span class="mf">0.</span> <span class="p">,</span>   <span class="mf">2.5</span><span class="p">,</span>   <span class="mf">5.</span> <span class="p">,</span>   <span class="mf">7.5</span><span class="p">,</span>  <span class="mf">10.</span> <span class="p">]),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>  <span class="mf">10.</span>        <span class="p">,</span>   <span class="mf">62.11010239</span><span class="p">,</span>  <span class="mf">115.33445849</span><span class="p">,</span>  <span class="mf">169.3380806</span> <span class="p">,</span>
                                   <span class="mf">223.80793771</span><span class="p">]))</span>
<span class="c1">#        a = EpusProfile(epus_object, H=10, zw=10, q0=10,</span>
<span class="c1">#                        nz=10, Npoint=1000, npp=10,</span>
<span class="c1">#                        nz_refine=[1],</span>
<span class="c1">#                        Npoint_refine=[0.25],</span>
<span class="c1">#                        npp_refine=[0.5],</span>
<span class="c1">#                        max_iter=15, atol=1, initial_stress=initial_stress)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">EpusProfile</span><span class="p">(</span><span class="n">epus_object</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">zw</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">q0</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                        <span class="n">nz</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">Npoint</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">npp</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                        <span class="n">nz_refine</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">Npoint_refine</span><span class="o">=</span><span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">npp_refine</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">max_iter</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">initial_stress</span><span class="o">=</span><span class="n">initial_stress</span><span class="p">,</span> <span class="p">)</span>


        <span class="n">a</span><span class="o">.</span><span class="n">calc</span><span class="p">()</span>
<span class="c1">#           fpath = &quot;C:\\Users\\Rohan Walker\\Documents\\temp\\profile.csv&quot;</span>
        <span class="n">fpath</span> <span class="o">=</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">rohanw</span><span class="se">\\</span><span class="s2">Documents</span><span class="se">\\</span><span class="s2">temp</span><span class="se">\\</span><span class="s2">profile.csv&quot;</span>
<span class="c1">#        print(repr(a.profile.z))</span>
<span class="c1">#        print(repr(a.profile.st))</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">);</span> <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">elapsed</span><span class="p">)))</span>
        <span class="n">a</span><span class="o">.</span><span class="n">compression_indexes</span><span class="p">(</span><span class="n">dsig</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">dpsi</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">water_permeability</span><span class="p">()</span><span class="c1">#e_ksat = void_ratio_permeability.ConstantPermeabilityModel</span>
        <span class="n">a</span><span class="o">.</span><span class="n">air_permeability</span><span class="p">()</span>
        <span class="n">a</span><span class="o">.</span><span class="n">save_profile_to_file</span><span class="p">(</span><span class="n">fpath</span><span class="o">=</span><span class="n">fpath</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">niter</span><span class="p">)</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">);</span> <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">elapsed</span><span class="p">)))</span>


        <span class="n">fig</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">plot_profile</span><span class="p">()</span>
        <span class="n">save_figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fpath</span><span class="p">),</span> <span class="s1">&#39;myfig&#39;</span><span class="p">))</span>
<span class="c1">#        fig.tight_layout()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2014, Rohan Walker.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>