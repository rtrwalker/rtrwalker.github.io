
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>geotecha.constitutive_models.swcc &#8212; geotecha 0.2.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../_static/logo.png" border="0" alt="py4sci"/></a>
</div>



      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for geotecha.constitutive_models.swcc</h1><div class="highlight"><pre>
<span></span><span class="c1"># geotecha - A software suite for geotechncial engineering</span>
<span class="c1"># Copyright (C) 2015  Rohan T. Walker (rtrwalker@gmail.com)</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program.  If not, see http://www.gnu.org/licenses/gpl.html.</span>

<span class="sd">&quot;&quot;&quot;Some soil water characteristic curves (SWCC) for unsaturated soil&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">fsolve</span>
<span class="kn">import</span> <span class="nn">sympy</span>



<div class="viewcode-block" id="SWCC"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.swcc.html#geotecha.constitutive_models.swcc.SWCC">[docs]</a><span class="k">class</span> <span class="nc">SWCC</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for defining soil water characteristic curve&quot;&quot;&quot;</span>

<div class="viewcode-block" id="SWCC.w_from_psi"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.swcc.html#geotecha.constitutive_models.swcc.SWCC.w_from_psi">[docs]</a>    <span class="k">def</span> <span class="nf">w_from_psi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Water content from suction&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;w_from_psi must be implemented&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SWCC.psi_from_w"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.swcc.html#geotecha.constitutive_models.swcc.SWCC.psi_from_w">[docs]</a>    <span class="k">def</span> <span class="nf">psi_from_w</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Suction from water content&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;w_from_psi must be implemented&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SWCC.dw_dpsi"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.swcc.html#geotecha.constitutive_models.swcc.SWCC.dw_dpsi">[docs]</a>    <span class="k">def</span> <span class="nf">dw_dpsi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Slope of SWCC dw/dpsi&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;dw_dpsi must be implemented&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SWCC.psi_and_w_for_plotting"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.swcc.html#geotecha.constitutive_models.swcc.SWCC.psi_and_w_for_plotting">[docs]</a>    <span class="k">def</span> <span class="nf">psi_and_w_for_plotting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Suction and water content for plotting that plot the method&quot;&quot;&quot;</span>
        <span class="c1"># should return a tuple of x and y values</span>
        <span class="c1"># x-values are peremability, y-values are void ratio.</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;psi_and_w_for_plotting must be implemented&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SWCC.plot_model"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.swcc.html#geotecha.constitutive_models.swcc.SWCC.plot_model">[docs]</a>    <span class="k">def</span> <span class="nf">plot_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the void ratio-permeability&quot;&quot;&quot;</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi_and_w_for_plotting</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span></div></div>



<div class="viewcode-block" id="SWCC_FredlundAndXing1994"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.swcc.html#geotecha.constitutive_models.swcc.SWCC_FredlundAndXing1994">[docs]</a><span class="k">class</span> <span class="nc">SWCC_FredlundAndXing1994</span><span class="p">(</span><span class="n">SWCC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Soil water characteristic curve from Fredlund and Xing 1994</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    a : float</span>
<span class="sd">        Fitting parameter corresponding to soil suction at the inflection</span>
<span class="sd">        point.</span>
<span class="sd">    n : float</span>
<span class="sd">        Fitting parameter designating th rate of desaturation.</span>
<span class="sd">    m : float</span>
<span class="sd">        Third fitting parameter</span>
<span class="sd">    ws : float, optional</span>
<span class="sd">        Saturated water content. Default ws=1.0 i.e. basically a degree of</span>
<span class="sd">        saturation.</span>
<span class="sd">    psir : float, optional</span>
<span class="sd">        Residual suction. Default psir=1e6.</span>
<span class="sd">    correction : float, optional</span>
<span class="sd">        Manual correction factor.  Default correction=None i.e. correction</span>
<span class="sd">        factor is caclulated.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Fredlund, D.G., Anqing Xing, and Shangyan Huang.</span>
<span class="sd">           &quot;Predicting the Permeability Function for Unsaturated Soils</span>
<span class="sd">           Using the Soil-Water Characteristic Curve.&quot;</span>
<span class="sd">           Canadian Geotechnical Journal 31, no. 4 (1994): 533-46.</span>
<span class="sd">           doi:10.1139/t94-062.</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The equation for the soil water charcteristic curve is given by:</span>

<span class="sd">    .. math:: w(\\psi) = C(\\psi)</span>
<span class="sd">        \\frac{w_s}</span>
<span class="sd">            {\\left[{\\ln\\left[{\\exp(1)+</span>
<span class="sd">                                 \\left({\\psi/a}\\right)^n}\\right]}\\right]^m}</span>

<span class="sd">    where the correction factor is given by:</span>

<span class="sd">    .. math:: C(\\psi) = \\left[{1 - \\frac{\\ln\\left({1+\\psi/\\psi_r}\\right)}</span>
<span class="sd">                               {\\ln\\left({1+10^6/\\psi_r}\\right)}}\\right]</span>


<span class="sd">    SWCC_FredlundAndXing1994()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">psir</span><span class="o">=</span><span class="mf">1.0e6</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="n">ws</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psir</span> <span class="o">=</span> <span class="n">psir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">correction</span> <span class="o">=</span> <span class="n">correction</span>

<div class="viewcode-block" id="SWCC_FredlundAndXing1994.w_from_psi"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.swcc.html#geotecha.constitutive_models.swcc.SWCC_FredlundAndXing1994.w_from_psi">[docs]</a>    <span class="k">def</span> <span class="nf">w_from_psi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;water content from suction</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        psi : float</span>
<span class="sd">            Suction</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        w : float</span>
<span class="sd">            Suction corresponding to psi</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; a = SWCC_FredlundAndXing1994(a=3000, n=1.5, m=1, ws=60, correction=1)</span>
<span class="sd">        &gt;&gt;&gt; a.w_from_psi(2000)</span>
<span class="sd">        50.73...</span>
<span class="sd">        &gt;&gt;&gt; b = SWCC_FredlundAndXing1994(a=100, n=2, m=4, correction=1)</span>
<span class="sd">        &gt;&gt;&gt; b.w_from_psi(90)</span>
<span class="sd">        0.395...</span>
<span class="sd">        &gt;&gt;&gt; c = SWCC_FredlundAndXing1994(a=427, n=0.794, m=0.613, psir=3000)</span>
<span class="sd">        &gt;&gt;&gt; c.w_from_psi(10000)</span>
<span class="sd">        0.40...</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">psir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psir</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">correction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">corr</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">psi</span> <span class="o">/</span> <span class="n">psir</span><span class="p">)</span> <span class="o">/</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">1.0e6</span> <span class="o">/</span> <span class="n">psir</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">correction</span>


        <span class="k">return</span> <span class="p">(</span><span class="n">corr</span> <span class="o">*</span> <span class="n">ws</span> <span class="o">/</span>
                <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">psi</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="n">m</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_derive_dw_dpsi</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Derive the slope dw_dpsi with sympy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dw_dpsi1 : sympy expression</span>
<span class="sd">            Derivative including correction factor.</span>
<span class="sd">        dw_dpsi2 : sympy expression</span>
<span class="sd">            Derivative with correction factor equal to one.</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="n">psi</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">psir</span><span class="p">,</span> <span class="n">ws</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;psi, a, n, m, psir, ws&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="n">log</span><span class="p">,</span> <span class="n">exp</span>
        <span class="n">C1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">psi</span> <span class="o">/</span> <span class="n">psir</span><span class="p">)</span> <span class="o">/</span>
                          <span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">1.0e6</span> <span class="o">/</span> <span class="n">psir</span><span class="p">))</span>

        <span class="n">C2</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">C1</span> <span class="o">*</span> <span class="n">ws</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">psi</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="n">m</span>
        <span class="n">dw_dpsi1</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">psi</span><span class="p">)</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">C2</span> <span class="o">*</span> <span class="n">ws</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">psi</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="n">m</span>
        <span class="n">dw_dpsi2</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">psi</span><span class="p">)</span>
        <span class="k">return</span>  <span class="n">dw_dpsi1</span><span class="p">,</span> <span class="n">dw_dpsi2</span>

    <span class="k">def</span> <span class="nf">_numerical_check_of_dw_dpsi</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Produce plot of dw_dpsi, and check against numerical slope</span>

<span class="sd">        only needs to be close</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : matplotlib.Axes object, optional</span>
<span class="sd">            Axes to plot on.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s1">&#39;ax&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">SWCC_FredlundAndXing1994</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">427</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mf">0.794</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mf">0.613</span><span class="p">,</span> <span class="n">psir</span><span class="o">=</span><span class="mi">3000</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">SWCC_FredlundAndXing1994</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;a=</span><span class="si">{a:g}</span><span class="s1">, n=</span><span class="si">{n:g}</span><span class="s1">, m=</span><span class="si">{m:g}</span><span class="s1">, psir=</span><span class="si">{psir:g}</span><span class="s1">, &#39;</span>
                <span class="s1">&#39;ws=</span><span class="si">{ws:g}</span><span class="s1">, correction=</span><span class="si">{correction}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">text</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">psir</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">psir</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">ws</span><span class="p">,</span>
                                   <span class="n">correction</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">correction</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]]</span>


        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span> <span class="n">labels</span><span class="p">):</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">psi_and_w_for_plotting</span><span class="p">(</span><span class="n">npts</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">xm</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span>
            <span class="n">slope_n</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">dx</span>
            <span class="n">slope_a</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">dw_dpsi</span><span class="p">(</span><span class="n">xm</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xm</span><span class="p">,</span> <span class="n">slope_n</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="s2">&quot;numerical: &quot;</span> <span class="o">+</span> <span class="n">label</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xm</span><span class="p">,</span> <span class="n">slope_a</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="s2">&quot;analytical: &quot;</span> <span class="o">+</span> <span class="n">label</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">psi$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$dw/d</span><span class="se">\\</span><span class="s1">psi$&#39;</span><span class="p">)</span>
        <span class="n">leg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">leg</span><span class="o">.</span><span class="n">draggable</span><span class="p">()</span>
<span class="c1">#            print(np.isclose(slope_a, slope_n))</span>
<span class="c1">#            print(slope_a-slope_n)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<div class="viewcode-block" id="SWCC_FredlundAndXing1994.dw_dpsi"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.swcc.html#geotecha.constitutive_models.swcc.SWCC_FredlundAndXing1994.dw_dpsi">[docs]</a>    <span class="k">def</span> <span class="nf">dw_dpsi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Slope of SWCC dw/dpsi</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        psi : float</span>
<span class="sd">            Suction</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dw_dpsi : float</span>
<span class="sd">            Suction corresponding to psi</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; a = SWCC_FredlundAndXing1994(a=3000, n=1.5, m=1, ws=60, correction=1)</span>
<span class="sd">        &gt;&gt;&gt; a.dw_dpsi(2000)</span>
<span class="sd">        -0.00536...</span>
<span class="sd">        &gt;&gt;&gt; b = SWCC_FredlundAndXing1994(a=100, n=2, m=4, correction=1)</span>
<span class="sd">        &gt;&gt;&gt; b.dw_dpsi(90)</span>
<span class="sd">        -0.00640...</span>
<span class="sd">        &gt;&gt;&gt; c = SWCC_FredlundAndXing1994(a=427, n=0.794, m=0.613, psir=3000)</span>
<span class="sd">        &gt;&gt;&gt; c.dw_dpsi(10000)</span>
<span class="sd">        -1.317...e-05</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">psir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psir</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">correction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">ws</span><span class="o">*</span><span class="p">(</span><span class="n">psi</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">psi</span><span class="o">/</span><span class="n">psir</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span>
                    <span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">1000000.0</span><span class="o">/</span><span class="n">psir</span><span class="p">))</span><span class="o">*</span><span class="n">log</span><span class="p">((</span><span class="n">psi</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="n">n</span> <span class="o">+</span> <span class="n">E</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">/</span>
                    <span class="p">(</span><span class="n">psi</span><span class="o">*</span><span class="p">((</span><span class="n">psi</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="n">n</span> <span class="o">+</span> <span class="n">E</span><span class="p">)</span><span class="o">*</span><span class="n">log</span><span class="p">((</span><span class="n">psi</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="n">n</span> <span class="o">+</span> <span class="n">E</span><span class="p">))</span> <span class="o">-</span>
                    <span class="n">ws</span><span class="o">*</span><span class="n">log</span><span class="p">((</span><span class="n">psi</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="n">n</span> <span class="o">+</span> <span class="n">E</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">psir</span><span class="o">*</span><span class="p">(</span><span class="n">psi</span><span class="o">/</span><span class="n">psir</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span>
                    <span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">1000000.0</span><span class="o">/</span><span class="n">psir</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">correction</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">ws</span><span class="o">*</span><span class="p">(</span><span class="n">psi</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="n">n</span><span class="o">*</span>
                <span class="n">log</span><span class="p">((</span><span class="n">psi</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="n">n</span> <span class="o">+</span> <span class="n">E</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">psi</span><span class="o">*</span><span class="p">((</span><span class="n">psi</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="n">n</span> <span class="o">+</span> <span class="n">E</span><span class="p">)</span><span class="o">*</span>
                <span class="n">log</span><span class="p">((</span><span class="n">psi</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="n">n</span> <span class="o">+</span> <span class="n">E</span><span class="p">)))</span></div>




<div class="viewcode-block" id="SWCC_FredlundAndXing1994.psi_and_w_for_plotting"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.swcc.html#geotecha.constitutive_models.swcc.SWCC_FredlundAndXing1994.psi_and_w_for_plotting">[docs]</a>    <span class="k">def</span> <span class="nf">psi_and_w_for_plotting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Suction and water content for plotting</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        npts : int, optional</span>
<span class="sd">            Number of points to return.  Default npts=100.</span>
<span class="sd">        xmin, xmax : float, optional</span>
<span class="sd">            Range of x (i.e. effective stress) values from which</span>
<span class="sd">            to return points. Default xmin=1, xmax=1e6.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        x, y : 1d ndarray</span>
<span class="sd">            `npts` permeability, and void ratio values between</span>
<span class="sd">            `xmin` and `xmax`.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">npts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;npts&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xmin&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xmax&#39;</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xmin</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xmax</span><span class="p">),</span> <span class="n">npts</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_from_psi</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>


<div class="viewcode-block" id="SWCC_FredlundAndXing1994.k_from_psi"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.swcc.html#geotecha.constitutive_models.swcc.SWCC_FredlundAndXing1994.k_from_psi">[docs]</a>    <span class="k">def</span> <span class="nf">k_from_psi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Relative permeability from suction</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------_</span>
<span class="sd">        psi : float</span>
<span class="sd">            Soil suction. Can be a 1d array.</span>
<span class="sd">        aev : float, optional</span>
<span class="sd">            Air entry soil suction. Default aev=1.0</span>
<span class="sd">        npts : int, optional</span>
<span class="sd">            Numper of intervals to break integral into. Default npts=500.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        k : float</span>
<span class="sd">            Relative permeability.</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; b = SWCC_FredlundAndXing1994(a=2.77, n=11.2, m=0.45, psir=300)</span>
<span class="sd">        &gt;&gt;&gt; b.k_from_psi(4)</span>
<span class="sd">        0.0520...</span>



<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The permability relative to the saturated value is given by:</span>

<span class="sd">        .. math:: k_r(\\psi) =  \\left.</span>
<span class="sd">            \\int_{\\ln(\\psi)}^{b}</span>
<span class="sd">              {\\frac{\\theta(e^y) - \\theta(\\psi)}{e^y} \\theta^{\\prime}(e^y)\\,dy}</span>
<span class="sd">            \\middle/</span>
<span class="sd">              \\int_{\\ln(\\psi_{\\textrm{aev}})}^{b}</span>
<span class="sd">              {\\frac{\\theta(e^y) - \\theta_s}{e^y} \\theta^{\\prime}(e^y)\\,dy}</span>
<span class="sd">            \\right.</span>

<span class="sd">        where, :math:`b=\\ln(10^6)`, :math:`\\theta(\\psi)` is the volumetric</span>
<span class="sd">        water content at a given soil suction.  :math:`\\psi_{\\textrm{aev}}`</span>
<span class="sd">        is the air entry value of soil suction (must be positive for the</span>
<span class="sd">        log integral to work).  Each integral is performed by dividing the</span>
<span class="sd">        integration inteval into N sections, evaluating the integrand at the</span>
<span class="sd">        mid point of each inteval, then summing the areas of each section.</span>


<span class="sd">        If you enter a single elment array you will get a scalar returned.</span>


<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        .. [1] Fredlund, D.G., Anqing Xing, and Shangyan Huang.</span>
<span class="sd">               &quot;Predicting the Permeability Function for Unsaturated</span>
<span class="sd">               Soils Using the Soil-Water Characteristic Curve.</span>
<span class="sd">               Canadian Geotechnical Journal 31, no. 4 (1994): 533-46.</span>
<span class="sd">               doi:10.1139/t94-062.</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">aev</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;aev&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">npts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;npts&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.0e6</span><span class="p">)</span> <span class="c1">#conceivably this could be the suction at residual</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
        <span class="n">dy1</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a1</span><span class="p">)</span> <span class="o">/</span> <span class="n">npts</span>

        <span class="n">y1</span> <span class="o">=</span> <span class="n">a1</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">dy1</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npts</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ey1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>

        <span class="n">f1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_from_psi</span><span class="p">(</span><span class="n">ey1</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">w_from_psi</span><span class="p">(</span><span class="n">psi</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dw_dpsi</span><span class="p">(</span><span class="n">ey1</span><span class="p">)</span> <span class="o">/</span> <span class="n">ey1</span>

        <span class="n">numer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">aev</span><span class="p">)</span>

        <span class="n">dy2</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a2</span><span class="p">)</span> <span class="o">/</span> <span class="n">npts</span>

        <span class="n">y2</span> <span class="o">=</span> <span class="n">a2</span> <span class="o">+</span> <span class="n">dy2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>

        <span class="n">f2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_from_psi</span><span class="p">(</span><span class="n">ey2</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dw_dpsi</span><span class="p">(</span><span class="n">ey2</span><span class="p">)</span> <span class="o">/</span> <span class="n">ey2</span>
<span class="c1">#        ws_numerical = self.w_from_psi(aev)</span>
<span class="c1">#        f2 = (self.w_from_psi(ey2) - ws_numerical) * self.dw_dpsi(ey2) / ey2</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>

        <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">numer</span> <span class="o">*</span> <span class="n">dy1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">denom</span> <span class="o">*</span> <span class="n">dy2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">size</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">k</span>
        <span class="k">return</span> <span class="n">k</span></div></div>


<div class="viewcode-block" id="SWCC_PhamAndFredlund2008"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.swcc.html#geotecha.constitutive_models.swcc.SWCC_PhamAndFredlund2008">[docs]</a><span class="k">class</span> <span class="nc">SWCC_PhamAndFredlund2008</span><span class="p">(</span><span class="n">SWCC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Soil water characteristic curve from Fredlund and Xing 2008</span>

<span class="sd">    Be careful interpreting results when suction is less than 1.</span>
<span class="sd">    At low suction values we expect wc approx equal to wsat-wr, but the</span>
<span class="sd">    s1 * log10(psi) term gives large negative numbers for psi&lt;&lt;1,</span>
<span class="sd">    whereas at psi=1 the term dissapears as expected.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    a : float</span>
<span class="sd">        Curve fitting parameter.</span>
<span class="sd">    b : float</span>
<span class="sd">        Curve fitting parameter.</span>
<span class="sd">    wr : float</span>
<span class="sd">        Residual gravimetric water content.</span>
<span class="sd">    s1 : float</span>
<span class="sd">        Initial slope of SWCC (i.e. Cc/Gs)</span>
<span class="sd">    ws : float</span>
<span class="sd">        Saturated water content. Default ws=1.0 i.e. basically a degree of</span>
<span class="sd">        saturation.</span>
<span class="sd">    psir : float, optional</span>
<span class="sd">        Residual suction. Default psir=None, i.e. psir = (2.7*a) **(1/b).</span>
<span class="sd">    correction : float, optional</span>
<span class="sd">        Manual correction factor.  Default correction=None i.e. correction</span>
<span class="sd">        factor is caclulated.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Pham, Hung Q., and Delwyn G. Fredlund. &quot;Equations for the</span>
<span class="sd">           Entire Soil-Water Characteristic Curve of a Volume Change</span>
<span class="sd">           Soil.&quot; Canadian Geotechnical Journal 45, no. 4</span>
<span class="sd">           (April 1, 2008): 443-53.</span>
<span class="sd">           doi:10.1139/T07-117.</span>



<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The equation for the soil water charcteristic curve is given by:</span>

<span class="sd">    .. math:: w(\\psi) = C(\\psi)</span>
<span class="sd">        \\left[{\\left({w_{sat} - S_l \\log(\\psi) -w_r}\\right)</span>
<span class="sd">            \\frac{a}{\\psi^{b}+a} + w_r}\\right]</span>



<span class="sd">    where the correction factor is given by:</span>

<span class="sd">    .. math:: C(\\psi) = \\left[{1 - \\frac{\\ln\\left({1+\\psi/\\psi_r}\\right)}</span>
<span class="sd">                               {\\ln\\left({1+10^6/\\psi_r}\\right)}}\\right]</span>


<span class="sd">    SWCC_PhamAndFredlund2008()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">wr</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">psir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="n">ws</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wr</span> <span class="o">=</span> <span class="n">wr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s1</span> <span class="o">=</span> <span class="n">s1</span>
        <span class="k">if</span> <span class="n">psir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psir</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.7</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psir</span> <span class="o">=</span> <span class="n">psir</span>
<span class="c1">#        self.psir = psir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">correction</span> <span class="o">=</span> <span class="n">correction</span>

<div class="viewcode-block" id="SWCC_PhamAndFredlund2008.w_from_psi"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.swcc.html#geotecha.constitutive_models.swcc.SWCC_PhamAndFredlund2008.w_from_psi">[docs]</a>    <span class="k">def</span> <span class="nf">w_from_psi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;water content from suction</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        psi : float</span>
<span class="sd">            Suction</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        w : float</span>
<span class="sd">            Suction corresponding to psi</span>

<span class="sd">#        Examples</span>
<span class="sd">#        --------</span>
<span class="sd">#        &gt;&gt;&gt; a = SWCC_FredlundAndXing1994(a=3000, n=1.5, m=1, ws=60, correction=1)</span>
<span class="sd">#        &gt;&gt;&gt; a.w_from_psi(2000)</span>
<span class="sd">#        50.73...</span>
<span class="sd">#        &gt;&gt;&gt; b = SWCC_FredlundAndXing1994(a=100, n=2, m=4, correction=1)</span>
<span class="sd">#        &gt;&gt;&gt; b.w_from_psi(90)</span>
<span class="sd">#        0.395...</span>
<span class="sd">#        &gt;&gt;&gt; c = SWCC_FredlundAndXing1994(a=427, n=0.794, m=0.613, psir=3000)</span>
<span class="sd">#        &gt;&gt;&gt; c.w_from_psi(10000)</span>
<span class="sd">#        0.40...</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">psir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psir</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
        <span class="n">wr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wr</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s1</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">correction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">corr</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">psi</span> <span class="o">/</span> <span class="n">psir</span><span class="p">)</span> <span class="o">/</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">1.0e6</span> <span class="o">/</span> <span class="n">psir</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">correction</span>


        <span class="k">return</span> <span class="p">(</span><span class="n">corr</span> <span class="o">*</span> <span class="p">((</span><span class="n">ws</span> <span class="o">-</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> <span class="o">-</span> <span class="n">wr</span><span class="p">)</span> <span class="o">*</span>
                    <span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="n">psi</span><span class="o">**</span><span class="n">b</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">wr</span><span class="p">))</span></div>


    <span class="k">def</span> <span class="nf">_derive_dw_dpsi</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Derive the slope dw_dpsi with sympy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dw_dpsi1 : sympy expression</span>
<span class="sd">            Derivative including correction factor.</span>
<span class="sd">        dw_dpsi2 : sympy expression</span>
<span class="sd">            Derivative with correction factor equal to one.</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="n">psi</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">psir</span><span class="p">,</span> <span class="n">ws</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;psi, a, n, m, psir, ws&#39;</span><span class="p">)</span>
        <span class="n">psi</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">wr</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">psir</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;psi, ws, a, b, wr, s1, psir&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="n">log</span><span class="p">,</span> <span class="n">exp</span>
        <span class="n">C1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">psi</span> <span class="o">/</span> <span class="n">psir</span><span class="p">)</span> <span class="o">/</span>
                          <span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">1.0e6</span> <span class="o">/</span> <span class="n">psir</span><span class="p">))</span>

        <span class="n">C2</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">l10</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;l10&#39;</span><span class="p">)</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">C1</span> <span class="o">*</span> <span class="p">((</span><span class="n">ws</span> <span class="o">-</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span><span class="o">/</span><span class="n">l10</span> <span class="o">-</span> <span class="n">wr</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="n">psi</span><span class="o">**</span><span class="n">b</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">wr</span><span class="p">)</span>
        <span class="n">dw_dpsi1</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">psi</span><span class="p">)</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">C2</span> <span class="o">*</span> <span class="p">((</span><span class="n">ws</span> <span class="o">-</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span><span class="o">/</span><span class="n">l10</span> <span class="o">-</span> <span class="n">wr</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="n">psi</span><span class="o">**</span><span class="n">b</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">wr</span><span class="p">)</span>
        <span class="n">dw_dpsi2</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">psi</span><span class="p">)</span>
        <span class="k">return</span>  <span class="n">dw_dpsi1</span><span class="p">,</span> <span class="n">dw_dpsi2</span>

    <span class="k">def</span> <span class="nf">_numerical_check_of_dw_dpsi</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Produce plot of dw_dpsi, and check against numerical slope</span>

<span class="sd">        only needs to be close</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : matplotlib.Axes object, optional</span>
<span class="sd">            Axes to plot on.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s1">&#39;ax&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">SWCC_PhamAndFredlund2008</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mf">3.1e6</span><span class="p">,</span>
                                     <span class="n">b</span> <span class="o">=</span> <span class="mf">3.377</span><span class="p">,</span>
                                     <span class="n">wr</span> <span class="o">=</span> <span class="mf">0.128</span><span class="p">,</span>
                                     <span class="n">s1</span> <span class="o">=</span> <span class="mf">0.115</span><span class="p">,</span>
                                     <span class="n">ws</span><span class="o">=</span><span class="mf">0.262</span><span class="p">,</span>
                                     <span class="n">psir</span><span class="o">=</span><span class="mi">3000</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">SWCC_PhamAndFredlund2008</span><span class="p">(</span>
                                     <span class="n">a</span> <span class="o">=</span> <span class="mf">1.1e6</span><span class="p">,</span>
                                     <span class="n">b</span> <span class="o">=</span> <span class="mf">2.</span><span class="p">,</span>
                                     <span class="n">wr</span> <span class="o">=</span> <span class="mf">0.128</span><span class="p">,</span>
                                     <span class="n">s1</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
                                     <span class="n">ws</span><span class="o">=</span><span class="mf">0.262</span><span class="p">,</span>
                                     <span class="n">correction</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;ws=</span><span class="si">{ws:g}</span><span class="s1">, a=</span><span class="si">{a:g}</span><span class="s1">, b=</span><span class="si">{b:g}</span><span class="s1">, wr=</span><span class="si">{wr:g}</span><span class="s1">, s1=</span><span class="si">{s1:g}</span><span class="s1">, &#39;</span>
                <span class="s1">&#39;psir=</span><span class="si">{psir:g}</span><span class="s1">, correction=</span><span class="si">{correction}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">text</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">ws</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">wr</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">wr</span><span class="p">,</span>
                              <span class="n">s1</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">s1</span><span class="p">,</span> <span class="n">psir</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">psir</span><span class="p">,</span>
                                   <span class="n">correction</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">correction</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]]</span>


        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span> <span class="n">labels</span><span class="p">):</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">psi_and_w_for_plotting</span><span class="p">(</span><span class="n">npts</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">xm</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span>
            <span class="n">slope_n</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">dx</span>
            <span class="n">slope_a</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">dw_dpsi</span><span class="p">(</span><span class="n">xm</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xm</span><span class="p">,</span> <span class="n">slope_n</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="s2">&quot;numerical: &quot;</span> <span class="o">+</span> <span class="n">label</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xm</span><span class="p">,</span> <span class="n">slope_a</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="s2">&quot;analytical: &quot;</span> <span class="o">+</span> <span class="n">label</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">psi$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$dw/d</span><span class="se">\\</span><span class="s1">psi$&#39;</span><span class="p">)</span>
        <span class="n">leg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">leg</span><span class="o">.</span><span class="n">draggable</span><span class="p">()</span>
<span class="c1">#            print(np.isclose(slope_a, slope_n))</span>
<span class="c1">#            print(slope_a-slope_n)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<div class="viewcode-block" id="SWCC_PhamAndFredlund2008.dw_dpsi"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.swcc.html#geotecha.constitutive_models.swcc.SWCC_PhamAndFredlund2008.dw_dpsi">[docs]</a>    <span class="k">def</span> <span class="nf">dw_dpsi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Slope of SWCC dw/dpsi</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        psi : float</span>
<span class="sd">            Suction</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dw_dpsi : float</span>
<span class="sd">            Suction corresponding to psi</span>

<span class="sd">#        Examples</span>
<span class="sd">#        --------</span>
<span class="sd">#        &gt;&gt;&gt; a = SWCC_FredlundAndXing1994(a=3000, n=1.5, m=1, ws=60, correction=1)</span>
<span class="sd">#        &gt;&gt;&gt; a.dw_dpsi(2000)</span>
<span class="sd">#        -0.00536...</span>
<span class="sd">#        &gt;&gt;&gt; b = SWCC_FredlundAndXing1994(a=100, n=2, m=4, correction=1)</span>
<span class="sd">#        &gt;&gt;&gt; b.dw_dpsi(90)</span>
<span class="sd">#        -0.00640...</span>
<span class="sd">#        &gt;&gt;&gt; c = SWCC_FredlundAndXing1994(a=427, n=0.794, m=0.613, psir=3000)</span>
<span class="sd">#        &gt;&gt;&gt; c.dw_dpsi(10000)</span>
<span class="sd">#        -1.317...e-05</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">psir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psir</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
        <span class="n">wr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wr</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s1</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span>
        <span class="n">l10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">10.</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">correction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">psi</span><span class="o">/</span><span class="n">psir</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">1000000.0</span><span class="o">/</span><span class="n">psir</span><span class="p">))</span><span class="o">*</span>
             <span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">psi</span><span class="o">**</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">wr</span> <span class="o">+</span> <span class="n">ws</span> <span class="o">-</span> <span class="n">s1</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span><span class="o">/</span><span class="n">l10</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">psi</span><span class="o">*</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">psi</span><span class="o">**</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
             <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">s1</span><span class="o">/</span><span class="p">(</span><span class="n">l10</span><span class="o">*</span><span class="n">psi</span><span class="o">*</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">psi</span><span class="o">**</span><span class="n">b</span><span class="p">)))</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">wr</span> <span class="o">+</span> <span class="n">ws</span> <span class="o">-</span>
             <span class="n">s1</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span><span class="o">/</span><span class="n">l10</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">psi</span><span class="o">**</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">wr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">psir</span><span class="o">*</span><span class="p">(</span><span class="n">psi</span><span class="o">/</span><span class="n">psir</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span>
             <span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">1000000.0</span><span class="o">/</span><span class="n">psir</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">correction</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">psi</span><span class="o">**</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">wr</span> <span class="o">+</span> <span class="n">ws</span> <span class="o">-</span>
                <span class="n">s1</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span><span class="o">/</span><span class="n">l10</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">psi</span><span class="o">*</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">psi</span><span class="o">**</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span>
                <span class="n">a</span><span class="o">*</span><span class="n">s1</span><span class="o">/</span><span class="p">(</span><span class="n">l10</span><span class="o">*</span><span class="n">psi</span><span class="o">*</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">psi</span><span class="o">**</span><span class="n">b</span><span class="p">)))</span></div>




<div class="viewcode-block" id="SWCC_PhamAndFredlund2008.psi_and_w_for_plotting"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.swcc.html#geotecha.constitutive_models.swcc.SWCC_PhamAndFredlund2008.psi_and_w_for_plotting">[docs]</a>    <span class="k">def</span> <span class="nf">psi_and_w_for_plotting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Suction and water content for plotting</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        npts : int, optional</span>
<span class="sd">            Number of points to return.  Default npts=100.</span>
<span class="sd">        xmin, xmax : float, optional</span>
<span class="sd">            Range of x (i.e. effective stress) values from which</span>
<span class="sd">            to return points. Default xmin=1, xmax=1e6.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        x, y : 1d ndarray</span>
<span class="sd">            `npts` permeability, and void ratio values between</span>
<span class="sd">            `xmin` and `xmax`.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">npts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;npts&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xmin&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xmax&#39;</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xmin</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xmax</span><span class="p">),</span> <span class="n">npts</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_from_psi</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>


<div class="viewcode-block" id="SWCC_PhamAndFredlund2008.k_from_psi"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.swcc.html#geotecha.constitutive_models.swcc.SWCC_PhamAndFredlund2008.k_from_psi">[docs]</a>    <span class="k">def</span> <span class="nf">k_from_psi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Relative permeability from suction</span>

<span class="sd">        If k_from_psi returns a number greater than zero then try reducing</span>
<span class="sd">        aev.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        psi : float</span>
<span class="sd">            Soil suction. Can be a 1d array.</span>
<span class="sd">        aev : float, optional</span>
<span class="sd">            Air entry soil suction. Default aev=0.001</span>
<span class="sd">        npts : int, optional</span>
<span class="sd">            Numper of intervals to break integral into. Default npts=500.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        k : float</span>
<span class="sd">            Relative permeability.</span>


<span class="sd">#        Examples</span>
<span class="sd">#        --------</span>
<span class="sd">#        &gt;&gt;&gt; b = SWCC_FredlundAndXing1994(a=2.77, n=11.2, m=0.45, psir=300)</span>
<span class="sd">#        &gt;&gt;&gt; b.k_from_psi(4)</span>
<span class="sd">#        0.0520...</span>



<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The permability relative to the saturated value is given by:</span>

<span class="sd">        .. math:: k_r(\\psi) =  \\left.</span>
<span class="sd">            \\int_{\\ln(\\psi)}^{b}</span>
<span class="sd">              {\\frac{\\theta(e^y) - \\theta(\\psi)}{e^y} \\theta^{\\prime}(e^y)\\,dy}</span>
<span class="sd">            \\middle/</span>
<span class="sd">              \\int_{\\ln(\\psi_{\\textrm{aev}})}^{b}</span>
<span class="sd">              {\\frac{\\theta(e^y) - \\theta_s}{e^y} \\theta^{\\prime}(e^y)\\,dy}</span>
<span class="sd">            \\right.</span>

<span class="sd">        where, :math:`b=\\ln(10^6)`, :math:`\\theta(\\psi)` is the volumetric</span>
<span class="sd">        water content at a given soil suction.  :math:`\\psi_{\\textrm{aev}}`</span>
<span class="sd">        is the air entry value of soil suction (must be positive for the</span>
<span class="sd">        log integral to work).  Each integral is performed by dividing the</span>
<span class="sd">        integration inteval into N sections, evaluating the integrand at the</span>
<span class="sd">        mid point of each inteval, then summing the areas of each section.</span>


<span class="sd">        If you enter a single element array you will get a scalar returned.</span>


<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        .. [1] Fredlund, D.G., Anqing Xing, and Shangyan Huang.</span>
<span class="sd">               &quot;Predicting the Permeability Function for Unsaturated</span>
<span class="sd">               Soils Using the Soil-Water Characteristic Curve.</span>
<span class="sd">               Canadian Geotechnical Journal 31, no. 4 (1994): 533-46.</span>
<span class="sd">               doi:10.1139/t94-062.</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">aev</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;aev&#39;</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>
        <span class="n">npts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;npts&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.0e6</span><span class="p">)</span> <span class="c1">#conceivably this could be the suction at residual</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
        <span class="n">dy1</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a1</span><span class="p">)</span> <span class="o">/</span> <span class="n">npts</span>

        <span class="n">y1</span> <span class="o">=</span> <span class="n">a1</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">dy1</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npts</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ey1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>

        <span class="n">f1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_from_psi</span><span class="p">(</span><span class="n">ey1</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">w_from_psi</span><span class="p">(</span><span class="n">psi</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dw_dpsi</span><span class="p">(</span><span class="n">ey1</span><span class="p">)</span> <span class="o">/</span> <span class="n">ey1</span>

        <span class="n">numer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">aev</span><span class="p">)</span>

        <span class="n">dy2</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a2</span><span class="p">)</span> <span class="o">/</span> <span class="n">npts</span>

        <span class="n">y2</span> <span class="o">=</span> <span class="n">a2</span> <span class="o">+</span> <span class="n">dy2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>

<span class="c1">#        f2 = (self.w_from_psi(ey2) - self.ws) * self.dw_dpsi(ey2) / ey2</span>
        <span class="n">ws_numerical</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_from_psi</span><span class="p">(</span><span class="n">aev</span><span class="p">)</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_from_psi</span><span class="p">(</span><span class="n">ey2</span><span class="p">)</span> <span class="o">-</span> <span class="n">ws_numerical</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dw_dpsi</span><span class="p">(</span><span class="n">ey2</span><span class="p">)</span> <span class="o">/</span> <span class="n">ey2</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>

        <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">numer</span><span class="o">*</span><span class="n">dy1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">denom</span><span class="o">*</span><span class="n">dy2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">size</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">k</span>
        <span class="k">return</span> <span class="n">k</span></div></div>



<div class="viewcode-block" id="kwrel_from_discrete_swcc"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.swcc.html#geotecha.constitutive_models.swcc.kwrel_from_discrete_swcc">[docs]</a><span class="k">def</span> <span class="nf">kwrel_from_discrete_swcc</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">psi_swcc</span><span class="p">,</span> <span class="n">vw_swcc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Relative permeability from integrating discrete soil water</span>
<span class="sd">    characteristic curve.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    psi: float</span>
<span class="sd">        Suction values to calculate relative permeability at. Suction is</span>
<span class="sd">        positve.</span>
<span class="sd">    psi_swcc : 1d array of float</span>
<span class="sd">        Suction values defining soil water charteristic curve.</span>
<span class="sd">    vw_swcc : 1d array of float</span>
<span class="sd">        Volumetric water content corresponding to psi_swcc</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    krel : 1d array of float</span>
<span class="sd">        relative permeability values corresponding to psi.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This integrates the whole SWCC.  Initial slope of SWCC is non-zero then</span>
<span class="sd">    peremability reduction with suction will commence straight from first</span>
<span class="sd">    value of psi_swcc.</span>

<span class="sd">    Uses _[1] method but does it assuming taht you already have all</span>
<span class="sd">    the SWCC points (_[1] can calculate volumetric water content from suction).</span>
<span class="sd">    Main differnce is that in _[1] vw and dvw/dpsi at the midpoint are</span>
<span class="sd">    calculated analytically, whereas here midpoint value is half the</span>
<span class="sd">    segment endpoint values, and slope is approx value at segmetn endpoint.</span>

<span class="sd">    Will return scalar if scalar or single elemtn array is input.</span>

<span class="sd">    If you get some sort of index error then probably your pis input is</span>
<span class="sd">    beyond your data range.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; b = SWCC_FredlundAndXing1994(a=2.77, n=11.2, m=0.45, psir=300)</span>
<span class="sd">    &gt;&gt;&gt; x = np.logspace(-3,6,500)</span>
<span class="sd">    &gt;&gt;&gt; y = b.w_from_psi(x)</span>
<span class="sd">    &gt;&gt;&gt; kwrel_from_discrete_swcc(4, x, y)</span>
<span class="sd">    0.0550...</span>



<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Fredlund, D.G., Anqing Xing, and Shangyan Huang.</span>
<span class="sd">           &quot;Predicting the Permeability Function for Unsaturated</span>
<span class="sd">           Soils Using the Soil-Water Characteristic Curve.</span>
<span class="sd">           Canadian Geotechnical Journal 31, no. 4 (1994): 533-46.</span>
<span class="sd">           doi:10.1139/t94-062.</span>
<span class="sd">    &quot;&quot;&quot;</span>




    <span class="n">dlogx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">psi_swcc</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">psi_swcc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#interval in log10-space</span>

    <span class="n">xbar</span> <span class="o">=</span> <span class="n">psi_swcc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dlogx</span><span class="p">)</span> <span class="c1"># x value at midpoint</span>
    <span class="n">ybar</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">vw_swcc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">vw_swcc</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="c1"># y value at interval</span>
    <span class="n">logslope</span> <span class="o">=</span> <span class="p">(</span><span class="n">vw_swcc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">vw_swcc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dlogx</span> <span class="c1">#interval slope in log10-space</span>
    <span class="n">slopebar</span> <span class="o">=</span> <span class="n">logslope</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="n">xbar</span> <span class="c1">#slope at interval midpoint in normal space</span>

    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">psi_swcc</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
    <span class="c1"># if index error then chances are</span>

    <span class="c1">#TODO: limit what values of idx, to be within range</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">dlogx</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">ybar</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">ybar</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="n">idx</span><span class="p">])</span> <span class="o">/</span> <span class="n">xbar</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">slopebar</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span>
    <span class="c1">#note in f1 each row is an interval, each column is a psi value</span>

    <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">f1</span><span class="p">[</span><span class="n">row</span><span class="o">&lt;</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1">#ignore values before psi</span>

    <span class="n">numer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dlogx</span><span class="p">[:]</span><span class="o">*</span><span class="p">(</span><span class="n">ybar</span><span class="p">[:]</span> <span class="o">-</span> <span class="n">ybar</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">xbar</span><span class="p">[:]</span> <span class="o">*</span> <span class="n">slopebar</span><span class="p">[:])</span>

    <span class="n">krel</span> <span class="o">=</span> <span class="n">numer</span> <span class="o">/</span> <span class="n">denom</span>


    <span class="k">if</span> <span class="n">krel</span><span class="o">.</span><span class="n">size</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">krel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">krel</span></div>


<div class="viewcode-block" id="karel_air_from_saturation"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.swcc.html#geotecha.constitutive_models.swcc.karel_air_from_saturation">[docs]</a><span class="k">def</span> <span class="nf">karel_air_from_saturation</span><span class="p">(</span><span class="n">Sr</span><span class="p">,</span> <span class="n">qfit</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Relative air peremability (w.r.t. dry_ka)</span>

<span class="sd">    krel = (1-Sr)**0.5*(1-Sr**(1 / qfit))**(2*qfit)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Sr : 1d array of float</span>
<span class="sd">        Degree of saturation at which to calc relative permeability of air.</span>
<span class="sd">    qfit : float, optional</span>
<span class="sd">        Fitting parameter.  Generally between between 0 and 1.</span>
<span class="sd">        Default qfit=1</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Ba-Te, B., Limin Zhang, and Delwyn G. Fredlund. &quot;A General</span>
<span class="sd">           Air-Phase Permeability Function for Airflow through Unsaturated</span>
<span class="sd">           Soils.&quot; In Proceedings of Geofrontiers 2005 Cngress,</span>
<span class="sd">           2961-85. Austin, Tx: ASCE, 2005. doi:10.1061/40787(166)29.</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Sr</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Sr</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">qfit</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">qfit</span><span class="p">)</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">nose</span>
    <span class="n">nose</span><span class="o">.</span><span class="n">runmodule</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nose&#39;</span><span class="p">,</span> <span class="s1">&#39;--verbosity=3&#39;</span><span class="p">,</span> <span class="s1">&#39;--with-doctest&#39;</span><span class="p">,</span> <span class="s1">&#39;--doctest-options=+ELLIPSIS&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">SWCC_FredlundAndXing1994</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">SWCC_FredlundAndXing1994</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">SWCC_FredlundAndXing1994</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">plot_model</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">]]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">70</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">SWCC_FredlundAndXing1994</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">SWCC_FredlundAndXing1994</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">427</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mf">0.794</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mf">0.613</span><span class="p">,</span> <span class="n">psir</span><span class="o">=</span><span class="mi">3000</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">plot_model</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="c1">#        plt.gca().set_ylim([0,70])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">SWCC_FredlundAndXing1994</span><span class="o">.</span><span class="n">_derive_dw_dpsi</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">SWCC_FredlundAndXing1994</span><span class="o">.</span><span class="n">_numerical_check_of_dw_dpsi</span><span class="p">()</span>
<span class="c1">#        b = SWCC_FredlundAndXing1994(a=427, n=0.794, m=0.613, psir=3000)</span>
<span class="c1">#        b = SWCC_FredlundAndXing1994(a=200, n=2, m=1, ws=40, correction=1)</span>
<span class="c1">#        x, y = b.psi_and_w_for_plotting(npts=10000)</span>
<span class="c1">#        dx = np.diff(x)</span>
<span class="c1">#        dy = np.diff(y)</span>
<span class="c1">#        xm = x[:-1] + dx</span>
<span class="c1">#        slope_n = dy / dx</span>
<span class="c1">#        slope_a = b.dw_dpsi(xm)</span>
<span class="c1">#        plt.plot(xm, slope_n, marker=&#39;o&#39;, ms=2, ls=&#39;.&#39;)</span>
<span class="c1">#        plt.plot(xm, slope_a, color=&#39;red&#39;)</span>
<span class="c1">#        plt.gca().set_xscale(&#39;log&#39;)</span>
<span class="c1">#        print(np.isclose(slope_a, slope_n))</span>
<span class="c1">#        print(slope_a-slope_n)</span>
<span class="c1">#        plt.show()</span>


    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>

<span class="c1">#        b = SWCC_FredlundAndXing1994(a=427, n=0.794, m=0.613, psir=3000)</span>
<span class="c1">#        b = SWCC_FredlundAndXing1994(a=8.34, n=9.9, m=0.44, psir=30)</span>
<span class="c1">#         b = SWCC_FredlundAndXing1994(a=6.01, n=11.86, m=0.36, psir=30)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">SWCC_FredlundAndXing1994</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">2.77</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mf">11.2</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mf">0.45</span><span class="p">,</span> <span class="n">psir</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="c1">#        b = SWCC_FredlundAndXing1994(a=2.7, n=2.05, m=0.36, psir=100)</span>



<span class="c1">#        b = SWCC_FredlundAndXing1994(a=200, n=2, m=1, ws=40, correction=1)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">psi_and_w_for_plotting</span><span class="p">(</span><span class="n">npts</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="n">k</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">k_from_psi</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">aev</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="s1">&#39;211&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$psi$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="s1">&#39;212&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$psi$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k/k_</span><span class="si">{sat}</span><span class="s1">$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>


        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">SWCC_PhamAndFredlund2008</span><span class="o">.</span><span class="n">_derive_dw_dpsi</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">SWCC_PhamAndFredlund2008</span><span class="o">.</span><span class="n">_numerical_check_of_dw_dpsi</span><span class="p">()</span>


    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">SWCC_PhamAndFredlund2008</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mf">50000.</span><span class="p">,</span>
                                     <span class="n">b</span> <span class="o">=</span> <span class="mf">2.</span><span class="p">,</span>
                                     <span class="n">wr</span> <span class="o">=</span> <span class="mf">0.12</span><span class="p">,</span>
                                     <span class="n">s1</span> <span class="o">=</span> <span class="mf">0.04</span><span class="p">,</span>
                                     <span class="n">ws</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                     <span class="n">correction</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="c1">#        b = SWCC_PhamAndFredlund2008(a = 25000.,</span>
<span class="c1">#                                     b = 3.,</span>
<span class="c1">#                                     wr = 0.12,</span>
<span class="c1">#                                     s1 = 0.04,</span>
<span class="c1">#                                     ws=0.5,</span>
<span class="c1">#                                     correction=None)</span>
<span class="c1">#        b = SWCC_PhamAndFredlund2008(a = 50000.,</span>
<span class="c1">#                                     b = 1.5,</span>
<span class="c1">#                                     wr = 0.12,</span>
<span class="c1">#                                     s1 = 0.04,</span>
<span class="c1">#                                     ws=0.5,</span>
<span class="c1">#                                     correction=None)</span>



        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">psi_and_w_for_plotting</span><span class="p">(</span><span class="n">npts</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="n">k</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">k_from_psi</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">aev</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="s1">&#39;211&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$psi$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="s1">&#39;212&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$psi$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k/k_</span><span class="si">{sat}</span><span class="s1">$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>


        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">SWCC_FredlundAndXing1994</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">2.77</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mf">11.2</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mf">0.45</span><span class="p">,</span> <span class="n">psir</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>


        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">w_from_psi</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
<span class="c1">#        print(x)</span>
<span class="c1">#        print(x2)</span>
        <span class="n">k_obj</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">k_from_psi</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


        <span class="n">np</span><span class="o">.</span><span class="n">logspace</span>
        <span class="n">krel</span> <span class="o">=</span> <span class="n">kwrel_from_discrete_swcc</span><span class="p">(</span><span class="n">x2</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="c1">#        krel = kwrel_from_discrete_swcc(x[:-1], x, y)</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k_obj</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;expected&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">krel</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;numerical&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="c1">#        ax.plot(x[:-1], krel, label=&quot;numerical&quot;, ls=&quot;None&quot;, marker=&#39;o&#39;)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;psi&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;krel&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2014, Rohan Walker.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>