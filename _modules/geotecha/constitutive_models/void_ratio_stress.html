
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>geotecha.constitutive_models.void_ratio_stress &#8212; geotecha 0.2.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../_static/logo.png" border="0" alt="py4sci"/></a>
</div>



      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for geotecha.constitutive_models.void_ratio_stress</h1><div class="highlight"><pre>
<span></span><span class="c1"># geotecha - A software suite for geotechncial engineering</span>
<span class="c1"># Copyright (C) 2018  Rohan T. Walker (rtrwalker@gmail.com)</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program.  If not, see http://www.gnu.org/licenses/gpl.html.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Relationships between void-ratio and effective stress.</span>

<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">fixed_point</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="k">import</span> <span class="n">odeint</span>
<span class="kn">import</span> <span class="nn">geotecha.piecewise.piecewise_linear_1d</span> <span class="k">as</span> <span class="nn">pwise</span>

<div class="viewcode-block" id="OneDimensionalVoidRatioEffectiveStress"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.OneDimensionalVoidRatioEffectiveStress">[docs]</a><span class="k">class</span> <span class="nc">OneDimensionalVoidRatioEffectiveStress</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for defining 1D void ratio-effective stress relationships&quot;&quot;&quot;</span>

<div class="viewcode-block" id="OneDimensionalVoidRatioEffectiveStress.e_from_stress"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.OneDimensionalVoidRatioEffectiveStress.e_from_stress">[docs]</a>    <span class="k">def</span> <span class="nf">e_from_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estress</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Void ratio from effective stress&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;e_from_stress must be implemented&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OneDimensionalVoidRatioEffectiveStress.stress_from_e"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.OneDimensionalVoidRatioEffectiveStress.stress_from_e">[docs]</a>    <span class="k">def</span> <span class="nf">stress_from_e</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Effective stress from void ratio&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;stress_from_e must be implemented&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OneDimensionalVoidRatioEffectiveStress.e_and_stress_for_plotting"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.OneDimensionalVoidRatioEffectiveStress.e_and_stress_for_plotting">[docs]</a>    <span class="k">def</span> <span class="nf">e_and_stress_for_plotting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Void ratio and stress values that plot the method&quot;&quot;&quot;</span>
        <span class="c1"># should return a tuple of x and y values</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;e_and_stress_for_plotting must be &quot;</span>
                                  <span class="s2">&quot;implemented&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OneDimensionalVoidRatioEffectiveStress.av_from_stress"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.OneDimensionalVoidRatioEffectiveStress.av_from_stress">[docs]</a>    <span class="k">def</span> <span class="nf">av_from_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estress</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Slope of void ratio from effective stress&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;av_from_stress must be implemented&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OneDimensionalVoidRatioEffectiveStress.plot_model"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.OneDimensionalVoidRatioEffectiveStress.plot_model">[docs]</a>    <span class="k">def</span> <span class="nf">plot_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;plot the void ratio-stress points&quot;&quot;&quot;</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e_and_stress_for_plotting</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span></div></div>

<div class="viewcode-block" id="AvSoilModel"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.AvSoilModel">[docs]</a><span class="k">class</span> <span class="nc">AvSoilModel</span><span class="p">(</span><span class="n">OneDimensionalVoidRatioEffectiveStress</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Linear void ratio-effective stress relationship</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    av : float</span>
<span class="sd">        Slope of compression line.</span>
<span class="sd">    siga, ea : float</span>
<span class="sd">        Effective stress and void ratio specifying point on av line.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">av</span><span class="p">,</span> <span class="n">siga</span><span class="p">,</span> <span class="n">ea</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">av</span> <span class="o">=</span> <span class="n">av</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">siga</span> <span class="o">=</span> <span class="n">siga</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea</span> <span class="o">=</span> <span class="n">ea</span>

<div class="viewcode-block" id="AvSoilModel.e_from_stress"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.AvSoilModel.e_from_stress">[docs]</a>    <span class="k">def</span> <span class="nf">e_from_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estress</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Void ratio from effective stress</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        estress : float</span>
<span class="sd">            Current effective stress.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        e : float</span>
<span class="sd">            Void ratio corresponding to current stress state.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; a = AvSoilModel(av=1.5, siga=19, ea=4)</span>
<span class="sd">        &gt;&gt;&gt; a.e_from_stress(20)</span>
<span class="sd">        2.5</span>

<span class="sd">        Array inputs:</span>

<span class="sd">        &gt;&gt;&gt; a = AvSoilModel(av=1.5, siga=19, ea=4)</span>
<span class="sd">        &gt;&gt;&gt; a.e_from_stress(np.array([20, 21]))</span>
<span class="sd">        array([2.5, 1. ])</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ea</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">av</span> <span class="o">*</span> <span class="p">(</span><span class="n">estress</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">siga</span><span class="p">)</span></div>

<div class="viewcode-block" id="AvSoilModel.stress_from_e"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.AvSoilModel.stress_from_e">[docs]</a>    <span class="k">def</span> <span class="nf">stress_from_e</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Effective stress from void ratio</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        e : float</span>
<span class="sd">            Current void ratio.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        estress : float</span>
<span class="sd">            Effective stress corresponding to current void ratio</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; a = AvSoilModel(av=1.5, siga=19, ea=4)</span>
<span class="sd">        &gt;&gt;&gt; a.stress_from_e(1)</span>
<span class="sd">        21.0</span>

<span class="sd">        Array inputs:</span>

<span class="sd">        &gt;&gt;&gt; a = AvSoilModel(av=1.5, siga=19, ea=4)</span>
<span class="sd">        &gt;&gt;&gt; a.stress_from_e(np.array([1, 2.5]))</span>
<span class="sd">        array([21., 20.])</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">estress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">siga</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ea</span> <span class="o">-</span> <span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">av</span>

        <span class="k">return</span>  <span class="n">estress</span></div>

<div class="viewcode-block" id="AvSoilModel.e_and_stress_for_plotting"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.AvSoilModel.e_and_stress_for_plotting">[docs]</a>    <span class="k">def</span> <span class="nf">e_and_stress_for_plotting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Void ratio and stress values that plot the model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        npts : int, optional</span>
<span class="sd">            Number of points to return.  Default npts=100.</span>
<span class="sd">        xmin, xmax : float, optional</span>
<span class="sd">            range of x (i.e. effective stress) values from which</span>
<span class="sd">            to return points. Default xmin=1, xmax=100</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        x, y : 1d ndarray</span>
<span class="sd">            `npts` stress, and void ratio values between `xmin` and `xmax`.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">npts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;npts&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xmin&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xmax&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e_from_stress</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>

<div class="viewcode-block" id="AvSoilModel.av_from_stress"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.AvSoilModel.av_from_stress">[docs]</a>    <span class="k">def</span> <span class="nf">av_from_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Slope of void ratio from effective stress&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">av</span></div></div>


<div class="viewcode-block" id="CcCrSoilModel"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.CcCrSoilModel">[docs]</a><span class="k">class</span> <span class="nc">CcCrSoilModel</span><span class="p">(</span><span class="n">OneDimensionalVoidRatioEffectiveStress</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Semi-log void ratio-effective stress realationship</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Cc : float</span>
<span class="sd">        Compressibility index, slope of e-log(sig) line.</span>
<span class="sd">    Cr : float</span>
<span class="sd">        Recompression index, slope of e-log(sig) line.</span>
<span class="sd">    siga, ea : float</span>
<span class="sd">        Point on compression line fixing it in effective stress-void ratio</span>
<span class="sd">        space.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Cc</span><span class="p">,</span> <span class="n">Cr</span><span class="p">,</span> <span class="n">siga</span><span class="p">,</span> <span class="n">ea</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cc</span> <span class="o">=</span> <span class="n">Cc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span> <span class="o">=</span> <span class="n">Cr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">siga</span> <span class="o">=</span> <span class="n">siga</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea</span> <span class="o">=</span> <span class="n">ea</span>

<div class="viewcode-block" id="CcCrSoilModel.e_from_stress"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.CcCrSoilModel.e_from_stress">[docs]</a>    <span class="k">def</span> <span class="nf">e_from_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estress</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Void ratio from effective stress</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        estress : float</span>
<span class="sd">            Current effective stress.</span>
<span class="sd">        pstress : float, optional</span>
<span class="sd">            Preconsolidation stress.  Default pstress=estress i.e. normally</span>
<span class="sd">            consolidated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        e : float</span>
<span class="sd">            Void ratio corresponding to current stress state.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        On recompression line:</span>

<span class="sd">        &gt;&gt;&gt; a = CcCrSoilModel(Cc=3, Cr=0.5, siga=10, ea=5)</span>
<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=40, pstress=50)</span>
<span class="sd">        2.95154...</span>

<span class="sd">        On compression line:</span>

<span class="sd">        &gt;&gt;&gt; a = CcCrSoilModel(Cc=3, Cr=0.5, siga=10, ea=5)</span>
<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=60, pstress=50)</span>
<span class="sd">        2.66554...</span>

<span class="sd">        Array inputs:</span>

<span class="sd">        &gt;&gt;&gt; a = CcCrSoilModel(Cc=3, Cr=0.5, siga=10, ea=5)</span>
<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=np.array([40, 60]),</span>
<span class="sd">        ... pstress=np.array([50, 55]))</span>
<span class="sd">        array([2.95154499, 2.66554625])</span>

<span class="sd">        Normally consolidated (pstress not specified):</span>

<span class="sd">        &gt;&gt;&gt; a = CcCrSoilModel(Cc=3.0, Cr=0.5, siga=10, ea=5)</span>
<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=10)</span>
<span class="sd">        5.0</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">pstress</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pstress&#39;</span><span class="p">,</span> <span class="n">estress</span><span class="p">)</span>
        <span class="n">ea</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ea</span>
        <span class="n">Cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cc</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span>
        <span class="n">siga</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">siga</span>

        <span class="n">max_past</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">pstress</span><span class="p">,</span> <span class="n">estress</span><span class="p">)</span>

        <span class="c1"># void ratio at preconsolidation pressure</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">ea</span> <span class="o">-</span> <span class="n">Cc</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_past</span> <span class="o">/</span> <span class="n">siga</span><span class="p">)</span>
        <span class="c1"># void ratio at current effetive stress</span>
        <span class="n">e</span> <span class="o">+=</span> <span class="n">Cr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_past</span> <span class="o">/</span> <span class="n">estress</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">e</span></div>

<div class="viewcode-block" id="CcCrSoilModel.stress_from_e"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.CcCrSoilModel.stress_from_e">[docs]</a>    <span class="k">def</span> <span class="nf">stress_from_e</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Effective stress from void ratio</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        e : float</span>
<span class="sd">            Current void ratio.</span>
<span class="sd">        pstress : float, optional</span>
<span class="sd">            Preconsolidation stress.  Default pstress=estress i.e. normally</span>
<span class="sd">            consolidated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        estress : float</span>
<span class="sd">            Effective stress corresponding to current void ratio.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        On recompression line:</span>

<span class="sd">        &gt;&gt;&gt; a = CcCrSoilModel(Cc=3.0, Cr=0.5, siga=10, ea=5)</span>
<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=2.95154499, pstress=50)</span>
<span class="sd">        40...</span>

<span class="sd">        On compression line:</span>

<span class="sd">        &gt;&gt;&gt; a = CcCrSoilModel(Cc=3, Cr=0.5, siga=10, ea=5)</span>
<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=2.66554625, pstress=50)</span>
<span class="sd">        59.999...</span>

<span class="sd">        Array inputs:</span>

<span class="sd">        &gt;&gt;&gt; a = CcCrSoilModel(Cc=3, Cr=0.5, siga=10, ea=5)</span>
<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=np.array([2.95154499, 2.66554625]), pstress=50)</span>
<span class="sd">        array([40.0..., 59.99...])</span>

<span class="sd">        Normally consolidated:</span>

<span class="sd">        &gt;&gt;&gt; a = CcCrSoilModel(Cc=3.0, Cr=0.5, siga=10, ea=5)</span>
<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=5)</span>
<span class="sd">        10.0</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pstress</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pstress&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">ea</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ea</span>
        <span class="n">Cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cc</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span>
        <span class="n">siga</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">siga</span>

        <span class="n">fact</span> <span class="o">=</span> <span class="mf">2.3025850929940459</span> <span class="c1"># 10**(x)==exp(fact*x)</span>


        <span class="k">if</span> <span class="n">pstress</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Normally consolidated</span>
            <span class="n">estress</span> <span class="o">=</span> <span class="n">siga</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">fact</span> <span class="o">*</span> <span class="p">(</span><span class="n">ea</span> <span class="o">-</span> <span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="n">Cc</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">estress</span>

        <span class="c1"># void ratio at preconsolidation pressure</span>
        <span class="n">ep</span> <span class="o">=</span> <span class="n">ea</span> <span class="o">-</span> <span class="n">Cc</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pstress</span> <span class="o">/</span> <span class="n">siga</span><span class="p">)</span>

        <span class="c1"># stress change from (pstress, ep) if on extended Cc line</span>
        <span class="n">dpCc</span> <span class="o">=</span> <span class="n">pstress</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">fact</span> <span class="o">*</span> <span class="p">(</span><span class="n">ep</span> <span class="o">-</span> <span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="n">Cc</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="c1"># stress change from (pstress, ep) if on extended Cr line</span>
        <span class="n">dpCr</span> <span class="o">=</span> <span class="n">pstress</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">fact</span> <span class="o">*</span> <span class="p">(</span><span class="n">ep</span> <span class="o">-</span> <span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="n">Cr</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="n">estress</span> <span class="o">=</span> <span class="n">pstress</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">dpCc</span><span class="p">,</span> <span class="n">dpCr</span><span class="p">)</span>

        <span class="k">return</span>  <span class="n">estress</span></div>

<div class="viewcode-block" id="CcCrSoilModel.e_and_stress_for_plotting"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.CcCrSoilModel.e_and_stress_for_plotting">[docs]</a>    <span class="k">def</span> <span class="nf">e_and_stress_for_plotting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Void ratio and stress values that plot the model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pstress : float, optional</span>
<span class="sd">            Preconsolidation stress.  Default behaviour is normally</span>
<span class="sd">            consolidated.</span>
<span class="sd">        npts : int, optional</span>
<span class="sd">            Number of points to return.  Default npts=100.</span>
<span class="sd">        xmin, xmax : float, optional</span>
<span class="sd">            range of x (i.e. effective stress) values from which</span>
<span class="sd">            to return points. Default xmin=1, xmax=100</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        x, y : 1d ndarray</span>
<span class="sd">            `npts` stress, and void ratio values between `xmin` and `xmax`.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">npts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;npts&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xmin&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xmax&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
        <span class="n">pstress</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pstress&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pstress</span><span class="p">)</span>
        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pstress</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e_from_stress</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pstress</span><span class="o">=</span><span class="n">pstress</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>


<div class="viewcode-block" id="CcCrSoilModel.av_from_stress"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.CcCrSoilModel.av_from_stress">[docs]</a>    <span class="k">def</span> <span class="nf">av_from_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estress</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Slope of void ratio from effective stress</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        estress : float</span>
<span class="sd">            Current effective stress.</span>
<span class="sd">        pstress : float, optional</span>
<span class="sd">            Preconsolidation stress.  Default pstress=estress i.e. normally</span>
<span class="sd">            consolidated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        av : float</span>
<span class="sd">            Slope of void-ratio vs effective stress plot at current stress</span>
<span class="sd">            state.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        On recompression line:</span>

<span class="sd">        &gt;&gt;&gt; a = CcCrSoilModel(Cc=3.0, Cr=0.5, siga=10, ea=5)</span>
<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=40, pstress=50)</span>
<span class="sd">        0.00542868...</span>

<span class="sd">        On compression line:</span>

<span class="sd">        &gt;&gt;&gt; a = CcCrSoilModel(Cc=3.0, Cr=0.5, siga=10, ea=5)</span>
<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=60, pstress=50)</span>
<span class="sd">        0.02171472...</span>

<span class="sd">        Array inputs:</span>

<span class="sd">        &gt;&gt;&gt; a = CcCrSoilModel(Cc=3.0, Cr=0.5, siga=10, ea=5)</span>
<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=np.array([40, 60.0]),</span>
<span class="sd">        ... pstress=np.array([50, 55.0]))</span>
<span class="sd">        array([0.00542868, 0.02171472])</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pstress</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pstress&#39;</span><span class="p">,</span> <span class="n">estress</span><span class="p">)</span>

        <span class="n">Cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cc</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span>

        <span class="n">chooser</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">Cc</span><span class="p">,</span> <span class="n">Cc</span><span class="p">,</span> <span class="n">Cr</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1"># appropriate value of Cc or Cr</span>
        <span class="n">Cx</span> <span class="o">=</span> <span class="n">chooser</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">estress</span> <span class="o">-</span> <span class="n">pstress</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)]</span>

        <span class="n">av</span> <span class="o">=</span> <span class="mf">0.43429448190325182</span> <span class="o">*</span> <span class="n">Cx</span> <span class="o">/</span> <span class="n">estress</span>

        <span class="k">return</span> <span class="n">av</span></div></div>


<div class="viewcode-block" id="PwiseLinearSoilModel"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.PwiseLinearSoilModel">[docs]</a><span class="k">class</span> <span class="nc">PwiseLinearSoilModel</span><span class="p">(</span><span class="n">OneDimensionalVoidRatioEffectiveStress</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pwise linear void ratio-effective stress realationship</span>

<span class="sd">    x and y data can be interpolated natural-natural, natural-log10,</span>
<span class="sd">    log10-natural, or log10, log10.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    siga, ea : 1d array</span>
<span class="sd">        Effective stress values and void ratio values defining a one-to-one</span>
<span class="sd">        relationship.  Slope of void ratio-effectinve stress plot should never</span>
<span class="sd">        fall below `Cr`.</span>
<span class="sd">    Cr : float</span>
<span class="sd">        Precompression index, slope of void rato-effective stress line.  Note</span>
<span class="sd">        that `Cr` is the slope in whatever scales of slog and ylog that have</span>
<span class="sd">        been chosen.</span>
<span class="sd">    xlog, ylog : True/False, Optional</span>
<span class="sd">        If True then interpolation on each axis is assumed to be logarithmic</span>
<span class="sd">        with base 10. Default xlog=ylog=False</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">siga</span><span class="p">,</span> <span class="n">ea</span><span class="p">,</span> <span class="n">Cr</span><span class="p">,</span> <span class="n">xlog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">siga</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">siga</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ea</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlog</span> <span class="o">=</span> <span class="n">xlog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ylog</span> <span class="o">=</span> <span class="n">ylog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span> <span class="o">=</span> <span class="n">Cr</span>
        <span class="c1">#TODO: adjust for different logarithm bases.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">siga_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">siga</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1"># siga is in decreasing order</span>
            <span class="c1"># reverse the slice for e_from_stress interpolation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">siga_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ea</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1"># ea is in decreasing order</span>
            <span class="c1"># reverse the slice for stress_from_e interpolation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ea_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#            raise ValueError(&quot;&#39;ea&#39; must be in monotomically decreasng order.&quot;)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">siga</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ea</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;&#39;siga&#39; and &#39;ea&#39; must be the same length.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log_siga</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">siga</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_ea</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ea</span><span class="p">)</span>

<div class="viewcode-block" id="PwiseLinearSoilModel.e_from_stress"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.PwiseLinearSoilModel.e_from_stress">[docs]</a>    <span class="k">def</span> <span class="nf">e_from_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estress</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Void ratio from effective stress</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        estress : float</span>
<span class="sd">            Current effective stress.  etress must be within the range of the</span>
<span class="sd">            soil model points.</span>
<span class="sd">        pstress : float, optional</span>
<span class="sd">            Preconsolidation stress.  Default pstress=estress i.e. normally</span>
<span class="sd">            consolidated. pstress must be in the range of the soil model</span>
<span class="sd">            points.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        e : float</span>
<span class="sd">            Void ratio corresponding to current stress state.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        On recompression line:</span>

<span class="sd">        &gt;&gt;&gt; x, y = np.array([1,2,2.5]), np.array([4, 3.5, 2])</span>
<span class="sd">        &gt;&gt;&gt; a = PwiseLinearSoilModel(siga=x, ea=y, Cr=0.2)</span>
<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=1.25, pstress=2.25)</span>
<span class="sd">        2.95...</span>

<span class="sd">        On compression line:</span>

<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=2.25, pstress=2)</span>
<span class="sd">        2.75...</span>

<span class="sd">        Normally consolidated (pstress not specified):</span>

<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=2.25)</span>
<span class="sd">        2.75...</span>

<span class="sd">        Array inputs:</span>

<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=np.array([1.25, 2.25]), pstress=2.25)</span>
<span class="sd">        array([2.95, 2.75])</span>


<span class="sd">        Logarithmic effective stress scale:</span>
<span class="sd">        On recompression line:</span>

<span class="sd">        &gt;&gt;&gt; x, y = np.array([1,2,2.5]), np.array([4, 3.5, 2])</span>
<span class="sd">        &gt;&gt;&gt; a = PwiseLinearSoilModel(siga=x, ea=y, Cr=0.2, xlog=True)</span>
<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=1.25, pstress=2.25)</span>
<span class="sd">        2.75930...</span>

<span class="sd">        On compression line:</span>

<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=2.25, pstress=2)</span>
<span class="sd">        2.70824...</span>

<span class="sd">        Normally consolidated (pstress not specified):</span>

<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=2.25)</span>
<span class="sd">        2.70824...</span>

<span class="sd">        Array inputs:</span>

<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=np.array([1.25, 2.25]), pstress=2.25)</span>
<span class="sd">        array([2.75930..., 2.70824...])</span>


<span class="sd">        Logarithmic void ratio scale</span>
<span class="sd">        On recompression line:</span>

<span class="sd">        &gt;&gt;&gt; x, y = np.array([1,2,2.5]), np.array([4, 3.5, 2])</span>
<span class="sd">        &gt;&gt;&gt; a = PwiseLinearSoilModel(siga=x, ea=y, Cr=0.1, ylog=True)</span>
<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=1.25, pstress=2.25)</span>
<span class="sd">        3.330803...</span>

<span class="sd">        On compression line:</span>

<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=2.25, pstress=2)</span>
<span class="sd">        2.64575...</span>

<span class="sd">        Normally consolidated (pstress not specified):</span>

<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=2.25)</span>
<span class="sd">        2.64575...</span>

<span class="sd">        Array inputs:</span>

<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=np.array([1.25, 2.25]), pstress=2.25)</span>
<span class="sd">        array([3.330803..., 2.64575...])</span>


<span class="sd">        Logarithmic effective stress and void ratio scales</span>
<span class="sd">        On recompression line:</span>

<span class="sd">        &gt;&gt;&gt; x, y = np.array([1,2,2.5]), np.array([4, 3.5, 2])</span>
<span class="sd">        &gt;&gt;&gt; a = PwiseLinearSoilModel(siga=x, ea=y, Cr=0.1, xlog=True, ylog=True)</span>
<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=1.25, pstress=2.25)</span>
<span class="sd">        2.76255...</span>

<span class="sd">        On compression line:</span>

<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=2.25, pstress=2)</span>
<span class="sd">        2.604857...</span>

<span class="sd">        Normally consolidated (pstress not specified):</span>

<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=2.25)</span>
<span class="sd">        2.604857...</span>

<span class="sd">        Array inputs:</span>

<span class="sd">        &gt;&gt;&gt; a.e_from_stress(estress=np.array([1.25, 2.25]), pstress=2.25)</span>
<span class="sd">        array([2.76255..., 2.604857...])</span>


<span class="sd">        Increasing vs decreasing inputs</span>

<span class="sd">        &gt;&gt;&gt; ea = np.arange(1,10)</span>
<span class="sd">        &gt;&gt;&gt; siga = 3 * ea</span>
<span class="sd">        &gt;&gt;&gt; np.isclose(PwiseLinearSoilModel(siga, ea,</span>
<span class="sd">        ... Cr=0.1).e_from_stress(7.2),</span>
<span class="sd">        ... PwiseLinearSoilModel(siga[::-1], ea[::-1],</span>
<span class="sd">        ... Cr=0.1).e_from_stress(7.2))</span>
<span class="sd">        True</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pstress</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pstress&#39;</span><span class="p">,</span> <span class="n">estress</span><span class="p">)</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span>
        <span class="n">max_past</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">pstress</span><span class="p">,</span> <span class="n">estress</span><span class="p">)</span>

        <span class="c1">#transform x data if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlog</span><span class="p">:</span>
            <span class="n">siga</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_siga</span>
            <span class="c1"># np.log10(max_past, out=max_past) # doesn&#39;t work for single values</span>
            <span class="n">max_past</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_past</span><span class="p">)</span>
            <span class="n">estress</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">estress</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">siga</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">siga</span>
        <span class="c1">#transform y data if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylog</span><span class="p">:</span>
            <span class="n">ea</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_ea</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ea</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ea</span>

        <span class="c1"># void ratio at preconsolidation pressure</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">max_past</span><span class="p">,</span> <span class="n">siga</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">siga_slice</span><span class="p">],</span> <span class="n">ea</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">siga_slice</span><span class="p">])</span>
        <span class="c1"># void ratio at current effetive stress</span>
        <span class="n">e</span> <span class="o">+=</span> <span class="n">Cr</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_past</span> <span class="o">-</span> <span class="n">estress</span><span class="p">)</span>

        <span class="c1"># transform y back if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylog</span><span class="p">:</span>
            <span class="c1"># np.power(10, e, out=e) # doesn&#39;t work for single values</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">e</span></div>

<div class="viewcode-block" id="PwiseLinearSoilModel.stress_from_e"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.PwiseLinearSoilModel.stress_from_e">[docs]</a>    <span class="k">def</span> <span class="nf">stress_from_e</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Effective stress from void ratio</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        e : float</span>
<span class="sd">            Current void ratio.</span>
<span class="sd">        pstress : float, optional</span>
<span class="sd">            Preconsolidation stress.  Default pstress=estress i.e. normally</span>
<span class="sd">            consolidated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        estress : float</span>
<span class="sd">            Effective stress corresponding to current void ratio.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        On recompression line:</span>

<span class="sd">        &gt;&gt;&gt; x, y = np.array([1,2,2.5]), np.array([4, 3.5, 2])</span>
<span class="sd">        &gt;&gt;&gt; a = PwiseLinearSoilModel(siga=x, ea=y, Cr=0.1)</span>
<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=2.8, pstress=2.25)</span>
<span class="sd">        1.75...</span>

<span class="sd">        On compression line:</span>

<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=2.65, pstress=2)</span>
<span class="sd">        2.28333...</span>

<span class="sd">        Normally consolidated (pstress not specified):</span>
<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=2.65)</span>
<span class="sd">        2.28333...</span>

<span class="sd">        Array inputs:</span>

<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=np.array([2.8, 2.65]),</span>
<span class="sd">        ... pstress=np.array([2.25, 2.0]))</span>
<span class="sd">        array([1.75..., 2.28333...])</span>


<span class="sd">        Logarithmic effective stress scale</span>
<span class="sd">        On recompression line:</span>

<span class="sd">        &gt;&gt;&gt; x, y = np.array([1,2,2.5]), np.array([4, 3.5, 2])</span>
<span class="sd">        &gt;&gt;&gt; a = PwiseLinearSoilModel(siga=x, ea=y, Cr=0.1, xlog=True)</span>
<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=2.73, pstress=2.25)</span>
<span class="sd">        1.363494...</span>

<span class="sd">        On compression line:</span>

<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=2.73, pstress=2)</span>
<span class="sd">        2.2427...</span>

<span class="sd">        Normally consolidated (pstress not specified):</span>

<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=2.73)</span>
<span class="sd">        2.2427...</span>

<span class="sd">        Array inputs:</span>

<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=2.73, pstress=np.array([2.25, 2.]))</span>
<span class="sd">        array([1.363494..., 2.2427...])</span>


<span class="sd">        Logarithmic void ratio scale</span>
<span class="sd">        On recompression line:</span>

<span class="sd">        &gt;&gt;&gt; x, y = np.array([1,2,2.5]), np.array([4, 3.5, 2])</span>
<span class="sd">        &gt;&gt;&gt; a = PwiseLinearSoilModel(siga=x, ea=y, Cr=0.1, ylog=True)</span>
<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=2.75, pstress=2.25)</span>
<span class="sd">        2.082163...</span>

<span class="sd">        On compression line:</span>

<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=2.65, pstress=2)</span>
<span class="sd">        2.24856...</span>

<span class="sd">        Normally consolidated (pstress not specified):</span>

<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=2.65)</span>
<span class="sd">        2.24856...</span>

<span class="sd">        Array inputs:</span>

<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=np.array([2.75, 2.65]),</span>
<span class="sd">        ... pstress=np.array([2.25, 2]))</span>
<span class="sd">        array([2.082163..., 2.24856...])</span>


<span class="sd">        Logarithmic effective stress and void ratio scales</span>
<span class="sd">        On recompression line:</span>

<span class="sd">        &gt;&gt;&gt; x, y = np.array([1,2,2.5]), np.array([4, 3.5, 2])</span>
<span class="sd">        &gt;&gt;&gt; a = PwiseLinearSoilModel(siga=x, ea=y, Cr=0.1, xlog=True, ylog=True)</span>
<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=2.65, pstress=2.25)</span>
<span class="sd">        1.8948013...</span>

<span class="sd">        On compression line:</span>

<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=2.65, pstress=2)</span>
<span class="sd">        2.23463...</span>

<span class="sd">        Normally consolidated (pstress not specified):</span>

<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=2.65)</span>
<span class="sd">        2.23463...</span>

<span class="sd">        Array inputs:</span>

<span class="sd">        &gt;&gt;&gt; a.stress_from_e(e=2.65, pstress=np.array([2.25, 2]))</span>
<span class="sd">        array([1.8948013..., 2.23463...])</span>


<span class="sd">        Increasing vs decreasing inputs</span>

<span class="sd">        &gt;&gt;&gt; ea = np.arange(1,10)</span>
<span class="sd">        &gt;&gt;&gt; siga = 3 * ea</span>
<span class="sd">        &gt;&gt;&gt; np.isclose(PwiseLinearSoilModel(siga, ea, Cr=0.1).stress_from_e(3.0, pstress=4.0),</span>
<span class="sd">        ... PwiseLinearSoilModel(siga[::-1], ea[::-1], Cr=0.1).stress_from_e(3.0, pstress=4.0))</span>
<span class="sd">        True</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="c1">#transform x data if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlog</span><span class="p">:</span>
            <span class="n">siga</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_siga</span>
<span class="c1">#            estress = np.log10(estress)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">siga</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">siga</span>
        <span class="c1">#transform y data if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylog</span><span class="p">:</span>
            <span class="n">ea</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_ea</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ea</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ea</span>

        <span class="n">pstress</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pstress&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>


        <span class="c1">#fact = 2.3025850929940459 # 10**(x)==exp(fact*x)</span>


        <span class="k">if</span> <span class="n">pstress</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Normally consolidated</span>
            <span class="n">estress</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">ea</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ea_slice</span><span class="p">],</span> <span class="n">siga</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ea_slice</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlog</span><span class="p">:</span>
                <span class="n">estress</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">estress</span><span class="p">)</span>
<span class="c1">#                estress *= fact</span>
<span class="c1">#                np.exp(estress, out=estress)</span>
            <span class="k">return</span> <span class="n">estress</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlog</span><span class="p">:</span>
            <span class="n">pstress</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pstress</span><span class="p">)</span>


        <span class="n">Cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span>
        <span class="c1"># void ratio at preconsolidation pressure</span>
        <span class="n">ep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">pstress</span><span class="p">,</span> <span class="n">siga</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">siga_slice</span><span class="p">],</span> <span class="n">ea</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">siga_slice</span><span class="p">])</span>

        <span class="c1"># stress change from (pstress, ep) if on pwise line</span>
        <span class="n">dp_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">ea</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ea_slice</span><span class="p">],</span> <span class="n">siga</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ea_slice</span><span class="p">])</span> <span class="o">-</span> <span class="n">pstress</span>
        <span class="c1"># stress change from (pstress, ep) if on extended Cr line</span>
        <span class="n">dpCr</span> <span class="o">=</span> <span class="p">(</span><span class="n">ep</span> <span class="o">-</span> <span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="n">Cr</span>

        <span class="c1"># effective stress at current void ratio</span>
        <span class="n">estress</span> <span class="o">=</span> <span class="n">pstress</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">dp_interp</span><span class="p">,</span> <span class="n">dpCr</span><span class="p">)</span>

        <span class="c1"># transform x back if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlog</span><span class="p">:</span>
            <span class="n">estress</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">estress</span><span class="p">)</span>

        <span class="k">return</span>  <span class="n">estress</span></div>

<div class="viewcode-block" id="PwiseLinearSoilModel.e_and_stress_for_plotting"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.PwiseLinearSoilModel.e_and_stress_for_plotting">[docs]</a>    <span class="k">def</span> <span class="nf">e_and_stress_for_plotting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Void ratio and stress values that plot the model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pstress : float, optional</span>
<span class="sd">            Preconsolidation stress.  Default behaviour is normally</span>
<span class="sd">            consolidated.</span>
<span class="sd">        npts : int, optional</span>
<span class="sd">            Number of points to return.  Default npts=100</span>
<span class="sd">        xmin, xmax : float, optional</span>
<span class="sd">            Range of x (i.e. effective stress) values from which</span>
<span class="sd">            to return points. Default minumum of model `siga`.</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        x, y : 1d ndarray</span>
<span class="sd">            `npts` stress, and void ratio values between `xmin` and `xmax`.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">npts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;npts&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">siga</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">siga</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
        <span class="n">pstress</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pstress&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e_from_stress</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pstress</span><span class="o">=</span><span class="n">pstress</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>


<div class="viewcode-block" id="PwiseLinearSoilModel.av_from_stress"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.PwiseLinearSoilModel.av_from_stress">[docs]</a>    <span class="k">def</span> <span class="nf">av_from_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estress</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Slope of void ratio from effective stress</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        estress : float</span>
<span class="sd">            Current effective stress.</span>
<span class="sd">        pstress : float, optional</span>
<span class="sd">            Preconsolidation stress.  Default pstress=estress i.e. normally</span>
<span class="sd">            consolidated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        av : float</span>
<span class="sd">            Slope of void-ratio vs effective stress plot at current stress</span>
<span class="sd">            state.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        On recompression line:</span>

<span class="sd">        &gt;&gt;&gt; x, y = np.array([1,2,2.5]), np.array([4, 3.5, 2])</span>
<span class="sd">        &gt;&gt;&gt; a = PwiseLinearSoilModel(siga=x, ea=y, Cr=0.1)</span>
<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=1.25, pstress=2.25)</span>
<span class="sd">        0.1...</span>

<span class="sd">        On compression line:</span>

<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=2.25, pstress=2)</span>
<span class="sd">        3.0...</span>

<span class="sd">        Normally consolidated (pstress not specified):</span>

<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=2.25)</span>
<span class="sd">        3.0...</span>

<span class="sd">        Array inputs:</span>

<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=np.array([1.25, 2.25]),</span>
<span class="sd">        ... pstress=np.array([2.25, 2.]))</span>
<span class="sd">        array([0.1, 3. ])</span>


<span class="sd">        Logarithmic effective stress scale</span>
<span class="sd">        On recompression line:</span>

<span class="sd">        &gt;&gt;&gt; x, y = np.array([1,2,2.5]), np.array([4, 3.5, 2])</span>
<span class="sd">        &gt;&gt;&gt; a = PwiseLinearSoilModel(siga=x, ea=y, Cr=0.1, xlog=True)</span>
<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=1.25, pstress=2.25)</span>
<span class="sd">        0.034743...</span>

<span class="sd">        On compression line:</span>

<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=2.25, pstress=2)</span>
<span class="sd">        2.987...</span>

<span class="sd">        Normally consolidated (pstress not specified):</span>

<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=2.25)</span>
<span class="sd">        2.987...</span>

<span class="sd">        Array inputs:</span>

<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=np.array([1.25, 2.25]),</span>
<span class="sd">        ... pstress=np.array([2.25, 2.]))</span>
<span class="sd">        array([0.034743..., 2.987...])</span>


<span class="sd">        Logarithmic void ratio scale</span>
<span class="sd">        On recompression line:</span>

<span class="sd">        &gt;&gt;&gt; x, y = np.array([1,2,2.5]), np.array([4, 3.5, 2])</span>
<span class="sd">        &gt;&gt;&gt; a = PwiseLinearSoilModel(siga=x, ea=y, Cr=0.1, ylog=True)</span>
<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=1.25, pstress=2.25)</span>
<span class="sd">        0.76694...</span>

<span class="sd">        On compression line:</span>

<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=2.25, pstress=2)</span>
<span class="sd">        2.9612...</span>

<span class="sd">        Normally consolidated (pstress not specified):</span>

<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=2.25)</span>
<span class="sd">        2.9612...</span>

<span class="sd">        Array inputs:</span>

<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=np.array([1.25, 2.25]), pstress=2.25)</span>
<span class="sd">        array([0.76694..., 2.9612...])</span>


<span class="sd">        Logarithmic effective stress and void ratio scales</span>
<span class="sd">        On recompression line:</span>

<span class="sd">        &gt;&gt;&gt; x, y = np.array([1,2,2.5]), np.array([4, 3.5, 2])</span>
<span class="sd">        &gt;&gt;&gt; a = PwiseLinearSoilModel(siga=x, ea=y, Cr=0.1, xlog=True, ylog=True)</span>
<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=1.25, pstress=2.25)</span>
<span class="sd">        0.2210045...</span>

<span class="sd">        On compression line:</span>

<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=2.25, pstress=2)</span>
<span class="sd">        2.9034...</span>

<span class="sd">        Normally consolidated (pstress not specified):</span>

<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=2.25)</span>
<span class="sd">        2.9034...</span>

<span class="sd">        Array inputs:</span>

<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=np.array([1.25, 2.25]), pstress=2.25)</span>
<span class="sd">        array([0.2210045..., 2.9034...])</span>


<span class="sd">        Increasing vs decreasing inputs</span>

<span class="sd">        &gt;&gt;&gt; ea = np.arange(1,10)</span>
<span class="sd">        &gt;&gt;&gt; siga = 3 * ea</span>
<span class="sd">        &gt;&gt;&gt; np.isclose(PwiseLinearSoilModel(siga, ea, Cr=0.1).av_from_stress(7.2),</span>
<span class="sd">        ... PwiseLinearSoilModel(siga[::-1], ea[::-1], Cr=0.1).av_from_stress(7.2))</span>
<span class="sd">        True</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pstress</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pstress&#39;</span><span class="p">,</span> <span class="n">estress</span><span class="p">)</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span>
        <span class="n">max_past</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">pstress</span><span class="p">,</span> <span class="n">estress</span><span class="p">)</span>

        <span class="c1">#transform x data if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlog</span><span class="p">:</span>
            <span class="n">siga</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_siga</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">siga_slice</span><span class="p">]</span>
            <span class="c1"># np.log10(max_past, out=max_past) # doesn&#39;t work for single values</span>
            <span class="n">max_past</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_past</span><span class="p">)</span>
            <span class="n">estress</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">estress</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">siga</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">siga</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">siga_slice</span><span class="p">]</span>
        <span class="c1">#transform y data if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylog</span><span class="p">:</span>
            <span class="n">ea</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_ea</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">siga_slice</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ea</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ea</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">siga_slice</span><span class="p">]</span>

        <span class="c1"># interval at preconsolidatio stress</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">siga</span><span class="p">,</span> <span class="n">max_past</span><span class="p">)</span>
        <span class="n">Cc</span> <span class="o">=</span> <span class="p">(</span><span class="n">ea</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ea</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">siga</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">siga</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="c1"># void ratio at preconsolidation pressure</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">ea</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Cc</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_past</span> <span class="o">-</span> <span class="n">siga</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="c1"># void ratio at current effetive stress</span>
        <span class="n">e</span> <span class="o">+=</span> <span class="n">Cr</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_past</span> <span class="o">-</span> <span class="n">estress</span><span class="p">)</span>

        <span class="n">Cx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">max_past</span> <span class="o">&gt;</span> <span class="n">estress</span><span class="p">,</span> <span class="n">Cr</span><span class="p">,</span> <span class="n">Cc</span><span class="p">)</span> <span class="c1"># may need float comparison</span>

        <span class="c1"># modify Cx slope for log axes</span>
        <span class="n">fact</span> <span class="o">=</span> <span class="mf">2.3025850929940459</span> <span class="c1">#fact = log(10)</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span>
        <span class="c1"># transform y back if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylog</span><span class="p">:</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">fact</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlog</span><span class="p">:</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">fact</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">estress</span><span class="p">)</span>

        <span class="n">av</span> <span class="o">=</span> <span class="n">Cx</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">dx</span>
        <span class="k">return</span> <span class="n">av</span></div></div>


<div class="viewcode-block" id="FunctionSoilModel"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.FunctionSoilModel">[docs]</a><span class="k">class</span> <span class="nc">FunctionSoilModel</span><span class="p">(</span><span class="n">OneDimensionalVoidRatioEffectiveStress</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Functional definition of void-ratio stress relationship</span>

<span class="sd">    User provides python functions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fn_e_from_stress: callable object</span>
<span class="sd">        Function to obtain void ratio from stress.  fn_e_from_stress should</span>
<span class="sd">        be the inverse function of fn_stress_from_e.</span>
<span class="sd">    fn_stress_from_e : callable object</span>
<span class="sd">        Function to obtain stress from void ratio. fn_stress_from_e should</span>
<span class="sd">        be the inverse function of fn_e_from_stress.</span>
<span class="sd">    fn_av_from_stress: callable object</span>
<span class="sd">        Function to obtain slope of void ratio-stress relationship.</span>
<span class="sd">        fn_av_from_stress should be negative the derivative of</span>
<span class="sd">        fn_e_from_stress w.r.t. stress</span>
<span class="sd">        be the inverse function of fn_k_from_e.</span>
<span class="sd">    *args, **kwargs : anything</span>
<span class="sd">        Positional and keyword arguments to be passed to the</span>
<span class="sd">        fn_e_from_stress, fn_stress_from_e, fn_av_from_stress functions.  Note</span>
<span class="sd">        that any additional args and kwargs passed to the functions will be</span>
<span class="sd">        appended to the args, and kwargs.  You may get into a mess for</span>
<span class="sd">        example with e_from_stress because normally the first postional</span>
<span class="sd">        argument passed to such fucntions is estress.  If you add your own</span>
<span class="sd">        positional arguments, then k will be after you own arguments.</span>
<span class="sd">        Just be aware that the usual way to call methods of the base object</span>
<span class="sd">        `OneDimensionalVoidRatioEffectiveStress` a single positonal arguement,</span>
<span class="sd">        e.g. estress, e, followed by any required keyword arguments.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Any function should be able to accept additonal keywords.</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; def efs(s, b=2):</span>
<span class="sd">    ...     return s * b</span>
<span class="sd">    &gt;&gt;&gt; def sfe(e, b=2):</span>
<span class="sd">    ...     return e / b</span>
<span class="sd">    &gt;&gt;&gt; def afs(s, b=2):</span>
<span class="sd">    ...     return -b</span>
<span class="sd">    &gt;&gt;&gt; a = FunctionSoilModel(efs, sfe, afs, b=5)</span>
<span class="sd">    &gt;&gt;&gt; a.e_from_stress(3)</span>
<span class="sd">    15</span>
<span class="sd">    &gt;&gt;&gt; a.stress_from_e(15)</span>
<span class="sd">    3.0</span>
<span class="sd">    &gt;&gt;&gt; a.av_from_stress(3)</span>
<span class="sd">    -5</span>

<span class="sd">    Prconsolidation stress:</span>

<span class="sd">    &gt;&gt;&gt; def efs2(s, pstress=None, b=2):</span>
<span class="sd">    ...     if pstress is None:</span>
<span class="sd">    ...         pstress=8</span>
<span class="sd">    ...     return s * b + pstress</span>
<span class="sd">    &gt;&gt;&gt; a = FunctionSoilModel(efs2, sfe, afs, b=5)</span>
<span class="sd">    &gt;&gt;&gt; a.e_from_stress(3)</span>
<span class="sd">    23</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">fn_e_from_stress</span><span class="p">,</span>
                 <span class="n">fn_stress_from_e</span><span class="p">,</span>
                 <span class="n">fn_av_from_stress</span><span class="p">,</span>
                 <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fn_e_from_stress</span> <span class="o">=</span> <span class="n">fn_e_from_stress</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn_stress_from_e</span> <span class="o">=</span> <span class="n">fn_stress_from_e</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn_av_from_stress</span> <span class="o">=</span> <span class="n">fn_av_from_stress</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">e_from_stress</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">fn_e_from_stress</span><span class="p">,</span>
                                               <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                                               <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stress_from_e</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">fn_stress_from_e</span><span class="p">,</span>
                                               <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                                               <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">av_from_stress</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">fn_av_from_stress</span><span class="p">,</span>
                                               <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                                               <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span></div>


<div class="viewcode-block" id="YinAndGrahamSoilModel"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.YinAndGrahamSoilModel">[docs]</a><span class="k">class</span> <span class="nc">YinAndGrahamSoilModel</span><span class="p">(</span><span class="n">OneDimensionalVoidRatioEffectiveStress</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Yin and Graham creep void ratio-effective stress realationship</span>

<span class="sd">    This model uses the integral void ratio form of the Yin and</span>
<span class="sd">    Graham (1996) [1]_ soil model as described by Hu et al. (2014) [2]_.</span>
<span class="sd">    Basically you step through time keeping track of the stress state and</span>
<span class="sd">    a cumulatlive integral representing creep strain.</span>



<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lam : float</span>
<span class="sd">        Compressibility index, slope of the referece time line</span>
<span class="sd">        e-ln(sig) line.</span>
<span class="sd">    kap : float</span>
<span class="sd">        Recompression index, slope of e-ln(sig) line.</span>
<span class="sd">    psi : float</span>
<span class="sd">        Creep parameter.  Slope of the void ratio-ln(time) line.</span>
<span class="sd">    siga, ea : float</span>
<span class="sd">        Point on reference time line fixing it in effective</span>
<span class="sd">        stress-void ratio space.</span>
<span class="sd">    ta : float</span>
<span class="sd">        Reference time corresponding to the reference time line.</span>
<span class="sd">    e0 : float, optional</span>
<span class="sd">        Initial void ratio. Default e0=None.</span>
<span class="sd">        If specifying initial conditions then only use two of the four</span>
<span class="sd">        available (e0, estress0, pstress0, t0).</span>
<span class="sd">    estress0 : float, optional</span>
<span class="sd">        Initial effective stress. Default estress=None.</span>
<span class="sd">        If specifying initial conditions then only use two of the four</span>
<span class="sd">        available (e0, estress0, pstress0, t0).</span>
<span class="sd">    pstress0 : float, optional</span>
<span class="sd">        Initial &#39;preconsolidation` stress on the reference time line.</span>
<span class="sd">        Default pstress0=None.</span>
<span class="sd">        If specifying initial conditions then only use two of the four</span>
<span class="sd">        available (e0, estress0, pstress0, t0).</span>
<span class="sd">    t0 : float, optional</span>
<span class="sd">        Initial equivalent time at the initial conditon. Default t0=None.</span>
<span class="sd">        If specifying initial conditions then only use two of the four</span>
<span class="sd">        available (e0, estress0, pstress0, t0).</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    _alpha : float</span>
<span class="sd">        Composite material parameter (lam - kap / psi)</span>
<span class="sd">    _psi_zero_model : CcCrSoilModel</span>
<span class="sd">        soil model when psi=0.  i.e. CcCrSoilModel following instant time line</span>
<span class="sd">        and reference time line.</span>
<span class="sd">    _igral : float</span>
<span class="sd">        Current value of the material model integration w.r.t. time.</span>
<span class="sd">        _igral = integrate[1/t0 * (estress/etress0)**alpha, t,0,t]</span>
<span class="sd">    _inc : float</span>
<span class="sd">        Increment to add to _igral.  Helper array to speed up stress_from_e.</span>
<span class="sd">        Only present after initial conditions have been initialized.</span>
<span class="sd">        _inc = integrate[1/t0 * (estress/etress0)**alpha, t,(t),(t + dt)]</span>
<span class="sd">    _es : float</span>
<span class="sd">        Temp effectve stress.  Helper array to speed up stress_from_e calc.</span>
<span class="sd">        Only present after initial conditions have been initialized.</span>
<span class="sd">    _estress : float</span>
<span class="sd">        Current value of effective stress.  Only present after initial</span>
<span class="sd">        conditions have been initialized.  Basically when you call</span>
<span class="sd">        method e_from_stress or method stress_from_e with parameter dt, then</span>
<span class="sd">        _estress and _igral correspond to effective stress and the time</span>
<span class="sd">        integral at the start of the increment; the integration increment</span>
<span class="sd">        _inc will be calculated and then _igral and _estress will be</span>
<span class="sd">        updated to reflect values at the end of dt time increment.</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Combos of initial conditions give the same results</span>

<span class="sd">    &gt;&gt;&gt; fixed_param = dict(lam=0.2, kap=0.04, psi=0.01, siga=20, ea=1, ta=1)</span>
<span class="sd">    &gt;&gt;&gt; oparam = dict(e0=0.95, estress0=18, pstress0=28.06637954,</span>
<span class="sd">    ... t0=1220.73731)</span>
<span class="sd">    &gt;&gt;&gt; a = YinAndGrahamSoilModel(e0=oparam[&#39;e0&#39;],</span>
<span class="sd">    ... estress0=oparam[&#39;estress0&#39;], **fixed_param)</span>
<span class="sd">    &gt;&gt;&gt; [a.e0, a.estress0, a.pstress0, a.t0]</span>
<span class="sd">    [0.95..., 18..., 28.0..., 1220.737...]</span>
<span class="sd">    &gt;&gt;&gt; a = YinAndGrahamSoilModel(e0=oparam[&#39;e0&#39;],</span>
<span class="sd">    ... pstress0=oparam[&#39;pstress0&#39;], **fixed_param)</span>
<span class="sd">    &gt;&gt;&gt; [a.e0, a.estress0, a.pstress0, a.t0]</span>
<span class="sd">    [0.95..., 18..., 28.0..., 1220.737...]</span>
<span class="sd">    &gt;&gt;&gt; a = YinAndGrahamSoilModel(e0=oparam[&#39;e0&#39;],</span>
<span class="sd">    ... t0=oparam[&#39;t0&#39;], **fixed_param)</span>
<span class="sd">    &gt;&gt;&gt; [a.e0, a.estress0, a.pstress0, a.t0]</span>
<span class="sd">    [0.95..., 18..., 28.0..., 1220.737...]</span>
<span class="sd">    &gt;&gt;&gt; a = YinAndGrahamSoilModel(estress0=oparam[&#39;estress0&#39;],</span>
<span class="sd">    ... pstress0=oparam[&#39;pstress0&#39;], **fixed_param)</span>
<span class="sd">    &gt;&gt;&gt; [a.e0, a.estress0, a.pstress0, a.t0]</span>
<span class="sd">    [0.95..., 18..., 28.0..., 1220.737...]</span>
<span class="sd">    &gt;&gt;&gt; a = YinAndGrahamSoilModel(estress0=oparam[&#39;estress0&#39;],</span>
<span class="sd">    ... t0=oparam[&#39;t0&#39;], **fixed_param)</span>
<span class="sd">    &gt;&gt;&gt; [a.e0, a.estress0, a.pstress0, a.t0]</span>
<span class="sd">    [0.95..., 18..., 28.0..., 1220.737...]</span>
<span class="sd">    &gt;&gt;&gt; a = YinAndGrahamSoilModel(pstress0=oparam[&#39;pstress0&#39;],</span>
<span class="sd">    ... t0=oparam[&#39;t0&#39;], **fixed_param)</span>
<span class="sd">    &gt;&gt;&gt; [a.e0, a.estress0, a.pstress0, a.t0]</span>
<span class="sd">    [0.95..., 18..., 28.0..., 1220.737...]</span>


<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Yin, J.-H., and Graham, J. (1996). &#39;Elastic visco-plastic modelling</span>
<span class="sd">           of one-dimensional consolidation. Geotechnique, 46(3), 515-527.</span>

<span class="sd">    .. [2] Hu, Y.-Y., Zhou, W.-H., and Cai, Y.-Q. (2014).</span>
<span class="sd">           &#39;Large-strain elastic viscoplastic consolidation analysis of very</span>
<span class="sd">           soft clay layers with vertical drains under preloading.</span>
<span class="sd">           Canadian Geotechnical Journal, 51(2), 144-157.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    The void ratio stress relationship is:</span>

<span class="sd">        .. math::</span>

<span class="sd">           e=e0-\\kappa\\ln\\left({\\frac{\\sigma^{\\prime}_z}{\\sigma^{\\prime}_{z}}}\\right)</span>
<span class="sd">             -\\psi\\ln\\left[{</span>
<span class="sd">               \\int_{0}^{t}{</span>
<span class="sd">                 \\frac{1}{t_0}</span>
<span class="sd">                 \\left({</span>
<span class="sd">                   \\frac{\\sigma^{\\prime}_z}</span>
<span class="sd">                   {\\sigma^{\\prime}_{0}}}\\right)^{\\alpha}\\,dt</span>
<span class="sd">                             }+1</span>
<span class="sd">                           }\\right]</span>

<span class="sd">        To calculate the integral we keep track of the effective stress and</span>
<span class="sd">        the integration at time t</span>
<span class="sd">        and then add the integration increment between :math:`t` and</span>
<span class="sd">        :math:`t+\\bigtriangleup t`:</span>

<span class="sd">        .. math::</span>

<span class="sd">           e=e0-\\kappa\\ln\\left({\\frac{\\sigma^{\\prime}_{z,t+\\bigtriangleup t}}{\\sigma^{\\prime}_{z}}}\\right)</span>
<span class="sd">             -\\psi\\ln\\left[{</span>
<span class="sd">               \\int_{0}^{t}{</span>
<span class="sd">                 \\frac{1}{t_0}</span>
<span class="sd">                 \\left({</span>
<span class="sd">                   \\frac{\\sigma^{\\prime}_z}</span>
<span class="sd">                   {\\sigma^{\\prime}_{0}}}\\right)^{\\alpha}\\,dt</span>
<span class="sd">                             }</span>
<span class="sd">               +</span>
<span class="sd">               \\int_{t}^{t+\\bigtriangleup t}{</span>
<span class="sd">                 \\frac{1}{t_0}</span>
<span class="sd">                 \\left({</span>
<span class="sd">                   \\frac{\\sigma^{\\prime}_z}</span>
<span class="sd">                   {\\sigma^{\\prime}_{0}}}\\right)^{\\alpha}\\,dt</span>
<span class="sd">                             }</span>
<span class="sd">                             +1}\\right]</span>


<span class="sd">        Consider a time increment of length :math:`\\bigtriangleup t` in which</span>
<span class="sd">        the effective stress changes from :math:`\\sigma^{\\prime}_{t}`</span>
<span class="sd">        to :math:`\\sigma^{\\prime}_{t + \\bigtriangleup t}`.  Assume</span>
<span class="sd">        that the stress changes in a linear fashion over</span>
<span class="sd">        :math:`\\bigtriangleup t`:</span>

<span class="sd">        .. math::</span>

<span class="sd">            \\sigma^{\\prime}\\left({t}\\right) =</span>
<span class="sd">              \\sigma^{\\prime}_{t} + t</span>
<span class="sd">              \\frac{\\sigma^{\\prime}_{t+ \\bigtriangleup t}</span>
<span class="sd">                     -\\sigma^{\\prime}_{t}}</span>
<span class="sd">                    {\\bigtriangleup t}</span>



<span class="sd">        The time integral becomes:</span>


<span class="sd">        .. math::</span>

<span class="sd">           \\frac{1}{t_0}\\int_{0}^{t}{</span>
<span class="sd">                 \\left({</span>
<span class="sd">                   \\frac{\\sigma^{\\prime}_z}</span>
<span class="sd">                   {\\sigma^{\\prime}_{z0}}}\\right)^{\\alpha}\\,dt                             }</span>
<span class="sd">                   + \\frac{1}{t_0}\\int_{0}^{\\bigtriangleup t}</span>
<span class="sd">                   {\\left({\\frac{\\sigma^{\\prime}_{t} + t</span>
<span class="sd">              \\frac{\\sigma^{\\prime}_{t+ \\bigtriangleup t}</span>
<span class="sd">                     -\\sigma^{\\prime}_{t}}</span>
<span class="sd">                    {\\bigtriangleup t}}{\\sigma^{\\prime}_0}}\\right)^\\alpha\\,dt}</span>



<span class="sd">        The increment that is added to the main integral is:</span>


<span class="sd">        .. math::</span>

<span class="sd">           \\frac{1}{t_0}\\int_{0}^{\\bigtriangleup t}</span>
<span class="sd">                   {\\left({\\frac{\\sigma^{\\prime}_{t} + t</span>
<span class="sd">              \\frac{\\sigma^{\\prime}_{t+ \\bigtriangleup t}</span>
<span class="sd">                     -\\sigma^{\\prime}_{t}}</span>
<span class="sd">                    {\\bigtriangleup t}}{\\sigma^{\\prime}_0}}\\right)^\\alpha\\,dt}</span>
<span class="sd">           =</span>
<span class="sd">           \\frac{1}{t_0}</span>
<span class="sd">           \\frac{\\sigma^{\\prime}_{0} \\bigtriangleup t}</span>
<span class="sd">                 {\\left({\\alpha+1}\\right)</span>
<span class="sd">                  \\left({\\sigma^{\\prime}_{t+ \\bigtriangleup t}</span>
<span class="sd">                     -\\sigma^{\\prime}_{t}}\\right)}</span>
<span class="sd">           \\left({</span>
<span class="sd">                   \\left({\\frac{\\sigma^{\\prime}_{t+ \\bigtriangleup t}}{\\sigma^{\\prime}_0}}\\right)^{\\alpha+1}-</span>
<span class="sd">                   \\left({\\frac{\\sigma^{\\prime}_{t}}{\\sigma^{\\prime}_0}}\\right)^{\\alpha+1}</span>
<span class="sd">                   }\\right)</span>

<span class="sd">        When :math:`\\sigma^{\\prime}_{t+ \\bigtriangleup t}=\\sigma^{\\prime}_{t}`</span>
<span class="sd">        then the increment is:</span>

<span class="sd">        .. math::</span>

<span class="sd">           \\frac{1}{t_0}\\int_{0}^{\\bigtriangleup t}</span>
<span class="sd">                   {\\left({\\frac{\\sigma^{\\prime}_{t} + t</span>
<span class="sd">              \\frac{\\sigma^{\\prime}_{t+ \\bigtriangleup t}</span>
<span class="sd">                     -\\sigma^{\\prime}_{t}}</span>
<span class="sd">                    {\\bigtriangleup t}}{\\sigma^{\\prime}_0}}\\right)^\\alpha\\,dt}</span>
<span class="sd">           =</span>
<span class="sd">           \\frac{1}{t_0}\\bigtriangleup t</span>
<span class="sd">           \\left({\\frac{\\sigma^{\\prime}_{t}}{\\sigma^{\\prime}_0}}\\right)^{\\alpha+1}</span>

<span class="sd">        The value of the integral and the effective stress is stored</span>
<span class="sd">        within the YinAndGrahamSoilModel object and updated after each call</span>
<span class="sd">        to `e_from_stress` or `stress_from_e`.</span>

<span class="sd">        **e_from_stress**</span>

<span class="sd">        `e_from_stress` uses the above equations directly (knowing all</span>
<span class="sd">        material parameters, the value of the integral at the start of the</span>
<span class="sd">        increment, and the efffective stresses at the beginning and end of</span>
<span class="sd">        time incremetn dt, then e can be calculated directly).</span>

<span class="sd">        **stress_from_e**</span>

<span class="sd">        `stress_from_e`  recasts the equations as estress=f(estress)</span>
<span class="sd">        and uses fixed point iteration to determine the effective stress</span>
<span class="sd">        at the end of the increment.</span>

<span class="sd">        **initial_conditions**</span>

<span class="sd">        If two of the following four parameters describing the intial state</span>
<span class="sd">        of the soil are known, then the equations below can be combined to</span>
<span class="sd">        solve for the remaining two unknowns:</span>
<span class="sd">        initial void ratio :math:`e_0`, initial stress</span>
<span class="sd">        :math:`\\sigma^{\\prime}_0`, pseudo initial preconsolidation stress</span>
<span class="sd">        :math:`\\sigma^{\\prime}_p` and equivalent time corresponding to</span>
<span class="sd">        initial state :math:`t_0`.</span>


<span class="sd">        On the reference time line running through point</span>
<span class="sd">        :math:`(\\sigma^{\\prime}_a, e_a)`, the psuedo preconsolidation</span>
<span class="sd">        pressure :math:`\\sigma^{\\prime}_p` corresponds to void ratio</span>
<span class="sd">        :math:`e_p`:</span>

<span class="sd">        .. math::</span>

<span class="sd">           e_p = e_a - \\lambda</span>
<span class="sd">              \\ln\\left({</span>
<span class="sd">                            \\frac{\\sigma^{\\prime}_p}</span>
<span class="sd">                                  {\\sigma^{\\prime}_a}</span>
<span class="sd">                            }\\right)</span>


<span class="sd">        The instant time line running through point</span>
<span class="sd">        :math:`(\\sigma^{\\prime}_0, e_0)` meets the reference time line at</span>
<span class="sd">        :math:`\\sigma^{\\prime}_p` and void ratio :math:`e_p`:</span>

<span class="sd">        .. math::</span>

<span class="sd">            e_p = e_0 - \\kappa</span>
<span class="sd">              \\ln\\left({</span>
<span class="sd">                            \\frac{\\sigma^{\\prime}_p}</span>
<span class="sd">                                  {\\sigma^{\\prime}_0}</span>
<span class="sd">                            }\\right)</span>



<span class="sd">        The initial state :math:`(\\sigma^{\\prime}_0, e_0)` can be reached</span>
<span class="sd">        from the reference time line by either a) loading</span>
<span class="sd">        to :math:`\\sigma^{\\prime}_p` and then unloading to</span>
<span class="sd">        :math:`\\sigma^{\\prime}_0`  or b) creeping from time :math:`t_a` to</span>
<span class="sd">        time :math:`t_0` at constant stress :math:`\\sigma^{\\prime}_0`.</span>
<span class="sd">        equating the two void ratio changes gives:</span>

<span class="sd">        .. math::</span>

<span class="sd">           \\left({\\lambda-\\kappa}\\right)</span>
<span class="sd">             \\ln\\left({</span>
<span class="sd">                         \\frac{\\sigma^{\\prime}_p}{\\sigma^{\\prime}_0}</span>
<span class="sd">                        }\\right)</span>
<span class="sd">           = \\psi</span>
<span class="sd">             \\ln\\left({</span>
<span class="sd">                         \\frac{t_0}{t_a}</span>
<span class="sd">                        }\\right)</span>

<span class="sd">        YinAndGrahamSoilModel()</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">siga</span><span class="p">,</span> <span class="n">ea</span><span class="p">,</span> <span class="n">ta</span><span class="p">,</span>
                 <span class="n">e0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">estress0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pstress0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lam</span> <span class="o">=</span> <span class="n">lam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kap</span> <span class="o">=</span> <span class="n">kap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="n">psi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">siga</span> <span class="o">=</span> <span class="n">siga</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea</span> <span class="o">=</span> <span class="n">ea</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ta</span> <span class="o">=</span> <span class="n">ta</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lam</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">kap</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_psi_zero_model</span> <span class="o">=</span> <span class="n">CcCrSoilModel</span><span class="p">(</span><span class="n">Cc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lam</span><span class="p">,</span>
                                             <span class="n">Cr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">kap</span><span class="p">,</span>
                                             <span class="n">siga</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">siga</span><span class="p">,</span>
                                             <span class="n">ea</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ea</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">e0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstress0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions</span><span class="p">(</span><span class="n">e0</span><span class="o">=</span><span class="n">e0</span><span class="p">,</span>
                                    <span class="n">estress0</span><span class="o">=</span><span class="n">estress0</span><span class="p">,</span>
                                    <span class="n">pstress0</span><span class="o">=</span><span class="n">pstress0</span><span class="p">,</span>
                                    <span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_igral</span> <span class="o">=</span> <span class="mi">0</span><span class="c1">#np.zeros(len(np.asarray(self.e0)), dtype=float)</span>



<div class="viewcode-block" id="YinAndGrahamSoilModel.initial_conditions"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.YinAndGrahamSoilModel.initial_conditions">[docs]</a>    <span class="k">def</span> <span class="nf">initial_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">estress0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pstress0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the initial conditions</span>

<span class="sd">        Only use two of the parameters, the other two will be calculated.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        e0 : float, optional</span>
<span class="sd">            Initial void ratio. Default e0=None.</span>
<span class="sd">            If specifying initial conditions then only use two of the four</span>
<span class="sd">            available (e0, estress0, pstress0, t0).</span>
<span class="sd">        estress0 : float, optional</span>
<span class="sd">            Initial effective stress. Default estress=None.</span>
<span class="sd">            If specifying initial conditions then only use two of the four</span>
<span class="sd">            available (e0, estress0, pstress0, t0).</span>
<span class="sd">        pstress0 : float, optional</span>
<span class="sd">            Initial &#39;preconsolidation` stress on the reference time line.</span>
<span class="sd">            Default pstress0=None.</span>
<span class="sd">            If specifying initial conditions then only use two of the four</span>
<span class="sd">            available (e0, estress0, pstress0, t0).</span>
<span class="sd">        t0 : float, optional</span>
<span class="sd">            Initial equivalent time at the initial conditon. Default t0=None.</span>
<span class="sd">            If specifying initial conditions then only use two of the four</span>
<span class="sd">            available (e0, estress0, pstress0, t0).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        e0 : float</span>
<span class="sd">            Initial void ratio</span>
<span class="sd">        estress0 : float</span>
<span class="sd">            Initial effective stress</span>
<span class="sd">        pstress0 : float</span>
<span class="sd">            Inital preconsolidation stress</span>
<span class="sd">        t0 : float</span>
<span class="sd">            Initial equivalent time.</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">d</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;e0&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">e0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;e0&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">e0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;estress0&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">estress0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;estress0&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">estress0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;pstress0&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pstress0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;pstress0&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pstress0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">t0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">t0</span>
<span class="c1">#        d = dict(e0=e0, estress0=estress0, pstress0=pstress0, t0=t0)</span>
        <span class="n">ic_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;e0&#39;</span><span class="p">,</span> <span class="s1">&#39;estress0&#39;</span><span class="p">,</span> <span class="s1">&#39;pstress0&#39;</span><span class="p">,</span><span class="s1">&#39;t0&#39;</span><span class="p">]</span>
        <span class="n">ic_given</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ic_list</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ic_given</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="c1">#no initial conditions set</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ic_given</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="c1">#2 of the 4 initial condition parameters are given, calc the others</span>
            <span class="n">e0</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;e0&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">estress0</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;estress0&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">pstress0</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pstress0&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">ea</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ea</span>
            <span class="n">siga</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">siga</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span>
            <span class="n">kap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kap</span>
            <span class="n">lam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lam</span>
            <span class="n">psi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi</span>
            <span class="n">ta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ta</span>
            <span class="k">if</span> <span class="n">ic_given</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;e0&#39;</span><span class="p">,</span> <span class="s1">&#39;estress0&#39;</span><span class="p">]:</span>
                <span class="n">numer</span> <span class="o">=</span> <span class="p">(</span><span class="n">ea</span> <span class="o">-</span> <span class="n">e0</span> <span class="o">-</span> <span class="n">kap</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">estress0</span><span class="p">)</span> <span class="o">+</span> <span class="n">lam</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">siga</span><span class="p">))</span>
                <span class="n">denom</span> <span class="o">=</span> <span class="p">(</span><span class="n">lam</span> <span class="o">-</span> <span class="n">kap</span><span class="p">)</span>
                <span class="n">pstress0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">numer</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span>
                <span class="n">t0</span> <span class="o">=</span> <span class="p">(</span><span class="n">pstress0</span> <span class="o">/</span> <span class="n">estress0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">ta</span>
            <span class="k">elif</span> <span class="n">ic_given</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;e0&#39;</span><span class="p">,</span> <span class="s1">&#39;pstress0&#39;</span><span class="p">]:</span>
                <span class="n">numer</span> <span class="o">=</span> <span class="p">(</span><span class="n">ea</span> <span class="o">-</span> <span class="n">e0</span><span class="o">-</span> <span class="p">(</span><span class="n">lam</span><span class="o">-</span><span class="n">kap</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pstress0</span><span class="p">)</span> <span class="o">+</span> <span class="n">lam</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">siga</span><span class="p">))</span>
                <span class="n">denom</span> <span class="o">=</span> <span class="p">(</span><span class="n">kap</span><span class="p">)</span>
                <span class="n">estress0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">numer</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span>
                <span class="n">t0</span> <span class="o">=</span> <span class="p">(</span><span class="n">pstress0</span> <span class="o">/</span> <span class="n">estress0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">ta</span>
            <span class="k">elif</span> <span class="n">ic_given</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;e0&#39;</span><span class="p">,</span> <span class="s1">&#39;t0&#39;</span><span class="p">]:</span>
                <span class="n">OCR</span> <span class="o">=</span> <span class="p">(</span><span class="n">t0</span><span class="o">/</span><span class="n">ta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">alpha</span><span class="p">)</span>
                <span class="n">numer</span> <span class="o">=</span> <span class="p">(</span><span class="n">ea</span> <span class="o">-</span> <span class="n">e0</span> <span class="o">+</span> <span class="n">lam</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">siga</span><span class="p">)</span> <span class="o">+</span> <span class="n">kap</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">OCR</span><span class="p">))</span>
                <span class="n">denom</span> <span class="o">=</span> <span class="p">(</span><span class="n">lam</span><span class="p">)</span>
                <span class="n">pstress0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">numer</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span>
                <span class="n">estress0</span> <span class="o">=</span> <span class="n">pstress0</span> <span class="o">/</span> <span class="n">OCR</span>
            <span class="k">elif</span> <span class="n">ic_given</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;estress0&#39;</span><span class="p">,</span> <span class="s1">&#39;pstress0&#39;</span><span class="p">]:</span>
                <span class="n">OCR</span> <span class="o">=</span> <span class="n">pstress0</span> <span class="o">/</span> <span class="n">estress0</span>
                <span class="n">t0</span> <span class="o">=</span> <span class="p">(</span><span class="n">OCR</span><span class="p">)</span><span class="o">**</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">ta</span>
                <span class="n">e0</span> <span class="o">=</span> <span class="p">(</span><span class="n">ea</span> <span class="o">-</span> <span class="n">lam</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pstress0</span> <span class="o">/</span> <span class="n">siga</span><span class="p">)</span>
                      <span class="o">+</span> <span class="n">kap</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">OCR</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">ic_given</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;estress0&#39;</span><span class="p">,</span> <span class="s1">&#39;t0&#39;</span><span class="p">]:</span>
                <span class="n">OCR</span> <span class="o">=</span> <span class="p">(</span><span class="n">t0</span><span class="o">/</span><span class="n">ta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">alpha</span><span class="p">)</span>
                <span class="n">pstress0</span> <span class="o">=</span> <span class="n">OCR</span> <span class="o">*</span> <span class="n">estress0</span>
                <span class="n">e0</span> <span class="o">=</span> <span class="n">ea</span> <span class="o">-</span> <span class="n">lam</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pstress0</span> <span class="o">/</span> <span class="n">siga</span><span class="p">)</span> <span class="o">+</span> <span class="n">kap</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">OCR</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ic_given</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;pstress0&#39;</span><span class="p">,</span> <span class="s1">&#39;t0&#39;</span><span class="p">]:</span>
                <span class="n">OCR</span> <span class="o">=</span> <span class="p">(</span><span class="n">t0</span><span class="o">/</span><span class="n">ta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">alpha</span><span class="p">)</span>
                <span class="n">estress0</span> <span class="o">=</span> <span class="n">pstress0</span> <span class="o">/</span> <span class="n">OCR</span>
                <span class="n">e0</span> <span class="o">=</span> <span class="p">(</span><span class="n">ea</span> <span class="o">-</span> <span class="n">lam</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pstress0</span> <span class="o">/</span> <span class="n">siga</span><span class="p">)</span>
                      <span class="o">+</span> <span class="n">kap</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">OCR</span><span class="p">))</span>

            <span class="c1">#make some temp arrays to speed calcs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">estress0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_es</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">estress0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_estress</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">estress0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_es</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_es</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_estress</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_estress</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_estress</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">estress0</span>

            <span class="k">return</span> <span class="n">e0</span><span class="p">,</span> <span class="n">estress0</span><span class="p">,</span> <span class="n">pstress0</span><span class="p">,</span> <span class="n">t0</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="c1">#too many initial conditoin parameters given.</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If specifying initial conditions (</span><span class="si">{}</span><span class="s2">) then only &quot;</span>
                    <span class="s2">&quot;two and only two can be specified.  &quot;</span>
                    <span class="s2">&quot;You have </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ic_list</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ic_given</span><span class="p">)))</span></div>




<div class="viewcode-block" id="YinAndGrahamSoilModel.e_from_stress"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.YinAndGrahamSoilModel.e_from_stress">[docs]</a>    <span class="k">def</span> <span class="nf">e_from_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estress</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Void ratio from effective stress</span>

<span class="sd">        When dt is None then then self.e0, self.estress0, self.t0 and</span>
<span class="sd">        self.pstress0 will be initialized from estress and pstress; self.e0</span>
<span class="sd">        will be returned.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        estress : float</span>
<span class="sd">            Current effective stress. estress is assumed to be the effective</span>
<span class="sd">            stress at the end of an increment of length dt. i.e. at time t+dt.</span>
<span class="sd">        dt : float, optional</span>
<span class="sd">            Time increment. Default dt=None.  When dt is None, the void</span>
<span class="sd">            ratio is calculted assuming psi=0.  i.e. along the instant</span>
<span class="sd">            time line and then down the reference time line.</span>
<span class="sd">        pstress : float, optional</span>
<span class="sd">            Preconsolidation stress.  This is only relevant if dt is not None.</span>
<span class="sd">            Default pstress=estress i.e. on the reference time line.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        e : float</span>
<span class="sd">            Void ratio corresponding to current stress state.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        self._igral and self._estress and self._inc will be updated!</span>



<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">pstress</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pstress&#39;</span><span class="p">,</span> <span class="n">estress</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># assume calculating initial conditions from stress state</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstress0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions</span><span class="p">(</span><span class="n">estress0</span><span class="o">=</span><span class="n">estress</span><span class="p">,</span> <span class="n">pstress0</span><span class="o">=</span><span class="n">pstress</span><span class="p">))</span>
<span class="c1">#            e = self._psi_zero_model.e_from_stress(estress, pstress)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">e0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># estress is assumed to be the effective stress at the end</span>
            <span class="c1"># of an increment of length dt.</span>
            <span class="n">e0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e0</span>
            <span class="n">kap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kap</span>
            <span class="n">lam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lam</span>
            <span class="n">psi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi</span>
            <span class="n">estress0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_inc_from_stress</span><span class="p">(</span><span class="n">estress</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_igral</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_estress</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">estress</span>


<span class="c1">#            inc = dt/self.t0 * (estress / estress0) ** self._alpha</span>
<span class="c1">#            self._igral += inc</span>
            <span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="n">e0</span> <span class="o">-</span> <span class="n">kap</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">estress</span> <span class="o">/</span> <span class="n">estress0</span><span class="p">)</span>
                 <span class="o">-</span> <span class="n">psi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_igral</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">e</span></div>

    <span class="k">def</span> <span class="nf">_reset_to_initial_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset parameters to initial conditions&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_igral</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_estress</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span>

    <span class="k">def</span> <span class="nf">_inc_from_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estress</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Integration increment</span>

<span class="sd">        As well as returning the integration increment self._inc will be updated.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        estress : 1d array of float</span>
<span class="sd">            effective stress at end of dt increment.</span>
<span class="sd">        dt : float</span>
<span class="sd">            Lenght of time increment</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        inc : 1darray of float</span>
<span class="sd">            Integration increment.</span>


<span class="sd">        Stress is assumed to vary from self._estress to estress over</span>
<span class="sd">        a time incrementn dt.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        self._inc will be updated!</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span> <span class="o">/=</span> <span class="p">(</span><span class="n">estress</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estress</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span> <span class="o">*=</span> <span class="p">((</span><span class="n">estress</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                      <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_estress</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="p">)</span>

        <span class="c1"># Following expression gives errors when t0, estress0 or _estress are</span>
        <span class="c1"># not arrays so I did it differently (may be slower):</span>
        <span class="c1"># self._inc[nans] = dt / self.t0[nans] * (self._estress[nans] / self.estress0[nans]) ** (self._alpha + 1)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_estress</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="p">[</span><span class="n">nans</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estress</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="p">[</span><span class="n">nans</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estress</span><span class="p">[</span><span class="n">nans</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estress0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="p">[</span><span class="n">nans</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="p">[</span><span class="n">nans</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span><span class="p">[</span><span class="n">nans</span><span class="p">]</span>

        <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="p">[</span><span class="n">nans</span><span class="p">],(</span><span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span><span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="p">[</span><span class="n">nans</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="p">[</span><span class="n">nans</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="p">[</span><span class="n">nans</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0</span><span class="p">[</span><span class="n">nans</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span>



<div class="viewcode-block" id="YinAndGrahamSoilModel.stress_from_e"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.YinAndGrahamSoilModel.stress_from_e">[docs]</a>    <span class="k">def</span> <span class="nf">stress_from_e</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Effective stress from void ratio</span>

<span class="sd">        If `stress_from_e` is called when self.estress0 is not initialized</span>
<span class="sd">        then the initial conditions will be initialized assumming the</span>
<span class="sd">        stress state is on the reference time line.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        e : float</span>
<span class="sd">            Current void ratio.  e is assumed to be the effective</span>
<span class="sd">            stress at the end of an increment of length dt. i.e. at time t+dt.</span>
<span class="sd">        dt : float, optional</span>
<span class="sd">            Time increment. Default dt=0.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        estress : float</span>
<span class="sd">            Effective stress corresponding to current void ratio.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        self._igral and self._estress and self._inc will be updated!</span>


<span class="sd">        &quot;&quot;&quot;</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># estress is on reference line</span>
            <span class="c1"># assume calculating initial conditions from void ratio state</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstress0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions</span><span class="p">(</span><span class="n">e0</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ta</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span>


        <span class="n">dt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">fn</span><span class="p">(</span><span class="n">estress</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inc_from_stress</span><span class="p">(</span><span class="n">estress</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_es</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_es</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_es</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_igral</span>
            <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_es</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_es</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_es</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi</span>
            <span class="n">np</span><span class="o">.</span><span class="n">negative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_es</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_es</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_es</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_es</span> <span class="o">-=</span> <span class="n">e</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_es</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kap</span>
            <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_es</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_es</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_es</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span>


            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_es</span>
<span class="c1">#        fn(0)</span>
<span class="c1">#        self._es *= 0.95</span>
        <span class="n">fixed_point</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estress</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

        <span class="c1">#update the properties at end of dt time increment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_igral</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_estress</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_es</span>

        <span class="k">return</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_es</span></div>


<span class="c1">#    def e_and_stress_for_plotting(self, **kwargs):</span>
<span class="c1">#        &quot;&quot;&quot;Void ratio and stress values that plot the model</span>
<span class="c1">#</span>
<span class="c1">#        Parameters</span>
<span class="c1">#        ----------</span>
<span class="c1">#        pstress : float, optional</span>
<span class="c1">#            Preconsolidation stress.  Default behaviour is normally</span>
<span class="c1">#            consolidated.</span>
<span class="c1">#        npts : int, optional</span>
<span class="c1">#            Number of points to return.  Default npts=100.</span>
<span class="c1">#        xmin, xmax : float, optional</span>
<span class="c1">#            range of x (i.e. effective stress) values from which</span>
<span class="c1">#            to return points. Default xmin=1, xmax=100</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#        Returns</span>
<span class="c1">#        -------</span>
<span class="c1">#        x, y : 1d ndarray</span>
<span class="c1">#            `npts` stress, and void ratio values between `xmin` and `xmax`.</span>
<span class="c1">#</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#</span>
<span class="c1">#        npts = kwargs.get(&#39;npts&#39;, 100)</span>
<span class="c1">#        xmin, xmax = kwargs.get(&#39;xmin&#39;, 1.0), kwargs.get(&#39;xmax&#39;, 100)</span>
<span class="c1">#</span>
<span class="c1">#        x = np.linspace(xmin, xmax, npts)</span>
<span class="c1">#        pstress = kwargs.get(&#39;pstress&#39;, x)</span>
<span class="c1">#        i = np.searchsorted(x, pstress)</span>
<span class="c1">#        x[i] = pstress</span>
<span class="c1">#        y = self.e_from_stress(x, pstress=pstress)</span>
<span class="c1">#</span>
<span class="c1">#        return x, y</span>
<span class="c1">#</span>
<span class="c1">#</span>
<div class="viewcode-block" id="YinAndGrahamSoilModel.av_from_stress"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.YinAndGrahamSoilModel.av_from_stress">[docs]</a>    <span class="k">def</span> <span class="nf">av_from_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estress</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Slope of void ratio from effective stress</span>

<span class="sd">        When `estressdot` is provided as a kwarg then av is a true</span>
<span class="sd">        representation of de/destress at the current time (i.e. using the</span>
<span class="sd">        current value of self._igral). When `estressdot` is not provided then</span>
<span class="sd">        a conservative lower value of av based on self.kap and the current</span>
<span class="sd">        estress is calculated.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        estress : float</span>
<span class="sd">            Current effective stress.</span>
<span class="sd">        estressdot: float, optional</span>
<span class="sd">            Rate of change of effective stress w.r.t. time. Default</span>
<span class="sd">            estressdot=None i.e. av is calculated using self.kap and</span>
<span class="sd">            current effective stress.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        av : float</span>
<span class="sd">            Slope of void-ratio vs effective stress plot at current stress</span>
<span class="sd">            state, assuming psi=0.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; a = YinAndGrahamSoilModel(lam=0.2, kap=0.04, psi=0.01, siga=20,</span>
<span class="sd">        ... ea=1, ta=1, e0=0.90, estress0=18)</span>
<span class="sd">        &gt;&gt;&gt; a._igral=3.1 #artificially set igral. Usually calculted advancing through time using e_from_stress or stress_from_e</span>
<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=10)</span>
<span class="sd">        0.004</span>
<span class="sd">        &gt;&gt;&gt; a.av_from_stress(estress=40, estressdot=1.5)</span>
<span class="sd">        0.00417...</span>


<span class="sd">        #todo: write up av equations</span>




<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">estressdot</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;estressdot&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">estressdot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">av</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kap</span> <span class="o">/</span> <span class="n">estress</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">av</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kap</span> <span class="o">/</span> <span class="n">estress</span>
                  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">estressdot</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_igral</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                  <span class="o">*</span> <span class="p">(</span><span class="n">estress</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span><span class="p">)</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">av</span></div>

<div class="viewcode-block" id="YinAndGrahamSoilModel.CRSN"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.YinAndGrahamSoilModel.CRSN">[docs]</a>    <span class="k">def</span> <span class="nf">CRSN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tvals</span><span class="p">,</span> <span class="n">edot</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constant rate of strain simulation</span>

<span class="sd">        Note that the rate of chage of void ratio is specified.  Strain can be</span>
<span class="sd">        back caluclated using strain = (e0-e) / (1 + e0).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tvals : 1d array of float</span>
<span class="sd">            Time values for piecewise linear strain-rate vs time.</span>
<span class="sd">        edot : 1d array of float</span>
<span class="sd">            Time rate of change of void ratio corresponding to tvals. Note that</span>
<span class="sd">            you will need a negative edot for void ratio to decrease.  Be</span>
<span class="sd">            careful because strain in geotech is usually positive for a</span>
<span class="sd">            decrease in void ratio.</span>
<span class="sd">        method : [&#39;step&#39;, &#39;ode&#39;] optional</span>
<span class="sd">            Describes which method to use.  &#39;step&#39; will step through time</span>
<span class="sd">            using the stress_from_e function. &#39;odeint&#39; will reframe the</span>
<span class="sd">            constitutive model in terms of stress-rate and use odeint to</span>
<span class="sd">            solve  for effective stress. Both methods should produce the</span>
<span class="sd">            same results; the &#39;odeint&#39; method is really just a validity</span>
<span class="sd">            check of the the &#39;step&#39; method. Default method=&#39;step&#39;.</span>
<span class="sd">        **kwargs : various</span>
<span class="sd">            Arguments (other than method) will be passed to</span>
<span class="sd">            the subdivide_x_into_segments function.  If not given then the</span>
<span class="sd">            following values will be used, dx = (tvals[-1]-tvals[0])/200,</span>
<span class="sd">            min_segments=50. You may have to fiddle around with kwargs to</span>
<span class="sd">            get meaningful results; a small dx value will give good results</span>
<span class="sd">            but could take a long time to compute.</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tvals_ : 1d array of float</span>
<span class="sd">            Time values</span>
<span class="sd">        estress : 1d array of float</span>
<span class="sd">            Effective stress at tvals_.</span>
<span class="sd">        e : 1d array of float</span>
<span class="sd">            Void ratio at time tvals_.</span>
<span class="sd">        edot_ : 1d array of float.</span>
<span class="sd">            Time rate of change of void ratio at tvals_</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        geotecha.piecewise.piecewsie_linear_1d.subdivide_x_into_segments : used</span>
<span class="sd">            to determine time intervals.</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">igral0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_igral</span> <span class="c1"># remember _igral value before CRSN simulation</span>

        <span class="n">method</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">tvals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="o">-</span><span class="n">tvals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;min_segments&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_segments&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

        <span class="n">tvals_</span> <span class="o">=</span> <span class="n">pwise</span><span class="o">.</span><span class="n">subdivide_x_into_segments</span><span class="p">(</span><span class="n">tvals</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;odeint&quot;</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tt</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;Effective stress rate</span>

<span class="sd">                This is based on</span>

<span class="sd">                Parameters</span>
<span class="sd">                ----------</span>
<span class="sd">                x : float</span>
<span class="sd">                    Effective stress.</span>
<span class="sd">                tt : float</span>
<span class="sd">                    Time.</span>

<span class="sd">                Returns</span>
<span class="sd">                -------</span>
<span class="sd">                y : float</span>
<span class="sd">                    Effective stress rate.</span>


<span class="sd">                &quot;&quot;&quot;</span>

                <span class="n">erate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">tvals</span><span class="p">,</span> <span class="n">edot</span><span class="p">)</span>
                <span class="n">evalue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e0</span> <span class="o">+</span> <span class="n">pwise</span><span class="o">.</span><span class="n">integrate_x_y_between_xi_xj</span><span class="p">(</span><span class="n">tvals</span><span class="p">,</span> <span class="n">edot</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tt</span><span class="p">)</span>

                <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">kap</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="n">erate</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">ta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">evalue</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ea</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">)</span>
                    <span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">siga</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lam</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">)</span>
                    <span class="p">))</span>


            <span class="n">estress</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span><span class="p">,</span> <span class="n">tvals_</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">edot_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">tvals_</span><span class="p">,</span> <span class="n">tvals</span><span class="p">,</span> <span class="n">edot</span><span class="p">)</span>
            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e0</span> <span class="o">+</span> <span class="n">pwise</span><span class="o">.</span><span class="n">integrate_x_y_between_xi_xj</span><span class="p">(</span><span class="n">tvals</span><span class="p">,</span> <span class="n">edot</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tvals_</span><span class="p">),</span> <span class="n">tvals_</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tvals_</span><span class="p">)</span>
            <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e0</span>
            <span class="n">estress</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tvals_</span><span class="p">)</span>
            <span class="n">estress</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span>

            <span class="n">edot_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">tvals_</span><span class="p">,</span> <span class="n">tvals</span><span class="p">,</span> <span class="n">edot</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">tvals_</span><span class="p">)</span>

            <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">edot_</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dt_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
                <span class="n">estress</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stress_from_e</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt_</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_igral</span> <span class="o">=</span> <span class="n">igral0</span> <span class="c1"># reset _igral to value before CRSN</span>

        <span class="k">return</span> <span class="n">tvals_</span><span class="p">,</span> <span class="n">estress</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">edot_</span></div>


<div class="viewcode-block" id="YinAndGrahamSoilModel.CRSS"><a class="viewcode-back" href="../../../api/geotecha.constitutive_models.void_ratio_stress.html#geotecha.constitutive_models.void_ratio_stress.YinAndGrahamSoilModel.CRSS">[docs]</a>    <span class="k">def</span> <span class="nf">CRSS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tvals</span><span class="p">,</span> <span class="n">estressdot</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constant rate of stress simulation</span>

<span class="sd">        Note that the output is void ratio not strain.  Strain can be</span>
<span class="sd">        back caluclated using strain = (e0-e) / (1 + e0).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tvals : 1d array of float</span>
<span class="sd">            Time values for piecewise linear strain-rate vs time.</span>
<span class="sd">        estressdot : 1d array of float</span>
<span class="sd">            Time rate of change of effective stress corresponding</span>
<span class="sd">            to tvals.</span>
<span class="sd">        method : [&#39;step&#39;, &#39;ode&#39;] optional</span>
<span class="sd">            Describes which method to use.  &#39;step&#39; will step through time</span>
<span class="sd">            using the e_from_stress function. &#39;odeint&#39; will reframe the</span>
<span class="sd">            constitutive model in terms of strain-rate and use odeint to</span>
<span class="sd">            solve  for effective stress. Both methods should produce the</span>
<span class="sd">            same results; the &#39;odeint&#39; method is really just a validity</span>
<span class="sd">            check of the the &#39;step&#39; method. Default method=&#39;step&#39;.</span>
<span class="sd">        **kwargs : various</span>
<span class="sd">            Arguments (other than method) will be passed to</span>
<span class="sd">            the subdivide_x_into_segments function.  If not given then the</span>
<span class="sd">            following values will be used, dx = (tvals[-1]-tvals[0])/200,</span>
<span class="sd">            min_segments=50. You may have to fiddle around with kwargs to</span>
<span class="sd">            get meaningful results; a small dx value will give good results</span>
<span class="sd">            but could take a long time to compute.</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tvals_ : 1d array of float</span>
<span class="sd">            Time values</span>
<span class="sd">        estress : 1d array of float</span>
<span class="sd">            Effective stress at tvals_.</span>
<span class="sd">        e : 1d array of float</span>
<span class="sd">            Void ratio at time tvals_.</span>
<span class="sd">        estressdot_ : 1d array of float.</span>
<span class="sd">            Time rate of change of stress at tvals_</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        geotecha.piecewise.piecewsie_linear_1d.subdivide_x_into_segments : used</span>
<span class="sd">            to determine time intervals.</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">igral0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_igral</span> <span class="c1"># remember _igral value before CRSS simulation</span>

        <span class="n">method</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">tvals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="o">-</span><span class="n">tvals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;min_segments&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_segments&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

        <span class="n">tvals_</span> <span class="o">=</span> <span class="n">pwise</span><span class="o">.</span><span class="n">subdivide_x_into_segments</span><span class="p">(</span><span class="n">tvals</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;odeint&quot;</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tt</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;time rate of change in void ratio</span>

<span class="sd">                This is based on</span>

<span class="sd">                Parameters</span>
<span class="sd">                ----------</span>
<span class="sd">                x : float</span>
<span class="sd">                    void ratio.</span>
<span class="sd">                tt : float</span>
<span class="sd">                    Time.</span>

<span class="sd">                Returns</span>
<span class="sd">                -------</span>
<span class="sd">                y : float</span>
<span class="sd">                    Rate of void ratio change</span>


<span class="sd">                &quot;&quot;&quot;</span>

                <span class="n">estressrate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">tvals</span><span class="p">,</span> <span class="n">estressdot</span><span class="p">)</span>
                <span class="n">estressvalue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span> <span class="o">+</span> <span class="n">pwise</span><span class="o">.</span><span class="n">integrate_x_y_between_xi_xj</span><span class="p">(</span><span class="n">tvals</span><span class="p">,</span> <span class="n">estressdot</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tt</span><span class="p">)</span>

                <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">kap</span> <span class="o">*</span> <span class="n">estressrate</span><span class="o">/</span><span class="n">estressvalue</span>
                        <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">ta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ea</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">)</span>
                        <span class="o">*</span><span class="p">(</span><span class="n">estressvalue</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">siga</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lam</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">))</span>


            <span class="n">e</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e0</span><span class="p">,</span> <span class="n">tvals_</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">estressdot_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">tvals_</span><span class="p">,</span> <span class="n">tvals</span><span class="p">,</span> <span class="n">estressdot</span><span class="p">)</span>
            <span class="n">estress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span> <span class="o">+</span> <span class="n">pwise</span><span class="o">.</span><span class="n">integrate_x_y_between_xi_xj</span><span class="p">(</span><span class="n">tvals</span><span class="p">,</span> <span class="n">estressdot</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tvals_</span><span class="p">),</span> <span class="n">tvals_</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tvals_</span><span class="p">)</span>
            <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e0</span>
            <span class="n">estress</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tvals_</span><span class="p">)</span>
            <span class="n">estress</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estress0</span>

            <span class="n">estressdot_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">tvals_</span><span class="p">,</span> <span class="n">tvals</span><span class="p">,</span> <span class="n">estressdot</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">tvals_</span><span class="p">)</span>

            <span class="n">estress</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">estressdot_</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">estress</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">estress</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dt_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
                <span class="n">e</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e_from_stress</span><span class="p">(</span><span class="n">estress</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt_</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_igral</span> <span class="o">=</span> <span class="n">igral0</span> <span class="c1"># reset _igral to value before CRSS</span>

        <span class="k">return</span> <span class="n">tvals_</span><span class="p">,</span> <span class="n">estress</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">estressdot_</span></div></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="c1">#    print(CcCr_estress_from_e(2.95154499, 50, 3, 0.5, 10, 5))</span>
    <span class="kn">import</span> <span class="nn">nose</span>
    <span class="n">nose</span><span class="o">.</span><span class="n">runmodule</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nose&#39;</span><span class="p">,</span> <span class="s1">&#39;--verbosity=3&#39;</span><span class="p">,</span> <span class="s1">&#39;--with-doctest&#39;</span><span class="p">,</span> <span class="s1">&#39;--doctest-options=+ELLIPSIS&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
    <span class="c1">#    a = YinAndGraham(lam=0.2, kap=0.04, psi=0.001, siga=20, ea=1, ta=1,</span>
    <span class="c1">#                     e0=1.5)</span>

        <span class="n">fixed_param</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lam</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">kap</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">psi</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">siga</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ea</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">oparam</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">e0</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">estress0</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">oparam</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">e0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.95</span><span class="p">]),</span> <span class="n">estress0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">18</span><span class="p">]))</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">YinAndGrahamSoilModel</span><span class="p">(</span><span class="n">e0</span><span class="o">=</span><span class="n">oparam</span><span class="p">[</span><span class="s1">&#39;e0&#39;</span><span class="p">],</span> <span class="n">estress0</span><span class="o">=</span><span class="n">oparam</span><span class="p">[</span><span class="s1">&#39;estress0&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">fixed_param</span><span class="p">)</span>
        <span class="n">b</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">_psi_zero_model</span><span class="o">.</span><span class="n">plot_model</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">siga</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ea</span> <span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">estress0</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">e0</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">pstress0</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ea</span><span class="o">-</span><span class="n">a</span><span class="o">.</span><span class="n">lam</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">pstress0</span><span class="o">/</span><span class="n">a</span><span class="o">.</span><span class="n">siga</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1">#    print([a.e0, a.estress0, a.pstress0, a.t0])</span>
    <span class="c1">#    bb = a.stress_from_e(a.e0*0.9, dt=10000000)</span>
    <span class="c1">#    print(bb)</span>
    <span class="c1">#</span>
    <span class="c1">#    plt.gca().plot(bb, a.e0*.9, marker = &#39;h&#39;, ms=5)</span>
    <span class="c1">#    plt.show()</span>
    <span class="c1">#</span>
    <span class="c1">#    plt.show()</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">3000</span><span class="p">])</span>
        <span class="n">edot</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">])</span>

        <span class="n">tt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1001</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">])</span>
        <span class="n">edot</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">])</span>
    <span class="c1">#    kwargs = dict(logx=True, dx=0.01)</span>
        <span class="n">kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
        <span class="n">tvals</span><span class="p">,</span> <span class="n">estress</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">edot_</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">CRSN</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">edot</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;odeint&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">estress</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;odeint&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">tvals</span><span class="p">,</span> <span class="n">estress</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">edot_</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">CRSN</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">edot</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">estress</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">leg</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">leg</span><span class="o">.</span><span class="n">draggable</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2014, Rohan Walker.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>